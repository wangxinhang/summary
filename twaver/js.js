var box, home_box;
var network;
var autoLayouter;
var subAutoLayouter;
var overview;
var idfinder;
var namefinder;
var width;
var height;
var devDataList;
var symbolLocationMap = {};
var linkDataList;
var resizeTimer = null;
var rightPane;
var rsing_id, pro;
var tree;
var curr_city_aid = "0";
var overend = false;
var is_query_multi_hop = false;
var subAuto_list; //存储subNetWork 的node和list容器,每进一次地市，会清空重新加载
var whole_color = '#0d4981'; //全局背景色
 var tmplinkMap = new Map(); //全局link(优化骨干网/北京创建link慢的问题)

requirejs(["jquery", "jqueryUi", "bootstrap", "datatable", "datetime_zh"],
    function ($, jqueryUi, bootstrap, datatable, datetime_zh, twaver2) {
        $(document).ready(function () {
            var requ = getRequest();
            rsing_id = requ['rsing_id'];
            pro = requ['pro'];
            $(document).attr("title", pro + "省网络拓扑图")
            box = new ElementBox();
            home_box = new ElementBox();
            network = new twaver.vector.Network(box);
            autoLayouter = new twaver.layout.AutoLayouter(box);
            subAutoLayouter = new twaver.layout.AutoLayouter(box);
            overview = new twaver.vector.Overview(network); //鹰眼视图组件
            idfinder = new twaver.QuickFinder(box, "id"); //devid
            namefinder = new twaver.QuickFinder(box, "name"); //根据name查询
            popupMenu = new twaver.controls.PopupMenu(network); //右键菜单
            subAuto_list = new twaver.List();
            tree = new Tree(box);
            data = new twaver.Element();
            width = $(window).width();
            height = $(window).height();
            init();
        })
    })

function init() {
    $(".modal").draggable({
        handle: ".modal-header"
    });
    var toolbar = document.getElementById("toolbar");
    initToolbar(toolbar);
    windowResize();
    tick();
}

function tick() {
    var today;
    $.post("/rsing/topo/howAreYou", function (data) {
        console.log("AutoRefresh!")
    });
    window.setTimeout(function () {
        tick();
    }, 300000); //5分钟刷一次
}

function initDevNetTypeRole() {
    $.post("/rsing/topo/getDevNetTypeRole", function (data) {
        var net = data.net;
        var type = data.type;
        var role = data.role;
        for (var key in net) {
            netMap[key] = net[key]
        }
        for (var key in type) {
            typeMap[key] = type[key]
        }
        for (var key in role) {
            roleMap[key] = role[key]
        }
    });
}



var cityMap = { //处理直辖市
    "北京": 1101,
    "上海": 11022,
    "天津": 1105,
    "重庆": 1103
}

function windowResize() {
    var self = this;
    initHomeNetwork(); //
    $.ajaxSetup({
        async: false
    }); //ajax 同步
    initDevNetTypeRole();
    if (rsing_id == 99) {
        /*----------只有169拓扑有右键菜单-------------------*/
        // if(rsing_id==99){
        popupMenu.setWidth(140);
        popupMenu.setBackground(whole_color);
        popupMenu.setBorder("1px solid #56c5f1"); //#56c5f1
        popupMenu.setColor("#ffffff");
        popupMenu.setFocusBackground("#56c5f1");
        popupMenu.setFocusColor("#ffffff");
        popupMenu.setMenuItems([{
            label: '进入该节点视图',
            action: to169Html
        }]);
        // }
        /*-------------------------------------------*/
        init169DataBox();
    } else if (pro == "北京" || pro == "上海" || pro == "天津" || pro == "重庆") {
        if (pro == "北京") { //单独优化北京
            initSubDataBox_lazyLoading(null, false)
        } else {
            initSubDataBox(null, false)
        }
    } else if (rsing_id > 99 && rsing_id < 200) {
        initOtherHomeBox();
    } else {
        initHomeDataBox(); //加载首页数据 
    }
    network.setScrollBarVisible(false); //设置滚动条是否可见 
    //监听事件----点击显示设备信息 
    var resizeTimer = 0;
    network.addInteractionListener(function (e) {
        if (e.kind == 'clickBackground' || e.kind == 'enterSubNetwork' ||
            e.kind == 'liveMoveStart' || e.kind == 'liveMoveBetween') {
            $("#devdiv").hide();
            $("#ifinfo").hide();
            $("#ifbundle").hide();
        }
        if (e.kind == 'clickElement') {
            $("#ifinfo").hide();
            $("#devdiv").hide();
            $("#ifbundle").hide();
            if (resizeTimer) {
                clearTimeout(resizeTimer) //timeout 控制鼠标连带问题 
                resizeTimer = 0;
            }
            resizeTimer = setTimeout(function () {
                //timeout控制鼠标连带问题 
                //------------------------------------------------------------------------ 
                if (e.element.getClassName() == 'twaver.Node') {
                    var devinfo_node = e.element;
                    if (devinfo_node.getId() != 0 &&
                        devinfo_node.getToolTip() != null) {
                        //处理骨干网的 
                        var dialog = initDialog(devinfo_node);
                        var s = dialog.style;
                        s.left = (e.event.clientX - 0.15 * width) + 'px';
                        s.top = (e.event.clientY + 24) + 'px';
                    }
                } else if (e.element.getClassName() == 'twaver.Link') {
                    var tmp_link = e.element;
                    var expanded = tmp_link.getStyle('link.bundle.expanded');
                    //是否展开 
                    if (expanded || tmp_link.getBundleCount() == 1) {
                        //解决绑定线路为1的时候下不显示链路信息 
                        var dialog = ifDialog(tmp_link);
                        //获取接口性能数据 
                        var s = dialog.style;
                        s.display = 'block';
                        s.left = (e.event.clientX - 0.15 * width) + 'px';
                        s.top = e.event.clientY + 'px';
                    } else if (tmp_link.isBundleAgent()) {
                        var sum = 0;
                        var map_v4v6 = {};
                        var linklist = tmp_link.getBundleLinks().getLinks();
                        linklist.forEach(function (value) {
                            var ifspeed = value.getClient("ifspeed");
                            var alpha = value.getStyle('whole.alpha');
                            //TODO this
                            if (alpha == 1) {
                                //TODO this 
                                var type_name = value.getClient("type_name");
                                var ip_ver = value.getClient("ip_ver");
                                //IPv4v6 
                                var tmp_str = ipv4v6Map[ip_ver] + "_" +
                                    type_name;
                                if (map_v4v6[tmp_str] == null) {
                                    map_v4v6[tmp_str] = 1;
                                } else {
                                    map_v4v6[tmp_str] += 1;
                                }
                                sum += ifspeed;
                            }
                        })
                        var result = sum / 1000 / 1000 / 1000 + "G";
                        var dialog = ifbundleDialog(result, map_v4v6);
                        var s = dialog.style;
                        s.display = 'block';
                        s.left = (e.event.clientX - 0.15 * width) + 'px';
                        s.top = e.event.clientY + 'px';
                    }
                    // }
                } else if (e.element instanceof twaver.SubNetwork) {}
                //------------------------------------------------------------------------ 
            }, 200);
            //timeout 控制鼠标连带问题
        } else if (e.kind === 'doubleClickElement') {
            if (resizeTimer) {
                clearTimeout(resizeTimer);
                resizeTimer = 0;
            }
            if (e.element instanceof twaver.SubNetwork) {
                var subNetWork = currentSubnetwork = e.element;
                if (subNetWork.getChildrenSize() < 1) {
                    //initSubDataBox(subNetWork, false) //增加了承载AB网的城市子网 doubleClickSub(subNetWork)
                } else {
                    network.zoomOverview(true);
                }
            }
            if ((rsing_id == 99 || rsing_id == 19) && e.element instanceof twaver.Group && e.element
                .getClient("isLoading") == null && e.element.getParent() ==
                null) {
                if (rsing_id == 99) {
                    lazyLoading169(e.element);
                } else if (rsing_id == 19) {
                    lazyLoading_city(e.element);
                }
                e.element.setClient("isLoading", true)
            }
        } else if (e.kind === 'upSubNetwork') {
            if (is_query_multi_hop) {
                location.reload();
            } else {
                network.zoomOverview(true);
            }
        }
    });
    tree.addInteractionListener(function (evt) {
        var node = evt.data;
        if (evt.kind == 'click') { //单击 
            if (node.getClassName() == 'twaver.SubNetwork') {
                if (node.getChildrenSize() < 1) { // 
                    initSubDataBox(node, false);
                    doubleClickSub(subNetWork)
                } else {
                    network.zoomOverview(true);
                }
            } else if (node.getClassName() == 'twaver.Group') {
                network.zoomOverview(true);
            }
        } else if (evt.kind == 'collapse') { //合并 
            if (node.getClassName() == 'twaver.SubNetwork') {
                if (is_query_multi_hop) {
                    location.reload();
                } else {
                    network.upSubNetwork(true);
                }
            } else if (node.getClassName() == 'twaver.Group') {
                node.setExpanded(false);
            }
            network.zoomOverview(true);
        }
    });
    tree.setVisibleFunction(function (element) {
        return element instanceof twaver.Node;
    });
    tree.getIcon = function (element) {
        return null;
    };
    //选中颜色变化功能
    network.getSelectionModel().addSelectionChangeListener(function (e) {
        e.datas.forEach(function (element) {
            if (self.box.getSelectionModel().contains(element)) {
                element.setStyle('body.type', 'default.vector');
                element.setStyle('select.color', '#ffffff'); //选中模型边框颜色 
                element.setStyle('vector.fill.color', '#185d9e'); //选中模型背景颜色
            } else {
                element.setStyle('body.type', 'default');
            }
        }, this);
    }, this);
    //------------------------------------------------------------------------- 
    //设置链路聚合显示链路条数
    network.getLinkHandlerLabel = function (link) { //一大堆的条件过滤就是为了减少遍历和计算
        if (!overend) return null;
        var currSub = network.getCurrentSubNetwork();
        if (currSub != null && !link.isDescendantOf(currSub)) return null;
        if (currSub == null || link.isBundleAgent()) {
            var expanded = link.getStyle('link.bundle.expanded'); //是否展开 
            if (expanded || link.getBundleLinks() == null) {
                //展开或展开只有自己一条link 
                return link.getClient("ifspeed") / 1000 / 1000 / 1000;
            }
            var sum = 0;
            var agentFlag = false;
            var agentLink = null;
            var linkGouplist = link.getBundleLinks().getLinks();
            linkGouplist.forEach(function (value) {
                var ifspeed = value.getClient("ifspeed");
                var
                    alpha = value.getStyle(
                        'whole.alpha'
                    ); //TODO this 
                if (alpha == 1) {
                    //TODO this 
                    sum += ifspeed;
                    if (!agentFlag) {
                        agentFlag = true;
                        agentLink = value;
                    }
                }
                //TODO this 
            })
            return sum / 1000 / 1000 / 1000;
        } else if (!link.isBundleAgent()) {
            return link.getClient("ifspeed") / 1000 / 1000 / 1000;
        } else {
            return null;
        }
        return null;
    }; //------------------------------------------------------------------------- //解决点击网元，显示的div使网元无法拖动的情况
    network.getView().addEventListener('mouseup', function (e) {
        var element = network.getElementAt(e);
        if (element != null &&
            element.getClassName() == 'twaver.Node') {
            setTimeout(function () {
                if (element.getId() != 0 && element.getToolTip() != null) {
                    $("#devdiv").show();
                }
            }, 200) //延迟0.2秒显示 
        }
    });
    //------------------------------------------------------------------------- 
}
//创建工具栏 
function initToolbar(div) {
    var b1 = addButton2(div, "拓扑说明", "", function () {
        $("#waringinfo").modal("show");
    });
    b1.innerHTML = "<span class='glyphicon glyphicon-pushpin' aria-hidden='true'></span>"
    addButton(div, "放大", false, function () {
        network.zoomIn();
    });
    addButton(div, '缩小', false, function () {
        network.zoomOut();
    });
    addButton(div, '显示全部', false, function () {
        network.zoomOverview();
    });
    addButton(div, '显示默认', false, function () {
        network.setZoom(1);
    });
    addButton(div, '自动布局', false, function () { //只布局当前页面的拓扑位置 var
        currSub = network.getCurrentSubNetwork();
        if (rsing_id >= 99 || (cityMap[pro] != null)) {
            autoLayouter.setRepulsion(2)
            autoLayouter.doLayout('symmetry', function () {
                network.zoomOverview(true);
            });
        } else if (currSub != null) {
            subAutoLayouter.getElements = function () {
                return subAuto_list;
            };
            subAutoLayouter.setRepulsion(2);
            subAutoLayouter.setAnimate(false);
            var aaaaaa = subAutoLayouter.doLayout('symmetry', function () {
                network.zoomOverview(true);
            });
        } else {
            alert("不支持该视图自动布局");
        }

    });
    addButton(div, '保存当前位置', false, function () {
        savelocation();
    });
    //峰值利用率(北京和骨干网去掉该功能,有懒加载的无法使用该功能,虚拟链路没有带宽利用率)
    if (!(rsing_id == 99 || rsing_id == 19))
        addSelect(div, 'select_up_div');
    if (rsing_id < 99) {
        //骨干网和承载网去掉概览 
        addButton(div, '概览', false, function () {
            analysis_ipv4v6('4');
        }); //一跳多跳按钮
        addSelect(div, 'topo_multi_hop');
    }
    //ipv4v6切换按钮
    addSelect(div, 'select_ipv4v6');
    addButton(div, '返回上级视图', false, function () {
        if (network.getCurrentSubNetwork() == null) {
            alert("当前已是最顶层视图")
        } else {
            if (is_query_multi_hop) {
                location.reload();
            } else {
                network.upSubNetwork(true);
                network.zoomOverview(true);
            }
        }
    });
    addButton(div, '刷新', false, function () {
        location.reload();
    });
}

function select(s, e, type) {
    s = s * 1;
    e = e * 1;
    var currSub = network.getCurrentSubNetwork();
    if (currSub != null) {
        var chilList = currSub.getChildren();
        chilList.forEach(function (link) {
            if (link.getClassName() == 'twaver.Link') {
                var send = link.getClient("send_rate") * 1;
                var rec = link.getClient("rec_rate") * 1;
                var flag = false;
                if ('all' == type) {
                    if ((send >= s && send < e) || (rec >= s && rec < e))
                        flag = true;
                } else if ('up' == type) {
                    if (send >= s && send < e) flag = true;
                } else if ('down' == type) {
                    if (rec >= s &&
                        rec < e) flag = true;
                }
                if (flag) {
                    link.setStyle('whole.alpha', 1);
                } else {
                    link.setStyle('whole.alpha', 0.2);
                }
            }
        });
    } else {
        //说明是首页 
        box.forEach(function (ele) {
            //China 169 骨干网 省网核心
            var filter = ele.getClassName() ==
                'twaver.Link' //&& ele.getToNode().getParent().getClassName() == 'twaver.Group';
            if (filter) {
                var send = ele.getClient("send_rate") * 1;
                var rec = ele.getClient("rec_rate") * 1;
                var flag = false;
                if ('all' == type) {
                    if ((send >= s && send < e) || (rec >= s && rec < e)) flag = true;
                } else if ('up' == type) {
                    if (send >= s && send < e) flag = true;
                } else if ('down' == type) {
                    if (rec >= s && rec < e) flag = true;
                }
                if (flag) {
                    ele.setStyle('whole.alpha', 1);
                } else {
                    ele.setStyle('whole.alpha', 0.2);
                }
            }
        })
    }
}

function selectv4v6(args1, args2) {
    box.forEach(function (ele) {
        var filter = ele.getClassName() ==
            'twaver.Link' //&&ele.getToNode().getParent().getClassName() == 'twaver.Group';
        if (filter) {
            var ip_ver = ele.getClient("ip_ver");
            var flag = false;
            if ('all' == args1) {
                flag = true;
            } else if (args1 == ip_ver || args2 == ip_ver) {
                flag = true;
            }
            if (flag) {
                ele.setStyle('whole.alpha', 1);
            } else {
                ele.setStyle('whole.alpha', 0.2);
            }
        }
    })
}

function reLoadTopo(type) {
    var currSub = network.getCurrentSubNetwork();
    if (currSub == null) {
        if (type == "1") {
            if ( /*pro=="北京" ||*/ pro == "上海" || pro == "天津" || pro == "重庆") { //单独处理直辖市默认 
                box.clear();
                initSubDataBox(null, false);
            } else {
                network.zoomOverview();
            }
        } else {
            if ( /*pro=="北京" ||*/ pro == "上海" || pro == "天津" ||
                pro == "重庆") { //单独处理直辖市的多跳 
                initSubDataBox(null, true);
            } else {
                alert("由于全省设备较多,仅支持地市视图查看多跳拓扑");
            }
        }
    } else {
        if (type == "1") {
            box.clear();
            copyDataFrom1To2(home_box, box);
            var
                tmp_subNet = idfinder.findFirst(curr_city_aid);
            initSubDataBox(tmp_subNet, false)
            network.setCurrentSubNetwork(tmp_subNet);
        } else {
            is_query_multi_hop = true;
            var tmp_subNet = idfinder.findFirst("multi_hop" + curr_city_aid);
            if (tmp_subNet == null) {
                tmp_subNet = new twaver.SubNetwork("multi_hop" + curr_city_aid);
                tmp_subNet.setToolTip(currSub.getToolTip());
                tmp_subNet.setName(currSub.getName());
                tmp_subNet.setStyle('icons.names', 'Text');
                tmp_subNet.setStyle('background.type', 'vector');
                tmp_subNet.setStyle('background.vector.fill', true); //
                tmp_subNet.setStyle('background.vector.fill.color', "#73b9fd");
                tmp_subNet.setStyle('background.vector.fill.color', whole_color);
                tmp_subNet.setStyle('whole.alpha', 0);
                //这个子网不需要展示只是用来切换一跳多跳的 
                box.add(tmp_subNet);
            }
            initSubDataBox(tmp_subNet, true);
            network.setCurrentSubNetwork(tmp_subNet);
        }
    }
}
//这个是统计流量的 
function analysis_ipv4v6(ip_ver) {
    var currSub = network.getCurrentSubNetwork();
    var currCityN = "";
    var currCityId = "";
    var v4v6 = "";
    if (ip_ver == "-1") {
        v4v6 = " IPv4/IPv6"
        $("#btn_ipv4v6").removeClass();
        $("#btn_ipv4v6").addClass("btn_style btnall")
    } else if (ip_ver == '4') {
        v4v6 = " IPv4"
        $("#btn_ipv4v6").removeClass();
        $("#btn_ipv4v6").addClass("btn_style btn4")
    }
    if (ip_ver == '6') {
        v4v6 = " IPv6"
        $("#btn_ipv4v6").removeClass();
        $("#btn_ipv4v6").addClass("btn_style btn6")
    }
    var span1 = "<span style='color:#9fedec'>" + v4v6 + " </span>"
    if (currSub != null) {
        currCityN = currSub.getName();
        currCityId = (currSub.getId() + "").replace("multi_hop", "");
        $("#analysisTitle").html(currCityN + "带宽流量利用率" + span1);
    } else {
        $("#analysisTitle").html(pro + "带宽流量利用率" + span1);
    }
    var analysisTable = document.getElementById('analysisTable');
    drawAnalysisTableV4V6(analysisTable, currCityN, currCityId, currSub, ip_ver);
    $("#analysisView").modal("show");
}
//首页布局 
function initHomeNetwork() {
    network.setZoomManager(new twaver.vector.LogicalZoomManager(network)); //混合缩放视图,使得图标不缩放，只缩放距离 //设置背景颜色
    box.setStyle('background.type', 'vector');
    box.setStyle('background.vector.fill', true);
    box.setStyle('background.vector.fill.color', whole_color); //"#99CCFF"
    network.setToolTipEnabled(false); //设置tooltip显示
    network.adjustBounds({
        width: width * 0.85 * 2,
        height: height * 2
    });
    //注册图标
    registerImage("../resource/img/rsing/topoimages/169ggw.png", network);
    registerImage("../resource/img/rsing/topoimages/sw.png", network);
    registerImage("../resource/img/rsing/topoimages/CR.png", network);
    registerImage("../resource/img/rsing/topoimages/CR-group.png", network);
    registerImage("../resource/img/rsing/topoimages/SR.png", network);
    registerImage("../resource/img/rsing/topoimages/SR-group.png", network);
    registerImage("../resource/img/rsing/topoimages/idccloud-gray.png", network);
    registerImage("../resource/img/rsing/topoimages/cdncloud-gray.png", network);
    registerImage("../resource/img/rsing/topoimages/mobcloud-gray.png", network);
    registerImage("../resource/img/rsing/topoimages/treeC.png", network);
    registerImage("../resource/img/rsing/topoimages/treeE.png", network);
    registerImage("../resource/img/rsing/topoimages/169group.png", network);
    //插入图例-----------------------------------------
    var legend = document.createElement('div');
    var analysisView = document.getElementById('analysisView');
    var waringinfo = document.getElementById('waringinfo');
    rightPane = new twaver.controls.BorderPane(network);
    demo.Util.appendChild(analysisView, rightPane.getView(), null, null, null, null); //top, right, bottom, left
    demo.Util.appendChild(waringinfo, rightPane.getView(), 200, 50, null, 50); //top,right, bottom,left 
    //----------------------------------------------------------------------- 
    //-------调整tree的整体样式----------------------------------------------------------
    var treeview = tree.getView();
    treeview.setAttribute("style",
        "background:#282d33;color:#ffffff; " //#dbdada;设置tree的背景色和字体颜色 font-family:'微软雅黑';
        +
        "font-size:13px;padding-top:10px;overflow: auto;"); //overflow是滚动条
    tree.setExpandIcon("treeE"); //合并图标
    tree.setCollapseIcon("treeC"); //展开图标 
    var treePane = new twaver.controls.BorderPane(tree);
    treePane.setTopHeight(10);
    var leftSplit = new twaver.controls.SplitPane(treePane, legend, 'vertical', 1);
    //-------调整tree的整体样式----------------------------------------------------------
    demo.Util.appendChild(document.getElementById('toolbar'), rightPane.getView(), 0, null, null, 0);
    var mainSplit = new twaver.controls.SplitPane(leftSplit, rightPane, 'horizontal', 0.13);
    demo.Util.appendChild(mainSplit.getView(), document.body, 0, 0, 0, 0);
    initPane(leftSplit);
    initPane(mainSplit); //----------鹰眼(OverView)
    overview.setOutlineColor("#020202"); //边框线颜色
    overview.setOutlineWidth(1.3); //边框线宽度
    demo.Util.appendChild(overview.getView(), rightPane.getView(), 0, 0, null, null);
    var owidth = width * 0.85 * 0.2;
    var oheight = height * 0.2; //其实overview内的canvas是自动调整的,这个只是设置了边界
    overview.adjustBounds({
        width: owidth,
        height: oheight
    });
}
//加载数据 
function initHomeDataBox() {
    $.ajaxSetup({
        async: false
    }); //ajax同步-- -- - 这是一个全局的 //绘制时每次需要清空box 
    var city_map = new Map(); //
    {
        dev_id + "_home": city
    }
    box.clear();
    var autoflag = true; //自动布局标识 //加载位置信息 var
    loc_url = "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id + "&type=0";
    $.post(loc_url, function (data) {
        symbolLocationMap = data;
    }) var
        url = "/rsing/topo/getTopoData.do?1=1&rsing_id=" + rsing_id;
    $.post(url, function (data) {
        devDataList = data.devDataList;
        if (devDataList.length >
            0) {
            $.each(devDataList, function (n, value) {
                var id = value.dev_id;
                var name = value.symbol_name;
                var image = "CR-group";
                city_map.set(id + "_home", value.city_aid);
                if (value.dev_net == 4) {
                    var group169 = idfinder.findFirst(0);
                    if (group169 == null) group169 = creatGroup(0, "China 169骨干网",
                        "169ggw");
                    var tmpnode = creatNode("169_" + name, name, "CR", value);
                    group169.addChild(tmpnode);
                    if (autoflag && group169.getClient("flag") && tmpnode.getClient(
                            "flag")) {
                        autoflag = false;
                    }

                } else if (value.dev_net == 1 && value.dev_type == 1 && value.dev_role ==
                    3) {
                    var sw_g = idfinder.findFirst("省网");
                    if (sw_g == null) sw_g = creatGroup("省网", "省网核心", "sw");
                    var tmpnode = creatNode(id + "_home", name, "CR", value);
                    if (autoflag && sw_g.getClient("flag") && tmpnode.getClient("flag")) {
                        //位置表有位置，不会触发自动布局
                        autoflag = false;
                    }
                    sw_g.addChild(tmpnode);
                } else if (value.dev_net == 1 && value.dev_type == 1 && value.dev_role !=
                    3) {
                    var city_name = value.city
                    var city_sub = idfinder.findFirst(value.city_aid);
                    if (city_sub == null) {
                        city_sub = createSubnetwork(value.city_aid, city_name, image,
                            value);
                        if (autoflag && city_sub.getClient("flag")) {
                            autoflag = false;
                        }
                    } else {
                        var tmp_devid = city_sub.getToolTip();
                        city_sub.setToolTip(tmp_devid + "," + value.dev_id);
                    }
                }
            })
        }

        //链路信息linkDataList
        linkDataList = data.linkDataList;
        $.each(linkDataList, function (n, value) {
            var fromNode = null;
            var toNode = null;
            //查找连接点
            var fromId = value.a_dev_id + "_home";
            var toId = value.z_dev_id + "_home";
            if (value.z_dev_net == 4) {
                toNode = idfinder.findFirst("169_" + value.z_dev_name); //找骨干
            } else if (value.z_dev_net == 1 && value.z_dev_type == 1 && value.z_dev_role ==
                3) {
                toNode = idfinder.findFirst(toId); //找省网
            }
            if (toNode == null) {
                var city_aid = city_map.get(toId); //找地市节点------------------
                if (city_aid != null) toNode = idfinder.findFirst(city_aid);
            }
            fromNode = idfinder.findFirst(fromId); //找省网
            if (fromNode == null) {
                var city_aid = city_map.get(fromId); //找地市节点----------
                if (city_aid != null) fromNode = idfinder.findFirst(city_aid);
            }
            if (fromNode != null && toNode != null && fromNode != toNode) {
                var link_id = "pro-" + rsing_id + "-" + value.a_dev_id + "-" + value
                    .a_ifindex;
                var link = idfinder.findFirst(link_id);
                if (link == null) {
                    link = creatLink(link_id, fromNode, toNode, value);
                }
            }
        });

    });

    //自动布局 ----围绕布局round 对称布局(symmetry)
    //上下topbottom 下上布局(bottomtop) 左右布局(leftright)左右布局(leftright)分层布局(hierarchic)
    if (autoflag) {
        autoLayouter.setRepulsion(2)
        autoLayouter.doLayout('symmetry', function () {
            network.zoomOverview(true);
        });
    } else {
        network.addViewListener(callback);
    }
    copyDataFrom1To2(box, home_box); //备份home数据
    $("#loading").hide();
}

function copyDataFrom1To2(box1, box2) {
    box1.forEach(function (ele) {
        // if(ele.getId!='default') 这个是操作laylerbox时的条件
        box2.add(ele);
    });
}

//骨干网链路太多，做了“伪懒加载",主要是懒加载创建链路的操作，配合lazyLoading169方法使用
function init169DataBox() {
    $.ajaxSetup({
        async: false
    }); //ajax 同步-----这是一个全局的
    box.clear();
    var autoflag = true; //自动布局标识
    //加载位置信息
    var inte_set = new Set();
    var loc_url = "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id + "&type=0";
    $.post(loc_url, function (data) {
        symbolLocationMap = data;
    })
    var internation = createSubnetwork("169海外", "海外节点", "169group", null); //国际子图
    var url = "/rsing/topo/get169TopoData.do?1=1&rsing_id=" + rsing_id;
    var flag_loc = "_169_home";
    if (rsing_id > 99) flag_loc = "169other_" + rsing_id;
    $.post(url, function (data) {
        devDataList = data.devDataList;
        if (devDataList.length > 0) {
            $.each(devDataList, function (n, value) {
                var id = value.dev_id;
                var name = value.symbol_name;
                var area = value.area;
                var pro = value.pro;
                var city = value.city;

                var tmpnode = creatNode(id + flag_loc, name, "CR", value);
                if (area == "海外节点") {
                    tmpnode.setName(city);
                    internation.addChild(tmpnode);
                    inte_set.add(id);
                } else {
                    var area_group = creat169Group("a_" + area, area, "169group");
                    var
                        group = creat169Group(rsing_id + "_" + pro + "_" + value.dev_type, pro +
                            "_" + typeMap[value.dev_type], "CR-group");
                    group.addChild(tmpnode);
                    area_group.addChild(group);
                }

                if (area == "国际出口") {
                    var area_group = creat169Group("a_" + area + "_bak", area, "169group");
                    var tmpnode2 = creatNode(id + flag_loc + "_bak", pro, "CR", value);
                    area_group.addChild(tmpnode2);
                    internation.addChild(area_group);
                    inte_set.add(id);
                }

                if (autoflag && (tmpnode.getClient("flag"))) {
                    //位置表有位置，不会触发自动布局
                    autoflag = false;
                }

            })
        }

        //链路信息linkDataList
        linkDataList = data.linkDataList;
        $.each(linkDataList, function (n, value) {
            var fromNode = null;
            var toNode = null;
            //查找连接点
            var fromId = value.a_dev_id + flag_loc;
            var toId = value.z_dev_id + flag_loc;
            toNode = idfinder.findFirst(toId);
            fromNode = idfinder.findFirst(fromId);

            if (fromNode != null && toNode != null && fromNode != toNode) {
                var fa = fromNode.getParent().getParent();
                var ta = toNode.getParent().getParent();
                if (fa != null && ta != null) {
                    var ifspeed_aa = value.ifspeed;
                    var link_s = tmplinkMap.get(fa.getId() + "$" + ta.getId())
                    if (link_s == null) link_s = 0;
                    tmplinkMap.set(fa.getId() + "$" + ta.getId(), link_s + ifspeed_aa);
                }

            }

            if (fromNode != null && toNode != null && fromNode != toNode &&
                (fromNode.getParent() == internation || toNode.getParent() == internation)) {
                //海外节点和国际出口之间的线
                var link_id = "pro-" + rsing_id + "-" + value.a_dev_id + "-" + value.a_ifindex;
                var link = creatLink(link_id, fromNode, toNode, value);
            }
            //下面是处理副本的(海外节点subnetwork内的节点)
            if (inte_set.has(value.a_dev_id) && inte_set.has(value.z_dev_id)) {
                toNode = idfinder.findFirst(toId + "_bak"); //海外子网有一份国际接口副本
                fromNode = idfinder.findFirst(fromId + "_bak"); //海外子网有一份国际接口副本
                if (toNode == null) toNode = idfinder.findFirst(toId);
                if (fromNode == null) fromNode = idfinder.findFirst(fromId);
                if (fromNode != null && toNode != null && fromNode != toNode) {
                    var link_id = "pro-" + rsing_id + "-" + value.a_dev_id + "-" + value
                        .a_ifindex + "_bak";
                    var link = creatLink(link_id, fromNode, toNode, value);
                    internation.addChild(link);
                }
            }
        });
        for (var t_link of tmplinkMap) { // 遍历Array创建聚合后的链路
            var tmp_strs = t_link[0].split("$")
            var to_g = idfinder.findFirst(tmp_strs[1]);
            var from_g = idfinder.findFirst(tmp_strs[0]);
            if (from_g != null && to_g != null && from_g != to_g) {
                var link = creatLink("169_" + t_link[0], from_g, to_g, null);
                link.setClient("ifspeed", t_link[1]);
            }
        }
    });

    //自动布局 ----围绕布局round 对称布局(symmetry)
    //上下topbottom 下上布局(bottomtop) 左右布局(leftright)左右布局(leftright)分层布局(hierarchic)
    if (autoflag) {
        autoLayouter.setRepulsion(2)
        autoLayouter.doLayout('symmetry', function () {
            network.zoomOverview(true);
        });
    } else {
        network.addViewListener(callback);
    }
    $("#loading").hide();
}

/**
 * 大概流程: 加载慢主要是应为创建链路比较占用资源，所以优化的主要任务就避免首次加载所有链路
 * [ps:目前来看1300多条链路基本没有压力,2500多条链路需要16秒左右，4800多条链路需要47秒]
 * 1.init169DataBox函数执行后只会创建几条链路
 * 2.点击每个分组时，会将虚拟链路删除重新创建(不是node-node的链路都是虚拟的链路)
 * 3.只要是已经创建node-node的链路，就不会再加载，反之node-group，group-group的链路每次都会删掉重新创建
 * 虚拟链路保存在tmplinkMap这个全局变量中，每次都会从box中删除/创建
 * @param group_obj 当前双击要展开组的对象
 */
function lazyLoading169(group_obj) {
    $.ajaxSetup({
        async: false
    }); //ajax 同步-----这是一个全局的
    //加载位置信息
    var inte_set = new Set();
    for (var t_link of tmplinkMap) {
        box.removeById("169_" + t_link[0])
    }

    tmplinkMap.clear();
    var internation = box.getDataById("169海外"); //国际子图
    var url = "/rsing/topo/get169TopoData.do?1=1&rsing_id=" + rsing_id;
    var flag_loc = "_169_home";
    if (rsing_id > 99) flag_loc = "169other_" + rsing_id;
    $.post(url, function (data) {
        //链路信息linkDataList
        linkDataList = data.linkDataList;
        $.each(linkDataList, function (n, value) { //start:1.遍历链路根据
            group的属性isLoading和node的情况判断是需要创建虚拟链路还是真实链路
            var fromNode = null;
            var toNode = null;
            //查找连接点
            var fromId = value.a_dev_id + flag_loc;
            var toId = value.z_dev_id + flag_loc;

            toNode = idfinder.findFirst(toId);
            fromNode = idfinder.findFirst(fromId);
            if (fromNode != null && toNode != null && fromNode != toNode) {
                var fa = fromNode.getParent().getParent();
                var ta = toNode.getParent().getParent();
                if (fa != null && ta != null) {
                    var flag_fa = fa.getClient("isLoading");
                    var flag_ta = ta.getClient("isLoading");
                    var fa_g_name = fa.getName();
                    var ta_g_name = ta.getName();

                    if (flag_fa && flag_ta) { //2.本端的group和对端group都展开过了
                        //Do Nothing
                    } else if (flag_fa == null && flag_ta == null) { //3.本端group和对端group都没有展开过
                        var node_id = "";
                        var group_id = "";
                        if (group_obj.getName() == fa_g_name && group_obj.getName() ==
                            ta_g_name) {
                            //3.1都是本组node 直接建实际链路
                            var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" + value
                                .a_ifindex;
                            var link = creatLink(link_id, fromNode, toNode, value);
                        } else { //3.2 组内node和其他group
                            if (group_obj.getName() == fa_g_name) { //3.2.1 判断谁是node,谁是group
                                node_id = fromNode.getId();
                                group_id = ta.getId();
                            } else if (group_obj.getName() ==
                                ta_g_name) { //3.2.2 判断谁是node,谁是group
                                node_id = toNode.getId();
                                group_id = fa.getId();
                            } else { //3.2.3 2个都是group
                                node_id = ta.getId();
                                group_id = fa.getId();
                            }
                            var ifspeed_aa = value.ifspeed;
                            var link_s = tmplinkMap.get(node_id + "$" + group_id)
                            if (link_s == null) link_s = 0;
                            tmplinkMap.set(node_id + "$" + group_id, link_s + ifspeed_aa);
                        }

                    } else if (flag_fa == null || flag_ta ==
                        null) { //4.一个group开过,另一个group没有展开过,分3种情况
                        var node_id = "";
                        var group_id = "";
                        if (group_obj.getName() == fa_g_name) { //4.1 展开过的是当前选中的group
                            if (flag_fa) { //展开过的是本端
                                //DO Nothing
                            } else { //展开过的是对端
                                var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" +
                                    value.a_ifindex;
                                var link = creatLink(link_id, fromNode, toNode, value);
                            }
                        } else if (group_obj.getName() == ta_g_name) { //4.2 展开过的是选中group的对端
                            if (flag_ta) { //展开过的是对端
                                //DO Nothing
                            } else { //展开过的是本端
                                var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" +
                                    value.a_ifindex;
                                var link = creatLink(link_id, fromNode, toNode, value);
                            }
                        } else { // 4.3展开的不是选中的也不是对端
                            if (flag_fa) {
                                node_id = fromNode.getId();
                                group_id = ta.getId();
                            } else {
                                node_id = toNode.getId();
                                group_id = fa.getId();
                            }
                            var ifspeed_aa = value.ifspeed;
                            var link_s = tmplinkMap.get(node_id + "$" + group_id)
                            if (link_s == null) link_s = 0;
                            tmplinkMap.set(node_id + "$" + group_id, link_s + ifspeed_aa);
                        }
                    }
                }

            }

        });
        for (var t_link of tmplinkMap) { // 遍历Array
            var tmp_strs = t_link[0].split("$")
            var to_g = idfinder.findFirst(tmp_strs[1]);
            var from_g = idfinder.findFirst(tmp_strs[0]);
            if (from_g != null && to_g != null && from_g != to_g) {
                var link = creatLink("169_" + t_link[0], from_g, to_g, null);
                link.setClient("ifspeed", t_link[1]);
            }
        }
    });
    network.addViewListener(callback);
}

//专门为北京这种链路太多的城市做的优化,配合initSubDataBox_lazyLoading方法使用
function lazyLoading_city(group_obj) {
    if (group_obj == null) $.ajaxSetup({
        async: false
    }); //ajax 同步 这个是直辖市的特殊处理
    twaver.Defaults.LINK_BUNDLE_AGENT_FUNCTION = null;
    var autoflag = true; //自动布局标识
    var flag = 0; //判断结点初始化是否有坐标 决定用不用自动布局
    var city_id = cityMap[pro];
    city_id = (city_id + "").replace("multi_hop", "");
    var cr_devid = group_obj == null ? pro : group_obj.getToolTip();

    var tmp_url =
        "/rsing/topo/getSubTopoData.do?1=1&city_id=" + city_id + "&rsing_id=" + rsing_id;
    var url = tmp_url + "&multi_hop_flag=1";
    var city_name = group_obj == null ? pro : group_obj.getName();

    var inte_set = new Set();
    for (var t_link of tmplinkMap) {
        box.removeById("sub_" + t_link[0])
    }
    tmplinkMap.clear();
    $.post(url, function (data) {
        //链路信息linkDataList
        linkDataList = data.linkDataList;
        $.each(linkDataList, function (n, value) { //start:1.遍历链路根据
            group的属性isLoading和node的情况判断是需要创建虚拟链路还是真实链路
            var fromNode = null;
            var toNode = null;
            //1.找fromnode 和tonode
            var fromId = city_id + "_" + value.a_dev_id;
            fromNode = idfinder.findFirst(fromId);
            //处理普通设备节点
            if (value.z_dev_id != 0 && value.z_dev_net == 1 && value.z_dev_type != -1) {
                //查找连接点
                var toId = city_id + "_" + value.z_dev_id;
                toNode = idfinder.findFirst(toId);
                //role=4和role=7 devid=0的 为idc网络和cdn网络设备(只有设备名称没有其他信息) 需要单独处理
            } else if (value.z_dev_net == 2 || value.z_dev_net == 3 || value.z_dev_net == 6) {
                var toId =
                    city_id + "_" + (value.z_dev_id == 0 ? value.z_dev_name : value
                        .z_dev_id); //有的idc或cdn没有id只有设备名称
                toNode = idfinder.findFirst(toId);
                /*var
                g_image=getGroupImageFormDev(value.z_dev_net,value.z_dev_type,value.z_dev_role);
                var group_id=city_id+"_"+cr_devid+"_"+value.z_dev_net
                var group=idfinder.findFirst(group_id)*/

                //处理骨干网
            } else if (value.z_dev_net == 4) { //处理169骨干网
                toNode = idfinder.findFirst(city_id + "_" + value.z_dev_name); //找169骨干网
            }
            //2.划线逻辑
            if (fromNode != null && toNode != null && fromNode != toNode) {
                var fa = fromNode.getParent();
                var ta = toNode.getParent();
                if (fa != null && ta != null) {
                    var flag_fa = fa.getClient("isLoading");
                    var flag_ta = ta.getClient("isLoading");
                    var fa_g_name = fa.getName();
                    var ta_g_name = ta.getName();

                    if (flag_fa && flag_ta) { //2.本端的group和对端group都展开过了
                        //Do Nothing
                    } else if (flag_fa == null && flag_ta == null) { //3.本端group和对端group都没有展开过
                        var node_id = "";
                        var group_id = "";
                        if (group_obj.getName() == fa_g_name && group_obj.getName() ==
                            ta_g_name) {
                            //3.1都是本组node 直接建实际链路
                            var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" + value
                                .a_ifindex;
                            var link = creatLink(link_id, fromNode, toNode, value);
                        } else { //3.2 组内node和其他group
                            if (group_obj.getName() == fa_g_name) { //3.2.1 判断谁是node,谁是group
                                node_id = fromNode.getId();
                                group_id = ta.getId();
                            } else if (group_obj.getName() ==
                                ta_g_name) { //3.2.2 判断谁是node,谁是group
                                node_id = toNode.getId();
                                group_id = fa.getId();
                            } else { //3.2.3 2个都是group
                                node_id = ta.getId();
                                group_id = fa.getId();
                            }
                            var ifspeed_aa = value.ifspeed;
                            var link_s = tmplinkMap.get(node_id + "$" + group_id)
                            if (link_s == null) link_s = 0;
                            tmplinkMap.set(node_id + "$" + group_id, link_s + ifspeed_aa);
                        }

                    } else if (flag_fa == null || flag_ta ==
                        null) { //4.一个group开过,另一个group没有展开过,分3种情况
                        var node_id = "";
                        var group_id = "";
                        if (group_obj.getName() == fa_g_name) { //4.1 展开过的是当前选中的group
                            if (flag_fa) { //展开过的是本端
                                //DO Nothing
                            } else { //展开过的是对端
                                var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" +
                                    value.a_ifindex;
                                var link = creatLink(link_id, fromNode, toNode, value);
                            }
                        } else if (group_obj.getName() == ta_g_name) { //4.2 展开过的是选中group的对端
                            if (flag_ta) { //展开过的是对端
                                //DO Nothing
                            } else { //展开过的是本端
                                var link_id = "pro_" + rsing_id + "_" + value.a_dev_id + "_" +
                                    value.a_ifindex;
                                var link = creatLink(link_id, fromNode, toNode, value);
                            }
                        } else { // 4.3展开的不是选中的group也不是对端
                            if (flag_fa) {
                                node_id = fromNode.getId();
                                group_id = ta.getId();
                            } else {
                                node_id = toNode.getId();
                                group_id = fa.getId();
                            }
                            var ifspeed_aa = value.ifspeed;
                            var link_s = tmplinkMap.get(node_id + "$" + group_id)
                            if (link_s == null) link_s = 0;
                            tmplinkMap.set(node_id + "$" + group_id, link_s + ifspeed_aa);
                        }
                    }
                }

            }

        });
        for (var t_link of tmplinkMap) { // 遍历Array
            var tmp_strs = t_link[0].split("$")
            var to_g = idfinder.findFirst(tmp_strs[1]);
            var from_g = idfinder.findFirst(tmp_strs[0]);
            if (from_g != null && to_g != null && from_g != to_g) {
                var link = creatLink("sub_" + t_link[0], from_g, to_g, null);
                link.setClient("ifspeed", t_link[1]);
            }
        }
    });
    network.addViewListener(callback);
}



//加载数据
function initSubDataBox(subNetWork, multi_hop_flag) {
    if (subNetWork == null) $.ajaxSetup({
        async: false
    }); //ajax 同步 这个是直辖市的特殊处理
    twaver.Defaults.LINK_BUNDLE_AGENT_FUNCTION = null;
    var autoflag = true; //自动布局标识
    var flag = 0; //判断结点初始化是否有坐标 决定用不用自动布局
    subAuto_list.clear();
    var city_id = subNetWork == null ? cityMap[pro] : subNetWork.getId();
    city_id = (city_id + "").replace("multi_hop", "");
    curr_city_aid = city_id;
    var cr_devid = subNetWork == null ? pro : subNetWork.getToolTip();
    if (cityMap[pro] != null) {
        //加载位置信息
        var loc_url = "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id + "&type=0";
        $.post(loc_url, function (data) {
            symbolLocationMap = data;
        })
    }
    var tmp_url =
        "/rsing/topo/getSubTopoData.do?1=1&city_id=" + city_id + "&rsing_id=" + rsing_id;
    var
        url = tmp_url + "&multi_hop_flag=" + (multi_hop_flag ? "2" : "1"); //画多跳设备链路视图topo_view_type=2
    var city_name = subNetWork == null ? pro : subNetWork.getName();

    $.post(url, function (data) {
                //设备list
                devDataList = data.devDataList;
                if (devDataList.length > 0) {
                    $.each(devDataList, function (n, value) {
                            if (value.dev_net >= 1 && value.dev_net <= 6) {
                                var id = value.dev_id;
                                var
                                    name = value.symbol_name;
                                var
                                    image = getImageFormDev(value.dev_net, value.dev_type, value.dev_role);
                                if (value.dev_net == 4) { //处理骨干网 var g169_id=city_id+"sub_169"; var
                                    n169_id = city_id + "_" + name
                                    var group169 = idfinder.findFirst(g169_id);
                                    if (group169 == null) group169 = creatSubNetL3Group(g169_id, "China
                                        169 骨干网 ","
                                        169 ggw ",subNetWork,subAuto_list); var
                                        tmp_node_2 = idfinder.findFirst(city_id + "_" + name); //找169骨干网
                                        if (tmp_node_2 == null) {
                                            tmp_node_2 = creatNode(n169_id, name, "CR", value);
                                        }
                                        group169.addChild(tmp_node_2);
                                        if (autoflag && group169.getClient("flag") &&
                                            tmp_node_2.getClient("flag")) {
                                            autoflag = false;
                                        }
                                        if (subNetWork != null &&
                                            !subNetWork.isParentOf(group169)) { //这个是处理cr一跳多跳的
                                            subNetWork.addChild(group169);
                                        }
                                    }
                                    else { //处理非骨干网的 var x=0; var
                                        y = 0; //比如广州的sr可能会出现在佛山下和佛山CR链接，广州自己也有这个sr，为区分这2个sr，需要加城市id来区分 var
                                        tmp_node = idfinder.findFirst(city_id + "_" + id);
                                        if (tmp_node == null) {
                                            tmp_node = creatNode(city_id + "_" + id, name, image, value);
                                        }
                                        var
                                            l3g_id = value.city + "_" + cr_devid + "_" + value.dev_net +
                                            "_" + value.dev_type;
                                        var
                                            l3g_name = "unknown";
                                        if (value.dev_net == 2 || value.dev_net == 3 ||
                                            value.dev_net == 6
                                        ) { //单独处理IDC网络的 l3g_name=netMap[value.dev_net];
                                            image = getGroupImageFormDev(value.dev_net, value.dev_type,
                                                value.dev_role);
                                            l3g_id = city_id + "_" + cr_devid + "_" + value.dev_net;
                                        } else if (value.dev_net == 1 &&
                                            value.dev_type == 1) {
                                            if (value.dev_role == 3) { //省网cr l3g_id=city_id+"_swhx";
                                                l3g_name = "省网核心";
                                                image = getGroupImageFormDev(value.dev_net, value.dev_type,
                                                    value.dev_role);
                                            } else {
                                                l3g_id = value.city + "_" + cr_devid + "_" + value.dev_net +
                                                    "_" + value.dev_type + "_" + value.dev_role;
                                                if (value.dev_role == 2) {
                                                    l3g_name = value.city + "_" + typeMap[value.dev_type] +
                                                        "_" + roleMap[value.dev_role];
                                                } else {
                                                    l3g_name = value.city + "_" + typeMap[value.dev_type];
                                                }
                                                image = image + "-group";
                                            }
                                        } else {
                                            l3g_name = value.city + "_" + typeMap[value.dev_type];
                                            image = image + "-group";
                                        } //第三层 var
                                        l3group = creatSubNetL3Group(l3g_id, l3g_name, image, subNetWork,
                                            subAuto_list);
                                        l3group.addChild(tmp_node);
                                        if (autoflag && l3group.getClient("flag") &&
                                            tmp_node.getClient("flag")
                                        ) { //位置表有位置，不会触发自动布局 autoflag=false; } } //基本数据过滤
                                            els
                                        } /*else if(value.dev_net==6 ){ }*/
                                    })
                            } //链路信息linkDataList
                            linkDataList = data.linkDataList;
                            $.each(linkDataList, function (n, value) {
                                    var
                                        toNode = null;
                                    var fromNode = null;
                                    var fromId = city_id + "_" + value.a_dev_id;
                                    fromNode = idfinder.findFirst(
                                        fromId); //处理普通设备节点 if(value.z_dev_id !=0 &&
                                    value.z_dev_net == 1 && value.z_dev_type != -1) { //查找连接点 var
                                    toId = city_id + "_" + value.z_dev_id;
                                    toNode = idfinder.findFirst(toId); //role=4和role=7 devid=0的
                                    为idc网络和cdn网络设备(只有设备名称没有其他信息) 需要单独处理
                                } else if (value.z_dev_net == 2 ||
                                    value.z_dev_net == 3 || value.z_dev_net == 6) {
                                    var
                                        toId = city_id + "_" + (value.z_dev_id == 0 ? value.z_dev_name :
                                            value.z_dev_id); //有的idc或cdn没有id只有设备名称
                                    toNode = idfinder.findFirst(toId);
                                    var
                                        g_image = getGroupImageFormDev(value.z_dev_net, value
                                            .z_dev_type, value.z_dev_role);
                                    var group_id = city_id + "_" + cr_devid + "_" + value.z_dev_net
                                    var
                                        group = creatSubNetL3Group(group_id, netMap[value.z_dev_net],
                                            g_image, subNetWork, subAuto_list);
                                    if (toNode == null) {
                                        toNode = creatNode(toId, value.z_dev_name, "SR", null)
                                        toNode.setStyle('whole.alpha', 0.7);
                                        group.addChild(toNode);
                                        if (autoflag &&
                                            group.getClient("flag") && toNode.getClient("flag")) {
                                            autoflag = false;
                                        }
                                    }
                                    if (subNetWork != null && !subNetWork.isParentOf(
                                            group)) { //这个是处理cr一跳多跳的
                                        subNetWork.addChild(group);
                                    } //处理骨干网 }else
                                    if (value.z_dev_net ==
                                        4) { //处理169骨干网 toNode=idfinder.findFirst(city_id+"_"+
                                        value.z_dev_name
                                    ); //找169骨干网 } if(fromNode !=null && toNode !=null){ var
                                    link_id = "sub-" + rsing_id + "-" + value.a_dev_id + "-" + value
                                        .a_ifindex;
                                    var
                                        link = idfinder.findFirst(link_id);
                                    if (link == null) {
                                        link = creatLink(link_id, fromNode, toNode, value);
                                        if (subNetWork != null)
                                            subNetWork.addChild(link);
                                    }
                                    if (subNetWork != null &&
                                        !subNetWork.isParentOf(link)
                                    ) { //这个是处理cr一跳多跳的 if(subNetWork!=null)
                                        subNetWork.addChild(link);
                                    }
                                    subAuto_list.add(link);
                                    /*
                                                                               if(!fromNode.getClient("flag") || !toNode.getClient("flag")){
                                                                               console.log("let me see"); }*/
                                }
                            });
                    });
                if (autoflag) { //自动布局 ----围绕布局round
                    对称布局(symmetry) //上下topbottom 下上布局(bottomtop)
                    左右布局(leftright) 左右布局(leftright) 分层布局(hierarchic)
                    subAutoLayouter.getElements = function () {
                        return subAuto_list;
                    };
                    subAutoLayouter.setRepulsion(2);
                    subAutoLayouter.setAnimate(false);
                    var
                        aaaaaa = subAutoLayouter.doLayout('symmetry', function () {
                            network.zoomOverview(true);
                        });
                } else {
                    network.addViewListener(callback);
                }
            } //专门为北京这种链路太多的城市做的优化 配合lazyLoading_city使用 function
            initSubDataBox_lazyLoading(subNetWork, multi_hop_flag) {
                if (subNetWork == null)
                    $.ajaxSetup({
                        async: false
                    }); //ajax 同步 这个是直辖市的特殊处理
                twaver.Defaults.LINK_BUNDLE_AGENT_FUNCTION = null;
                var autoflag = true; //自动布局标识
                var flag = 0; //判断结点初始化是否有坐标 决定用不用自动布局 subAuto_list.clear(); var
                city_id = subNetWork == null ? cityMap[pro] : subNetWork.getId();
                city_id = (city_id + "").replace("multi_hop", "");
                curr_city_aid = city_id;
                var
                    cr_devid = subNetWork == null ? pro : subNetWork.getToolTip();
                if (cityMap[pro] != null) { //加载位置信息 var
                    loc_url = "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id + "&type=0";
                    $.post(loc_url, function (data) {
                        symbolLocationMap = data;
                    })
                }
                var
                    tmp_url = "/rsing/topo/getSubTopoData.do?1=1&city_id=" + city_id + "&rsing_id=" + rsing_id;
                var url = tmp_url + " &multi_hop_flag=" + (multi_hop_flag ? " 2" :
                    "1"); //画多跳设备链路视图topo_view_type=2 var
                city_name = subNetWork == null ? pro : subNetWork.getName();
                $.post(url, function (data) { //设备list devDataList=data.devDataList;
                        if (devDataList.length > 0) {
                            $.each(devDataList, function (n, value) {
                                    if (value.dev_net >= 1 && value.dev_net <= 6) {
                                        var id = value.dev_id;
                                        var
                                            name = value.symbol_name;
                                        var
                                            image = getImageFormDev(value.dev_net, value.dev_type, value
                                                .dev_role);
                                        if (value.dev_net ==
                                            4) { //处理骨干网 var g169_id=city_id+"sub_169"; var
                                            n169_id = city_id + "_" + name
                                            var group169 = idfinder.findFirst(g169_id);
                                            if (group169 == null) group169 = creatSubNetL3Group(g169_id,
                                                "China
                                                169 骨干网 ","
                                                169 ggw ",subNetWork,subAuto_list); var
                                                tmp_node_2 = idfinder.findFirst(city_id + "_" +
                                                    name); //找169骨干网
                                                if (tmp_node_2 == null) {
                                                    tmp_node_2 = creatNode(n169_id, name, "CR",
                                                        value);
                                                }
                                                group169.addChild(tmp_node_2);
                                                if (autoflag && group169.getClient("flag") &&
                                                    tmp_node_2.getClient("flag")) {
                                                    autoflag = false;
                                                }
                                                if (subNetWork != null &&
                                                    !subNetWork.isParentOf(group169)
                                                ) { //这个是处理cr一跳多跳的
                                                    subNetWork.addChild(group169);
                                                }
                                            }
                                            else { //处理非骨干网的 var x=0; var
                                                y =
                                                    0; //比如广州的sr可能会出现在佛山下和佛山CR链接，广州自己也有这个sr，为区分这2个sr，需要加城市id来区分 var
                                                tmp_node = idfinder.findFirst(city_id + "_" + id);
                                                if (tmp_node == null) {
                                                    tmp_node = creatNode(city_id + "_" + id, name,
                                                        image, value);
                                                }
                                                var
                                                    l3g_id = value.city + "_" + cr_devid + "_" + value
                                                    .dev_net + "_" + value.dev_type;
                                                var
                                                    l3g_name = "unknown";
                                                if (value.dev_net == 2 || value.dev_net == 3 ||
                                                    value.dev_net == 6
                                                ) { //单独处理IDC网络的 l3g_name=netMap[value.dev_net];
                                                    image = getGroupImageFormDev(value.dev_net, value
                                                        .dev_type, value.dev_role);
                                                    l3g_id = city_id + "_" + cr_devid + "_" + value
                                                        .dev_net;
                                                } else if (value.dev_net == 1 &&
                                                    value.dev_type == 1) {
                                                    if (value.dev_role == 3) { //省网cr
                                                        l3g_id = city_id + "_swhx";
                                                        l3g_name = "省网核心";
                                                        image = getGroupImageFormDev(value.dev_net,
                                                            value.dev_type, value.dev_role);
                                                    } else {
                                                        l3g_id = value.city + "_" + cr_devid + "_" +
                                                            value.dev_net + "_" + value.dev_type + "_" +
                                                            value.dev_role;
                                                        if (value.dev_role == 2) {
                                                            l3g_name = value.city + "_" + typeMap[value
                                                                .dev_type] + "_" + roleMap[value
                                                                .dev_role];
                                                        } else {
                                                            l3g_name = value.city + "_" + typeMap[value
                                                                .dev_type];
                                                        }
                                                        image = image + "-group";
                                                    }
                                                } else {
                                                    l3g_name = value.city + "_" + typeMap[value
                                                        .dev_type];
                                                    image = image + "-group";
                                                } //第三层 var
                                                l3group = creatSubNetL3Group(l3g_id, l3g_name, image,
                                                    subNetWork, subAuto_list);
                                                l3group.addChild(tmp_node);
                                                if (autoflag && l3group.getClient("flag") &&
                                                    tmp_node.getClient("flag")
                                                ) { //位置表有位置，不会触发自动布局 autoflag=false; } }
                                                } //基本数据过滤 }) } //链路信息linkDataList linkDataList=data.linkDataList;
                                                $.each(linkDataList, function (n, value) {
                                                        var toNode = null;
                                                        var
                                                            fromNode = null;
                                                        var fromId = city_id + "_" + value.a_dev_id;
                                                        fromNode = idfinder.findFirst(
                                                            fromId
                                                        ); //处理普通设备节点 if(value.z_dev_id !=0 &&
                                                        value.z_dev_net == 1 && value.z_dev_type !=
                                                            -1) { //查找连接点 var
                                                        toId = city_id + "_" + value.z_dev_id;
                                                        toNode = idfinder.findFirst(
                                                            toId); //role=4和role=7 devid=0的
                                                        为idc网络和cdn网络设备(只有设备名称没有其他信息) 需要单独处理
                                                    } else if (value.z_dev_net == 2 ||
                                                        value.z_dev_net == 3 || value.z_dev_net == 6
                                                    ) {
                                                        var
                                                            toId = city_id + "_" + (value
                                                                .z_dev_id == 0 ? value.z_dev_name :
                                                                value.z_dev_id
                                                            ); //有的idc或cdn没有id只有设备名称
                                                        toNode = idfinder.findFirst(toId);
                                                        var
                                                            g_image = getGroupImageFormDev(value
                                                                .z_dev_net, value.z_dev_type, value
                                                                .z_dev_role);
                                                        var group_id = city_id + "_" + cr_devid +
                                                            "_" + value.z_dev_net
                                                        var
                                                            group = creatSubNetL3Group(group_id,
                                                                netMap[value.z_dev_net], g_image,
                                                                subNetWork, subAuto_list);
                                                        if (toNode == null) {
                                                            toNode = creatNode(toId, value
                                                                .z_dev_name, "SR", null)
                                                            toNode.setStyle('whole.alpha', 0.7);
                                                            group.addChild(toNode);
                                                            if (autoflag &&
                                                                group.getClient("flag") && toNode
                                                                .getClient("flag")) {
                                                                autoflag = false;
                                                            }
                                                        }
                                                        if (subNetWork != null && !subNetWork
                                                            .isParentOf(group)) { //这个是处理cr一跳多跳的
                                                            subNetWork.addChild(group);
                                                        } //处理骨干网 }else
                                                        if (value.z_dev_net ==
                                                            4
                                                        ) { //处理169骨干网 toNode=idfinder.findFirst(city_id+"_"+
                                                            value.z_dev_name
                                                        ); //找169骨干网 } if(fromNode !=null && toNode !=null){ var
                                                        fa = fromNode.getParent();
                                                        var ta = toNode.getParent();
                                                        if (fa != null &&
                                                            ta != null) {
                                                            var ifspeed_aa = value.ifspeed;
                                                            var
                                                                link_s = tmplinkMap.get(fa.getId() +
                                                                    "$" + ta.getId()) if (link_s ==
                                                                    null)
                                                                    link_s = 0;
                                                            tmplinkMap.set(fa.getId() + "$" + ta
                                                                .getId(), link_s + ifspeed_aa);
                                                        }
                                                    }
                                                });
                                        });
                                    for (var t_link of tmplinkMap) { // 遍历Array创建聚合后的链路 var
                                        tmp_strs = t_link[0].split("$") var to_g = idfinder.findFirst(
                                            tmp_strs[1]);
                                        var from_g = idfinder.findFirst(tmp_strs[0]);
                                        if (from_g != null &&
                                            to_g != null && from_g != to_g) {
                                            var
                                                link = creatLink("sub_" + t_link[0], from_g, to_g,
                                                    null);
                                            link.setClient("ifspeed", t_link[1]);
                                            if (subNetWork != null)
                                                subNetWork.addChild(link);
                                            subAuto_list.add(link)
                                        }
                                        /* var
                                                                                       link_id="sub-" +rsing_id+"-"+value.a_dev_id+"-"+value.a_ifindex; var
                                                                                       link=idfinder.findFirst(link_id); if(link==null) {
                                                                                       link=creatLink(link_id,fromNode,toNode,value); if(subNetWork!=null)
                                                                                       subNetWork.addChild(link); } if(subNetWork!=null &&
                                                                                       !subNetWork.isParentOf(link)){//这个是处理cr一跳多跳的 if(subNetWork!=null)
                                                                                       subNetWork.addChild(link); } subAuto_list.add(link);*/
                                    }
                                    if (autoflag) { //自动布局 ----围绕布局round 对称布局(symmetry) //上下topbottom
                                        下上布局(bottomtop) 左右布局(leftright) 左右布局(leftright) 分层布局(hierarchic)
                                        subAutoLayouter.getElements = function () {
                                            return subAuto_list;
                                        };
                                        subAutoLayouter.setRepulsion(2);
                                        subAutoLayouter.setAnimate(false);
                                        var
                                            aaaaaa = subAutoLayouter.doLayout('symmetry', function () {
                                                network.zoomOverview(true);
                                            });
                                    } else {
                                        network.addViewListener(callback);
                                    }
                                } //承载a和 承载b(不是城域网 不是169骨干网 )
                                function initOtherHomeBox() {
                                    $.ajaxSetup({
                                        async: false
                                    }); //ajax
                                    同步-- -- - 这是一个全局的 box.clear();
                                    var autoflag = true; //自动布局标识 var city_map=new
                                    Map(); //{dev_id:city} //加载位置信息 var inte_set=new Set(); var
                                    loc_url = "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id +
                                        "&type=0";
                                    $.post(loc_url, function (data) {
                                        symbolLocationMap = data;
                                    }) var
                                        url = "/rsing/topo/get169TopoData.do?1=1&rsing_id=" +
                                        rsing_id;
                                    var
                                        flag_loc = "cz_AB_" + rsing_id + "_";
                                    $.post(url, function (data) {
                                        devDataList = data.devDataList;
                                        if (devDataList.length > 0) {
                                            $.each(devDataList, function (n, value) {
                                                var id = value.dev_id;
                                                var name = value.symbol_name;
                                                var area = value.area;
                                                var pro = value.pro;
                                                var city = value.city;
                                                var dev_type = value.dev_type;
                                                var the_type = typeMap[value.dev_type] +
                                                    ""

                                                var isCr = the_type.indexOf("CR") != -1
                                                var isBr = the_type.indexOf("BR") != -1
                                                if (isCr || the_type.indexOf("BR") >
                                                    0) {
                                                    if (isCr) { //CR分组,且有sub子网
                                                        var subid = flag_loc + pro +
                                                            "_CR"
                                                        var pro_sub = idfinder
                                                            .findFirst(subid);
                                                        if (pro_sub == null) {
                                                            pro_sub = createSubnetwork(
                                                                subid, pro + "_" +
                                                                the_type,
                                                                "CR-group", null);
                                                        }
                                                        city_map.set(id, subid);

                                                        if (autoflag && (pro_sub
                                                                .getClient("flag"))) {
                                                            autoflag = false;
                                                        }
                                                    } else {
                                                        var area_group = creat169Group(
                                                            "ca_A_" + dev_type,
                                                            the_type, "SR-group");
                                                        var tmpnode = creatNode(
                                                            flag_loc + id, name,
                                                            "CR", value);
                                                        var
                                                            group = creat169Group(
                                                                rsing_id + "_" + pro +
                                                                "_" + the_type, pro +
                                                                "_" + the_type,
                                                                "CR-group");
                                                        group.addChild(tmpnode);
                                                        area_group.addChild(group);

                                                        if (autoflag && (tmpnode
                                                                .getClient("flag"))) {
                                                            autoflag = false;
                                                        }
                                                    }

                                                } else if (isBr) { //br不分组，有sub子网
                                                    var pro_sub = idfinder.findFirst(
                                                        flag_loc + pro);
                                                    if (pro_sub == null) {
                                                        pro_sub = createSubnetwork(
                                                            flag_loc + pro, pro +
                                                            "_" + the_type,
                                                            "CR-group", null);
                                                        city_map.set(id, flag_loc +
                                                            pro);
                                                    }

                                                }

                                            })
                                        }

                                        //链路信息linkDataList
                                        linkDataList = data.linkDataList;
                                        $.each(linkDataList, function (n, value) {
                                            var fromNode = null;
                                            var toNode = null;
                                            //查找连接点
                                            var fromId = value.a_dev_id;
                                            var toId = value.z_dev_id;

                                            toNode = idfinder.findFirst(flag_loc +
                                                toId);
                                            fromNode = idfinder.findFirst(flag_loc +
                                                fromId);
                                            if (toNode ==
                                                null) { //找sub子网node，子网id是flag_loc+pro
                                                var tmpid = city_map.get(toId)
                                                toNode = idfinder.findFirst(tmpid);
                                            }
                                            if (fromNode == null) {
                                                var tmpid = city_map.get(fromId)
                                                fromNode = idfinder.findFirst(tmpid);
                                            }
                                            if (fromNode != null && toNode != null &&
                                                fromNode != toNode) {
                                                var link_id = "ca_AB_" + rsing_id +
                                                    "-" + value.a_dev_id + "-" + value
                                                    .a_ifindex;
                                                var link = creatLink(link_id, fromNode,
                                                    toNode, value);
                                            }
                                        })

                                    })
                                    if (autoflag) {
                                        autoLayouter.setRepulsion(2)
                                        autoLayouter.doLayout('symmetry', function () {
                                            network.zoomOverview(true);
                                        });
                                    } else {
                                        network.addViewListener(callback);
                                    }
                                    $("#loading").hide();

                                }


                                //承载a和 承载b(不是城域网 不是169骨干网 )
                                function initOtherSubBox(subNetWork) {
                                    $.ajaxSetup({
                                        async: false
                                    }); //ajax 同步-----这是一个全局的
                                    subAuto_list.clear();
                                    var autoflag = true; //自动布局标识
                                    var city_map = new Map(); //{dev_id:city}
                                    //加载位置信息
                                    var inte_set = new Set();
                                    var loc_url =
                                        "/rsing/topo/getlocation.do?1=1&rsing_id=" + rsing_id +
                                        "&type=0";
                                    $.post(loc_url, function (data) {
                                        symbolLocationMap = data;
                                    })
                                    var arg_pro = subNetWork.getName().split('_')[0];
                                    var url =
                                        "/rsing/topo/GetOtherSubNetWork.do?1=1&rsing_id=" + rsing_id +
                                        "&pro=" + arg_pro;
                                    var flag_loc = "cz_AB_sub_" + rsing_id + "_" + arg_pro + "_";
                                    $.post(url, function (data) {
                                        devDataList = data.devDataList;
                                        if (devDataList.length > 0) {
                                            $.each(devDataList, function (n, value) {
                                                var id = value.dev_id;
                                                var name = value.symbol_name;
                                                var area = value.area;
                                                var pro = value.pro;
                                                var city = value.city;
                                                var dev_type = value.dev_type;
                                                var the_type = typeMap[value.dev_type] +
                                                    ""

                                                //北京有上海的cr,上海有北京的cr靠省份区分这些节点
                                                var tmpnode = creatNode(flag_loc + id,
                                                    name, "CR", value);
                                                var
                                                    group = creatSubNetL3Group(
                                                        flag_loc + pro + "_" +
                                                        the_type + "_sub", pro + "_" +
                                                        the_type, "CR-group",
                                                        subNetWork, subAuto_list);
                                                group.addChild(tmpnode);
                                                if (autoflag && (tmpnode.getClient(
                                                        "flag"))) {
                                                    //位置表有位置，不会触发自动布局
                                                    autoflag = false;
                                                }

                                            })
                                        }

                                        //链路信息linkDataList
                                        linkDataList = data.linkDataList;
                                        $.each(linkDataList, function (n, value) {
                                            var fromNode = null;
                                            var toNode = null;
                                            //查找连接点
                                            var fromId = value.a_dev_id;
                                            var toId = value.z_dev_id;

                                            toNode = idfinder.findFirst(flag_loc +
                                                toId);
                                            fromNode = idfinder.findFirst(flag_loc +
                                                fromId);

                                            if (fromNode != null && toNode != null &&
                                                fromNode != toNode) {
                                                var link_id = flag_loc + value
                                                    .a_dev_id + "-" + value.a_ifindex;
                                                var link = creatLink(link_id, fromNode,
                                                    toNode, value);
                                            }
                                        })

                                    })
                                    if (autoflag) {
                                        subAutoLayouter.getElements = function () {
                                            return subAuto_list;
                                        };
                                        subAutoLayouter.setRepulsion(2);
                                        subAutoLayouter.setAnimate(false);
                                        var aaaaaa = subAutoLayouter.doLayout('symmetry', function () {
                                            network.zoomOverview(true);
                                        });
                                    } else {
                                        network.addViewListener(callback);
                                    }
                                    $("#loading").hide();

                                }

                                function doubleClickSub(ele) {
                                    if (rsing_id > 99 && rsing_id < 200) {
                                        initOtherSubBox(ele)
                                    } else {
                                        initSubDataBox(ele, false)
                                    }
                                } //创建node结点 function creatNode(id,
                                name, image, devinfo) {
                                var node = new
                                twaver.Node(id); //id为topo图中的symble_id if(devinfo!=null)
                                setDeviceDetail2Node(node, devinfo);
                                node.setName(name);
                                node.setImage(image);
                                node.setStyle('select.style', 'border');
                                node.setStyle('select.width', 1);
                                node.setStyle('select.join', 'round');
                                node.setStyle('select.color', '#000000');
                                node.setStyle('label.color', '#ffffff');
                                if (devinfo != null) {
                                    var
                                        nodetooltip = devinfo.dev_id; //存储结点信息 实际dev_id
                                    node.setToolTip(nodetooltip);
                                }
                                var loc = symbolLocationMap[id];
                                var
                                    x = 0;
                                var y = 0;
                                var flag = false;
                                if (loc != null) {
                                    x = loc[0];
                                    y = loc[1];
                                    flag = true;
                                }
                                node.setLocation(x, y);
                                node.setClient("flag", flag);
                                box.add(node);
                                return node;
                            } //创建组 function creatGroup(id, name,
                            image) {
                            var group = new twaver.Group(id);
                            group.setName(name);
                            group.s('group.shape', 'oval'); //设置分组边框形状
                            group.s('group.fill.color', whole_color); //填充色FEF3E2 E0FFFF //
                            group.s('group.fill.color', 'transparent'); //填充色FEF3E2 E0FFFF
                            group.s('group.outline.color', '#3cb2e6'); //F8C374 #0099FF
                            #99caea // group.s('group.outline.color', '# 3399 FF ' );//F8C374
                            #0099FF # 99 caea group.s('group.outline.width', '2');
                            group.s('vector.outline.pattern', [10, 0]); //轮廓 group.s('group.deep',
                            0);
                        group.s('select.style', 'border');
                        group.s('select.width', 1);
                        group.s('select.join', 'round');
                        group.s('select.color', '#000000');
                        group.s('label.color', '#ffffff');
                        var
                            loc = symbolLocationMap[id];
                        var x = 0;
                        var y = 0;
                        var flag = false;
                        if (loc != null) {
                            x = loc[0];
                            y = loc[1];
                            flag = true;
                        }
                        group.setLocation(x, y);
                        group.setClient("flag", flag);
                        group.setImage(image);
                        group.setExpanded(false);
                        box.add(group);
                        return group;
                    }

                    function creat169Group(id, name, image) {
                        var
                            group = idfinder.findFirst(id);
                        if (group == null) {
                            group = creatGroup(id,
                                name, image);
                            group.setExpanded(false);
                        }
                        return group;
                    }

                    function creatSubNetL3Group(l3g_id, l3g_name, groupimage, subNetWork, list, expand) {
                        var group = idfinder.findFirst(l3g_id);
                        if (group == null) {
                            group = creatGroup(l3g_id, l3g_name, groupimage);
                            group.setExpanded(false);
                            if (subNetWork != null)
                                subNetWork.addChild(group);
                            list.add(group)
                        }
                        if (subNetWork != null &&
                            !subNetWork.isParentOf(group)) {
                            subNetWork.addChild(group);
                        }
                        return
                        group;
                    } //准备构建二级子网 function createSubnetwork (id, name, image,
                    devinfo) {
                    var subNetwork = new twaver.SubNetwork(id);
                    subNetwork.setName(name);
                    subNetwork.setImage(image);
                    if (devinfo != null) subNetwork.setToolTip(devinfo.dev_id);
                    subNetwork.setStyle('icons.names', 'Text');
                    subNetwork.setStyle('background.type', 'vector');
                    subNetwork.setStyle('background.vector.fill', true);
                    subNetwork.setStyle('background.vector.fill.color', whole_color); //#99CCFF
                    subNetwork.setStyle('label.color', '#ffffff'); //#99CCFF
                    subNetwork.setStyle('select.style', 'border');
                    subNetwork.setStyle('select.shape', 'roundrect');
                    subNetwork.setStyle('select.width', 1);
                    subNetwork.setStyle('select.join', 'round');
                    subNetwork.setStyle('select.color', '#000000');
                    var
                        loc = symbolLocationMap[id];
                    var x = 0;
                    var y = 0;
                    var flag = false;
                    if (loc != null) {
                        x = loc[0];
                        y = loc[1];
                        flag = true;
                    }
                    subNetwork.setLocation(x, y);
                    subNetwork.setClient("flag", flag);
                    box.add(subNetwork);
                    return subNetwork;
                }

                function
                setDeviceDetail2Node(node, devinfo) {
                    node.setClient("devname", devinfo.symbol_name);
                    node.setClient("vendorname", devinfo.vendor_name);
                    node.setClient("devip", devinfo.dev_ip);
                    node.setClient("devipmask", devinfo.dev_ip_mask);
                    node.setClient("typename", devinfo.type_name);
                    node.setClient("net", netMap[devinfo.dev_net]);
                    node.setClient("type", typeMap[devinfo.dev_type]);
                    node.setClient("role", roleMap[devinfo.dev_role]);
                    node.setClient("city", devinfo.city);
                } //创建链路 function
                creatLink(link_id, from, to, linkinfo) {
                    var link = new
                    twaver.Link(link_id);
                    link.setFromNode(from);
                    link.setToNode(to);
                    if (linkinfo != null) {
                        autoLinkStyle(link, linkinfo.ifspeed);
                    } else {
                        link.setStyle('link.width', 3);
                        link.setStyle('link.bundle.expanded', false); //设定绑定状态 false为合并
                        link.setStyle('link.color', '#90dffe');
                        link.setStyle('link.handler.color', '#ffffff');
                    };
                    var
                        linkToolTip = "";
                    if (from != null && to != null && linkinfo != null) {
                        linkToolTip = from.getToolTip() + "=" + to.getToolTip();
                        link.setClient(" a_dev_name", linkinfo.a_dev_name);
                        link.setClient("a_if", linkinfo.a_if);
                        link.setClient("z_dev_name", linkinfo.z_dev_name);
                        link.setClient("z_if", linkinfo.z_if);
                        link.setClient("type_name", linkinfo.type_name);
                        link.setClient("ifspeed", linkinfo.ifspeed);
                        link.setClient("send_rate", linkinfo.send_rate);
                        link.setClient("rec_rate", linkinfo.rec_rate);
                        link.setClient("ip_ver", linkinfo.ip_ver);
                    }
                    link.setToolTip(linkToolTip);
                    box.add(link);
                    return link;
                } //link颜色
                function autoLinkStyle(link, ifspeed) {
                    link.setStyle('link.bundle.expanded', false); //设定绑定状态 false为合并 var
                    l_w = 0.5;
                    var col = '#14a8e2'; // var spe=ifspeed/1000/1000;//端口带宽MB
                    if (spe < 1000) { //小于1G l_w=0.6 }else if(spe<2500){//大于等于1G小于2.5G
                        l_w = 0.7 col = '#14a8e2'; //紫色col='#6600CC'; }else
                        if (spe < 10000) { //大于等于2.5G小于10GE l_w=1 col='#37baed'
                            ; //绿色col='#336699' }else if(spe<40000){//大于等于10G小于40GE l_w=1.5
                            col = '#56c5f1'; //绿色col='#66FF66' }else
                            if (spe < 100000) { //大于等于40G小于100GE l_w=2 col='#70d5fd'
                                ; //col='#0099CC'; }else{//大于等于100GE l_w=3; col='#90dffe'
                                ; //深蓝col='#006699'; } link.setStyle('link.width', l_w);
                                link.setStyle('link.color', col);
                                link.setStyle('link.handler.color', '#ffffff'); //
                                link.setStyle('link.flow', true); // link.setStyle('link.pattern',
                                [15, 15]); // link.setStyle('link.flow.color', '#0d4981' );//white
                        } //初始化代理,代理链路需要显示总带宽 function initAgentLink(linklist){ for (var
                        link of linklist) { // 遍历linklist if(link.isBundleAgent()){ var
                        sum = 0;
                        var linkGouplist = link.getBundleLinks().getLinks();
                        linkGouplist.forEach(function (value) {
                            var
                                ifspeed = value.getClient("ifspeed");
                            sum += ifspeed;
                        })
                        link.setClient("sumbandwidth", sum / 1000 / 1000 / 1000);
                    }
                }
            }

            function addButton(div, name, src, callbackfun) {
                var
                    button = document.createElement('input');
                button.setAttribute('type',
                    src ? 'image' : 'button');
                button.setAttribute('title', name);
                if ("放大" == name || "缩小" == name)
                    button.setAttribute('title', "转动鼠标滚轮可快捷操作放大或缩小视图");
                button.style.verticalAlign = 'top';
                if (src) {
                    button.style.padding = '4px 4px 4px 4px';
                    if (src.indexOf('/') < 0) {
                        src = '../resource/img/rsing/toolbar/' + src + '.png';
                    }
                    button.setAttribute('src', src);
                } else {
                    button.setAttribute("class", "btn btn-info btn-sm");
                    button.setAttribute("style", "padding:5px 5px 5px 5px;margin:1px 5px
                        1 px 0 px; background - color: #1c68ac;");// button.value= name;
                    }
                    button.addEventListener('click', callbackfun, false);
                    div.appendChild(button);
                    return button;
                }

                function
                addButton2(div, title, name, callbackfun) {
                    var
                        button = document.createElement('button');
                    button.setAttribute('title', title);
                    button.style.verticalAlign = 'top';
                    button.setAttribute("class", "btn
                        btn - info btn - sm "); button.setAttribute("
                        style ","
                        padding: 5 px 5 px 5 px 5 px; margin: 1 px 5 px 1 px 0 px; background - color: #1c68ac;");//































                                            button.value= name; button.addEventListener('click', callbackfun,
                            false); // button.setAttribute('onclick', callbackfun);
                        div.appendChild(button);
                        return button;
                    }

                    function
                    addSelect(div, chr_divid) {
                        var
                            select_div = document.getElementById(chr_divid);
                        div.appendChild(select_div);
                    }

                    function to169Html() {
                        var
                            g1 = network.getSelectionModel().getSelection();
                        var mark = g1.size() > 0;
                        if (mark) {
                            var chil0 = g1.get(0);
                            if (chil0.getClassName() == 'twaver.Group' &&
                                chil0.getChildAt(0).getClassName() == 'twaver.Node') {
                                //TODO 跳到另一个页面
                                var node_list = chil0.getChildren();
                                var nodes = "";
                                node_list.forEach(function (node) {
                                    nodes += node.getToolTip() + ",";
                                });
                                nodes = nodes.substring(0, nodes.length - 1);
                                var pro = chil0.getName().split("_")[0];
                                window.open("/rsing/topoView_169.html?rsing_id=99&devids_169=" + nodes +
                                    "&pro=" + pro);
                            } else {
                                alert("仅支持选中省节点。");
                            }
                        } else {
                            alert("没有选中设备！仅支持选中省节点。");
                        }

                    }

                    function imageName(category_name, run_state) {
                        //return "icon"+imgTemp[category_name]+"-"+imgTemp[run_state];
                        return "icon" + imgNameObj[category_name] + "-" + imgNameObj[run_state];
                    }

                    function getImageFormDev(net, type, role) {
                        if (net == 1) {
                            return imgtypeMap[type];
                        } else if (net == 2) {
                            return "SR";
                        } else if (net == 3) {
                            return "SR";
                        } else if (net == 6) {
                            return "SR";
                        } else {
                            return "169ggw";
                        }
                    }

                    function getGroupImageFormDev(net, type, role) {
                        if (net == 1) {
                            if (type == 1 && role == 3) {
                                return "sw";
                            }
                            return imgtypeMap[type] + "-group";
                        } else if (net == 2) {
                            return "idccloud-gray";
                        } else if (net == 3) {
                            return "cdncloud-gray";
                        } else if (net == 4) {
                            return "169ggw";
                        } else {
                            return "mobcloud-gray";
                        }
                    }

                    var ipv4v6Map = {
                        "-1": "未知",
                        "0": "未知",
                        "4": "IPv4",
                        "6": "IPv6",
                        "10": "双栈"
                    }

                    var netMap = { //init中添加
                        "-1": "未知"
                    }

                    var typeMap = { //init中添加
                        "-1": "未知"
                    }

                    var roleMap = { //init中添加
                        "-1": "未知"
                    }
                    var imgtypeMap = {
                        "1": "SR",
                        "2": "SR",
                        "3": "SR",
                        "4": "SR",
                        "13": "SR"
                    }
                    //画云用的
                    var imgnetMap = {
                        "2": "idccloud-gray",
                        "3": "cdncloud-gray",
                        "6": "mobcloud-gray"
                    }

                    //加载获取图片 svg为network
                    function registerImage(url, svg) {
                        var image = new Image();
                        image.src = url;
                        var views = arguments;
                        image.onload = function () {
                            twaver.Util.registerImage(getImageName(url), image, image.width,
                                image.height, svg === true);
                            image.onload = null;
                            for (var i = 1; i < views.length; i++) {
                                var view = views[i];
                                if (view.invalidateElementUIs) {
                                    view.invalidateElementUIs();
                                }
                                if (view.invalidateDisplay) {
                                    view.invalidateDisplay();
                                }
                            }
                        };
                    }

                    function getImageName(url) {
                        var index = url.lastIndexOf('/');
                        var
                            name = url;
                        if (index >= 0) {
                            name = url.substring(index + 1);
                        }
                        index = name.lastIndexOf('.');
                        if (index >= 0) {
                            name = name.substring(0, index);
                        }
                        return name;
                    }

                    //--------设备详情-----------
                    function initDialog(node) {
                        var div = document.getElementById("devdiv");
                        if (div == null) {
                            div = document.createElement('div');
                            div.setAttribute("id", "devdiv");
                            //
                            div.setAttribute("style", "height:230px;width:243px;padding-top:15px;
                                opacity: 0.9;
                                " +
                                //
                                "background:url(../resource/img/rsing/topoimages/dev_background.png)");
                            div.style.display = 'none';
                            div.style.zIndex = 100;
                            demo.Util.appendChild(div, rightPane.getView(), 0, 0, null,
                                null);
                        }
                        var devname = node.getClient("devname");
                        //table-bordered background-color:#FFFFCC
                        div.innerHTML = "<table class='dialog table table2 table-hover'>
                        "+
                        "<tr> <
                        td class = 'td11' > 设备名称： < /td> <
                        td class = 'td2' > "+
                        "<a href=\"deviceInfo.html?dev_name=" + devname + " \"
                        target = \"_blank\">" + devname + "</a></td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 设备厂家： < /td> <
                        td class = 'td2' > "+node.getClient("
                        vendorname ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 设备型号： < /td> <
                        td class = 'td2' > "+node.getClient("
                        typename ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > IP地址： < /td> <
                        td class = 'td2' > "+node.getClient("
                        devip ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 掩码： < /td> <
                        td class = 'td2' > "+node.getClient("
                        devipmask ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 网络类型： < /td> <
                        td class = 'td2' > "+node.getClient("
                        net ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 设备类型： < /td> <
                        td class = 'td2' > "+node.getClient("
                        type ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 设备角色： < /td> <
                        td class = 'td2' > "+node.getClient("
                        role ")+" < /td> < /
                        tr > "+
                        "<tr> <
                        td class = 'td11' > 省份 / 城市： < /td> <
                        td class = 'td2' > "+node.getClient("
                        city ")+" < /td> < /
                        tr > "+
                        "</table>";

                        return div;
                    }

                    //绘制接口详情
                    function ifDialog(tmp_link) {
                        var div = document.getElementById("ifinfo");
                        if (div == null) {
                            div = document.createElement('div');
                            div.setAttribute("id", "ifinfo");
                            //
                            div.setAttribute("style", "height:183px;width:290px;padding-top:15px;
                                opacity: 0.9;
                                " +
                                //
                                "background:url(../resource/img/rsing/topoimages/link_background.png)");
                            div.style.display = 'none';
                            div.style.zIndex = 100;
                            demo.Util.appendChild(div, rightPane.getView(), 0, 0, null,
                                null);
                        }
                        var a_name = tmp_link.getClient("a_dev_name");
                        var a_if = tmp_link.getClient("a_if");
                        var z_name = tmp_link.getClient("z_dev_name");
                        var z_if = tmp_link.getClient("z_if");
                        if (a_name == null && z_name == null) {
                            div.innerHTML = "<table class='dialogif table table2 table-hover'>
                            "+
                            "<tbody>" + "<tr> <
                            td class = 'td2' > 双击展开链路两端逻辑视图后展示详细信息 < /td> <
                            td > < /td> < /
                            tr > "+ " < /tbody > "+" < /table > ";
                        } else {
                            div.innerHTML = "<table
                            class = 'dialogif table table2 table-hover' > "+
                            "<tbody>" +
                            "<tr> <
                            td class = 'tdif ' > A端设备： < /td> <
                            td class = 'td2' > " +
                            "<a href=\"deviceInfo.html?dev_name=" + a_name + "\
                            "
                            target = \"_blank\">" + a_name + "</a></td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > A端接口： < /td> <
                            td class = 'td2' > "+
                            "<a href=\"instanceInfo_dev.html?dev_name=" + a_name + " &
                            inf_name = "+a_if+"\
                            "
                            target = \"_blank\">" + a_if + "</a></td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > Z端设备： < /td> <
                            td class = 'td2' > "+
                            "<a href=\"deviceInfo.html?dev_name=" + z_name + "\
                            "
                            target = \"_blank\">" + z_name + "</a></td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > Z端接口： < /td> <
                            td class = 'td2' > "+
                            "<a href=\"instanceInfo_dev.html?dev_name=" + z_name + " &
                            inf_name = "+z_if+"\
                            "
                            target = \"_blank\">" + z_if + "</a></td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > 接口带宽： < /td> <
                            td class = 'td2' > "+tmp_link.getClient("
                            type_name ")+" <
                                /td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > 链路类型： < /td> <
                            td class = 'td2' >
                                "+ipv4v6Map[tmp_link.getClient("
                            ip_ver ")]+" < /td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > 利用率峰值A - Z： < /td> <
                            td class = 'td2' >
                                "+tmp_link.getClient("
                            send_rate ")+" % "+" < /td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdif' > 利用率峰值Z - A： < /td> <
                            td class = 'td2' >
                                "+tmp_link.getClient("
                            rec_rate ")+" % "+" < /td> < /
                            tr > "+
                            "</tbody>" + "</table>";
                        }

                        return div;
                    }

                    //绘制接口详情
                    function ifbundleDialog(result, map_v4v6) {
                        var div = document.getElementById("ifbundle");
                        if (div == null) {
                            div = document.createElement('div');
                            div.setAttribute("id", "ifbundle");
                            div.style.display = 'none';
                            div.style.zIndex = 100;
                            demo.Util.appendChild(div, rightPane.getView(), 0, 0, null,
                                null);
                        }
                        var tmphtml = "";
                        var linksum = 0;
                        for (var key in map_v4v6) {
                            tmphtml += "<tr> <
                            td class = 'tdbundle ' > "+key+"
                            链路： < /td> <
                            td class = 'td2' > "+map_v4v6[key]+" < /td> < /
                            tr > ";
                            linksum += map_v4v6[key];
                        }

                        if (map_v4v6["undefined_undefined"] > 1) {
                            div.innerHTML = "<table class='dialogif table table2 table-hover'>
                            "+
                            "<tbody>" + "<tr> <
                            td class = 'td2' > 双击展开链路两端逻辑视图后展示详细信息 < /td> <
                            td > < /td> < /
                            tr > "+ " < /tbody > "+" < /table > ";
                        } else {
                            div.innerHTML = "<table
                            class = 'dialogif_b table table2 table-hover' > "+
                            "<tr> <
                            td class = 'tdbundle' > 链路总数： < /td> <
                            td class = 'td2' > "+linksum+" < /td> < /
                            tr > "+
                            "<tr> <
                            td class = 'tdbundle tr_underline' > 链路总带宽： < /td> <
                            td class = 'td2' > "+result+" < /td> < /
                            tr > "+
                            tmphtml + "</table>";
                        }
                        return div;
                    }


                    function
                    drawAnalysisTable(analysisView, subcityN, subcityId, currSub) {
                        return
                        drawAnalysisTableV4V6(analysisView, subcityN, subcityId, currSub, "");
                    }
                    //统计视图
                    function
                    drawAnalysisTableV4V6(analysisView, subcityN, subcityId, currSub, ip_ver) {
                        var url =
                            "/rsing/topo/getCountDev.do?1=1&rsing_id=" + rsing_id + "&pro=" + pro +
                            "&cityName=" + subcityN + "&cityId=" + subcityId + "&ip_ver=" + ip_ver;
                        var data;
                        $.post(url, function (data) {
                            var tmptr = "";
                            if (currSub == null) {
                                tmptr = "<tr> <
                                td > 省网CR： "+data.devCount[0]+" < /td> <
                                td > 城域网CR： "+data.devCount[1]+" < /td>"+
                                "<td>SR ：" + data.devCount[2] + "</td> <
                                td > BRAS： "+data.devCount[3]+" < /td> <
                                td > NAT： "+data.devCount[4]+" < /td> < /
                                tr > ";
                            } else {
                                var cr = 0,
                                    bras = 0,
                                    sr = 0,
                                    nat = 0;
                                var chilList = currSub.getChildren();
                                chilList.forEach(function (group) {
                                    if (group.getClassName() == 'twaver.Group') {
                                        var nodelist = group.getChildren();
                                        nodelist.forEach(function (node) {
                                            var type = node.getClient("type");
                                            var city = node.getClient("city")
                                            if (subcityN == node.getClient("city")) {
                                                if (type == "CR") cr++;
                                                if (type == "BRAS") bras++;
                                                if (type == "SR") sr++;
                                                if (type == "独立NAT44") nat++;
                                            }

                                        })
                                    }
                                });
                                tmptr = "<tr> <
                                td > 城域网CR： "+cr+" < /td>"+
                                "<td>BRAS ：" + bras + "</td> <
                                td > SR： "+sr+" < /td> <
                                td > NAT： "+nat+" < /td> < /
                                tr > ";
                            }
                            analysisView.innerHTML = "<table class='table table-bordered'
                            style = 'width:91%;margin:15px auto;' > "+tmptr+" < /table>"+
                            "<table class='table table-hover table-bordered'
                            style = 'width:95%;' > "+
                            "<thead> <
                            tr >
                                <
                                th class = 'tdc' > 局向 < /th> <
                            th class = 'tdc' > 总带宽G < /th> <
                            th class = 'tdc' > 上行流量峰值G < /th> <
                            th class = 'tdc' > 下行流量峰值G < /th>" +
                            "<th class='tdc'>上行利用率峰值%</th> <
                            th class = 'tdc' > 下行利用率峰值 % < /th>"+" < /
                            tr > <
                                /thead>"+
                            formatData(data) + "</table>";
                            analysisView.style.zIndex = 100;
                        })
                        return analysisView;
                    }

                    function formatData(data) {
                        var defult = "<td>0</td> <
                        td > 0 < /td> <
                        td > 0 < /td> <
                        td > 0.0 % < /td> <
                        td > 0.0 % < /td> < /
                        tr > ";
                        var tmpstr2 = "";
                        var thedate = "";
                        if (data.cr_169 != null) {
                            thedate = data.cr_169[5];
                            tmpstr2 += "<tr> <
                            td > 核心CR至骨干网 < /td> <
                            td > "+data.cr_169[0]+" < /td> <
                            td > "+data.cr_169[1]+" < /td> <
                            td > "+data.cr_169[2]+" < /td> <
                            td > "+data.cr_169[3]+" < /td> <
                            td > "+data.cr_169[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > 核心CR至骨干网 < /td>"+defult;
                        }
                        if (data.cr_net != null) {
                            thedate = data.cr_net[5];
                            tmpstr2 += " <
                            tr >
                                <
                                td > 核心CR至省网 < /td> <
                            td > "+data.cr_net[0]+" < /td> <
                            td > "+data.cr_net[1]+" < /td> <
                            td > "+data.cr_net[2]+" < /td> <
                            td > "+data.cr_net[3]+" < /td> <
                            td > "+data.cr_net[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > 核心CR至省网 < /td>"+defult;
                        }
                        if (data.cr_idc != null) {
                            thedate = data.cr_idc[5];
                            tmpstr2 += " <
                            tr >
                                <
                                td > 核心CR至IDC < /td> <
                            td > "+data.cr_idc[0]+" < /td> <
                            td > "+data.cr_idc[1]+" < /td> <
                            td > "+data.cr_idc[2]+" < /td> <
                            td > "+data.cr_idc[3]+" < /td> <
                            td > "+data.cr_idc[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > 核心CR至IDC < /td>"+defult;
                        }
                        if (data.cr_gi != null) {
                            thedate = data.cr_gi[5];
                            tmpstr2 += " <
                            tr >
                                <
                                td > 核心CR至GI < /td> <
                            td > "+data.cr_gi[0]+" < /td> <
                            td > "+data.cr_gi[1]+" < /td> <
                            td > "+data.cr_gi[2]+" < /td> <
                            td > "+data.cr_gi[3]+" < /td> <
                            td > "+data.cr_gi[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > 核心CR至GI < /td>"+defult;
                        }

                        if (data.cr_cdn != null) {
                            tmpstr2 += " <
                            tr >
                                <
                                td > 核心CR至CDN < /td> <
                            td > "+data.cr_cdn[0]+" < /td> <
                            td > "+data.cr_cdn[1]+" < /td> <
                            td > "+data.cr_cdn[2]+" < /td> <
                            td > "+data.cr_cdn[3]+" < /td> <
                            td > "+data.cr_cdn[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > 核心CR至CDN < /td>"+defult;
                        }

                        if (data.sr_cr != null) {
                            thedate = data.sr_cr[5];
                            tmpstr2 += " <
                            tr >
                                <
                                td > SR至核心CR < /td> <
                            td > "+data.sr_cr[0]+" < /td> <
                            td > "+data.sr_cr[1]+" < /td> <
                            td > "+data.sr_cr[2]+" < /td> <
                            td > "+data.sr_cr[3]+" < /td> <
                            td > "+data.sr_cr[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > SR至核心CR < /td>"+defult;
                        }

                        if (data.bras_cr != null) {
                            tmpstr2 += " <
                            tr >
                                <
                                td > BRAS至核心CR < /td> <
                            td > "+data.bras_cr[0]+" < /td> <
                            td > "+data.bras_cr[1]+" < /td> <
                            td > "+data.bras_cr[2]+" < /td> <
                            td > "+data.bras_cr[3]+" < /td> <
                            td > "+data.bras_cr[4]+" < /td> < /
                            tr > ";
                        } else {
                            tmpstr2 += "<tr> <
                            td > BRAS至核心CR < /td>"+defult;
                        }
                        $("#analysisHint").html("概览信息预统计" + thedate + "日数据");
                        return tmpstr2;
                    }

                    function initPane(splitPane) {
                        splitPane.setDividerBackground("#ffffff") //劈分条的背景色#0d4981
                        splitPane.setDividerOpacity(0.7) //设置劈分条的透明度
                        splitPane.setDividerWidth(0.05) //劈分条的宽度
                    }

                    //------------------------------保存图片-----------------------------
                    function imageExport() {
                        var
                        var box, home_box;
                        var network;
                        var autoLayouter;
                        var subAutoLayouter;
                        var overview;
                        var idfinder;
                        var namefinder;
                        var width;
                        var height;
                        var devDataList;
                        var symbolLocationMap = {};
                        var linkDataList;
                        var resizeTimer = null;
                        var rightPane;
                        var rsing_id, pro;
                        var tree;
                        var curr_city_aid = "0";
                        var overend = false;
                        var is_query_multi_hop = false;
                        var subAuto_list; //存储subNetWork 的node和list容器,每进一次地市，会清空重新加载
                        var whole_color = '#0d4981'; //全局背景色
                        var tmplinkMap = new Map(); //全局link(优化骨干网/北京创建link慢的问题)

                        requirejs(["jquery",
                                "jqueryUi", "bootstrap", "datatable", "datetime_zh"
                            ],
                            function ($, jqueryUi, bootstrap, datatable, datetime_zh, twaver2) {
                                $(document).ready(function () {
                                    var requ = getRequest();
                                    rsing_id = requ['rsing_id'];
                                    pro = requ['pro'];
                                    $(document).attr("title", pro + "省网络拓扑图")
                                    box = new ElementBox();
                                    home_box = new ElementBox();
                                    network = new twaver.vector.Network(box);
                                    autoLayouter = new twaver.layout.AutoLayouter(box);
                                    subAutoLayouter = new twaver.layout.AutoLayouter(box);
                                    overview = new twaver.vector.Overview(network); //鹰眼视图组件
                                    idfinder = new twaver.QuickFinder(box, "id"); //devid
                                    namefinder = new twaver.QuickFinder(box, "name"); //根据name查询
                                    popupMenu = new twaver.controls.PopupMenu(network); //右键菜单
                                    subAuto_list = new twaver.List();
                                    tree = new Tree(box);
                                    data = new twaver.Element();
                                    width = $(window).width();
                                    height = $(window).height();
                                    init();
                                })
                            })

                        function init() {
                            $(".modal").draggable({
                                handle: ".modal-header"
                            });
                            var toolbar = document.getElementById("toolbar");
                            initToolbar(toolbar);
                            windowResize();
                            tick();
                        }

                        function tick() {
                            var today;
                            $.post("/rsing/topo/howAreYou", function (data) {
                                console.log("AutoRefresh!")
                            });
                            window.setTimeout(function () {
                                tick();
                            }, 300000); //5分钟刷一次
                        }

                        function initDevNetTypeRole() {
                            $.post("/rsing/topo/getDevNetTypeRole", function (data) {
                                var net = data.net;
                                var type = data.type;
                                var role = data.role;
                                for (var key in net) {
                                    netMap[key] = net[key]
                                }
                                for (var key in type) {
                                    typeMap[key] = type[key]
                                }
                                for (var key in role) {
                                    roleMap[key] = role[key]
                                }
                            });
                        }



                        var cityMap = { //处理直辖市
                            "北京": 1101,
                            "上海": 11022,
                            "天津": 1105,
                            "重庆": 1103
                        }

                        function windowResize() {
                            var self = this;
                            initHomeNetwork(); //
                            $.ajaxSetup({
                                async: false
                            }); //ajax 同步
                            initDevNetTypeRole();
                            if (rsing_id == 99) {
                                /*----------只有169拓扑有右键菜单-------------------*/
                                // if(rsing_id==99){
                                popupMenu.setWidth(140);
                                popupMenu.setBackground(whole_color);
                                popupMenu.setBorder("1px solid #56c5f1"); //#56c5f1
                                popupMenu.setColor("#ffffff");
                                popupMenu.setFocusBackground("#56c5f1");
                                popupMenu.setFocusColor("#ffffff");
                                popupMenu.setMenuItems([{
                                    label: '进入该节点视图',
                                    action: to169Html
                                }]);
                                // }
                                /*-------------------------------------------*/
                                init169DataBox();
                            } else if (pro == "北京" || pro == "上海" || pro == "天津" || pro == "重庆") {
                                if (pro == "北京") { //单独优化北京
                                    initSubDataBox_lazyLoading(null, false)
                                } else {
                                    initSubDataBox(null, false)
                                }
                            } else if (rsing_id > 99 && rsing_id < 200) {
                                initOtherHomeBox();
                            } else {
                                initHomeDataBox(); //加载首页数据 }
                                network.setScrollBarVisible(false); //设置滚动条是否可见 //监听事件----点击显示设备信息
                                var resizeTimer = 0;
                                network.addInteractionListener(function (e) {
                                        if (e.kind == 'clickBackground' ||
                                            e.kind == 'enterSubNetwork' || e.kind == 'liveMoveStart' ||
                                            e.kind == 'liveMoveBetween') {
                                            $("#devdiv").hide();
                                            $("#ifinfo").hide();
                                            $("#ifbundle").hide();
                                        }
                                        if (e.kind == 'clickElement') {
                                            $("#ifinfo").hide();
                                            $("#devdiv").hide();
                                            $("#ifbundle").hide();
                                            if (resizeTimer) {
                                                clearTimeout(resizeTimer) //timeout
                                                控制鼠标连带问题 resizeTimer = 0;
                                            }
                                            resizeTimer = setTimeout(function () { //timeout
                                                控制鼠标连带问题 //------------------------------------------------------------------------
                                                if (e.element.getClassName() == 'twaver.Node') {
                                                    var
                                                        devinfo_node = e.element;
                                                    if (devinfo_node.getId() != 0 &&
                                                        devinfo_node.getToolTip() != null
                                                    ) { //处理骨干网的 var
                                                        dialog = initDialog(devinfo_node);
                                                        var s = dialog.style;
                                                        s.left = (e.event.clientX - 0.15 * width) +
                                                            'px';
                                                        s.top = (e.event.clientY + 24) + 'px';
                                                    }
                                                } else
                                                if (e.element.getClassName() == 'twaver.Link') {
                                                    var
                                                        tmp_link = e.element;
                                                    var
                                                        expanded = tmp_link.getStyle(
                                                            'link.bundle.expanded'); //是否展开
                                                    if (expanded ||
                                                        tmp_link.getBundleCount() == 1
                                                    ) { //解决绑定线路为1的时候下不显示链路信息 var
                                                        dialog = ifDialog(
                                                            tmp_link
                                                        ); //获取接口性能数据 var s=dialog.style;
                                                        s.display = 'block';
                                                        s.left = (e.event.clientX - 0.15 * width) +
                                                            'px';
                                                        s.top = e.event.clientY + 'px';
                                                    } else
                                                    if (tmp_link.isBundleAgent()) {
                                                        var sum = 0;
                                                        var
                                                            map_v4v6 = {};
                                                        var
                                                            linklist = tmp_link.getBundleLinks()
                                                            .getLinks();
                                                        linklist.forEach(function (value) {
                                                            var
                                                                ifspeed = value.getClient(
                                                                    "ifspeed");
                                                            var
                                                                alpha = value.getStyle(
                                                                    'whole.alpha'
                                                                ); //TODO this
                                                            if (alpha ==
                                                                1) { //TODO this var
                                                                type_name = value.getClient(
                                                                    "type_name");
                                                                var
                                                                    ip_ver = value
                                                                    .getClient(
                                                                        "ip_ver"
                                                                    ); //IPv4v6 var
                                                                tmp_str = ipv4v6Map[
                                                                        ip_ver] + "_" +
                                                                    type_name;
                                                                if (
                                                                    map_v4v6[tmp_str] ==
                                                                    null) {
                                                                    map_v4v6[tmp_str] = 1;
                                                                } else {
                                                                    map_v4v6[tmp_str] += 1;
                                                                }
                                                                sum += ifspeed;
                                                            }
                                                        }) var
                                                            result = sum / 1000 / 1000 / 1000 +
                                                            "G";
                                                        var
                                                            dialog = ifbundleDialog(result,
                                                                map_v4v6);
                                                        var
                                                            s = dialog.style;
                                                        s.display = 'block';
                                                        s.left = (e.event.clientX - 0.15 * width) +
                                                            'px';
                                                        s.top = e.event.clientY + 'px';
                                                    } // } }else if(e.element
                                                    instanceof twaver.SubNetwork
                                                ) {} //------------------------------------------------------------------------
                                            }, 200); //timeout 控制鼠标连带问题 }else if
                                            (e.kind === 'doubleClickElement') {
                                                if (resizeTimer) {
                                                    clearTimeout(resizeTimer);
                                                    resizeTimer = 0;
                                                }
                                                if (e.element instanceof twaver.SubNetwork) {
                                                    var
                                                        subNetWork = currentSubnetwork = e.element;
                                                    if (subNetWork.getChildrenSize() < 1) { //
                                                        initSubDataBox(subNetWork, false) //增加了承载AB网的城市子网
                                                        doubleClickSub(subNetWork)
                                                    } else {
                                                        network.zoomOverview(true);
                                                    }
                                                }
                                                if ((rsing_id == 99 ||
                                                        rsing_id == 19) && e.element instanceof twaver
                                                    .Group &&
                                                    e.element.getClient("isLoading") == null &&
                                                    e.element.getParent() == null) {
                                                    if (rsing_id == 99) {
                                                        lazyLoading169(e.element);
                                                    } else if (rsing_id == 19) {
                                                        lazyLoading_city(e.element);
                                                    }
                                                    e.element.setClient("isLoading", true)
                                                }
                                            } else if (e.kind === 'upSubNetwork') {
                                                if (is_query_multi_hop) {
                                                    location.reload();
                                                } else {
                                                    network.zoomOverview(true);
                                                }
                                            }
                                        }); tree.addInteractionListener(function (evt) {
                                        var
                                            node = evt.data;
                                        if (evt.kind == 'click') { //单击
                                            if (node.getClassName() == 'twaver.SubNetwork') {
                                                if (node.getChildrenSize() < 1) { //
                                                    initSubDataBox(node, false);
                                                    doubleClickSub(subNetWork)
                                                } else {
                                                    network.zoomOverview(true);
                                                }
                                            } else
                                            if (node.getClassName() == 'twaver.Group') {
                                                network.zoomOverview(true);
                                            }
                                        } else
                                        if (evt.kind == 'collapse') { //合并
                                            if (node.getClassName() == 'twaver.SubNetwork') {
                                                if (is_query_multi_hop) {
                                                    location.reload();
                                                } else {
                                                    network.upSubNetwork(true);
                                                }
                                            } else
                                            if (node.getClassName() == 'twaver.Group') {
                                                node.setExpanded(false);
                                            }
                                            network.zoomOverview(true);
                                        }
                                    }); tree.setVisibleFunction(function (element) {
                                        return
                                        element instanceof twaver.Node;
                                    }); tree.getIcon = function (element) {
                                        return null;
                                    }; //选中颜色变化功能
                                    network.getSelectionModel().addSelectionChangeListener(function (e) {
                                            e.datas.forEach(function (element) {
                                                if (self.box.getSelectionModel().contains(
                                                        element)) {
                                                    element.setStyle('body.type', 'default.vector');
                                                    element.setStyle('select.color',
                                                        '#ffffff'); //选中模型边框颜色
                                                    element.setStyle('vector.fill.color',
                                                        '#185d9e'); //选中模型背景颜色 } else {
                                                    element.setStyle('body.type', 'default');
                                                }
                                            }, this);
                                        },
                                        this
                                    ); //------------------------------------------------------------------------- //设置链路聚合显示链路条数
                                    network.getLinkHandlerLabel = function (link) { //一大堆的条件过滤就是为了减少遍历和计算
                                        if (!overend) return null;
                                        var
                                            currSub = network.getCurrentSubNetwork();
                                        if (currSub != null &&
                                            !link.isDescendantOf(currSub)) return null;
                                        if (currSub == null || link.isBundleAgent()) {
                                            var
                                                expanded = link.getStyle('link.bundle.expanded'); //是否展开
                                            if (expanded ||
                                                link.getBundleLinks() == null) { //展开或展开只有自己一条link return
                                                link.getClient("ifspeed") / 1000 / 1000 / 1000;
                                            }
                                            var sum = 0;
                                            var agentFlag = false;
                                            var agentLink = null;
                                            var
                                                linkGouplist = link.getBundleLinks().getLinks();
                                            linkGouplist.forEach(function (value) {
                                                    var
                                                        ifspeed = value.getClient("ifspeed");
                                                    var
                                                        alpha = value.getStyle(
                                                            'whole.alpha'); //TODO this
                                                    if (alpha ==
                                                        1) { //TODO this sum+=ifspeed; if(!agentFlag){
                                                        agentFlag = true;
                                                        agentLink = value;
                                                    }
                                                } //TODO this })
                                                return sum / 1000 / 1000 / 1000;
                                            }
                                            else
                                            if (!link.isBundleAgent()) {
                                                return
                                                link.getClient("ifspeed") / 1000 / 1000 / 1000;
                                            } else {
                                                return
                                                null;
                                            }
                                            return null;
                                        }; //------------------------------------------------------------------------- //解决点击网元，显示的div使网元无法拖动的情况
                                        network.getView().addEventListener('mouseup', function (e) {
                                                var element = network.getElementAt(e);
                                                if (element != null &&
                                                    element.getClassName() == 'twaver.Node') {
                                                    setTimeout(function () {
                                                        if (element.getId() != 0 &&
                                                            element.getToolTip() != null) {
                                                            $("#devdiv").show();
                                                        }
                                                    }, 200) //延迟0.2秒显示 }
                                                }
                                            ); //-------------------------------------------------------------------------
                                        } //创建工具栏 function initToolbar (div) { var
                                        b1 = addButton2(div, "拓扑说明", "", function () {
                                            $("#waringinfo").modal("show");
                                        });
                                        b1.innerHTML =
                                            "<span class='glyphicon glyphicon-pushpin' aria-hidden='true'></span>"
                                        addButton(div, "放大", false, function () {
                                            network.zoomIn();
                                        });
                                        addButton(div, '缩小',
                                            false,
                                            function () {
                                                network.zoomOut();
                                            });
                                        addButton(div, '显示全部', false, function () {
                                            network.zoomOverview();
                                        });
                                        addButton(div, '显示默认', false, function () {
                                            network.setZoom(1);
                                        });
                                        addButton(div, '自动布局', false, function () { //只布局当前页面的拓扑位置 var
                                            currSub = network.getCurrentSubNetwork();
                                            if (rsing_id >= 99 ||
                                                (cityMap[pro] != null)) {
                                                autoLayouter.setRepulsion(2)
                                                autoLayouter.doLayout('symmetry', function () {
                                                    network.zoomOverview(true);
                                                });
                                            } else if (currSub != null) {
                                                subAutoLayouter.getElements = function () {
                                                    return subAuto_list;
                                                };
                                                subAutoLayouter.setRepulsion(2);
                                                subAutoLayouter.setAnimate(false);
                                                var
                                                    aaaaaa = subAutoLayouter.doLayout('symmetry',
                                                        function () {
                                                            network.zoomOverview(true);
                                                        });
                                            } else {
                                                alert("不支持该视图自动布局");
                                            }

                                        });

                                        addButton(div, '保存当前位置', false, function () {
                                            savelocation();
                                        });
                                        //峰值利用率(北京和骨干网去掉该功能,有懒加载的无法使用该功能,虚拟链路没有带宽利用率)
                                        if (!(rsing_id == 99 || rsing_id == 19))
                                            addSelect(div, 'select_up_div');

                                        if (rsing_id < 99) { //骨干网和承载网去掉概览 addButton(div, '概览'
                                            , false,
                                            function () {
                                                analysis_ipv4v6('4');
                                            }); //一跳多跳按钮 addSelect(div,'topo_multi_hop');
                                    } //ipv4v6切换按钮 addSelect(div,'select_ipv4v6');
                                    addButton(div, '返回上级视图', false, function () {
                                        if (network.getCurrentSubNetwork() == null) {
                                            alert("当前已是最顶层视图")
                                        } else {
                                            if (is_query_multi_hop) {
                                                location.reload();
                                            } else {
                                                network.upSubNetwork(true);
                                                network.zoomOverview(true);
                                            }
                                        }
                                    }); addButton(div, '刷新', false, function () {
                                        location.reload();
                                    });
                                }

                                function select(s, e, type) {
                                    s = s * 1;
                                    e = e * 1;
                                    var
                                        currSub = network.getCurrentSubNetwork() if (currSub !=
                                            null) {
                                            var chilList = currSub.getChildren();
                                            chilList.forEach(function (link) {
                                                if (link.getClassName() == 'twaver.Link') {
                                                    var
                                                        send = link.getClient("send_rate") * 1;
                                                    var
                                                        rec = link.getClient("rec_rate") * 1;
                                                    var flag = false;
                                                    if ('all' == type) {
                                                        if ((send >= s && send < e) || (rec >= s &&
                                                                rec < e)) flag = true;
                                                    } else if ('up' == type) {
                                                        if (send >= s && send < e) flag = true;
                                                    } else
                                                    if ('down' == type) {
                                                        if (rec >= s && rec < e)
                                                            flag = true;
                                                    }
                                                    if (flag) {
                                                        link.setStyle('whole.alpha', 1);
                                                    } else {
                                                        link.setStyle('whole.alpha', 0.2);
                                                    }
                                                }
                                            });
                                        } else { //说明是首页
                                            box.forEach(function (ele) { //China
                                                169 骨干网 省网核心
                                                var
                                                    filter = ele.getClassName() == 'twaver.Link' //
                                                    &&
                                                    ele.getToNode().getParent().getClassName() ==
                                                    'twaver.Group';
                                                if (filter) {
                                                    var
                                                        send = ele.getClient("send_rate") * 1;
                                                    var rec = ele.getClient("rec_rate") * 1;
                                                    var flag = false;
                                                    if ('all' == type) {
                                                        if ((send >= s && send < e) || (rec >= s &&
                                                                rec < e)) flag = true;
                                                    } else
                                                    if ('up' == type) {
                                                        if (send >= s &&
                                                            send < e) flag = true;
                                                    } else
                                                    if ('down' == type) {
                                                        if (rec >= s && rec < e)
                                                            flag = true;
                                                    }
                                                    if (flag) {
                                                        ele.setStyle('whole.alpha', 1);
                                                    } else {
                                                        ele.setStyle('whole.alpha', 0.2);
                                                    }
                                                }
                                            })
                                        }
                                }

                                function
                                selectv4v6(args1, args2) {
                                    box.forEach(function (ele) {
                                        var
                                            filter = ele.getClassName() == 'twaver.Link' //
                                            &&
                                            ele.getToNode().getParent().getClassName() ==
                                            'twaver.Group';
                                        if (filter) {
                                            var
                                                ip_ver = ele.getClient("ip_ver");
                                            var flag = false;
                                            if ('all' == args1) {
                                                flag = true;
                                            } else
                                            if (args1 == ip_ver ||
                                                args2 == ip_ver) {
                                                flag = true;
                                            }
                                            if (flag) {
                                                ele.setStyle('whole.alpha', 1);
                                            } else {
                                                ele.setStyle('whole.alpha', 0.2);
                                            }
                                        }
                                    })
                                }

                                function
                                reLoadTopo(type) {
                                    var
                                        currSub = network.getCurrentSubNetwork();
                                    if (currSub == null) {
                                        if (type == "1") {
                                            if (
                                                /*pro=="北京"
                                                                                                                                                    ||*/
                                                pro == "上海" ||
                                                pro == "天津" ||
                                                pro == "重庆"
                                            ) { //单独处理直辖市默认
                                                box.clear();
                                                initSubDataBox(null, false);
                                            } else {
                                                network.zoomOverview();
                                            }
                                        } else {
                                            if (
                                                /*pro=="北京"
                                                                                                                                                    ||*/
                                                pro == "上海" ||
                                                pro == "天津" ||
                                                pro == "重庆"
                                            ) { //单独处理直辖市的多跳
                                                initSubDataBox(null, true);
                                            } else {
                                                alert("由于全省设备较多,仅支持地市视图查看多跳拓扑");
                                            }
                                        }
                                    } else {
                                        if (type == "1") {
                                            box.clear();
                                            copyDataFrom1To2(home_box, box);
                                            var
                                                tmp_subNet = idfinder.findFirst(curr_city_aid);
                                            initSubDataBox(tmp_subNet, false)
                                            network.setCurrentSubNetwork(tmp_subNet);
                                        } else {
                                            is_query_multi_hop = true;
                                            var
                                                tmp_subNet = idfinder.findFirst("multi_hop" + curr_city_aid);
                                            if (tmp_subNet == null) {
                                                tmp_subNet = new
                                                twaver.SubNetwork("multi_hop" + curr_city_aid);
                                                tmp_subNet.setToolTip(currSub.getToolTip());
                                                tmp_subNet.setName(currSub.getName());
                                                tmp_subNet.setStyle('icons.names', 'Text');
                                                tmp_subNet.setStyle('background.type', 'vector');
                                                tmp_subNet.setStyle('background.vector.fill', true); //
                                                tmp_subNet.setStyle('background.vector.fill.color', "#73b9fd");
                                                tmp_subNet.setStyle('background.vector.fill.color',
                                                    whole_color);
                                                tmp_subNet.setStyle('whole.alpha', 0); //这个子网不需要展示只是用来切换一跳多跳的
                                                box.add(tmp_subNet);
                                            }
                                            initSubDataBox(tmp_subNet, true)
                                            network.setCurrentSubNetwork(tmp_subNet);
                                        }
                                    }
                                } //这个是统计流量的
                                function
                                analysis_ipv4v6(ip_ver) {
                                    var
                                        currSub = network.getCurrentSubNetwork();
                                    var currCityN = "";
                                    var currCityId = "";
                                    var v4v6 = "";
                                    if (
                                        ip_ver == "-1") {
                                        v4v6 = " IPv4/IPv6"
                                        $("#btn_ipv4v6").removeClass();
                                        $("#btn_ipv4v6").addClass("btn_style
                                                btnall ") }else
                                                if (ip_ver == '4') {
                                                    v4v6 = " IPv4"
                                                    $("#btn_ipv4v6").removeClass();
                                                    $("#btn_ipv4v6").addClass("btn_style
                                                        btn4 ")
                                                    }
                                                    if (ip_ver == '6') {
                                                        v4v6 = " IPv6"
                                                        $("#btn_ipv4v6").removeClass();
                                                        $("#btn_ipv4v6").addClass("btn_style
                                                            btn6 ") } var
                                                            span1 = "<span style='color:#9fedec'>" +
                                                            v4v6 + " </span>"
                                                            if (currSub != null) {
                                                                currCityN = currSub.getName();
                                                                currCityId = (currSub.getId() + "").replace(
                                                                    "multi_hop", "");
                                                                $("#analysisTitle").html(currCityN +
                                                                    "带宽流量利用率" + span1);
                                                            } else {
                                                                $("#analysisTitle").html(pro + "带宽流量利用率" +
                                                                    span1);
                                                            }
                                                            var
                                                                analysisTable = document.getElementById(
                                                                    'analysisTable'); drawAnalysisTableV4V6(
                                                                analysisTable, currCityN, currCityId,
                                                                currSub, ip_ver); $("#analysisView").modal(
                                                                "show");
                                                        } //首页布局 function
                                                        initHomeNetwork() {
                                                            network.setZoomManager(new twaver.vector
                                                                .LogicalZoomManager(network)
                                                            ); //混合缩放视图,使得图标不缩放，只缩放距离 //设置背景颜色
                                                            box.setStyle('background.type', 'vector');
                                                            box.setStyle('background.vector.fill', true);
                                                            box.setStyle('background.vector.fill.color',
                                                                whole_color); //"#99CCFF"
                                                            network.setToolTipEnabled(false); //设置tooltip显示
                                                            network.adjustBounds({
                                                                width: width * 0.85 * 2,
                                                                height: height * 2
                                                            }); //注册图标
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/169ggw.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/sw.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/CR.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/CR-group.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/SR.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/SR-group.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/idccloud-gray.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/cdncloud-gray.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/mobcloud-gray.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/treeC.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/treeE.png",
                                                                network);
                                                            registerImage(
                                                                "../resource/img/rsing/topoimages/169group.png",
                                                                network
                                                            ); //插入图例-----------------------------------------
                                                            var
                                                                legend = document.createElement('div');
                                                            var
                                                                analysisView = document.getElementById(
                                                                    'analysisView');
                                                            var
                                                                waringinfo = document.getElementById(
                                                                    'waringinfo');
                                                            rightPane = new
                                                            twaver.controls.BorderPane(network);
                                                            demo.Util.appendChild(analysisView, rightPane
                                                                .getView(),
                                                                null, null, null,
                                                                null); //top, right,
                                                            bottom, left
                                                            demo.Util.appendChild(waringinfo, rightPane
                                                                .getView(),
                                                                200, 50, null,
                                                                50); //top, right,
                                                            bottom,
                                                            left //----------------------------------------------------------------------- //-------调整tree的整体样式----------------------------------------------------------
                                                            var
                                                                treeview = tree.getView();
                                                            treeview.setAttribute("style",
                                                                "background:#282d33;color:#ffffff; " +
                                                                //#dbdada;设置tree的背景色和字体颜色 font-family:'微软雅黑';
                                                                " font-size:13px;padding-top:10px;overflow: auto;"
                                                            ); //overflow是滚动条 tree.setExpandIcon("treeE");//合并图标
                                                            tree.setCollapseIcon("treeC"); //展开图标
                                                            var treePane = new
                                                            twaver.controls.BorderPane(tree);
                                                            treePane.setTopHeight(10);
                                                            var leftSplit = new
                                                            twaver.controls.SplitPane(treePane,
                                                                legend, 'vertical',
                                                                1
                                                            ); //-------调整tree的整体样式----------------------------------------------------------
                                                            demo.Util.appendChild(document.getElementById(
                                                                    'toolbar'), rightPane.getView(),
                                                                0, null, null, 0);
                                                            var mainSplit = new
                                                            twaver.controls.SplitPane(leftSplit,
                                                                rightPane, 'horizontal', 0.13);
                                                            demo.Util.appendChild(mainSplit.getView(),
                                                                document.body, 0, 0,
                                                                0, 0);
                                                            initPane(leftSplit);
                                                            initPane(mainSplit); //----------鹰眼(OverView)
                                                            overview.setOutlineColor("#020202"); //边框线颜色
                                                            overview.setOutlineWidth(1.3); //边框线宽度
                                                            demo.Util.appendChild(overview.getView(),
                                                                rightPane.getView(),
                                                                0, 0, null, null);
                                                            var
                                                                owidth = width * 0.85 * 0.2;
                                                            var
                                                                oheight = height *
                                                                0.2; //其实overview内的canvas是自动调整的,这个只是设置了边界
                                                            overview.adjustBounds({
                                                                width: owidth,
                                                                height: oheight
                                                            });
                                                        } //加载数据 function
                                                        initHomeDataBox() {
                                                                $.ajaxSetup({
                                                                    async: false
                                                                }); //ajax
                                                                同步-- -- - 这是一个全局的 //绘制时每次需要清空box
                                                                var city_map = new
                                                                Map(); //{dev_id+"_home":city}
                                                                box.clear();
                                                                var
                                                                    autoflag = true; //自动布局标识 //加载位置信息
                                                                var
                                                                    loc_url =
                                                                    "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                    rsing_id + "&type=0";
                                                                $.post(loc_url, function (data) {
                                                                    symbolLocationMap = data;
                                                                }) var
                                                                    url =
                                                                    "/rsing/topo/getTopoData.do?1=1&rsing_id=" +
                                                                    rsing_id;
                                                                $.post(url, function (data) {
                                                                        devDataList = data.devDataList;
                                                                        if (devDataList.length >
                                                                            0) {
                                                                            $.each(devDataList, function (n,
                                                                                    value) {
                                                                                    var id =
                                                                                        value.dev_id;
                                                                                    var name =
                                                                                        value
                                                                                        .symbol_name;
                                                                                    var image =
                                                                                        "CR-group";
                                                                                    city_map.set(id +
                                                                                        "_home",
                                                                                        value
                                                                                        .city_aid);
                                                                                    if (value.dev_net ==
                                                                                        4) {
                                                                                        var
                                                                                            group169 =
                                                                                            idfinder
                                                                                            .findFirst(
                                                                                                0);
                                                                                        if (group169 ==
                                                                                            null)
                                                                                            group169 =
                                                                                            creatGroup(
                                                                                                0,
                                                                                                "China
                                                                                                169 骨干网 ","
                                                                                                169 ggw ");
                                                                                                var
                                                                                                    tmpnode =
                                                                                                    creatNode(
                                                                                                        "169_" +
                                                                                                        name,
                                                                                                        name,
                                                                                                        "CR",
                                                                                                        value
                                                                                                    ); group169
                                                                                                .addChild(
                                                                                                    tmpnode
                                                                                                );
                                                                                                if (autoflag &&
                                                                                                    group169
                                                                                                    .getClient(
                                                                                                        "flag"
                                                                                                    ) &&
                                                                                                    tmpnode
                                                                                                    .getClient(
                                                                                                        "flag"
                                                                                                    )
                                                                                                ) {
                                                                                                    autoflag
                                                                                                        =
                                                                                                        false;
                                                                                                }

                                                                                            }
                                                                                        else
                                                                                        if (value
                                                                                            .dev_net ==
                                                                                            1 &&
                                                                                            value
                                                                                            .dev_type ==
                                                                                            1 &&
                                                                                            value
                                                                                            .dev_role ==
                                                                                            3
                                                                                        ) {
                                                                                            var
                                                                                                sw_g =
                                                                                                idfinder
                                                                                                .findFirst(
                                                                                                    "省网"
                                                                                                );
                                                                                            if (sw_g ==
                                                                                                null)
                                                                                                sw_g =
                                                                                                creatGroup(
                                                                                                    "省网",
                                                                                                    "省网核心",
                                                                                                    "sw"
                                                                                                );
                                                                                            var
                                                                                                tmpnode =
                                                                                                creatNode(
                                                                                                    id +
                                                                                                    "_home",
                                                                                                    name,
                                                                                                    "CR",
                                                                                                    value
                                                                                                );
                                                                                            if (autoflag &&
                                                                                                sw_g
                                                                                                .getClient(
                                                                                                    "flag"
                                                                                                ) &&
                                                                                                tmpnode
                                                                                                .getClient(
                                                                                                    "flag"
                                                                                                )) {
                                                                                                //位置表有位置，不会触发自动布局
                                                                                                autoflag
                                                                                                    =
                                                                                                    false;
                                                                                            }
                                                                                            sw_g.addChild(
                                                                                                tmpnode
                                                                                            );
                                                                                        } else
                                                                                        if (value
                                                                                            .dev_net ==
                                                                                            1 &&
                                                                                            value
                                                                                            .dev_type ==
                                                                                            1 &&
                                                                                            value
                                                                                            .dev_role !=
                                                                                            3
                                                                                        ) {
                                                                                            var
                                                                                                city_name =
                                                                                                value
                                                                                                .city
                                                                                            var
                                                                                                city_sub =
                                                                                                idfinder
                                                                                                .findFirst(
                                                                                                    value
                                                                                                    .city_aid
                                                                                                );
                                                                                            if (city_sub ==
                                                                                                null) {
                                                                                                city_sub
                                                                                                    =
                                                                                                    createSubnetwork(
                                                                                                        value
                                                                                                        .city_aid,
                                                                                                        city_name,
                                                                                                        image,
                                                                                                        value
                                                                                                    );
                                                                                                if (autoflag &&
                                                                                                    city_sub
                                                                                                    .getClient(
                                                                                                        "flag"
                                                                                                    )
                                                                                                ) {
                                                                                                    autoflag
                                                                                                        =
                                                                                                        false;
                                                                                                }
                                                                                            } else {
                                                                                                var
                                                                                                    tmp_devid =
                                                                                                    city_sub
                                                                                                    .getToolTip();
                                                                                                city_sub
                                                                                                    .setToolTip(
                                                                                                        tmp_devid +
                                                                                                        "," +
                                                                                                        value
                                                                                                        .dev_id
                                                                                                    );
                                                                                            }
                                                                                        }
                                                                                    })
                                                                            }

                                                                            //链路信息linkDataList
                                                                            linkDataList =
                                                                                data.linkDataList;
                                                                            $.each(linkDataList, function (
                                                                                n, value) {
                                                                                var fromNode = null;
                                                                                var toNode = null;
                                                                                //查找连接点
                                                                                var fromId =
                                                                                    value.a_dev_id +
                                                                                    "_home";
                                                                                var toId =
                                                                                    value.z_dev_id +
                                                                                    "_home";
                                                                                if (value
                                                                                    .z_dev_net == 4
                                                                                ) {
                                                                                    toNode =
                                                                                        idfinder
                                                                                        .findFirst(
                                                                                            "169_" +
                                                                                            value
                                                                                            .z_dev_name
                                                                                        ); //找骨干
                                                                                } else
                                                                                if (value
                                                                                    .z_dev_net ==
                                                                                    1 &&
                                                                                    value
                                                                                    .z_dev_type ==
                                                                                    1 &&
                                                                                    value
                                                                                    .z_dev_role == 3
                                                                                ) {
                                                                                    toNode =
                                                                                        idfinder
                                                                                        .findFirst(
                                                                                            toId
                                                                                        ); //找省网
                                                                                }
                                                                                if (toNode ==
                                                                                    null) {
                                                                                    var
                                                                                        city_aid =
                                                                                        city_map
                                                                                        .get(
                                                                                            toId
                                                                                        ); //找地市节点------------------
                                                                                    if (city_aid !=
                                                                                        null)
                                                                                        toNode =
                                                                                        idfinder
                                                                                        .findFirst(
                                                                                            city_aid
                                                                                        );
                                                                                }
                                                                                fromNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        fromId
                                                                                    ); //找省网
                                                                                if (fromNode ==
                                                                                    null) {
                                                                                    var
                                                                                        city_aid =
                                                                                        city_map
                                                                                        .get(
                                                                                            fromId
                                                                                        ); //找地市节点----------
                                                                                    if (city_aid !=
                                                                                        null)
                                                                                        fromNode =
                                                                                        idfinder
                                                                                        .findFirst(
                                                                                            city_aid
                                                                                        );
                                                                                }
                                                                                if (fromNode !=
                                                                                    null &&
                                                                                    toNode !=
                                                                                    null &&
                                                                                    fromNode !=
                                                                                    toNode
                                                                                ) {
                                                                                    var
                                                                                        link_id =
                                                                                        "pro-" +
                                                                                        rsing_id +
                                                                                        "-" + value
                                                                                        .a_dev_id +
                                                                                        "-" + value
                                                                                        .a_ifindex;
                                                                                    var link =
                                                                                        idfinder
                                                                                        .findFirst(
                                                                                            link_id
                                                                                        );
                                                                                    if (link ==
                                                                                        null) {
                                                                                        link =
                                                                                            creatLink(
                                                                                                link_id,
                                                                                                fromNode,
                                                                                                toNode,
                                                                                                value
                                                                                            );
                                                                                    }
                                                                                }
                                                                            });

                                                                        });

                                                                    //自动布局 ----围绕布局round
                                                                    对称布局(symmetry)
                                                                    //上下topbottom
                                                                    下上布局(bottomtop) 左右布局(leftright) 左右布局(
                                                                        leftright) 分层布局(hierarchic) if (
                                                                        autoflag) {
                                                                        autoLayouter.setRepulsion(2)
                                                                        autoLayouter.doLayout('symmetry',
                                                                            function () {
                                                                                network.zoomOverview(
                                                                                    true);
                                                                            });
                                                                    } else {
                                                                        network.addViewListener(callback);
                                                                    }
                                                                    copyDataFrom1To2(box,
                                                                        home_box); //备份home数据
                                                                    $("#loading").hide();
                                                                }

                                                                function
                                                                copyDataFrom1To2(box1, box2) {
                                                                    box1.forEach(function (ele) {
                                                                        //
                                                                        if (ele.getId != 'default')
                                                                            这个是操作laylerbox时的条件
                                                                        box2.add(ele);
                                                                    });
                                                                }

                                                                //骨干网链路太多，做了“伪懒加载",主要是懒加载创建链路的操作，配合lazyLoading169方法使用
                                                                function
                                                                init169DataBox() {
                                                                    $.ajaxSetup({
                                                                        async: false
                                                                    }); //ajax
                                                                    同步-- -- - 这是一个全局的
                                                                    box.clear();
                                                                    var
                                                                        autoflag = true; //自动布局标识
                                                                    //加载位置信息
                                                                    var inte_set = new
                                                                    Set();
                                                                    var loc_url =
                                                                        "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                        rsing_id + "&type=0";
                                                                    $.post(loc_url, function (data) {
                                                                        symbolLocationMap = data;
                                                                    })
                                                                    var internation =
                                                                        createSubnetwork("169海外", "海外节点",
                                                                            "169group", null); //国际子图
                                                                    var url =
                                                                        "/rsing/topo/get169TopoData.do?1=1&rsing_id=" +
                                                                        rsing_id;
                                                                    var
                                                                        flag_loc = "_169_home";
                                                                    if (rsing_id > 99)
                                                                        flag_loc = "169other_" + rsing_id;
                                                                    $.post(url, function (data) {
                                                                        devDataList =
                                                                            data.devDataList;
                                                                        if (devDataList.length > 0) {
                                                                            $.each(devDataList,
                                                                                function (n,
                                                                                    value) {
                                                                                    var id =
                                                                                        value
                                                                                        .dev_id;
                                                                                    var name =
                                                                                        value
                                                                                        .symbol_name;
                                                                                    var area = value
                                                                                        .area;
                                                                                    var pro = value
                                                                                        .pro;
                                                                                    var city =
                                                                                        value.city;

                                                                                    var
                                                                                        tmpnode =
                                                                                        creatNode(
                                                                                            id +
                                                                                            flag_loc,
                                                                                            name,
                                                                                            "CR",
                                                                                            value);
                                                                                    if (area ==
                                                                                        "海外节点") {
                                                                                        tmpnode
                                                                                            .setName(
                                                                                                city
                                                                                            );
                                                                                        internation
                                                                                            .addChild(
                                                                                                tmpnode
                                                                                            );
                                                                                        inte_set
                                                                                            .add(
                                                                                                id);
                                                                                    } else {
                                                                                        var
                                                                                            area_group =
                                                                                            creat169Group(
                                                                                                "a_" +
                                                                                                area,
                                                                                                area,
                                                                                                "169group"
                                                                                            );
                                                                                        var
                                                                                            group =
                                                                                            creat169Group(
                                                                                                rsing_id +
                                                                                                "_" +
                                                                                                pro +
                                                                                                "_" +
                                                                                                value
                                                                                                .dev_type,
                                                                                                pro +
                                                                                                "_" +
                                                                                                typeMap[
                                                                                                    value
                                                                                                    .dev_type
                                                                                                ],
                                                                                                "CR-group"
                                                                                            );
                                                                                        group
                                                                                            .addChild(
                                                                                                tmpnode
                                                                                            );
                                                                                        area_group
                                                                                            .addChild(
                                                                                                group
                                                                                            );
                                                                                    }

                                                                                    if (area ==
                                                                                        "国际出口") {
                                                                                        var
                                                                                            area_group =
                                                                                            creat169Group(
                                                                                                "a_" +
                                                                                                area +
                                                                                                "_bak",
                                                                                                area,
                                                                                                "169group"
                                                                                            );
                                                                                        var
                                                                                            tmpnode2 =
                                                                                            creatNode(
                                                                                                id +
                                                                                                flag_loc +
                                                                                                "_bak",
                                                                                                pro,
                                                                                                "CR",
                                                                                                value
                                                                                            );
                                                                                        area_group
                                                                                            .addChild(
                                                                                                tmpnode2
                                                                                            );
                                                                                        internation
                                                                                            .addChild(
                                                                                                area_group
                                                                                            );
                                                                                        inte_set
                                                                                            .add(
                                                                                                id);
                                                                                    }

                                                                                    if (autoflag &&
                                                                                        (tmpnode
                                                                                            .getClient(
                                                                                                "flag"
                                                                                            )
                                                                                        )) {
                                                                                        //位置表有位置，不会触发自动布局
                                                                                        autoflag =
                                                                                            false;
                                                                                    }

                                                                                })
                                                                        }

                                                                        //链路信息linkDataList
                                                                        linkDataList =
                                                                            data.linkDataList;
                                                                        $.each(linkDataList, function (
                                                                            n, value) {
                                                                            var fromNode = null;
                                                                            var toNode = null;
                                                                            //查找连接点
                                                                            var fromId =
                                                                                value.a_dev_id +
                                                                                flag_loc;
                                                                            var toId =
                                                                                value.z_dev_id +
                                                                                flag_loc;
                                                                            toNode = idfinder
                                                                                .findFirst(
                                                                                    toId);
                                                                            fromNode =
                                                                                idfinder
                                                                                .findFirst(
                                                                                    fromId);

                                                                            if (fromNode !=
                                                                                null &&
                                                                                toNode !=
                                                                                null &&
                                                                                fromNode !=
                                                                                toNode
                                                                            ) {
                                                                                var
                                                                                    fa =
                                                                                    fromNode
                                                                                    .getParent()
                                                                                    .getParent();
                                                                                var
                                                                                    ta = toNode
                                                                                    .getParent()
                                                                                    .getParent();
                                                                                if (fa !=
                                                                                    null &&
                                                                                    ta != null
                                                                                ) {
                                                                                    var
                                                                                        ifspeed_aa =
                                                                                        value
                                                                                        .ifspeed;
                                                                                    var
                                                                                        link_s =
                                                                                        tmplinkMap
                                                                                        .get(fa
                                                                                            .getId() +
                                                                                            "$" +
                                                                                            ta
                                                                                            .getId()
                                                                                        )
                                                                                    if (link_s ==
                                                                                        null)
                                                                                        link_s =
                                                                                        0;
                                                                                    tmplinkMap
                                                                                        .set(fa
                                                                                            .getId() +
                                                                                            "$" +
                                                                                            ta
                                                                                            .getId(),
                                                                                            link_s +
                                                                                            ifspeed_aa
                                                                                        );
                                                                                }

                                                                            }

                                                                            if (fromNode !=
                                                                                null &&
                                                                                toNode !=
                                                                                null &&
                                                                                fromNode !=
                                                                                toNode &&
                                                                                (fromNode
                                                                                    .getParent() ==
                                                                                    internation ||
                                                                                    toNode
                                                                                    .getParent() ==
                                                                                    internation)
                                                                            ) {
                                                                                //海外节点和国际出口之间的线
                                                                                var
                                                                                    link_id =
                                                                                    "pro-" +
                                                                                    rsing_id +
                                                                                    "-" + value
                                                                                    .a_dev_id +
                                                                                    "-" + value
                                                                                    .a_ifindex;
                                                                                var link =
                                                                                    creatLink(
                                                                                        link_id,
                                                                                        fromNode,
                                                                                        toNode,
                                                                                        value);
                                                                            }
                                                                            //下面是处理副本的(海外节点subnetwork内的节点)
                                                                            if (inte_set.has(
                                                                                    value
                                                                                    .a_dev_id
                                                                                ) &&
                                                                                inte_set.has(
                                                                                    value
                                                                                    .z_dev_id)
                                                                            ) {
                                                                                toNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        toId +
                                                                                        "_bak"
                                                                                    ); //海外子网有一份国际接口副本
                                                                                fromNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        fromId +
                                                                                        "_bak"
                                                                                    ); //海外子网有一份国际接口副本
                                                                                if (toNode ==
                                                                                    null)
                                                                                    toNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        toId);
                                                                                if (fromNode ==
                                                                                    null)
                                                                                    fromNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        fromId);
                                                                                if (fromNode !=
                                                                                    null &&
                                                                                    toNode !=
                                                                                    null &&
                                                                                    fromNode !=
                                                                                    toNode
                                                                                ) {
                                                                                    var
                                                                                        link_id =
                                                                                        "pro-" +
                                                                                        rsing_id +
                                                                                        "-" +
                                                                                        value
                                                                                        .a_dev_id +
                                                                                        "-" +
                                                                                        value
                                                                                        .a_ifindex +
                                                                                        "_bak";
                                                                                    var link =
                                                                                        creatLink(
                                                                                            link_id,
                                                                                            fromNode,
                                                                                            toNode,
                                                                                            value
                                                                                        );
                                                                                    internation
                                                                                        .addChild(
                                                                                            link
                                                                                        );
                                                                                }
                                                                            }
                                                                        });
                                                                        for (var t_link of
                                                                                tmplinkMap) { //
                                                                            遍历Array创建聚合后的链路
                                                                            var
                                                                                tmp_strs = t_link[0]
                                                                                .split("$")
                                                                            var
                                                                                to_g = idfinder
                                                                                .findFirst(tmp_strs[1]);
                                                                            var from_g =
                                                                                idfinder.findFirst(
                                                                                    tmp_strs[0]);
                                                                            if (from_g != null &&
                                                                                to_g != null &&
                                                                                from_g != to_g) {
                                                                                var link =
                                                                                    creatLink("169_" +
                                                                                        t_link[0],
                                                                                        from_g, to_g,
                                                                                        null);
                                                                                link.setClient(
                                                                                    "ifspeed",
                                                                                    t_link[1]);
                                                                            }
                                                                        }
                                                                    });

                                                                    //自动布局 ----围绕布局round
                                                                    对称布局(symmetry)
                                                                    //上下topbottom
                                                                    下上布局(bottomtop)
                                                                    左右布局(leftright) 左右布局(leftright) 分层布局(
                                                                        hierarchic)
                                                                    if (autoflag) {
                                                                        autoLayouter.setRepulsion(2)
                                                                        autoLayouter.doLayout('symmetry',
                                                                            function () {
                                                                                network.zoomOverview(true);
                                                                            });
                                                                    } else {
                                                                        network.addViewListener(callback);
                                                                    }
                                                                    $("#loading").hide();
                                                                }

                                                                /**
                                                                * 大概流程:
                                                                加载慢主要是应为创建链路比较占用资源，所以优化的主要任务就避免首次加载所有链路
                                                                *
                                                                [ps:目前来看1300多条链路基本没有压力,2500多条链路需要16秒左右，4800多条链路需要47秒]
                                                                *
                                                                1.init169DataBox函数执行后只会创建几条链路
                                                                *
                                                                2.点击每个分组时，会将虚拟链路删除重新创建(不是node-node的链路都是虚拟的链路)
                                                                *
                                                                3.只要是已经创建node-node的链路，就不会再加载，反之node-group，group-group的链路每次都会删掉重新创建
                                                                *
                                                                虚拟链路保存在tmplinkMap这个全局变量中，每次都会从box中删除/创建
                                                                * @param group_obj
                                                                当前双击要展开组的对象
                                                                */
                                                                function
                                                                lazyLoading169(group_obj) {
                                                                    $.ajaxSetup({
                                                                        async: false
                                                                    }); //ajax
                                                                    同步-- -- - 这是一个全局的
                                                                    //加载位置信息
                                                                    var inte_set = new
                                                                    Set();
                                                                    for (var t_link of
                                                                            tmplinkMap) {
                                                                        box.removeById("169_" + t_link[0])
                                                                    }

                                                                    tmplinkMap.clear();
                                                                    var internation =
                                                                        box.getDataById("169海外"); //国际子图
                                                                    var url =
                                                                        "/rsing/topo/get169TopoData.do?1=1&rsing_id=" +
                                                                        rsing_id;
                                                                    var
                                                                        flag_loc = "_169_home";
                                                                    if (rsing_id > 99)
                                                                        flag_loc = "169other_" + rsing_id;
                                                                    $.post(url, function (data) {
                                                                        //链路信息linkDataList
                                                                        linkDataList =
                                                                            data.linkDataList;
                                                                        $.each(linkDataList, function (
                                                                            n, value
                                                                        ) { //start:1.遍历链路根据
                                                                            group的属性isLoading和node的情况判断是需要创建虚拟链路还是真实链路
                                                                            var fromNode = null;
                                                                            var toNode = null;
                                                                            //查找连接点
                                                                            var fromId =
                                                                                value.a_dev_id +
                                                                                flag_loc;
                                                                            var toId =
                                                                                value.z_dev_id +
                                                                                flag_loc;

                                                                            toNode = idfinder
                                                                                .findFirst(
                                                                                    toId);
                                                                            fromNode =
                                                                                idfinder
                                                                                .findFirst(
                                                                                    fromId);
                                                                            if (fromNode !=
                                                                                null &&
                                                                                toNode !=
                                                                                null &&
                                                                                fromNode !=
                                                                                toNode
                                                                            ) {
                                                                                var
                                                                                    fa =
                                                                                    fromNode
                                                                                    .getParent()
                                                                                    .getParent();
                                                                                var
                                                                                    ta = toNode
                                                                                    .getParent()
                                                                                    .getParent();
                                                                                if (fa !=
                                                                                    null &&
                                                                                    ta != null
                                                                                ) {
                                                                                    var
                                                                                        flag_fa =
                                                                                        fa
                                                                                        .getClient(
                                                                                            "isLoading"
                                                                                        );
                                                                                    var
                                                                                        flag_ta =
                                                                                        ta
                                                                                        .getClient(
                                                                                            "isLoading"
                                                                                        );
                                                                                    var
                                                                                        fa_g_name =
                                                                                        fa
                                                                                        .getName();
                                                                                    var
                                                                                        ta_g_name =
                                                                                        ta
                                                                                        .getName();

                                                                                    if (flag_fa &&
                                                                                        flag_ta
                                                                                    ) { //2.本端的group和对端group都展开过了
                                                                                        //Do Nothing
                                                                                    } else
                                                                                    if (flag_fa ==
                                                                                        null &&
                                                                                        flag_ta ==
                                                                                        null
                                                                                    ) { //3.本端group和对端group都没有展开过
                                                                                        var node_id =
                                                                                            "";
                                                                                        var group_id =
                                                                                            "";
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            fa_g_name &&
                                                                                            group_obj
                                                                                            .getName() ==
                                                                                            ta_g_name
                                                                                        ) {
                                                                                            //3.1都是本组node
                                                                                            直接建实际链路
                                                                                            var
                                                                                                link_id =
                                                                                                "pro_" +
                                                                                                rsing_id +
                                                                                                "_" +
                                                                                                value
                                                                                                .a_dev_id +
                                                                                                "_" +
                                                                                                value
                                                                                                .a_ifindex;
                                                                                            var link =
                                                                                                creatLink(
                                                                                                    link_id,
                                                                                                    fromNode,
                                                                                                    toNode,
                                                                                                    value
                                                                                                );
                                                                                        } else { //3.2
                                                                                            组内node和其他group
                                                                                            if (group_obj
                                                                                                .getName() ==
                                                                                                fa_g_name
                                                                                            ) { //3.2.1
                                                                                                判断谁是node,
                                                                                                谁是group
                                                                                                node_id =
                                                                                                fromNode
                                                                                                .getId();
                                                                                                group_id =
                                                                                                ta
                                                                                                .getId();
                                                                                            }
                                                                                            else
                                                                                            if (group_obj
                                                                                                .getName() ==
                                                                                                ta_g_name
                                                                                            ) { //3.2.2
                                                                                                判断谁是node,
                                                                                                谁是group
                                                                                                node_id =
                                                                                                toNode
                                                                                                .getId();
                                                                                                group_id =
                                                                                                fa
                                                                                                .getId();
                                                                                            }
                                                                                            else { //3.2.3
                                                                                                2 个都是group
                                                                                                node_id
                                                                                                    =
                                                                                                    ta
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    fa
                                                                                                    .getId();
                                                                                            }
                                                                                            var
                                                                                                ifspeed_aa =
                                                                                                value
                                                                                                .ifspeed;
                                                                                            var
                                                                                                link_s =
                                                                                                tmplinkMap
                                                                                                .get(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id
                                                                                                )
                                                                                            if (link_s ==
                                                                                                null
                                                                                            )
                                                                                                link_s =
                                                                                                0;
                                                                                            tmplinkMap
                                                                                                .set(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id,
                                                                                                    link_s +
                                                                                                    ifspeed_aa
                                                                                                );
                                                                                        }

                                                                                    } else
                                                                                    if (flag_fa ==
                                                                                        null ||
                                                                                        flag_ta ==
                                                                                        null
                                                                                    ) { //4.一个group开过,另一个group没有展开过,分3种情况
                                                                                        var node_id =
                                                                                            "";
                                                                                        var group_id =
                                                                                            "";
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            fa_g_name
                                                                                        ) { //4.1
                                                                                            展开过的是当前选中的group
                                                                                            if (
                                                                                                flag_fa
                                                                                            ) { //展开过的是本端
                                                                                                //DO Nothing
                                                                                            } else { //展开过的是对端
                                                                                                var
                                                                                                    link_id =
                                                                                                    "pro_" +
                                                                                                    rsing_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_dev_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_ifindex;
                                                                                                var link =
                                                                                                    creatLink(
                                                                                                        link_id,
                                                                                                        fromNode,
                                                                                                        toNode,
                                                                                                        value
                                                                                                    );
                                                                                            }
                                                                                        } else
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            ta_g_name
                                                                                        ) { //4.2
                                                                                            展开过的是选中group的对端
                                                                                            if (
                                                                                                flag_ta
                                                                                            ) { //展开过的是对端
                                                                                                //DO Nothing
                                                                                            } else { //展开过的是本端
                                                                                                var
                                                                                                    link_id =
                                                                                                    "pro_" +
                                                                                                    rsing_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_dev_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_ifindex;
                                                                                                var link =
                                                                                                    creatLink(
                                                                                                        link_id,
                                                                                                        fromNode,
                                                                                                        toNode,
                                                                                                        value
                                                                                                    );
                                                                                            }
                                                                                        } else { //
                                                                                            4.3 展开的不是选中的也不是对端
                                                                                            if (
                                                                                                flag_fa
                                                                                            ) {
                                                                                                node_id
                                                                                                    =
                                                                                                    fromNode
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    ta
                                                                                                    .getId();
                                                                                            } else {
                                                                                                node_id
                                                                                                    =
                                                                                                    toNode
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    fa
                                                                                                    .getId();
                                                                                            }
                                                                                            var
                                                                                                ifspeed_aa =
                                                                                                value
                                                                                                .ifspeed;
                                                                                            var
                                                                                                link_s =
                                                                                                tmplinkMap
                                                                                                .get(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id
                                                                                                )
                                                                                            if (link_s ==
                                                                                                null
                                                                                            )
                                                                                                link_s =
                                                                                                0;
                                                                                            tmplinkMap
                                                                                                .set(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id,
                                                                                                    link_s +
                                                                                                    ifspeed_aa
                                                                                                );
                                                                                        }
                                                                                    }
                                                                                }

                                                                            }

                                                                        });
                                                                        for (var t_link of
                                                                                tmplinkMap) { //
                                                                            遍历Array
                                                                            var
                                                                                tmp_strs = t_link[0]
                                                                                .split("$")
                                                                            var
                                                                                to_g = idfinder
                                                                                .findFirst(tmp_strs[1]);
                                                                            var from_g =
                                                                                idfinder.findFirst(
                                                                                    tmp_strs[0]);
                                                                            if (from_g != null &&
                                                                                to_g != null &&
                                                                                from_g !=
                                                                                to_g) {
                                                                                var link =
                                                                                    creatLink("169_" +
                                                                                        t_link[0],
                                                                                        from_g, to_g,
                                                                                        null);
                                                                                link.setClient(
                                                                                    "ifspeed",
                                                                                    t_link[1]);
                                                                            }
                                                                        }
                                                                    });
                                                                    network.addViewListener(callback);
                                                                }

                                                                //专门为北京这种链路太多的城市做的优化,配合initSubDataBox_lazyLoading方法使用
                                                                function
                                                                lazyLoading_city(group_obj) {
                                                                    if (group_obj == null)
                                                                        $.ajaxSetup({
                                                                            async: false
                                                                        }); //ajax 同步
                                                                    这个是直辖市的特殊处理
                                                                    twaver.Defaults.LINK_BUNDLE_AGENT_FUNCTION =
                                                                        null;
                                                                    var
                                                                        autoflag = true; //自动布局标识
                                                                    var flag =
                                                                        0; //判断结点初始化是否有坐标
                                                                    决定用不用自动布局
                                                                    var city_id =
                                                                        cityMap[pro];
                                                                    city_id = (city_id + "").replace(
                                                                        "multi_hop", "");
                                                                    var cr_devid =
                                                                        group_obj == null ? pro : group_obj
                                                                        .getToolTip();

                                                                    var tmp_url =
                                                                        "/rsing/topo/getSubTopoData.do?1=1&city_id=" +
                                                                        city_id + "&rsing_id=" + rsing_id;
                                                                    var
                                                                        url = tmp_url + "&multi_hop_flag=1";
                                                                    var
                                                                        city_name = group_obj == null ? pro :
                                                                        group_obj.getName();

                                                                    var inte_set = new
                                                                    Set();
                                                                    for (var t_link of
                                                                            tmplinkMap) {
                                                                        box.removeById("sub_" + t_link[0])
                                                                    }
                                                                    tmplinkMap.clear();
                                                                    $.post(url, function (data) {
                                                                        //链路信息linkDataList
                                                                        linkDataList =
                                                                            data.linkDataList;
                                                                        $.each(linkDataList, function (
                                                                            n, value
                                                                        ) { //start:1.遍历链路根据
                                                                            group的属性isLoading和node的情况判断是需要创建虚拟链路还是真实链路
                                                                            var fromNode = null;
                                                                            var toNode = null;
                                                                            //1.找fromnode
                                                                            和tonode
                                                                            var fromId =
                                                                                city_id + "_" +
                                                                                value.a_dev_id;
                                                                            fromNode =
                                                                                idfinder
                                                                                .findFirst(
                                                                                    fromId);
                                                                            //处理普通设备节点
                                                                            if (value
                                                                                .z_dev_id !=
                                                                                0 &&
                                                                                value
                                                                                .z_dev_net ==
                                                                                1 &&
                                                                                value
                                                                                .z_dev_type !=
                                                                                -1) {
                                                                                //查找连接点
                                                                                var toId =
                                                                                    city_id +
                                                                                    "_" + value
                                                                                    .z_dev_id;
                                                                                toNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        toId);
                                                                                //role=4和role=7
                                                                                devid = 0 的
                                                                                为idc网络和cdn网络设备(
                                                                                    只有设备名称没有其他信息
                                                                                )
                                                                                需要单独处理
                                                                            } else
                                                                            if (value
                                                                                .z_dev_net ==
                                                                                2 ||
                                                                                value
                                                                                .z_dev_net ==
                                                                                3 ||
                                                                                value
                                                                                .z_dev_net ==
                                                                                6) {
                                                                                var toId =
                                                                                    city_id +
                                                                                    "_" + (value
                                                                                        .z_dev_id ==
                                                                                        0 ?
                                                                                        value
                                                                                        .z_dev_name :
                                                                                        value
                                                                                        .z_dev_id
                                                                                    ); //有的idc或cdn没有id只有设备名称
                                                                                toNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        toId);
                                                                                /*var
                                                                                g_image=getGroupImageFormDev(value.z_dev_net,value.z_dev_type,value.z_dev_role);
                                                                                var
                                                                                group_id=city_id+"_"+cr_devid+"_"+value.z_dev_net
                                                                                var
                                                                                group=idfinder.findFirst(group_id)*/

                                                                                //处理骨干网
                                                                            } else
                                                                            if (value
                                                                                .z_dev_net ==
                                                                                4) { //处理169骨干网
                                                                                toNode =
                                                                                    idfinder
                                                                                    .findFirst(
                                                                                        city_id +
                                                                                        "_" +
                                                                                        value
                                                                                        .z_dev_name
                                                                                    ); //找169骨干网
                                                                            }
                                                                            //2.划线逻辑
                                                                            if (fromNode !=
                                                                                null &&
                                                                                toNode !=
                                                                                null &&
                                                                                fromNode !=
                                                                                toNode
                                                                            ) {
                                                                                var
                                                                                    fa =
                                                                                    fromNode
                                                                                    .getParent();
                                                                                var
                                                                                    ta = toNode
                                                                                    .getParent();
                                                                                if (fa !=
                                                                                    null &&
                                                                                    ta != null
                                                                                ) {
                                                                                    var
                                                                                        flag_fa =
                                                                                        fa
                                                                                        .getClient(
                                                                                            "isLoading"
                                                                                        );
                                                                                    var
                                                                                        flag_ta =
                                                                                        ta
                                                                                        .getClient(
                                                                                            "isLoading"
                                                                                        );
                                                                                    var
                                                                                        fa_g_name =
                                                                                        fa
                                                                                        .getName();
                                                                                    var
                                                                                        ta_g_name =
                                                                                        ta
                                                                                        .getName();

                                                                                    if (flag_fa &&
                                                                                        flag_ta
                                                                                    ) { //2.本端的group和对端group都展开过了
                                                                                        //Do Nothing
                                                                                    } else
                                                                                    if (flag_fa ==
                                                                                        null &&
                                                                                        flag_ta ==
                                                                                        null
                                                                                    ) { //3.本端group和对端group都没有展开过
                                                                                        var node_id =
                                                                                            "";
                                                                                        var group_id =
                                                                                            "";
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            fa_g_name &&
                                                                                            group_obj
                                                                                            .getName() ==
                                                                                            ta_g_name
                                                                                        ) {
                                                                                            //3.1都是本组node
                                                                                            直接建实际链路
                                                                                            var
                                                                                                link_id =
                                                                                                "pro_" +
                                                                                                rsing_id +
                                                                                                "_" +
                                                                                                value
                                                                                                .a_dev_id +
                                                                                                "_" +
                                                                                                value
                                                                                                .a_ifindex;
                                                                                            var link =
                                                                                                creatLink(
                                                                                                    link_id,
                                                                                                    fromNode,
                                                                                                    toNode,
                                                                                                    value
                                                                                                );
                                                                                        } else { //3.2
                                                                                            组内node和其他group
                                                                                            if (group_obj
                                                                                                .getName() ==
                                                                                                fa_g_name
                                                                                            ) { //3.2.1
                                                                                                判断谁是node,
                                                                                                谁是group
                                                                                                node_id =
                                                                                                fromNode
                                                                                                .getId();
                                                                                                group_id =
                                                                                                ta
                                                                                                .getId();
                                                                                            }
                                                                                            else
                                                                                            if (group_obj
                                                                                                .getName() ==
                                                                                                ta_g_name
                                                                                            ) { //3.2.2
                                                                                                判断谁是node,
                                                                                                谁是group
                                                                                                node_id =
                                                                                                toNode
                                                                                                .getId();
                                                                                                group_id =
                                                                                                fa
                                                                                                .getId();
                                                                                            }
                                                                                            else { //3.2.3
                                                                                                2 个都是group
                                                                                                node_id
                                                                                                    =
                                                                                                    ta
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    fa
                                                                                                    .getId();
                                                                                            }
                                                                                            var
                                                                                                ifspeed_aa =
                                                                                                value
                                                                                                .ifspeed;
                                                                                            var
                                                                                                link_s =
                                                                                                tmplinkMap
                                                                                                .get(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id
                                                                                                )
                                                                                            if (link_s ==
                                                                                                null
                                                                                            )
                                                                                                link_s =
                                                                                                0;
                                                                                            tmplinkMap
                                                                                                .set(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id,
                                                                                                    link_s +
                                                                                                    ifspeed_aa
                                                                                                );
                                                                                        }

                                                                                    } else
                                                                                    if (flag_fa ==
                                                                                        null ||
                                                                                        flag_ta ==
                                                                                        null
                                                                                    ) { //4.一个group开过,另一个group没有展开过,分3种情况
                                                                                        var node_id =
                                                                                            "";
                                                                                        var group_id =
                                                                                            "";
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            fa_g_name
                                                                                        ) { //4.1
                                                                                            展开过的是当前选中的group
                                                                                            if (
                                                                                                flag_fa
                                                                                            ) { //展开过的是本端
                                                                                                //DO Nothing
                                                                                            } else { //展开过的是对端
                                                                                                var
                                                                                                    link_id =
                                                                                                    "pro_" +
                                                                                                    rsing_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_dev_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_ifindex;
                                                                                                var link =
                                                                                                    creatLink(
                                                                                                        link_id,
                                                                                                        fromNode,
                                                                                                        toNode,
                                                                                                        value
                                                                                                    );
                                                                                            }
                                                                                        } else
                                                                                        if (group_obj
                                                                                            .getName() ==
                                                                                            ta_g_name
                                                                                        ) { //4.2
                                                                                            展开过的是选中group的对端
                                                                                            if (
                                                                                                flag_ta
                                                                                            ) { //展开过的是对端
                                                                                                //DO Nothing
                                                                                            } else { //展开过的是本端
                                                                                                var
                                                                                                    link_id =
                                                                                                    "pro_" +
                                                                                                    rsing_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_dev_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .a_ifindex;
                                                                                                var link =
                                                                                                    creatLink(
                                                                                                        link_id,
                                                                                                        fromNode,
                                                                                                        toNode,
                                                                                                        value
                                                                                                    );
                                                                                            }
                                                                                        } else { //
                                                                                            4.3 展开的不是选中的group也不是对端
                                                                                            if (
                                                                                                flag_fa
                                                                                            ) {
                                                                                                node_id
                                                                                                    =
                                                                                                    fromNode
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    ta
                                                                                                    .getId();
                                                                                            } else {
                                                                                                node_id
                                                                                                    =
                                                                                                    toNode
                                                                                                    .getId();
                                                                                                group_id
                                                                                                    =
                                                                                                    fa
                                                                                                    .getId();
                                                                                            }
                                                                                            var
                                                                                                ifspeed_aa =
                                                                                                value
                                                                                                .ifspeed;
                                                                                            var
                                                                                                link_s =
                                                                                                tmplinkMap
                                                                                                .get(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id
                                                                                                )
                                                                                            if (link_s ==
                                                                                                null
                                                                                            )
                                                                                                link_s =
                                                                                                0;
                                                                                            tmplinkMap
                                                                                                .set(
                                                                                                    node_id +
                                                                                                    "$" +
                                                                                                    group_id,
                                                                                                    link_s +
                                                                                                    ifspeed_aa
                                                                                                );
                                                                                        }
                                                                                    }
                                                                                }

                                                                            }

                                                                        });
                                                                        for (var t_link of
                                                                                tmplinkMap) { //
                                                                            遍历Array
                                                                            var
                                                                                tmp_strs = t_link[0]
                                                                                .split("$")
                                                                            var
                                                                                to_g = idfinder
                                                                                .findFirst(tmp_strs[1]);
                                                                            var from_g =
                                                                                idfinder.findFirst(
                                                                                    tmp_strs[0]);
                                                                            if (from_g != null &&
                                                                                to_g != null &&
                                                                                from_g !=
                                                                                to_g) {
                                                                                var link =
                                                                                    creatLink("sub_" +
                                                                                        t_link[0],
                                                                                        from_g, to_g,
                                                                                        null);
                                                                                link.setClient(
                                                                                    "ifspeed",
                                                                                    t_link[1]);
                                                                            }
                                                                        }
                                                                    });
                                                                    network.addViewListener(callback);
                                                                }



                                                                //加载数据
                                                                function
                                                                initSubDataBox(subNetWork, multi_hop_flag) {
                                                                    if (subNetWork == null)
                                                                        $.ajaxSetup({
                                                                            async: false
                                                                        }); //ajax 同步
                                                                    这个是直辖市的特殊处理
                                                                    twaver.Defaults.LINK_BUNDLE_AGENT_FUNCTION =
                                                                        null;
                                                                    var
                                                                        autoflag = true; //自动布局标识
                                                                    var flag =
                                                                        0; //判断结点初始化是否有坐标
                                                                    决定用不用自动布局
                                                                    subAuto_list.clear();
                                                                    var city_id =
                                                                        subNetWork == null ? cityMap[pro] :
                                                                        subNetWork.getId();
                                                                    city_id = (city_id + "").replace(
                                                                        "multi_hop", "");
                                                                    curr_city_aid = city_id;
                                                                    var cr_devid =
                                                                        subNetWork == null ? pro : subNetWork
                                                                        .getToolTip();
                                                                    if (cityMap[pro] != null) {
                                                                        //加载位置信息
                                                                        var loc_url =
                                                                            "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                            rsing_id + "&type=0";
                                                                        $.post(loc_url, function (data) {
                                                                            symbolLocationMap = data;
                                                                        })
                                                                    }
                                                                    var tmp_url =
                                                                        "/rsing/topo/getSubTopoData.do?1=1&city_id=" +
                                                                        city_id + "&rsing_id=" + rsing_id;
                                                                    var
                                                                        url = tmp_url + "&multi_hop_flag=" + (
                                                                            multi_hop_flag ? "2" : "1"
                                                                        ); //画多跳设备链路视图topo_view_type=2
                                                                    var
                                                                        city_name = subNetWork == null ? pro :
                                                                        subNetWork.getName();

                                                                    $.post(url, function (data) {
                                                                                //设备list
                                                                                devDataList =
                                                                                    data.devDataList;
                                                                                if (devDataList.length > 0) {
                                                                                    $.each(devDataList,
                                                                                        function (n,
                                                                                            value) {
                                                                                            if (value
                                                                                                .dev_net >=
                                                                                                1 &&
                                                                                                value
                                                                                                .dev_net <=
                                                                                                6) {
                                                                                                var
                                                                                                    id =
                                                                                                    value
                                                                                                    .dev_id;
                                                                                                var
                                                                                                    name =
                                                                                                    value
                                                                                                    .symbol_name;
                                                                                                var
                                                                                                    image =
                                                                                                    getImageFormDev(
                                                                                                        value
                                                                                                        .dev_net,
                                                                                                        value
                                                                                                        .dev_type,
                                                                                                        value
                                                                                                        .dev_role
                                                                                                    );
                                                                                                if (value
                                                                                                    .dev_net ==
                                                                                                    4
                                                                                                ) { //处理骨干网
                                                                                                    var
                                                                                                        g169_id =
                                                                                                        city_id +
                                                                                                        "sub_169";
                                                                                                    var
                                                                                                        n169_id =
                                                                                                        city_id +
                                                                                                        "_" +
                                                                                                        name
                                                                                                    var
                                                                                                        group169 =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            g169_id
                                                                                                        );
                                                                                                    if (group169 ==
                                                                                                        null
                                                                                                    )
                                                                                                        group169 =
                                                                                                        creatSubNetL3Group(
                                                                                                            g169_id,
                                                                                                            "China
                                                                                                            169 骨干网 ","
                                                                                                            169 ggw ",subNetWork,subAuto_list);
                                                                                                            var
                                                                                                                tmp_node_2 =
                                                                                                                idfinder
                                                                                                                .findFirst(
                                                                                                                    city_id +
                                                                                                                    "_" +
                                                                                                                    name
                                                                                                                ); //找169骨干网
                                                                                                            if (tmp_node_2 ==
                                                                                                                null
                                                                                                            ) {
                                                                                                                tmp_node_2
                                                                                                                    =
                                                                                                                    creatNode(
                                                                                                                        n169_id,
                                                                                                                        name,
                                                                                                                        "CR",
                                                                                                                        value
                                                                                                                    );
                                                                                                            }
                                                                                                            group169
                                                                                                            .addChild(
                                                                                                                tmp_node_2
                                                                                                            );
                                                                                                            if (autoflag &&
                                                                                                                group169
                                                                                                                .getClient(
                                                                                                                    "flag"
                                                                                                                ) &&
                                                                                                                tmp_node_2
                                                                                                                .getClient(
                                                                                                                    "flag"
                                                                                                                )
                                                                                                            ) {
                                                                                                                autoflag
                                                                                                                    =
                                                                                                                    false;
                                                                                                            }
                                                                                                            if (subNetWork !=
                                                                                                                null &&
                                                                                                                !
                                                                                                                subNetWork
                                                                                                                .isParentOf(
                                                                                                                    group169
                                                                                                                )
                                                                                                            ) { //这个是处理cr一跳多跳的
                                                                                                                subNetWork
                                                                                                                    .addChild(
                                                                                                                        group169
                                                                                                                    );
                                                                                                            }
                                                                                                        }
                                                                                                    else { //处理非骨干网的
                                                                                                        var x =
                                                                                                            0;
                                                                                                        var
                                                                                                            y =
                                                                                                            0; //比如广州的sr可能会出现在佛山下和佛山CR链接，广州自己也有这个sr，为区分这2个sr，需要加城市id来区分
                                                                                                        var
                                                                                                            tmp_node =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                city_id +
                                                                                                                "_" +
                                                                                                                id
                                                                                                            );
                                                                                                        if (
                                                                                                            tmp_node ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            tmp_node
                                                                                                                =
                                                                                                                creatNode(
                                                                                                                    city_id +
                                                                                                                    "_" +
                                                                                                                    id,
                                                                                                                    name,
                                                                                                                    image,
                                                                                                                    value
                                                                                                                );
                                                                                                        }
                                                                                                        var
                                                                                                            l3g_id =
                                                                                                            value
                                                                                                            .city +
                                                                                                            "_" +
                                                                                                            cr_devid +
                                                                                                            "_" +
                                                                                                            value
                                                                                                            .dev_net +
                                                                                                            "_" +
                                                                                                            value
                                                                                                            .dev_type;
                                                                                                        var
                                                                                                            l3g_name =
                                                                                                            "unknown";
                                                                                                        if (value
                                                                                                            .dev_net ==
                                                                                                            2 ||
                                                                                                            value
                                                                                                            .dev_net ==
                                                                                                            3 ||
                                                                                                            value
                                                                                                            .dev_net ==
                                                                                                            6
                                                                                                        ) { //单独处理IDC网络的
                                                                                                            l3g_name
                                                                                                                =
                                                                                                                netMap[
                                                                                                                    value
                                                                                                                    .dev_net
                                                                                                                ];
                                                                                                            image
                                                                                                                =
                                                                                                                getGroupImageFormDev(
                                                                                                                    value
                                                                                                                    .dev_net,
                                                                                                                    value
                                                                                                                    .dev_type,
                                                                                                                    value
                                                                                                                    .dev_role
                                                                                                                );
                                                                                                            l3g_id
                                                                                                                =
                                                                                                                city_id +
                                                                                                                "_" +
                                                                                                                cr_devid +
                                                                                                                "_" +
                                                                                                                value
                                                                                                                .dev_net;
                                                                                                        } else
                                                                                                        if (value
                                                                                                            .dev_net ==
                                                                                                            1 &&
                                                                                                            value
                                                                                                            .dev_type ==
                                                                                                            1
                                                                                                        ) {
                                                                                                            if (value
                                                                                                                .dev_role ==
                                                                                                                3
                                                                                                            ) { //省网cr
                                                                                                                l3g_id
                                                                                                                    =
                                                                                                                    city_id +
                                                                                                                    "_swhx";
                                                                                                                l3g_name
                                                                                                                    =
                                                                                                                    "省网核心";
                                                                                                                image
                                                                                                                    =
                                                                                                                    getGroupImageFormDev(
                                                                                                                        value
                                                                                                                        .dev_net,
                                                                                                                        value
                                                                                                                        .dev_type,
                                                                                                                        value
                                                                                                                        .dev_role
                                                                                                                    );
                                                                                                            } else {
                                                                                                                l3g_id
                                                                                                                    =
                                                                                                                    value
                                                                                                                    .city +
                                                                                                                    "_" +
                                                                                                                    cr_devid +
                                                                                                                    "_" +
                                                                                                                    value
                                                                                                                    .dev_net +
                                                                                                                    "_" +
                                                                                                                    value
                                                                                                                    .dev_type +
                                                                                                                    "_" +
                                                                                                                    value
                                                                                                                    .dev_role;
                                                                                                                if (value
                                                                                                                    .dev_role ==
                                                                                                                    2
                                                                                                                ) {
                                                                                                                    l3g_name
                                                                                                                        =
                                                                                                                        value
                                                                                                                        .city +
                                                                                                                        "_" +
                                                                                                                        typeMap[
                                                                                                                            value
                                                                                                                            .dev_type
                                                                                                                        ] +
                                                                                                                        "_" +
                                                                                                                        roleMap[
                                                                                                                            value
                                                                                                                            .dev_role
                                                                                                                        ];
                                                                                                                } else {
                                                                                                                    l3g_name
                                                                                                                        =
                                                                                                                        value
                                                                                                                        .city +
                                                                                                                        "_" +
                                                                                                                        typeMap[
                                                                                                                            value
                                                                                                                            .dev_type
                                                                                                                        ];
                                                                                                                }
                                                                                                                image
                                                                                                                    =
                                                                                                                    image +
                                                                                                                    "-group";
                                                                                                            }
                                                                                                        } else {
                                                                                                            l3g_name
                                                                                                                =
                                                                                                                value
                                                                                                                .city +
                                                                                                                "_" +
                                                                                                                typeMap[
                                                                                                                    value
                                                                                                                    .dev_type
                                                                                                                ];
                                                                                                            image
                                                                                                                =
                                                                                                                image +
                                                                                                                "-group";
                                                                                                        } //第三层 var
                                                                                                        l3group
                                                                                                            =
                                                                                                            creatSubNetL3Group(
                                                                                                                l3g_id,
                                                                                                                l3g_name,
                                                                                                                image,
                                                                                                                subNetWork,
                                                                                                                subAuto_list
                                                                                                            );
                                                                                                        l3group
                                                                                                            .addChild(
                                                                                                                tmp_node
                                                                                                            );
                                                                                                        if (autoflag &&
                                                                                                            l3group
                                                                                                            .getClient(
                                                                                                                "flag"
                                                                                                            ) &&
                                                                                                            tmp_node
                                                                                                            .getClient(
                                                                                                                "flag"
                                                                                                            )
                                                                                                        ) { //位置表有位置，不会触发自动布局
                                                                                                            autoflag
                                                                                                                =
                                                                                                                false;
                                                                                                        }
                                                                                                    } //基本数据过滤 els
                                                                                                }
                                                                                                /*else
                                                                                                                                                                                                       if(value.dev_net==6
                                                                                                                                                                                                       ){ }*/
                                                                                            })
                                                                                    } //链路信息linkDataList
                                                                                    linkDataList = data
                                                                                        .linkDataList;
                                                                                    $.each(linkDataList,
                                                                                        function (n,
                                                                                            value) {
                                                                                            var
                                                                                                toNode =
                                                                                                null;
                                                                                            var
                                                                                                fromNode =
                                                                                                null;
                                                                                            var
                                                                                                fromId =
                                                                                                city_id +
                                                                                                "_" +
                                                                                                value
                                                                                                .a_dev_id;
                                                                                            fromNode =
                                                                                                idfinder
                                                                                                .findFirst(
                                                                                                    fromId
                                                                                                ); //处理普通设备节点
                                                                                            if (value
                                                                                                .z_dev_id !=
                                                                                                0 &&
                                                                                                value
                                                                                                .z_dev_net ==
                                                                                                1 &&
                                                                                                value
                                                                                                .z_dev_type !=
                                                                                                -1
                                                                                            ) { //查找连接点
                                                                                                var
                                                                                                    toId =
                                                                                                    city_id +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .z_dev_id;
                                                                                                toNode =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        toId
                                                                                                    ); //role=4和role=7
                                                                                                devid = 0 的
                                                                                                为idc网络和cdn网络设备
                                                                                                    (
                                                                                                        只有设备名称没有其他信息
                                                                                                    )
                                                                                                需要单独处理
                                                                                            } else
                                                                                            if (value
                                                                                                .z_dev_net ==
                                                                                                2 ||
                                                                                                value
                                                                                                .z_dev_net ==
                                                                                                3 ||
                                                                                                value
                                                                                                .z_dev_net ==
                                                                                                6) {
                                                                                                var
                                                                                                    toId =
                                                                                                    city_id +
                                                                                                    "_" + (
                                                                                                        value
                                                                                                        .z_dev_id ==
                                                                                                        0 ?
                                                                                                        value
                                                                                                        .z_dev_name :
                                                                                                        value
                                                                                                        .z_dev_id
                                                                                                    ); //有的idc或cdn没有id只有设备名称
                                                                                                toNode =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        toId
                                                                                                    );
                                                                                                var
                                                                                                    g_image =
                                                                                                    getGroupImageFormDev(
                                                                                                        value
                                                                                                        .z_dev_net,
                                                                                                        value
                                                                                                        .z_dev_type,
                                                                                                        value
                                                                                                        .z_dev_role
                                                                                                    );
                                                                                                var
                                                                                                    group_id =
                                                                                                    city_id +
                                                                                                    "_" +
                                                                                                    cr_devid +
                                                                                                    "_" +
                                                                                                    value
                                                                                                    .z_dev_net
                                                                                                var
                                                                                                    group =
                                                                                                    creatSubNetL3Group(
                                                                                                        group_id,
                                                                                                        netMap[
                                                                                                            value
                                                                                                            .z_dev_net
                                                                                                        ],
                                                                                                        g_image,
                                                                                                        subNetWork,
                                                                                                        subAuto_list
                                                                                                    );
                                                                                                if (toNode ==
                                                                                                    null) {
                                                                                                    toNode =
                                                                                                        creatNode(
                                                                                                            toId,
                                                                                                            value
                                                                                                            .z_dev_name,
                                                                                                            "SR",
                                                                                                            null
                                                                                                        )
                                                                                                    toNode
                                                                                                        .setStyle(
                                                                                                            'whole.alpha',
                                                                                                            0.7
                                                                                                        );
                                                                                                    group
                                                                                                        .addChild(
                                                                                                            toNode
                                                                                                        );
                                                                                                    if (autoflag &&
                                                                                                        group
                                                                                                        .getClient(
                                                                                                            "flag"
                                                                                                        ) &&
                                                                                                        toNode
                                                                                                        .getClient(
                                                                                                            "flag"
                                                                                                        )
                                                                                                    ) {
                                                                                                        autoflag
                                                                                                            =
                                                                                                            false;
                                                                                                    }
                                                                                                }
                                                                                                if (subNetWork !=
                                                                                                    null &&
                                                                                                    !
                                                                                                    subNetWork
                                                                                                    .isParentOf(
                                                                                                        group
                                                                                                    )
                                                                                                ) { //这个是处理cr一跳多跳的
                                                                                                    subNetWork
                                                                                                        .addChild(
                                                                                                            group
                                                                                                        );
                                                                                                } //处理骨干网 }else
                                                                                                if (value
                                                                                                    .z_dev_net ==
                                                                                                    4
                                                                                                ) { //处理169骨干网
                                                                                                    toNode =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            city_id +
                                                                                                            "_" +
                                                                                                            value
                                                                                                            .z_dev_name
                                                                                                        ); //找169骨干网
                                                                                                }
                                                                                                if (fromNode !=
                                                                                                    null &&
                                                                                                    toNode !=
                                                                                                    null) {
                                                                                                    var
                                                                                                        link_id =
                                                                                                        "sub-" +
                                                                                                        rsing_id +
                                                                                                        "-" +
                                                                                                        value
                                                                                                        .a_dev_id +
                                                                                                        "-" +
                                                                                                        value
                                                                                                        .a_ifindex;
                                                                                                    var
                                                                                                        link =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            link_id
                                                                                                        );
                                                                                                    if (link ==
                                                                                                        null
                                                                                                    ) {
                                                                                                        link =
                                                                                                            creatLink(
                                                                                                                link_id,
                                                                                                                fromNode,
                                                                                                                toNode,
                                                                                                                value
                                                                                                            );
                                                                                                        if (subNetWork !=
                                                                                                            null
                                                                                                        )
                                                                                                            subNetWork
                                                                                                            .addChild(
                                                                                                                link
                                                                                                            );
                                                                                                    }
                                                                                                    if (subNetWork !=
                                                                                                        null &&
                                                                                                        !
                                                                                                        subNetWork
                                                                                                        .isParentOf(
                                                                                                            link
                                                                                                        )
                                                                                                    ) { //这个是处理cr一跳多跳的
                                                                                                        if (subNetWork !=
                                                                                                            null
                                                                                                        )
                                                                                                            subNetWork
                                                                                                            .addChild(
                                                                                                                link
                                                                                                            );
                                                                                                    }
                                                                                                    subAuto_list
                                                                                                        .add(
                                                                                                            link
                                                                                                        );
                                                                                                    /*
                                                                                                                                                                                                           if(!fromNode.getClient("flag")
                                                                                                                                                                                                           ||
                                                                                                                                                                                                           !toNode.getClient("flag")){
                                                                                                                                                                                                           console.log("let
                                                                                                                                                                                                           me see"); }*/
                                                                                                }
                                                                                            });
                                                                                    });
                                                                                if (autoflag) { //自动布局
                                                                                    -- --围绕布局round
                                                                                    对称布局(symmetry) //上下topbottom
                                                                                    下上布局(bottomtop)
                                                                                    左右布局(leftright) 左右布局(
                                                                                        leftright) 分层布局(
                                                                                        hierarchic)
                                                                                    subAutoLayouter
                                                                                        .getElements =
                                                                                        function () {
                                                                                            return
                                                                                            subAuto_list;
                                                                                        };
                                                                                    subAutoLayouter
                                                                                        .setRepulsion(2);
                                                                                    subAutoLayouter.setAnimate(
                                                                                        false);
                                                                                    var
                                                                                        aaaaaa = subAutoLayouter
                                                                                        .doLayout('symmetry',
                                                                                            function () {
                                                                                                network
                                                                                                    .zoomOverview(
                                                                                                        true);
                                                                                            });
                                                                                } else {
                                                                                    network.addViewListener(
                                                                                        callback);
                                                                                }
                                                                            } //专门为北京这种链路太多的城市做的优化
                                                                            配合lazyLoading_city使用
                                                                            function initSubDataBox_lazyLoading(
                                                                                subNetWork, multi_hop_flag) {
                                                                                if (subNetWork == null)
                                                                                    $.ajaxSetup({
                                                                                        async: false
                                                                                    }); //ajax
                                                                                同步 这个是直辖市的特殊处理
                                                                                twaver.Defaults
                                                                                    .LINK_BUNDLE_AGENT_FUNCTION =
                                                                                    null;
                                                                                var
                                                                                    autoflag = true; //自动布局标识
                                                                                var
                                                                                    flag = 0; //判断结点初始化是否有坐标
                                                                                决定用不用自动布局
                                                                                subAuto_list.clear();
                                                                                var
                                                                                    city_id = subNetWork ==
                                                                                    null ? cityMap[pro] :
                                                                                    subNetWork.getId();
                                                                                city_id = (city_id + "")
                                                                                    .replace("multi_hop", "");
                                                                                curr_city_aid = city_id;
                                                                                var
                                                                                    cr_devid = subNetWork ==
                                                                                    null ? pro : subNetWork
                                                                                    .getToolTip();
                                                                                if (cityMap[pro] !=
                                                                                    null) { //加载位置信息
                                                                                    var
                                                                                        loc_url =
                                                                                        "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                                        rsing_id + "&type=0";
                                                                                    $.post(loc_url, function (
                                                                                        data) {
                                                                                        symbolLocationMap
                                                                                            = data;
                                                                                    })
                                                                                }
                                                                                var
                                                                                    tmp_url =
                                                                                    "/rsing/topo/getSubTopoData.do?1=1&city_id=" +
                                                                                    city_id + "&rsing_id=" +
                                                                                    rsing_id;
                                                                                var url = tmp_url +
                                                                                    " &multi_hop_flag=" + (
                                                                                        multi_hop_flag ? " 2" :
                                                                                        "1"
                                                                                    ); //画多跳设备链路视图topo_view_type=2 var city_name=subNetWork==null?pro:subNetWork.getName();
                                                                                $.post(url, function (
                                                                                        data) { //设备list
                                                                                        devDataList = data
                                                                                            .devDataList;
                                                                                        if (devDataList
                                                                                            .length >
                                                                                            0) {
                                                                                            $.each(devDataList,
                                                                                                function (
                                                                                                    n,
                                                                                                    value
                                                                                                ) {
                                                                                                    if (value
                                                                                                        .dev_net >=
                                                                                                        1 &&
                                                                                                        value
                                                                                                        .dev_net <=
                                                                                                        6
                                                                                                    ) {
                                                                                                        var
                                                                                                            id =
                                                                                                            value
                                                                                                            .dev_id;
                                                                                                        var
                                                                                                            name =
                                                                                                            value
                                                                                                            .symbol_name;
                                                                                                        var
                                                                                                            image =
                                                                                                            getImageFormDev(
                                                                                                                value
                                                                                                                .dev_net,
                                                                                                                value
                                                                                                                .dev_type,
                                                                                                                value
                                                                                                                .dev_role
                                                                                                            );
                                                                                                        if (value
                                                                                                            .dev_net ==
                                                                                                            4
                                                                                                        ) { //处理骨干网
                                                                                                            var
                                                                                                                g169_id =
                                                                                                                city_id +
                                                                                                                "sub_169";
                                                                                                            var
                                                                                                                n169_id =
                                                                                                                city_id +
                                                                                                                "_" +
                                                                                                                name
                                                                                                            var
                                                                                                                group169 =
                                                                                                                idfinder
                                                                                                                .findFirst(
                                                                                                                    g169_id
                                                                                                                );
                                                                                                            if (group169 ==
                                                                                                                null
                                                                                                            )
                                                                                                                group169 =
                                                                                                                creatSubNetL3Group(
                                                                                                                    g169_id,
                                                                                                                    "China
                                                                                                                    169 骨干网 ","
                                                                                                                    169 ggw ",subNetWork,subAuto_list);
                                                                                                                    var
                                                                                                                        tmp_node_2 =
                                                                                                                        idfinder
                                                                                                                        .findFirst(
                                                                                                                            city_id +
                                                                                                                            "_" +
                                                                                                                            name
                                                                                                                        ); //找169骨干网
                                                                                                                    if (tmp_node_2 ==
                                                                                                                        null
                                                                                                                    ) {
                                                                                                                        tmp_node_2
                                                                                                                            =
                                                                                                                            creatNode(
                                                                                                                                n169_id,
                                                                                                                                name,
                                                                                                                                "CR",
                                                                                                                                value
                                                                                                                            );
                                                                                                                    }
                                                                                                                    group169
                                                                                                                    .addChild(
                                                                                                                        tmp_node_2
                                                                                                                    );
                                                                                                                    if (autoflag &&
                                                                                                                        group169
                                                                                                                        .getClient(
                                                                                                                            "flag"
                                                                                                                        ) &&
                                                                                                                        tmp_node_2
                                                                                                                        .getClient(
                                                                                                                            "flag"
                                                                                                                        )
                                                                                                                    ) {
                                                                                                                        autoflag
                                                                                                                            =
                                                                                                                            false;
                                                                                                                    }
                                                                                                                    if (subNetWork !=
                                                                                                                        null &&
                                                                                                                        !
                                                                                                                        subNetWork
                                                                                                                        .isParentOf(
                                                                                                                            group169
                                                                                                                        )
                                                                                                                    ) { //这个是处理cr一跳多跳的
                                                                                                                        subNetWork
                                                                                                                            .addChild(
                                                                                                                                group169
                                                                                                                            );
                                                                                                                    }
                                                                                                                }
                                                                                                            else { //处理非骨干网的
                                                                                                                var x =
                                                                                                                    0;
                                                                                                                var
                                                                                                                    y =
                                                                                                                    0; //比如广州的sr可能会出现在佛山下和佛山CR链接，广州自己也有这个sr，为区分这2个sr，需要加城市id来区分
                                                                                                                var
                                                                                                                    tmp_node =
                                                                                                                    idfinder
                                                                                                                    .findFirst(
                                                                                                                        city_id +
                                                                                                                        "_" +
                                                                                                                        id
                                                                                                                    );
                                                                                                                if (
                                                                                                                    tmp_node ==
                                                                                                                    null
                                                                                                                ) {
                                                                                                                    tmp_node
                                                                                                                        =
                                                                                                                        creatNode(
                                                                                                                            city_id +
                                                                                                                            "_" +
                                                                                                                            id,
                                                                                                                            name,
                                                                                                                            image,
                                                                                                                            value
                                                                                                                        );
                                                                                                                }
                                                                                                                var
                                                                                                                    l3g_id =
                                                                                                                    value
                                                                                                                    .city +
                                                                                                                    "_" +
                                                                                                                    cr_devid +
                                                                                                                    "_" +
                                                                                                                    value
                                                                                                                    .dev_net +
                                                                                                                    "_" +
                                                                                                                    value
                                                                                                                    .dev_type;
                                                                                                                var
                                                                                                                    l3g_name =
                                                                                                                    "unknown";
                                                                                                                if (value
                                                                                                                    .dev_net ==
                                                                                                                    2 ||
                                                                                                                    value
                                                                                                                    .dev_net ==
                                                                                                                    3 ||
                                                                                                                    value
                                                                                                                    .dev_net ==
                                                                                                                    6
                                                                                                                ) { //单独处理IDC网络的
                                                                                                                    l3g_name
                                                                                                                        =
                                                                                                                        netMap[
                                                                                                                            value
                                                                                                                            .dev_net
                                                                                                                        ];
                                                                                                                    image
                                                                                                                        =
                                                                                                                        getGroupImageFormDev(
                                                                                                                            value
                                                                                                                            .dev_net,
                                                                                                                            value
                                                                                                                            .dev_type,
                                                                                                                            value
                                                                                                                            .dev_role
                                                                                                                        );
                                                                                                                    l3g_id
                                                                                                                        =
                                                                                                                        city_id +
                                                                                                                        "_" +
                                                                                                                        cr_devid +
                                                                                                                        "_" +
                                                                                                                        value
                                                                                                                        .dev_net;
                                                                                                                } else
                                                                                                                if (value
                                                                                                                    .dev_net ==
                                                                                                                    1 &&
                                                                                                                    value
                                                                                                                    .dev_type ==
                                                                                                                    1
                                                                                                                ) {
                                                                                                                    if (value
                                                                                                                        .dev_role ==
                                                                                                                        3
                                                                                                                    ) { //省网cr
                                                                                                                        l3g_id
                                                                                                                            =
                                                                                                                            city_id +
                                                                                                                            "_swhx";
                                                                                                                        l3g_name
                                                                                                                            =
                                                                                                                            "省网核心";
                                                                                                                        image
                                                                                                                            =
                                                                                                                            getGroupImageFormDev(
                                                                                                                                value
                                                                                                                                .dev_net,
                                                                                                                                value
                                                                                                                                .dev_type,
                                                                                                                                value
                                                                                                                                .dev_role
                                                                                                                            );
                                                                                                                    } else {
                                                                                                                        l3g_id
                                                                                                                            =
                                                                                                                            value
                                                                                                                            .city +
                                                                                                                            "_" +
                                                                                                                            cr_devid +
                                                                                                                            "_" +
                                                                                                                            value
                                                                                                                            .dev_net +
                                                                                                                            "_" +
                                                                                                                            value
                                                                                                                            .dev_type +
                                                                                                                            "_" +
                                                                                                                            value
                                                                                                                            .dev_role;
                                                                                                                        if (value
                                                                                                                            .dev_role ==
                                                                                                                            2
                                                                                                                        ) {
                                                                                                                            l3g_name
                                                                                                                                =
                                                                                                                                value
                                                                                                                                .city +
                                                                                                                                "_" +
                                                                                                                                typeMap[
                                                                                                                                    value
                                                                                                                                    .dev_type
                                                                                                                                ] +
                                                                                                                                "_" +
                                                                                                                                roleMap[
                                                                                                                                    value
                                                                                                                                    .dev_role
                                                                                                                                ];
                                                                                                                        } else {
                                                                                                                            l3g_name
                                                                                                                                =
                                                                                                                                value
                                                                                                                                .city +
                                                                                                                                "_" +
                                                                                                                                typeMap[
                                                                                                                                    value
                                                                                                                                    .dev_type
                                                                                                                                ];
                                                                                                                        }
                                                                                                                        image
                                                                                                                            =
                                                                                                                            image +
                                                                                                                            "-group";
                                                                                                                    }
                                                                                                                } else {
                                                                                                                    l3g_name
                                                                                                                        =
                                                                                                                        value
                                                                                                                        .city +
                                                                                                                        "_" +
                                                                                                                        typeMap[
                                                                                                                            value
                                                                                                                            .dev_type
                                                                                                                        ];
                                                                                                                    image
                                                                                                                        =
                                                                                                                        image +
                                                                                                                        "-group";
                                                                                                                } //第三层 var
                                                                                                                l3group
                                                                                                                    =
                                                                                                                    creatSubNetL3Group(
                                                                                                                        l3g_id,
                                                                                                                        l3g_name,
                                                                                                                        image,
                                                                                                                        subNetWork,
                                                                                                                        subAuto_list
                                                                                                                    );
                                                                                                                l3group
                                                                                                                    .addChild(
                                                                                                                        tmp_node
                                                                                                                    );
                                                                                                                if (autoflag &&
                                                                                                                    l3group
                                                                                                                    .getClient(
                                                                                                                        "flag"
                                                                                                                    ) &&
                                                                                                                    tmp_node
                                                                                                                    .getClient(
                                                                                                                        "flag"
                                                                                                                    )
                                                                                                                ) { //位置表有位置，不会触发自动布局
                                                                                                                    autoflag
                                                                                                                        =
                                                                                                                        false;
                                                                                                                }
                                                                                                            }
                                                                                                        } //基本数据过滤
                                                                                                    })
                                                                                            } //链路信息linkDataList
                                                                                            linkDataList =
                                                                                                data
                                                                                                .linkDataList;
                                                                                            $.each(linkDataList,
                                                                                                function (
                                                                                                    n,
                                                                                                    value
                                                                                                ) {
                                                                                                    var
                                                                                                        toNode =
                                                                                                        null;
                                                                                                    var
                                                                                                        fromNode =
                                                                                                        null;
                                                                                                    var
                                                                                                        fromId =
                                                                                                        city_id +
                                                                                                        "_" +
                                                                                                        value
                                                                                                        .a_dev_id;
                                                                                                    fromNode
                                                                                                        =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            fromId
                                                                                                        ); //处理普通设备节点
                                                                                                    if (value
                                                                                                        .z_dev_id !=
                                                                                                        0 &&
                                                                                                        value
                                                                                                        .z_dev_net ==
                                                                                                        1 &&
                                                                                                        value
                                                                                                        .z_dev_type !=
                                                                                                        -
                                                                                                        1
                                                                                                    ) { //查找连接点
                                                                                                        var
                                                                                                            toId =
                                                                                                            city_id +
                                                                                                            "_" +
                                                                                                            value
                                                                                                            .z_dev_id;
                                                                                                        toNode
                                                                                                            =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                toId
                                                                                                            ); //role=4和role=7
                                                                                                        devid
                                                                                                            =
                                                                                                            0 的
                                                                                                        为idc网络和cdn网络设备
                                                                                                            (
                                                                                                                只有设备名称没有其他信息
                                                                                                            )
                                                                                                        需要单独处理
                                                                                                    } else
                                                                                                    if (value
                                                                                                        .z_dev_net ==
                                                                                                        2 ||
                                                                                                        value
                                                                                                        .z_dev_net ==
                                                                                                        3 ||
                                                                                                        value
                                                                                                        .z_dev_net ==
                                                                                                        6
                                                                                                    ) {
                                                                                                        var
                                                                                                            toId =
                                                                                                            city_id +
                                                                                                            "_" +
                                                                                                            (value
                                                                                                                .z_dev_id ==
                                                                                                                0 ?
                                                                                                                value
                                                                                                                .z_dev_name :
                                                                                                                value
                                                                                                                .z_dev_id
                                                                                                            ); //有的idc或cdn没有id只有设备名称
                                                                                                        toNode
                                                                                                            =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                toId
                                                                                                            );
                                                                                                        var
                                                                                                            g_image =
                                                                                                            getGroupImageFormDev(
                                                                                                                value
                                                                                                                .z_dev_net,
                                                                                                                value
                                                                                                                .z_dev_type,
                                                                                                                value
                                                                                                                .z_dev_role
                                                                                                            );
                                                                                                        var
                                                                                                            group_id =
                                                                                                            city_id +
                                                                                                            "_" +
                                                                                                            cr_devid +
                                                                                                            "_" +
                                                                                                            value
                                                                                                            .z_dev_net
                                                                                                        var
                                                                                                            group =
                                                                                                            creatSubNetL3Group(
                                                                                                                group_id,
                                                                                                                netMap[
                                                                                                                    value
                                                                                                                    .z_dev_net
                                                                                                                ],
                                                                                                                g_image,
                                                                                                                subNetWork,
                                                                                                                subAuto_list
                                                                                                            );
                                                                                                        if (toNode ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            toNode
                                                                                                                =
                                                                                                                creatNode(
                                                                                                                    toId,
                                                                                                                    value
                                                                                                                    .z_dev_name,
                                                                                                                    "SR",
                                                                                                                    null
                                                                                                                )
                                                                                                            toNode
                                                                                                                .setStyle(
                                                                                                                    'whole.alpha',
                                                                                                                    0.7
                                                                                                                );
                                                                                                            group
                                                                                                                .addChild(
                                                                                                                    toNode
                                                                                                                );
                                                                                                            if (autoflag &&
                                                                                                                group
                                                                                                                .getClient(
                                                                                                                    "flag"
                                                                                                                ) &&
                                                                                                                toNode
                                                                                                                .getClient(
                                                                                                                    "flag"
                                                                                                                )
                                                                                                            ) {
                                                                                                                autoflag
                                                                                                                    =
                                                                                                                    false;
                                                                                                            }
                                                                                                        }
                                                                                                        if (subNetWork !=
                                                                                                            null &&
                                                                                                            !
                                                                                                            subNetWork
                                                                                                            .isParentOf(
                                                                                                                group
                                                                                                            )
                                                                                                        ) { //这个是处理cr一跳多跳的
                                                                                                            subNetWork
                                                                                                                .addChild(
                                                                                                                    group
                                                                                                                );
                                                                                                        } //处理骨干网
                                                                                                    } else
                                                                                                    if (value
                                                                                                        .z_dev_net ==
                                                                                                        4
                                                                                                    ) { //处理169骨干网
                                                                                                        toNode
                                                                                                            =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                city_id +
                                                                                                                "_" +
                                                                                                                value
                                                                                                                .z_dev_name
                                                                                                            ); //找169骨干网
                                                                                                    }
                                                                                                    if (fromNode !=
                                                                                                        null &&
                                                                                                        toNode !=
                                                                                                        null
                                                                                                    ) {
                                                                                                        var
                                                                                                            fa =
                                                                                                            fromNode
                                                                                                            .getParent();
                                                                                                        var
                                                                                                            ta =
                                                                                                            toNode
                                                                                                            .getParent();
                                                                                                        if (fa !=
                                                                                                            null &&
                                                                                                            ta !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            var
                                                                                                                ifspeed_aa =
                                                                                                                value
                                                                                                                .ifspeed;
                                                                                                            var
                                                                                                                link_s =
                                                                                                                tmplinkMap
                                                                                                                .get(
                                                                                                                    fa
                                                                                                                    .getId() +
                                                                                                                    "$" +
                                                                                                                    ta
                                                                                                                    .getId()
                                                                                                                )
                                                                                                            if (link_s ==
                                                                                                                null
                                                                                                            )
                                                                                                                link_s =
                                                                                                                0;
                                                                                                            tmplinkMap
                                                                                                                .set(
                                                                                                                    fa
                                                                                                                    .getId() +
                                                                                                                    "$" +
                                                                                                                    ta
                                                                                                                    .getId(),
                                                                                                                    link_s +
                                                                                                                    ifspeed_aa
                                                                                                                );
                                                                                                        }
                                                                                                    }
                                                                                                });
                                                                                        });
                                                                                    for (var
                                                                                            t_link of
                                                                                            tmplinkMap) { //
                                                                                        遍历Array创建聚合后的链路
                                                                                        var
                                                                                            tmp_strs =
                                                                                            t_link[0].split(
                                                                                                "$")
                                                                                        var
                                                                                            to_g = idfinder
                                                                                            .findFirst(
                                                                                                tmp_strs[1]
                                                                                            );
                                                                                        var
                                                                                            from_g =
                                                                                            idfinder
                                                                                            .findFirst(
                                                                                                tmp_strs[0]
                                                                                            );
                                                                                        if (from_g !=
                                                                                            null &&
                                                                                            to_g != null &&
                                                                                            from_g != to_g
                                                                                        ) {
                                                                                            var
                                                                                                link =
                                                                                                creatLink(
                                                                                                    "sub_" +
                                                                                                    t_link[
                                                                                                        0],
                                                                                                    from_g,
                                                                                                    to_g,
                                                                                                    null);
                                                                                            link.setClient(
                                                                                                "ifspeed",
                                                                                                t_link[
                                                                                                    1]);
                                                                                            if (subNetWork !=
                                                                                                null)
                                                                                                subNetWork
                                                                                                .addChild(
                                                                                                    link);
                                                                                            subAuto_list
                                                                                                .add(link)
                                                                                        }
                                                                                        /* var
                                                                                                                                                                                                   link_id="sub-"
                                                                                                                                                                                                   +rsing_id+"-"+value.a_dev_id+"-"+value.a_ifindex;
                                                                                                                                                                                                   var
                                                                                                                                                                                                   link=idfinder.findFirst(link_id);
                                                                                                                                                                                                   if(link==null)
                                                                                                                                                                                                   {
                                                                                                                                                                                                   link=creatLink(link_id,fromNode,toNode,value);
                                                                                                                                                                                                   if(subNetWork!=null)
                                                                                                                                                                                                   subNetWork.addChild(link);
                                                                                                                                                                                                   }
                                                                                                                                                                                                   if(subNetWork!=null
                                                                                                                                                                                                   &&
                                                                                                                                                                                                   !subNetWork.isParentOf(link)){//这个是处理cr一跳多跳的
                                                                                                                                                                                                   if(subNetWork!=null)
                                                                                                                                                                                                   subNetWork.addChild(link);
                                                                                                                                                                                                   }
                                                                                                                                                                                                   subAuto_list.add(link);*/
                                                                                    }
                                                                                    if (autoflag) { //自动布局
                                                                                        -- --围绕布局round
                                                                                        对称布局(
                                                                                            symmetry
                                                                                        ) //上下topbottom
                                                                                        下上布局(bottomtop)
                                                                                        左右布局(
                                                                                            leftright
                                                                                        ) 左右布局(
                                                                                            leftright
                                                                                        ) 分层布局(
                                                                                            hierarchic)
                                                                                        subAutoLayouter
                                                                                            .getElements =
                                                                                            function () {
                                                                                                return
                                                                                                subAuto_list
                                                                                                ;
                                                                                            };
                                                                                        subAutoLayouter
                                                                                            .setRepulsion(
                                                                                                2);
                                                                                        subAutoLayouter
                                                                                            .setAnimate(
                                                                                                false);
                                                                                        var
                                                                                            aaaaaa =
                                                                                            subAutoLayouter
                                                                                            .doLayout(
                                                                                                'symmetry',
                                                                                                function () {
                                                                                                    network
                                                                                                        .zoomOverview(
                                                                                                            true
                                                                                                        );
                                                                                                });
                                                                                    } else {
                                                                                        network
                                                                                            .addViewListener(
                                                                                                callback);
                                                                                    }
                                                                                } //承载a和
                                                                                承载b(不是城域网 不是169骨干网)

                                                                                function
                                                                                initOtherHomeBox() {
                                                                                    $.ajaxSetup({
                                                                                        async: false
                                                                                    }); //ajax
                                                                                    同步-- -- - 这是一个全局的
                                                                                    box.clear();
                                                                                    var
                                                                                        autoflag =
                                                                                        true; //自动布局标识
                                                                                    var
                                                                                        city_map = new
                                                                                    Map
                                                                                        (); //{dev_id:city} //加载位置信息
                                                                                    var
                                                                                        inte_set = new
                                                                                    Set();
                                                                                    var
                                                                                        loc_url =
                                                                                        "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                                        rsing_id + "&type=0";
                                                                                    $.post(loc_url, function (
                                                                                        data) {
                                                                                        symbolLocationMap
                                                                                            = data;
                                                                                    }) var
                                                                                        url =
                                                                                        "/rsing/topo/get169TopoData.do?1=1&rsing_id=" +
                                                                                        rsing_id;
                                                                                    var
                                                                                        flag_loc = "cz_AB_" +
                                                                                        rsing_id + "_";
                                                                                    $.post(url, function (
                                                                                        data) {
                                                                                        devDataList =
                                                                                            data
                                                                                            .devDataList;
                                                                                        if (devDataList
                                                                                            .length >
                                                                                            0) {
                                                                                            $.each(devDataList,
                                                                                                function (
                                                                                                    n,
                                                                                                    value
                                                                                                ) {
                                                                                                    var id =
                                                                                                        value
                                                                                                        .dev_id;
                                                                                                    var name =
                                                                                                        value
                                                                                                        .symbol_name;
                                                                                                    var area =
                                                                                                        value
                                                                                                        .area;
                                                                                                    var pro =
                                                                                                        value
                                                                                                        .pro;
                                                                                                    var city =
                                                                                                        value
                                                                                                        .city;
                                                                                                    var dev_type =
                                                                                                        value
                                                                                                        .dev_type;
                                                                                                    var
                                                                                                        the_type =
                                                                                                        typeMap[
                                                                                                            value
                                                                                                            .dev_type
                                                                                                        ] +
                                                                                                        ""

                                                                                                    var
                                                                                                        isCr =
                                                                                                        the_type
                                                                                                        .indexOf(
                                                                                                            "CR"
                                                                                                        ) !=
                                                                                                        -
                                                                                                        1
                                                                                                    var
                                                                                                        isBr =
                                                                                                        the_type
                                                                                                        .indexOf(
                                                                                                            "BR"
                                                                                                        ) !=
                                                                                                        -
                                                                                                        1
                                                                                                    if (isCr ||
                                                                                                        the_type
                                                                                                        .indexOf(
                                                                                                            "BR"
                                                                                                        ) >
                                                                                                        0
                                                                                                    ) {
                                                                                                        if (
                                                                                                            isCr
                                                                                                        ) { //CR分组,且有sub子网
                                                                                                            var
                                                                                                                subid =
                                                                                                                flag_loc +
                                                                                                                pro +
                                                                                                                "_CR"
                                                                                                            var
                                                                                                                pro_sub =
                                                                                                                idfinder
                                                                                                                .findFirst(
                                                                                                                    subid
                                                                                                                );
                                                                                                            if (pro_sub ==
                                                                                                                null
                                                                                                            ) {
                                                                                                                pro_sub
                                                                                                                    =
                                                                                                                    createSubnetwork(
                                                                                                                        subid,
                                                                                                                        pro +
                                                                                                                        "_" +
                                                                                                                        the_type,
                                                                                                                        "CR-group",
                                                                                                                        null
                                                                                                                    );
                                                                                                            }
                                                                                                            city_map
                                                                                                                .set(
                                                                                                                    id,
                                                                                                                    subid
                                                                                                                );

                                                                                                            if (autoflag &&
                                                                                                                (pro_sub
                                                                                                                    .getClient(
                                                                                                                        "flag"
                                                                                                                    )
                                                                                                                )
                                                                                                            ) {
                                                                                                                autoflag
                                                                                                                    =
                                                                                                                    false;
                                                                                                            }
                                                                                                        } else {
                                                                                                            var
                                                                                                                area_group =
                                                                                                                creat169Group(
                                                                                                                    "ca_A_" +
                                                                                                                    dev_type,
                                                                                                                    the_type,
                                                                                                                    "SR-group"
                                                                                                                );
                                                                                                            var
                                                                                                                tmpnode =
                                                                                                                creatNode(
                                                                                                                    flag_loc +
                                                                                                                    id,
                                                                                                                    name,
                                                                                                                    "CR",
                                                                                                                    value
                                                                                                                );
                                                                                                            var
                                                                                                                group =
                                                                                                                creat169Group(
                                                                                                                    rsing_id +
                                                                                                                    "_" +
                                                                                                                    pro +
                                                                                                                    "_" +
                                                                                                                    the_type,
                                                                                                                    pro +
                                                                                                                    "_" +
                                                                                                                    the_type,
                                                                                                                    "CR-group"
                                                                                                                );
                                                                                                            group
                                                                                                                .addChild(
                                                                                                                    tmpnode
                                                                                                                );
                                                                                                            area_group
                                                                                                                .addChild(
                                                                                                                    group
                                                                                                                );

                                                                                                            if (autoflag &&
                                                                                                                (tmpnode
                                                                                                                    .getClient(
                                                                                                                        "flag"
                                                                                                                    )
                                                                                                                )
                                                                                                            ) {
                                                                                                                autoflag
                                                                                                                    =
                                                                                                                    false;
                                                                                                            }
                                                                                                        }

                                                                                                    } else
                                                                                                    if (
                                                                                                        isBr
                                                                                                    ) { //br不分组，有sub子网
                                                                                                        var
                                                                                                            pro_sub =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                flag_loc +
                                                                                                                pro
                                                                                                            );
                                                                                                        if (pro_sub ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            pro_sub
                                                                                                                =
                                                                                                                createSubnetwork(
                                                                                                                    flag_loc +
                                                                                                                    pro,
                                                                                                                    pro +
                                                                                                                    "_" +
                                                                                                                    the_type,
                                                                                                                    "CR-group",
                                                                                                                    null
                                                                                                                );
                                                                                                            city_map
                                                                                                                .set(
                                                                                                                    id,
                                                                                                                    flag_loc +
                                                                                                                    pro
                                                                                                                );
                                                                                                        }

                                                                                                    }

                                                                                                })
                                                                                        }

                                                                                        //链路信息linkDataList
                                                                                        linkDataList
                                                                                            =
                                                                                            data
                                                                                            .linkDataList;
                                                                                        $.each(linkDataList,
                                                                                            function (
                                                                                                n,
                                                                                                value
                                                                                            ) {
                                                                                                var
                                                                                                    fromNode =
                                                                                                    null;
                                                                                                var
                                                                                                    toNode =
                                                                                                    null;
                                                                                                //查找连接点
                                                                                                var fromId =
                                                                                                    value
                                                                                                    .a_dev_id;
                                                                                                var toId =
                                                                                                    value
                                                                                                    .z_dev_id;

                                                                                                toNode
                                                                                                    =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        flag_loc +
                                                                                                        toId
                                                                                                    );
                                                                                                fromNode
                                                                                                    =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        flag_loc +
                                                                                                        fromId
                                                                                                    );
                                                                                                if (toNode ==
                                                                                                    null
                                                                                                ) { //找sub子网node，子网id是flag_loc+pro
                                                                                                    var
                                                                                                        tmpid =
                                                                                                        city_map
                                                                                                        .get(
                                                                                                            toId
                                                                                                        )
                                                                                                    toNode
                                                                                                        =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            tmpid
                                                                                                        );
                                                                                                }
                                                                                                if (fromNode ==
                                                                                                    null
                                                                                                ) {
                                                                                                    var
                                                                                                        tmpid =
                                                                                                        city_map
                                                                                                        .get(
                                                                                                            fromId
                                                                                                        )
                                                                                                    fromNode
                                                                                                        =
                                                                                                        idfinder
                                                                                                        .findFirst(
                                                                                                            tmpid
                                                                                                        );
                                                                                                }
                                                                                                if (fromNode !=
                                                                                                    null &&
                                                                                                    toNode !=
                                                                                                    null &&
                                                                                                    fromNode !=
                                                                                                    toNode
                                                                                                ) {
                                                                                                    var
                                                                                                        link_id =
                                                                                                        "ca_AB_" +
                                                                                                        rsing_id +
                                                                                                        "-" +
                                                                                                        value
                                                                                                        .a_dev_id +
                                                                                                        "-" +
                                                                                                        value
                                                                                                        .a_ifindex;
                                                                                                    var link =
                                                                                                        creatLink(
                                                                                                            link_id,
                                                                                                            fromNode,
                                                                                                            toNode,
                                                                                                            value
                                                                                                        );
                                                                                                }
                                                                                            })

                                                                                    })
                                                                                    if (autoflag) {
                                                                                        autoLayouter
                                                                                            .setRepulsion(2)
                                                                                        autoLayouter.doLayout(
                                                                                            'symmetry',
                                                                                            function () {
                                                                                                network
                                                                                                    .zoomOverview(
                                                                                                        true
                                                                                                    );
                                                                                            });
                                                                                    } else {
                                                                                        network.addViewListener(
                                                                                            callback);
                                                                                    }
                                                                                    $("#loading").hide();

                                                                                }


                                                                                //承载a和
                                                                                承载b(不是城域网 不是169骨干网)

                                                                                function
                                                                                initOtherSubBox(subNetWork) {
                                                                                    $.ajaxSetup({
                                                                                        async: false
                                                                                    });
                                                                                    //ajax
                                                                                    同步-- -- - 这是一个全局的
                                                                                    subAuto_list.clear();
                                                                                    var
                                                                                        autoflag =
                                                                                        true; //自动布局标识
                                                                                    var city_map = new
                                                                                    Map(); //{dev_id:city}
                                                                                    //加载位置信息
                                                                                    var
                                                                                        inte_set = new
                                                                                    Set();
                                                                                    var loc_url =
                                                                                        "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                                        rsing_id + "&type=0";
                                                                                    $.post(loc_url, function (
                                                                                        data) {
                                                                                        symbolLocationMap
                                                                                            = data;
                                                                                    })
                                                                                    var
                                                                                        arg_pro = subNetWork
                                                                                        .getName().split('_')[
                                                                                            0];
                                                                                    var url =
                                                                                        "/rsing/topo/GetOtherSubNetWork.do?1=1&rsing_id=" +
                                                                                        rsing_id + "&pro=" +
                                                                                        arg_pro;
                                                                                    var
                                                                                        flag_loc =
                                                                                        "cz_AB_sub_" +
                                                                                        rsing_id + "_" +
                                                                                        arg_pro + "_";
                                                                                    $.post(url, function (
                                                                                        data) {
                                                                                        devDataList
                                                                                            =
                                                                                            data
                                                                                            .devDataList;
                                                                                        if (devDataList
                                                                                            .length > 0
                                                                                        ) {
                                                                                            $.each(devDataList,
                                                                                                function (
                                                                                                    n,
                                                                                                    value
                                                                                                ) {
                                                                                                    var id =
                                                                                                        value
                                                                                                        .dev_id;
                                                                                                    var name =
                                                                                                        value
                                                                                                        .symbol_name;
                                                                                                    var area =
                                                                                                        value
                                                                                                        .area;
                                                                                                    var pro =
                                                                                                        value
                                                                                                        .pro;
                                                                                                    var city =
                                                                                                        value
                                                                                                        .city;
                                                                                                    var dev_type =
                                                                                                        value
                                                                                                        .dev_type;
                                                                                                    var
                                                                                                        the_type =
                                                                                                        typeMap[
                                                                                                            value
                                                                                                            .dev_type
                                                                                                        ] +
                                                                                                        ""

                                                                                                    //北京有上海的cr,上海有北京的cr靠省份区分这些节点
                                                                                                    var
                                                                                                        tmpnode =
                                                                                                        creatNode(
                                                                                                            flag_loc +
                                                                                                            id,
                                                                                                            name,
                                                                                                            "CR",
                                                                                                            value
                                                                                                        );
                                                                                                    var
                                                                                                        group =
                                                                                                        creatSubNetL3Group(
                                                                                                            flag_loc +
                                                                                                            pro +
                                                                                                            "_" +
                                                                                                            the_type +
                                                                                                            "_sub",
                                                                                                            pro +
                                                                                                            "_" +
                                                                                                            the_type,
                                                                                                            "CR-group",
                                                                                                            subNetWork,
                                                                                                            subAuto_list
                                                                                                        );
                                                                                                    group
                                                                                                        .addChild(
                                                                                                            tmpnode
                                                                                                        );
                                                                                                    if (autoflag &&
                                                                                                        (tmpnode
                                                                                                            .getClient(
                                                                                                                "flag"
                                                                                                            )
                                                                                                        )
                                                                                                    ) {
                                                                                                        //位置表有位置，不会触发自动布局
                                                                                                        autoflag
                                                                                                            =
                                                                                                            false;
                                                                                                    }

                                                                                                })
                                                                                        }

                                                                                        //链路信息linkDataList
                                                                                        linkDataList
                                                                                            =
                                                                                            data
                                                                                            .linkDataList;
                                                                                        $.each(linkDataList,
                                                                                            function (
                                                                                                n,
                                                                                                value
                                                                                            ) {
                                                                                                var
                                                                                                    fromNode =
                                                                                                    null;
                                                                                                var
                                                                                                    toNode =
                                                                                                    null;
                                                                                                //查找连接点
                                                                                                var fromId =
                                                                                                    value
                                                                                                    .a_dev_id;
                                                                                                var toId =
                                                                                                    value
                                                                                                    .z_dev_id;

                                                                                                toNode
                                                                                                    =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        flag_loc +
                                                                                                        toId
                                                                                                    );
                                                                                                fromNode
                                                                                                    =
                                                                                                    idfinder
                                                                                                    .findFirst(
                                                                                                        flag_loc +
                                                                                                        fromId
                                                                                                    );

                                                                                                if (fromNode !=
                                                                                                    null &&
                                                                                                    toNode !=
                                                                                                    null &&
                                                                                                    fromNode !=
                                                                                                    toNode
                                                                                                ) {
                                                                                                    var
                                                                                                        link_id =
                                                                                                        flag_loc +
                                                                                                        value
                                                                                                        .a_dev_id +
                                                                                                        "-" +
                                                                                                        value
                                                                                                        .a_ifindex;
                                                                                                    var link =
                                                                                                        creatLink(
                                                                                                            link_id,
                                                                                                            fromNode,
                                                                                                            toNode,
                                                                                                            value
                                                                                                        );
                                                                                                }
                                                                                            })

                                                                                    })
                                                                                    if (autoflag) {
                                                                                        subAutoLayouter
                                                                                            .getElements =
                                                                                            function () {
                                                                                                return
                                                                                                subAuto_list;
                                                                                            };
                                                                                        subAutoLayouter
                                                                                            .setRepulsion(2);
                                                                                        subAutoLayouter
                                                                                            .setAnimate(false);
                                                                                        var
                                                                                            aaaaaa =
                                                                                            subAutoLayouter
                                                                                            .doLayout(
                                                                                                'symmetry',
                                                                                                function () {
                                                                                                    network
                                                                                                        .zoomOverview(
                                                                                                            true
                                                                                                        );
                                                                                                });
                                                                                    } else {
                                                                                        network.addViewListener(
                                                                                            callback);
                                                                                    }
                                                                                    $("#loading").hide();

                                                                                }

                                                                                function
                                                                                doubleClickSub(ele) {
                                                                                    if (rsing_id > 99 &&
                                                                                        rsing_id <
                                                                                        200) {
                                                                                        initOtherSubBox(ele)
                                                                                    } else {
                                                                                        initSubDataBox(ele,
                                                                                            false)
                                                                                    }
                                                                                } //创建node结点
                                                                                function
                                                                                creatNode(id,
                                                                                    name,
                                                                                    image,
                                                                                    devinfo) {
                                                                                    var
                                                                                        node = new
                                                                                    twaver.Node(
                                                                                        id
                                                                                    ); //id为topo图中的symble_id
                                                                                    if (devinfo != null)
                                                                                        setDeviceDetail2Node(
                                                                                            node, devinfo);
                                                                                    node.setName(name);
                                                                                    node.setImage(image);
                                                                                    node.setStyle(
                                                                                        'select.style',
                                                                                        'border'
                                                                                    );
                                                                                    node.setStyle(
                                                                                        'select.width',
                                                                                        1);
                                                                                    node.setStyle('select.join',
                                                                                        'round'
                                                                                    );
                                                                                    node.setStyle(
                                                                                        'select.color',
                                                                                        '#000000'
                                                                                    );
                                                                                    node.setStyle('label.color',
                                                                                        '#ffffff'
                                                                                    );
                                                                                    if (devinfo != null) {
                                                                                        var
                                                                                            nodetooltip =
                                                                                            devinfo
                                                                                            .dev_id; //存储结点信息
                                                                                        实际dev_id
                                                                                        node.setToolTip(
                                                                                            nodetooltip);
                                                                                    }
                                                                                    var
                                                                                        loc = symbolLocationMap[
                                                                                            id];
                                                                                    var x = 0;
                                                                                    var y = 0;
                                                                                    var
                                                                                        flag = false;
                                                                                    if (loc != null) {
                                                                                        x = loc[0];
                                                                                        y = loc[1];
                                                                                        flag = true;
                                                                                    }
                                                                                    node.setLocation(x, y);
                                                                                    node.setClient("flag",
                                                                                        flag);
                                                                                    box.add(node);
                                                                                    return
                                                                                    node;
                                                                                } //创建组
                                                                                function
                                                                                creatGroup(id,
                                                                                    name,
                                                                                    image) {
                                                                                    var
                                                                                        group = new
                                                                                    twaver.Group(id);
                                                                                    group.setName(name);
                                                                                    group.s('group.shape',
                                                                                        'oval'
                                                                                    ); //设置分组边框形状
                                                                                    group.s('group.fill.color',
                                                                                        whole_color
                                                                                    ); //填充色FEF3E2
                                                                                    E0FFFF //
                                                                                    group.s('group.fill.color',
                                                                                        'transparent'
                                                                                    ); //填充色FEF3E2
                                                                                    E0FFFF
                                                                                    group.s('group.outline.color',
                                                                                        '#3cb2e6'
                                                                                    ); //F8C374
                                                                                    #0099FF































                                                                                                        # 99 caea //
                                                                                    group.s('group.outline.color',
                                                                                        '#3399FF'
                                                                                    ); //F8C374
                                                                                    #0099FF































                                                                                                        # 99 caea
                                                                                    group.s('group.outline.width',
                                                                                        '2'
                                                                                    );
                                                                                    group.s('vector.outline.pattern',
                                                                                        [10, 0]); //轮廓
                                                                                    group.s('group.deep',
                                                                                        0);
                                                                                    group.s('select.style',
                                                                                        'border'
                                                                                    );
                                                                                    group.s('select.width',
                                                                                        1);
                                                                                    group.s('select.join',
                                                                                        'round'
                                                                                    );
                                                                                    group.s('select.color',
                                                                                        '#000000'
                                                                                    );
                                                                                    group.s('label.color',
                                                                                        '#ffffff'
                                                                                    );
                                                                                    var
                                                                                        loc = symbolLocationMap[
                                                                                            id];
                                                                                    var x = 0;
                                                                                    var y = 0;
                                                                                    var
                                                                                        flag = false;
                                                                                    if (loc != null) {
                                                                                        x = loc[0];
                                                                                        y = loc[1];
                                                                                        flag = true;
                                                                                    }
                                                                                    group.setLocation(x, y);
                                                                                    group.setClient("flag",
                                                                                        flag);
                                                                                    group.setImage(image);
                                                                                    group.setExpanded(false);
                                                                                    box.add(group);
                                                                                    return
                                                                                    group;
                                                                                }

                                                                                function
                                                                                creat169Group(id, name, image) {
                                                                                    var
                                                                                        group = idfinder
                                                                                        .findFirst(id);
                                                                                    if (group == null) {
                                                                                        group = creatGroup(id,
                                                                                            name, image);
                                                                                        group.setExpanded(
                                                                                            false);
                                                                                    }
                                                                                    return
                                                                                    group;
                                                                                }

                                                                                function
                                                                                creatSubNetL3Group(l3g_id,
                                                                                    l3g_name, groupimage,
                                                                                    subNetWork, list, expand) {
                                                                                    var
                                                                                        group = idfinder
                                                                                        .findFirst(l3g_id);
                                                                                    if (group == null) {
                                                                                        group = creatGroup(
                                                                                            l3g_id,
                                                                                            l3g_name,
                                                                                            groupimage);
                                                                                        group.setExpanded(
                                                                                            false);
                                                                                        if (subNetWork != null)
                                                                                            subNetWork.addChild(
                                                                                                group);
                                                                                        list.add(group)
                                                                                    }
                                                                                    if (subNetWork != null &&
                                                                                        !subNetWork.isParentOf(
                                                                                            group)) {
                                                                                        subNetWork.addChild(
                                                                                            group);
                                                                                    }
                                                                                    return
                                                                                    group;
                                                                                } //准备构建二级子网
                                                                                function
                                                                                createSubnetwork(id,
                                                                                    name,
                                                                                    image,
                                                                                    devinfo) {
                                                                                    var
                                                                                        subNetwork = new
                                                                                    twaver.SubNetwork(id);
                                                                                    subNetwork.setName(name);
                                                                                    subNetwork.setImage(image);
                                                                                    if (devinfo != null)
                                                                                        subNetwork.setToolTip(
                                                                                            devinfo.dev_id);
                                                                                    subNetwork.setStyle(
                                                                                        'icons.names',
                                                                                        'Text');
                                                                                    subNetwork.setStyle(
                                                                                        'background.type',
                                                                                        'vector');
                                                                                    subNetwork.setStyle(
                                                                                        'background.vector.fill',
                                                                                        true);
                                                                                    subNetwork.setStyle(
                                                                                        'background.vector.fill.color',
                                                                                        whole_color); //#99CCFF
                                                                                    subNetwork.setStyle(
                                                                                        'label.color',
                                                                                        '#ffffff'
                                                                                    ); //#99CCFF
                                                                                    subNetwork.setStyle(
                                                                                        'select.style',
                                                                                        'border'
                                                                                    );
                                                                                    subNetwork.setStyle(
                                                                                        'select.shape',
                                                                                        'roundrect'
                                                                                    );
                                                                                    subNetwork.setStyle(
                                                                                        'select.width',
                                                                                        1);
                                                                                    subNetwork.setStyle(
                                                                                        'select.join',
                                                                                        'round'
                                                                                    );
                                                                                    subNetwork.setStyle(
                                                                                        'select.color',
                                                                                        '#000000'
                                                                                    );
                                                                                    var
                                                                                        loc = symbolLocationMap[
                                                                                            id];
                                                                                    var x = 0;
                                                                                    var y = 0;
                                                                                    var
                                                                                        flag = false;
                                                                                    if (loc != null) {
                                                                                        x = loc[0];
                                                                                        y = loc[1];
                                                                                        flag = true;
                                                                                    }
                                                                                    subNetwork.setLocation(x,
                                                                                        y);
                                                                                    subNetwork.setClient("flag",
                                                                                        flag);
                                                                                    box.add(subNetwork);
                                                                                    return
                                                                                    subNetwork;
                                                                                }

                                                                                function
                                                                                setDeviceDetail2Node(node,
                                                                                    devinfo) {
                                                                                    node.setClient("devname",
                                                                                        devinfo.symbol_name);
                                                                                    node.setClient("vendorname",
                                                                                        devinfo.vendor_name);
                                                                                    node.setClient("devip",
                                                                                        devinfo.dev_ip);
                                                                                    node.setClient("devipmask",
                                                                                        devinfo.dev_ip_mask);
                                                                                    node.setClient("typename",
                                                                                        devinfo.type_name);
                                                                                    node.setClient("net",
                                                                                        netMap[devinfo
                                                                                            .dev_net]);
                                                                                    node.setClient("type",
                                                                                        typeMap[devinfo
                                                                                            .dev_type]);
                                                                                    node.setClient("role",
                                                                                        roleMap[devinfo
                                                                                            .dev_role]);
                                                                                    node.setClient("city",
                                                                                        devinfo.city);
                                                                                } //创建链路
                                                                                function
                                                                                creatLink(link_id, from, to,
                                                                                    linkinfo) {
                                                                                    var
                                                                                        link = new
                                                                                    twaver.Link(link_id);
                                                                                    link.setFromNode(from);
                                                                                    link.setToNode(to);
                                                                                    if (linkinfo != null) {
                                                                                        autoLinkStyle(link,
                                                                                            linkinfo.ifspeed
                                                                                        );
                                                                                    } else {
                                                                                        link.setStyle(
                                                                                            'link.width',
                                                                                            3);
                                                                                        link.setStyle(
                                                                                            'link.bundle.expanded',
                                                                                            false); //设定绑定状态
                                                                                        false为合并
                                                                                        link.setStyle(
                                                                                            'link.color',
                                                                                            '#90dffe'
                                                                                        );
                                                                                        link.setStyle(
                                                                                            'link.handler.color',
                                                                                            '#ffffff'
                                                                                        );
                                                                                    };
                                                                                    var
                                                                                        linkToolTip = "";
                                                                                    if (from != null &&
                                                                                        to != null &&
                                                                                        linkinfo != null) {
                                                                                        linkToolTip = from
                                                                                            .getToolTip() +
                                                                                            "=" + to
                                                                                            .getToolTip();
                                                                                        link.setClient(
                                                                                            " a_dev_name",
                                                                                            linkinfo
                                                                                            .a_dev_name);
                                                                                        link.setClient("a_if",
                                                                                            linkinfo.a_if);
                                                                                        link.setClient(
                                                                                            "z_dev_name",
                                                                                            linkinfo
                                                                                            .z_dev_name);
                                                                                        link.setClient("z_if",
                                                                                            linkinfo.z_if);
                                                                                        link.setClient(
                                                                                            "type_name",
                                                                                            linkinfo
                                                                                            .type_name);
                                                                                        link.setClient(
                                                                                            "ifspeed",
                                                                                            linkinfo.ifspeed
                                                                                        );
                                                                                        link.setClient(
                                                                                            "send_rate",
                                                                                            linkinfo
                                                                                            .send_rate);
                                                                                        link.setClient(
                                                                                            "rec_rate",
                                                                                            linkinfo
                                                                                            .rec_rate);
                                                                                        link.setClient("ip_ver",
                                                                                            linkinfo.ip_ver);
                                                                                    }
                                                                                    link.setToolTip(
                                                                                        linkToolTip);
                                                                                    box.add(link);
                                                                                    return
                                                                                    link;
                                                                                } //link颜色
                                                                                function
                                                                                autoLinkStyle(link, ifspeed) {
                                                                                    link.setStyle(
                                                                                        'link.bundle.expanded',
                                                                                        false); //设定绑定状态
                                                                                    false为合并
                                                                                    var
                                                                                        l_w = 0.5;
                                                                                    var
                                                                                        col = '#14a8e2'; // var
                                                                                    spe = ifspeed / 1000 /
                                                                                        1000; //端口带宽MB
                                                                                    if (spe < 1000) { //小于1G
                                                                                        l_w = 0.6
                                                                                    } else
                                                                                    if (spe <
                                                                                        2500) { //大于等于1G小于2.5G
                                                                                        l_w = 0.7
                                                                                        col =
                                                                                            '#14a8e2'; //紫色col='#6600CC';
                                                                                    } else
                                                                                    if (spe <
                                                                                        10000
                                                                                    ) { //大于等于2.5G小于10GE
                                                                                        l_w = 1
                                                                                        col =
                                                                                            '#37baed'; //绿色col='#336699'
                                                                                    } else
                                                                                    if (spe <
                                                                                        40000) { //大于等于10G小于40GE
                                                                                        l_w = 1.5
                                                                                        col =
                                                                                            '#56c5f1'; //绿色col='#66FF66'
                                                                                    } else
                                                                                    if (spe <
                                                                                        100000
                                                                                    ) { //大于等于40G小于100GE
                                                                                        l_w = 2
                                                                                        col =
                                                                                            '#70d5fd'; //col='#0099CC';
                                                                                    } else { //大于等于100GE
                                                                                        l_w = 3;
                                                                                        col =
                                                                                            '#90dffe'; //深蓝col='#006699';
                                                                                    }
                                                                                    link.setStyle('link.width',
                                                                                        l_w);
                                                                                    link.setStyle('link.color',
                                                                                        col);
                                                                                    link.setStyle(
                                                                                        'link.handler.color',
                                                                                        '#ffffff'
                                                                                    ); //
                                                                                    link.setStyle('link.flow',
                                                                                        true); //
                                                                                    link.setStyle(
                                                                                        'link.pattern',
                                                                                        [15,
                                                                                            15
                                                                                        ]); //
                                                                                    link.setStyle(
                                                                                        'link.flow.color',
                                                                                        '#0d4981'
                                                                                    ); //white
                                                                                } //初始化代理,代理链路需要显示总带宽
                                                                                function
                                                                                initAgentLink(linklist) {
                                                                                    for (var
                                                                                            link of
                                                                                            linklist) { //
                                                                                        遍历linklist
                                                                                        if (link
                                                                                            .isBundleAgent()) {
                                                                                            var
                                                                                                sum = 0;
                                                                                            var
                                                                                                linkGouplist =
                                                                                                link
                                                                                                .getBundleLinks()
                                                                                                .getLinks();
                                                                                            linkGouplist
                                                                                                .forEach(
                                                                                                    function (
                                                                                                        value) {
                                                                                                        var
                                                                                                            ifspeed =
                                                                                                            value
                                                                                                            .getClient(
                                                                                                                "ifspeed"
                                                                                                            );
                                                                                                        sum +=
                                                                                                            ifspeed;
                                                                                                    })
                                                                                            link.setClient(
                                                                                                "sumbandwidth",
                                                                                                sum / 1000 /
                                                                                                1000 / 1000);
                                                                                        }
                                                                                    }
                                                                                }

                                                                                function
                                                                                addButton(div, name,
                                                                                    src,
                                                                                    callbackfun) {
                                                                                    var
                                                                                        button = document
                                                                                        .createElement('input');
                                                                                    button.setAttribute('type',
                                                                                        src ?
                                                                                        'image' :
                                                                                        'button'
                                                                                    );
                                                                                    button.setAttribute('title',
                                                                                        name);
                                                                                    if ("放大" == name ||
                                                                                        "缩小" == name
                                                                                    )
                                                                                        button.setAttribute(
                                                                                            'title',
                                                                                            "转动鼠标滚轮可快捷操作放大或缩小视图"
                                                                                        );
                                                                                    button.style.verticalAlign =
                                                                                        'top';
                                                                                    if (src) {
                                                                                        button.style.padding =
                                                                                            '4px 4px 4px 4px';
                                                                                        if (src.indexOf('/') <
                                                                                            0) {
                                                                                            src =
                                                                                                '../resource/img/rsing/toolbar/' +
                                                                                                src +
                                                                                                '.png';
                                                                                        }
                                                                                        button.setAttribute(
                                                                                            'src',
                                                                                            src);
                                                                                    } else {
                                                                                        button.setAttribute(
                                                                                            "class", "btn
                                                                                            btn - info btn -
                                                                                            sm ");
                                                                                            button
                                                                                            .setAttribute(
                                                                                                "style",
                                                                                                "padding:5px
                                                                                                5 px 5 px 5 px; margin:
                                                                                                1 px 5 px 1 px 0 px; background -
                                                                                                color:
                                                                                                #1c68ac;");//































                                                                                                        button.value= name;
                                                                                            }
                                                                                            button
                                                                                            .addEventListener(
                                                                                                'click',
                                                                                                callbackfun,
                                                                                                false); div
                                                                                            .appendChild(
                                                                                                button);
                                                                                            return button;
                                                                                        }

                                                                                        function
                                                                                        addButton2(div, title,
                                                                                            name,
                                                                                            callbackfun) {
                                                                                            var
                                                                                                button =
                                                                                                document
                                                                                                .createElement(
                                                                                                    'button');
                                                                                            button.setAttribute(
                                                                                                'title',
                                                                                                title);
                                                                                            button.style
                                                                                                .verticalAlign =
                                                                                                'top';
                                                                                            button.setAttribute(
                                                                                                    "class",
                                                                                                    "btn
                                                                                                    btn -
                                                                                                    info btn -
                                                                                                    sm ");
                                                                                                    button
                                                                                                    .setAttribute(
                                                                                                        "style",
                                                                                                        "padding:5px
                                                                                                        5 px 5 px 5 px; margin:
                                                                                                        1 px 5 px 1 px 0 px; background -
                                                                                                        color:
                                                                                                        #1c68ac;");//































                                                                                                        button.value= name; button
                                                                                                        .addEventListener(
                                                                                                            'click',
                                                                                                            callbackfun,
                                                                                                            false
                                                                                                        ); //
                                                                                                        button
                                                                                                        .setAttribute(
                                                                                                            'onclick',
                                                                                                            callbackfun
                                                                                                        ); div
                                                                                                        .appendChild(
                                                                                                            button
                                                                                                        );
                                                                                                        return button;
                                                                                                    }

                                                                                                    function addSelect(
                                                                                                        div,
                                                                                                        chr_divid
                                                                                                    ) {
                                                                                                        var
                                                                                                            select_div =
                                                                                                            document
                                                                                                            .getElementById(
                                                                                                                chr_divid
                                                                                                            );
                                                                                                        div.appendChild(
                                                                                                            select_div
                                                                                                        );
                                                                                                    }

                                                                                                    function to169Html() {
                                                                                                        var
                                                                                                            g1 =
                                                                                                            network
                                                                                                            .getSelectionModel()
                                                                                                            .getSelection();
                                                                                                        var
                                                                                                            mark =
                                                                                                            g1
                                                                                                            .size() >
                                                                                                            0;
                                                                                                        if (
                                                                                                            mark
                                                                                                        ) {
                                                                                                            var
                                                                                                                chil0 =
                                                                                                                g1
                                                                                                                .get(
                                                                                                                    0
                                                                                                                );
                                                                                                            if (chil0
                                                                                                                .getClassName() ==
                                                                                                                'twaver.Group' &&
                                                                                                                chil0
                                                                                                                .getChildAt(
                                                                                                                    0
                                                                                                                )
                                                                                                                .getClassName() ==
                                                                                                                'twaver.Node'
                                                                                                            ) {
                                                                                                                //TODO
                                                                                                                跳到另一个页面
                                                                                                                var
                                                                                                                    node_list =
                                                                                                                    chil0
                                                                                                                    .getChildren();
                                                                                                                var
                                                                                                                    nodes =
                                                                                                                    "";
                                                                                                                node_list
                                                                                                                    .forEach(
                                                                                                                        function (
                                                                                                                            node
                                                                                                                        ) {
                                                                                                                            nodes
                                                                                                                                +=
                                                                                                                                node
                                                                                                                                .getToolTip() +
                                                                                                                                ",";
                                                                                                                        }
                                                                                                                    );
                                                                                                                nodes
                                                                                                                    =
                                                                                                                    nodes
                                                                                                                    .substring(
                                                                                                                        0,
                                                                                                                        nodes
                                                                                                                        .length -
                                                                                                                        1
                                                                                                                    );
                                                                                                                var
                                                                                                                    pro =
                                                                                                                    chil0
                                                                                                                    .getName()
                                                                                                                    .split(
                                                                                                                        "_"
                                                                                                                    )[
                                                                                                                        0
                                                                                                                    ];
                                                                                                                window
                                                                                                                    .open(
                                                                                                                        "/rsing/topoView_169.html?rsing_id=99&devids_169=" +
                                                                                                                        nodes +
                                                                                                                        "&pro=" +
                                                                                                                        pro
                                                                                                                    );
                                                                                                            } else {
                                                                                                                alert
                                                                                                                    (
                                                                                                                        "仅支持选中省节点。"
                                                                                                                    );
                                                                                                            }
                                                                                                        } else {
                                                                                                            alert
                                                                                                                (
                                                                                                                    "没有选中设备！仅支持选中省节点。"
                                                                                                                );
                                                                                                        }

                                                                                                    }

                                                                                                    function imageName(
                                                                                                        category_name,
                                                                                                        run_state
                                                                                                    ) {
                                                                                                        //return
                                                                                                        "icon" +
                                                                                                        imgTemp[
                                                                                                                category_name
                                                                                                            ] +
                                                                                                            "-" +
                                                                                                            imgTemp[
                                                                                                                run_state
                                                                                                            ];
                                                                                                        return "icon" +
                                                                                                            imgNameObj[
                                                                                                                category_name
                                                                                                            ] +
                                                                                                            "-" +
                                                                                                            imgNameObj[
                                                                                                                run_state
                                                                                                            ];
                                                                                                    }

                                                                                                    function getImageFormDev(
                                                                                                        net,
                                                                                                        type,
                                                                                                        role) {
                                                                                                        if (net ==
                                                                                                            1) {
                                                                                                            return
                                                                                                            imgtypeMap
                                                                                                                [
                                                                                                                    type
                                                                                                                ];
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            2) {
                                                                                                            return "SR";
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            3) {
                                                                                                            return "SR";
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            6) {
                                                                                                            return "SR";
                                                                                                        } else {
                                                                                                            return "169ggw";
                                                                                                        }
                                                                                                    }

                                                                                                    function getGroupImageFormDev(
                                                                                                        net,
                                                                                                        type,
                                                                                                        role) {
                                                                                                        if (net ==
                                                                                                            1) {
                                                                                                            if (type ==
                                                                                                                1 &&
                                                                                                                role ==
                                                                                                                3
                                                                                                            ) {
                                                                                                                return "sw";
                                                                                                            }
                                                                                                            return
                                                                                                            imgtypeMap
                                                                                                                [
                                                                                                                    type
                                                                                                                ] +
                                                                                                                "-group";
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            2) {
                                                                                                            return "idccloud-gray";
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            3) {
                                                                                                            return "cdncloud-gray";
                                                                                                        } else
                                                                                                        if (net ==
                                                                                                            4) {
                                                                                                            return "169ggw";
                                                                                                        } else {
                                                                                                            return "mobcloud-gray";
                                                                                                        }
                                                                                                    }

                                                                                                    var
                                                                                                        ipv4v6Map = {
                                                                                                            "-1": "未知",
                                                                                                            "0": "未知",
                                                                                                            "4": "IPv4",
                                                                                                            "6": "IPv6",
                                                                                                            "10": "双栈"
                                                                                                        }

                                                                                                    var
                                                                                                        netMap = { //init中添加
                                                                                                            "-1": "未知"
                                                                                                        }

                                                                                                    var
                                                                                                        typeMap = { //init中添加
                                                                                                            "-1": "未知"
                                                                                                        }

                                                                                                    var
                                                                                                        roleMap = { //init中添加
                                                                                                            "-1": "未知"
                                                                                                        }
                                                                                                    var
                                                                                                        imgtypeMap = {
                                                                                                            "1": "SR",
                                                                                                            "2": "SR",
                                                                                                            "3": "SR",
                                                                                                            "4": "SR",
                                                                                                            "13": "SR"
                                                                                                        }
                                                                                                    //画云用的
                                                                                                    var
                                                                                                        imgnetMap = {
                                                                                                            "2": "idccloud-gray",
                                                                                                            "3": "cdncloud-gray",
                                                                                                            "6": "mobcloud-gray"
                                                                                                        }

                                                                                                    //加载获取图片
                                                                                                    svg为network
                                                                                                    function registerImage(
                                                                                                        url,
                                                                                                        svg) {
                                                                                                        var
                                                                                                            image =
                                                                                                            new
                                                                                                        Image();
                                                                                                        image
                                                                                                            .src =
                                                                                                            url;
                                                                                                        var
                                                                                                            views =
                                                                                                            arguments;
                                                                                                        image
                                                                                                            .onload =
                                                                                                            function () {
                                                                                                                twaver
                                                                                                                    .Util
                                                                                                                    .registerImage(
                                                                                                                        getImageName(
                                                                                                                            url
                                                                                                                        ),
                                                                                                                        image,
                                                                                                                        image
                                                                                                                        .width,
                                                                                                                        image
                                                                                                                        .height,
                                                                                                                        svg ===
                                                                                                                        true
                                                                                                                    );
                                                                                                                image
                                                                                                                    .onload =
                                                                                                                    null;
                                                                                                                for (
                                                                                                                    var
                                                                                                                        i =
                                                                                                                        1; i <
                                                                                                                    views
                                                                                                                    .length; i++
                                                                                                                ) {
                                                                                                                    var
                                                                                                                        view =
                                                                                                                        views[
                                                                                                                            i
                                                                                                                        ];
                                                                                                                    if (view
                                                                                                                        .invalidateElementUIs
                                                                                                                    ) {
                                                                                                                        view
                                                                                                                            .invalidateElementUIs();
                                                                                                                    }
                                                                                                                    if (view
                                                                                                                        .invalidateDisplay
                                                                                                                    ) {
                                                                                                                        view
                                                                                                                            .invalidateDisplay();
                                                                                                                    }
                                                                                                                }
                                                                                                            };
                                                                                                    }

                                                                                                    function getImageName(
                                                                                                        url) {
                                                                                                        var
                                                                                                            index =
                                                                                                            url
                                                                                                            .lastIndexOf(
                                                                                                                '/'
                                                                                                            );
                                                                                                        var
                                                                                                            name =
                                                                                                            url;
                                                                                                        if (index > = 0) {
                                                                                                            name
                                                                                                                =
                                                                                                                url
                                                                                                                .substring(
                                                                                                                    index +
                                                                                                                    1
                                                                                                                );
                                                                                                        }
                                                                                                        index
                                                                                                            =
                                                                                                            name
                                                                                                            .lastIndexOf(
                                                                                                                '.'
                                                                                                            );
                                                                                                        if (index >=
                                                                                                            0) {
                                                                                                            name
                                                                                                                =
                                                                                                                name
                                                                                                                .substring(
                                                                                                                    0,
                                                                                                                    index
                                                                                                                );
                                                                                                        }
                                                                                                        return
                                                                                                        name;
                                                                                                    }

                                                                                                    //--------设备详情-----------
                                                                                                    function initDialog(
                                                                                                        node) {
                                                                                                        var
                                                                                                            div =
                                                                                                            document
                                                                                                            .getElementById(
                                                                                                                "devdiv"
                                                                                                            );
                                                                                                        if (div ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            div
                                                                                                                =
                                                                                                                document
                                                                                                                .createElement(
                                                                                                                    'div'
                                                                                                                );
                                                                                                            div.setAttribute(
                                                                                                                "id",
                                                                                                                "devdiv"
                                                                                                            );
                                                                                                            //
                                                                                                            div.setAttribute(
                                                                                                                "style",
                                                                                                                "height:230px;width:243px;padding-top:15px;
                                                                                                                opacity:
                                                                                                                0.9;
                                                                                                                " +
                                                                                                                //
                                                                                                                "background:url(../resource/img/rsing/topoimages/dev_background.png)"
                                                                                                            );
                                                                                                            div.style
                                                                                                                .display =
                                                                                                                'none';
                                                                                                            div.style
                                                                                                                .zIndex =
                                                                                                                100;
                                                                                                            demo.Util
                                                                                                                .appendChild(
                                                                                                                    div,
                                                                                                                    rightPane
                                                                                                                    .getView(),
                                                                                                                    0,
                                                                                                                    0,
                                                                                                                    null,
                                                                                                                    null
                                                                                                                );
                                                                                                        }
                                                                                                        var
                                                                                                            devname =
                                                                                                            node
                                                                                                            .getClient(
                                                                                                                "devname"
                                                                                                            );
                                                                                                        //table-bordered
                                                                                                        background
                                                                                                            -
                                                                                                            color: #
                                                                                                            FFFFCC
                                                                                                        div.innerHTML =
                                                                                                            " <
                                                                                                        table
                                                                                                        class =
                                                                                                            'dialog table table2 table-hover' >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            设备名称： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+
                                                                                                        "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                        devname
                                                                                                            +
                                                                                                            "\
                                                                                                        "
                                                                                                        target
                                                                                                            = \
                                                                                                            "_blank\">" +
                                                                                                            devname +
                                                                                                            "</a> < /
                                                                                                        td >
                                                                                                            <
                                                                                                            /tr>
                                                                                                        "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            设备厂家： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        vendorname
                                                                                                            ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            设备型号： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        typename
                                                                                                            ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            IP地址： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        devip
                                                                                                            ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            掩码： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        devipmask
                                                                                                            ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            网络类型： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        net ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            设备类型： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        type ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            设备角色： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        role ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " <
                                                                                                        tr >
                                                                                                            <
                                                                                                            td
                                                                                                        class =
                                                                                                            'td11' >
                                                                                                            省份 /
                                                                                                            城市： <
                                                                                                            /td> <
                                                                                                        td
                                                                                                        class =
                                                                                                            'td2' >
                                                                                                            "+node.getClient("
                                                                                                        city ")+" <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            "+
                                                                                                        " < /
                                                                                                        table >
                                                                                                            ";

                                                                                                        return
                                                                                                        div;
                                                                                                    }

                                                                                                    //绘制接口详情
                                                                                                    function ifDialog(
                                                                                                        tmp_link
                                                                                                    ) {
                                                                                                        var
                                                                                                            div =
                                                                                                            document
                                                                                                            .getElementById(
                                                                                                                "ifinfo"
                                                                                                            );
                                                                                                        if (div ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            div
                                                                                                                =
                                                                                                                document
                                                                                                                .createElement(
                                                                                                                    'div'
                                                                                                                );
                                                                                                            div.setAttribute(
                                                                                                                "id",
                                                                                                                "ifinfo"
                                                                                                            );
                                                                                                            //
                                                                                                            div.setAttribute(
                                                                                                                "style",
                                                                                                                "height:183px;width:290px;padding-top:15px;
                                                                                                                opacity:
                                                                                                                0.9;
                                                                                                                " +
                                                                                                                //
                                                                                                                "background:url(../resource/img/rsing/topoimages/link_background.png)"
                                                                                                            );
                                                                                                            div.style
                                                                                                                .display =
                                                                                                                'none';
                                                                                                            div.style
                                                                                                                .zIndex =
                                                                                                                100;
                                                                                                            demo.Util
                                                                                                                .appendChild(
                                                                                                                    div,
                                                                                                                    rightPane
                                                                                                                    .getView(),
                                                                                                                    0,
                                                                                                                    0,
                                                                                                                    null,
                                                                                                                    null
                                                                                                                );
                                                                                                        }
                                                                                                        var
                                                                                                            a_name =
                                                                                                            tmp_link
                                                                                                            .getClient(
                                                                                                                "a_dev_name"
                                                                                                            );
                                                                                                        var
                                                                                                            a_if =
                                                                                                            tmp_link
                                                                                                            .getClient(
                                                                                                                "a_if"
                                                                                                            );
                                                                                                        var
                                                                                                            z_name =
                                                                                                            tmp_link
                                                                                                            .getClient(
                                                                                                                "z_dev_name"
                                                                                                            );
                                                                                                        var
                                                                                                            z_if =
                                                                                                            tmp_link
                                                                                                            .getClient(
                                                                                                                "z_if"
                                                                                                            );
                                                                                                        if (a_name ==
                                                                                                            null &&
                                                                                                            z_name ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            div.innerHTML =
                                                                                                                " <
                                                                                                            table
                                                                                                            class
                                                                                                                =
                                                                                                                'dialogif table table2 table-hover' >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tbody
                                                                                                                >
                                                                                                                "+" <
                                                                                                                tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                双击展开链路两端逻辑视图后展示详细信息 <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            " < /
                                                                                                            tbody
                                                                                                                >
                                                                                                                "+" <
                                                                                                                /table>
                                                                                                            ";
                                                                                                        } else {
                                                                                                            div.innerHTML =
                                                                                                                " <
                                                                                                            table
                                                                                                            class
                                                                                                                =
                                                                                                                'dialogif table table2 table-hover' >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tbody
                                                                                                                >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif ' >
                                                                                                                A端设备： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                " +
                                                                                                            "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                            a_name
                                                                                                                +
                                                                                                                "\
                                                                                                            "
                                                                                                            target
                                                                                                                = \
                                                                                                                "_blank\">" +
                                                                                                                a_name +
                                                                                                                "</a> < /
                                                                                                            td >
                                                                                                                <
                                                                                                                /tr>
                                                                                                            "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                A端接口： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+
                                                                                                            "<a href=\"instanceInfo_dev.html?dev_name=" +
                                                                                                            a_name
                                                                                                                +
                                                                                                                " &
                                                                                                            inf_name
                                                                                                                =
                                                                                                                "+a_if+"\
                                                                                                            "
                                                                                                            target
                                                                                                                = \
                                                                                                                "_blank\">" +
                                                                                                                a_if +
                                                                                                                "</a> < /
                                                                                                            td >
                                                                                                                <
                                                                                                                /tr>
                                                                                                            "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                Z端设备： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+
                                                                                                            "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                            z_name
                                                                                                                +
                                                                                                                "\
                                                                                                            "
                                                                                                            target
                                                                                                                = \
                                                                                                                "_blank\">" +
                                                                                                                z_name +
                                                                                                                "</a> < /
                                                                                                            td >
                                                                                                                <
                                                                                                                /tr>
                                                                                                            "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                Z端接口： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+
                                                                                                            "<a href=\"instanceInfo_dev.html?dev_name=" +
                                                                                                            z_name
                                                                                                                +
                                                                                                                " &
                                                                                                            inf_name
                                                                                                                =
                                                                                                                "+z_if+"\
                                                                                                            "
                                                                                                            target
                                                                                                                = \
                                                                                                                "_blank\">" +
                                                                                                                z_if +
                                                                                                                "</a> < /
                                                                                                            td >
                                                                                                                <
                                                                                                                /tr>
                                                                                                            "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                接口带宽： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+tmp_link.getClient("
                                                                                                            type_name
                                                                                                                ")+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                链路类型： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+ipv4v6Map[tmp_link.getClient("
                                                                                                            ip_ver
                                                                                                                ")]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                利用率峰值A -
                                                                                                                Z： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+tmp_link.getClient("
                                                                                                            send_rate
                                                                                                                ")+" %
                                                                                                                "+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td
                                                                                                            class
                                                                                                                =
                                                                                                                'tdif' >
                                                                                                                利用率峰值Z -
                                                                                                                A： <
                                                                                                                /td> <
                                                                                                            td
                                                                                                            class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+tmp_link.getClient("
                                                                                                            rec_rate
                                                                                                                ")+" %
                                                                                                                "+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            " < /
                                                                                                            tbody
                                                                                                                >
                                                                                                                "+" <
                                                                                                                /table>
                                                                                                            ";
                                                                                                        }

                                                                                                        return
                                                                                                        div;
                                                                                                    }

                                                                                                    //绘制接口详情
                                                                                                    function ifbundleDialog(
                                                                                                        result,
                                                                                                        map_v4v6
                                                                                                    ) {
                                                                                                        var
                                                                                                            div =
                                                                                                            document
                                                                                                            .getElementById(
                                                                                                                "ifbundle"
                                                                                                            );
                                                                                                        if (div ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            div
                                                                                                                =
                                                                                                                document
                                                                                                                .createElement(
                                                                                                                    'div'
                                                                                                                );
                                                                                                            div.setAttribute(
                                                                                                                "id",
                                                                                                                "ifbundle"
                                                                                                            );
                                                                                                            div.style
                                                                                                                .display =
                                                                                                                'none';
                                                                                                            div.style
                                                                                                                .zIndex =
                                                                                                                100;
                                                                                                            demo.Util
                                                                                                                .appendChild(
                                                                                                                    div,
                                                                                                                    rightPane
                                                                                                                    .getView(),
                                                                                                                    0,
                                                                                                                    0,
                                                                                                                    null,
                                                                                                                    null
                                                                                                                );
                                                                                                        }
                                                                                                        var
                                                                                                            tmphtml =
                                                                                                            "";
                                                                                                        var
                                                                                                            linksum =
                                                                                                            0;
                                                                                                        for (var
                                                                                                                key in
                                                                                                                map_v4v6) {
                                                                                                            tmphtml
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td class =
                                                                                                                'tdbundle ' >
                                                                                                                "+key+"
                                                                                                            链路： <
                                                                                                                /td> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+map_v4v6[key]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                            linksum
                                                                                                                +=
                                                                                                                map_v4v6[
                                                                                                                    key
                                                                                                                ];
                                                                                                        }

                                                                                                        if (map_v4v6[
                                                                                                                "undefined_undefined"
                                                                                                            ] >
                                                                                                            1) {
                                                                                                            div.innerHTML =
                                                                                                                "<table class='dialogif table table2 table-hover'>
                                                                                                            "+
                                                                                                            "<tbody>" +
                                                                                                            "<tr> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                双击展开链路两端逻辑视图后展示详细信息 <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+ " <
                                                                                                                /tbody >
                                                                                                            "+" <
                                                                                                            /table>";
                                                                                                        } else {
                                                                                                            div.innerHTML =
                                                                                                                "<table
                                                                                                            class
                                                                                                                =
                                                                                                                'dialogif_b table table2 table-hover' >
                                                                                                                "+
                                                                                                            "<tr> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'tdbundle' >
                                                                                                                链路总数： <
                                                                                                                /td> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+linksum+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            "<tr> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'tdbundle tr_underline' >
                                                                                                                链路总带宽： <
                                                                                                                /td> <
                                                                                                            td class
                                                                                                                =
                                                                                                                'td2' >
                                                                                                                "+result+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                "+
                                                                                                            tmphtml
                                                                                                                +
                                                                                                                "</table>";
                                                                                                        }
                                                                                                        return div;
                                                                                                    }


                                                                                                    function drawAnalysisTable(
                                                                                                        analysisView,
                                                                                                        subcityN,
                                                                                                        subcityId,
                                                                                                        currSub
                                                                                                    ) {
                                                                                                        return
                                                                                                        drawAnalysisTableV4V6
                                                                                                            (analysisView,
                                                                                                                subcityN,
                                                                                                                subcityId,
                                                                                                                currSub,
                                                                                                                ""
                                                                                                            );
                                                                                                    }
                                                                                                    //统计视图
                                                                                                    function drawAnalysisTableV4V6(
                                                                                                        analysisView,
                                                                                                        subcityN,
                                                                                                        subcityId,
                                                                                                        currSub,
                                                                                                        ip_ver
                                                                                                    ) {
                                                                                                        var url =
                                                                                                            "/rsing/topo/getCountDev.do?1=1&rsing_id=" +
                                                                                                            rsing_id +
                                                                                                            "&pro=" +
                                                                                                            pro +
                                                                                                            "&cityName=" +
                                                                                                            subcityN +
                                                                                                            "&cityId=" +
                                                                                                            subcityId +
                                                                                                            "&ip_ver=" +
                                                                                                            ip_ver;
                                                                                                        var
                                                                                                            data;
                                                                                                        $.post(url,
                                                                                                            function (
                                                                                                                data
                                                                                                            ) {
                                                                                                                var tmptr =
                                                                                                                    "";
                                                                                                                if (currSub ==
                                                                                                                    null
                                                                                                                ) {
                                                                                                                    tmptr
                                                                                                                        =
                                                                                                                        "<tr> <
                                                                                                                    td >
                                                                                                                        省网CR： "+data.devCount[0]+" <
                                                                                                                        /td> <
                                                                                                                    td >
                                                                                                                        城域网CR： "+data.devCount[1]+" <
                                                                                                                        /td>"+
                                                                                                                    "<td>SR ：" +
                                                                                                                    data.devCount[
                                                                                                                            2
                                                                                                                        ] +
                                                                                                                        "</td> <
                                                                                                                    td >
                                                                                                                        BRAS： "+data.devCount[3]+" <
                                                                                                                        /td> <
                                                                                                                    td >
                                                                                                                        NAT： "+data.devCount[4]+" <
                                                                                                                        /td> < /
                                                                                                                    tr >
                                                                                                                        ";
                                                                                                                } else {
                                                                                                                    var cr =
                                                                                                                        0,
                                                                                                                        bras =
                                                                                                                        0,
                                                                                                                        sr =
                                                                                                                        0,
                                                                                                                        nat =
                                                                                                                        0;
                                                                                                                    var chilList =
                                                                                                                        currSub
                                                                                                                        .getChildren();
                                                                                                                    chilList
                                                                                                                        .forEach(
                                                                                                                            function (
                                                                                                                                group
                                                                                                                            ) {
                                                                                                                                if (group
                                                                                                                                    .getClassName() ==
                                                                                                                                    'twaver.Group'
                                                                                                                                ) {
                                                                                                                                    var nodelist =
                                                                                                                                        group
                                                                                                                                        .getChildren();
                                                                                                                                    nodelist
                                                                                                                                        .forEach(
                                                                                                                                            function (
                                                                                                                                                node
                                                                                                                                            ) {
                                                                                                                                                var type =
                                                                                                                                                    node
                                                                                                                                                    .getClient(
                                                                                                                                                        "type"
                                                                                                                                                    );
                                                                                                                                                var city =
                                                                                                                                                    node
                                                                                                                                                    .getClient(
                                                                                                                                                        "city"
                                                                                                                                                    )
                                                                                                                                                if (subcityN ==
                                                                                                                                                    node
                                                                                                                                                    .getClient(
                                                                                                                                                        "city"
                                                                                                                                                    )
                                                                                                                                                ) {
                                                                                                                                                    if (type ==
                                                                                                                                                        "CR"
                                                                                                                                                    )
                                                                                                                                                        cr++;
                                                                                                                                                    if (type ==
                                                                                                                                                        "BRAS"
                                                                                                                                                    )
                                                                                                                                                        bras++;
                                                                                                                                                    if (type ==
                                                                                                                                                        "SR"
                                                                                                                                                    )
                                                                                                                                                        sr++;
                                                                                                                                                    if (type ==
                                                                                                                                                        "独立NAT44"
                                                                                                                                                    )
                                                                                                                                                        nat++;
                                                                                                                                                }

                                                                                                                                            }
                                                                                                                                        )
                                                                                                                                }
                                                                                                                            }
                                                                                                                        );
                                                                                                                    tmptr
                                                                                                                        =
                                                                                                                        "<tr> <
                                                                                                                    td >
                                                                                                                        城域网CR： "+cr+" <
                                                                                                                        /td>"+
                                                                                                                    "<td>BRAS ：" +
                                                                                                                    bras +
                                                                                                                        "</td> <
                                                                                                                    td >
                                                                                                                        SR： "+sr+" <
                                                                                                                        /td> <
                                                                                                                    td >
                                                                                                                        NAT： "+nat+" <
                                                                                                                        /td> < /
                                                                                                                    tr >
                                                                                                                        ";
                                                                                                                }
                                                                                                                analysisView
                                                                                                                    .innerHTML =
                                                                                                                    "<table class='table table-bordered'
                                                                                                                style
                                                                                                                    =
                                                                                                                    'width:91%;margin:15px auto;' >
                                                                                                                    "+tmptr+" <
                                                                                                                    /table>"+
                                                                                                                "<table class='table table-hover table-bordered'
                                                                                                                style
                                                                                                                    =
                                                                                                                    'width:95%;' >
                                                                                                                    "+
                                                                                                                "<thead> <
                                                                                                                tr >
                                                                                                                    <
                                                                                                                    th class =
                                                                                                                    'tdc' >
                                                                                                                    局向 <
                                                                                                                    /th> <
                                                                                                                th class
                                                                                                                    =
                                                                                                                    'tdc' >
                                                                                                                    总带宽G <
                                                                                                                    /th> <
                                                                                                                th class
                                                                                                                    =
                                                                                                                    'tdc' >
                                                                                                                    上行流量峰值G <
                                                                                                                    /th> <
                                                                                                                th class
                                                                                                                    =
                                                                                                                    'tdc' >
                                                                                                                    下行流量峰值G <
                                                                                                                    /th>" +
                                                                                                                "<th class='tdc'>上行利用率峰值%</th> <
                                                                                                                th class
                                                                                                                    =
                                                                                                                    'tdc' >
                                                                                                                    下行利用率峰值 %
                                                                                                                    <
                                                                                                                    /th>"+" < /
                                                                                                                tr >
                                                                                                                    <
                                                                                                                    /thead>"+
                                                                                                                formatData
                                                                                                                    (
                                                                                                                        data
                                                                                                                    ) +
                                                                                                                    "</table>";
                                                                                                                analysisView
                                                                                                                    .style
                                                                                                                    .zIndex =
                                                                                                                    100;
                                                                                                            }
                                                                                                        )
                                                                                                        return analysisView;
                                                                                                    }

                                                                                                    function formatData(
                                                                                                        data) {
                                                                                                        var defult =
                                                                                                            "<td>0</td> <
                                                                                                        td >
                                                                                                            0 <
                                                                                                            /td> <
                                                                                                        td >
                                                                                                            0 <
                                                                                                            /td> <
                                                                                                        td >
                                                                                                            0.0 %
                                                                                                            <
                                                                                                            /td> <
                                                                                                        td >
                                                                                                            0.0 %
                                                                                                            <
                                                                                                            /td> < /
                                                                                                        tr >
                                                                                                            ";
                                                                                                        var tmpstr2 =
                                                                                                            "";
                                                                                                        var thedate =
                                                                                                            "";
                                                                                                        if (data
                                                                                                            .cr_169 !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            thedate
                                                                                                                =
                                                                                                                data
                                                                                                                .cr_169[
                                                                                                                    5
                                                                                                                ];
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至骨干网 <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_169[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_169[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_169[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_169[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_169[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至骨干网 <
                                                                                                                /td>"+defult;
                                                                                                        }
                                                                                                        if (data
                                                                                                            .cr_net !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            thedate
                                                                                                                =
                                                                                                                data
                                                                                                                .cr_net[
                                                                                                                    5
                                                                                                                ];
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                核心CR至省网 <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_net[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_net[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_net[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_net[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_net[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至省网 <
                                                                                                                /td>"+defult;
                                                                                                        }
                                                                                                        if (data
                                                                                                            .cr_idc !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            thedate
                                                                                                                =
                                                                                                                data
                                                                                                                .cr_idc[
                                                                                                                    5
                                                                                                                ];
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                核心CR至IDC <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_idc[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_idc[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_idc[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_idc[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_idc[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至IDC <
                                                                                                                /td>"+defult;
                                                                                                        }
                                                                                                        if (data
                                                                                                            .cr_gi !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            thedate
                                                                                                                =
                                                                                                                data
                                                                                                                .cr_gi[
                                                                                                                    5
                                                                                                                ];
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                核心CR至GI <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_gi[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_gi[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_gi[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_gi[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_gi[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至GI <
                                                                                                                /td>"+defult;
                                                                                                        }

                                                                                                        if (data
                                                                                                            .cr_cdn !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                核心CR至CDN <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_cdn[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_cdn[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_cdn[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_cdn[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.cr_cdn[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                核心CR至CDN <
                                                                                                                /td>"+defult;
                                                                                                        }

                                                                                                        if (data
                                                                                                            .sr_cr !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            thedate
                                                                                                                =
                                                                                                                data
                                                                                                                .sr_cr[
                                                                                                                    5
                                                                                                                ];
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                SR至核心CR <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.sr_cr[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.sr_cr[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.sr_cr[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.sr_cr[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.sr_cr[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                SR至核心CR <
                                                                                                                /td>"+defult;
                                                                                                        }

                                                                                                        if (data
                                                                                                            .bras_cr !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                " <
                                                                                                            tr >
                                                                                                                <
                                                                                                                td >
                                                                                                                BRAS至核心CR <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.bras_cr[0]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.bras_cr[1]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.bras_cr[2]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.bras_cr[3]+" <
                                                                                                                /td> <
                                                                                                            td >
                                                                                                                "+data.bras_cr[4]+" <
                                                                                                                /td> < /
                                                                                                            tr >
                                                                                                                ";
                                                                                                        } else {
                                                                                                            tmpstr2
                                                                                                                +=
                                                                                                                "<tr> <
                                                                                                            td >
                                                                                                                BRAS至核心CR <
                                                                                                                /td>"+defult;
                                                                                                        }
                                                                                                        $("#analysisHint")
                                                                                                            .html(
                                                                                                                "概览信息预统计" +
                                                                                                                thedate +
                                                                                                                "日数据"
                                                                                                            );
                                                                                                        return tmpstr2;
                                                                                                    }

                                                                                                    function initPane(
                                                                                                        splitPane
                                                                                                    ) {
                                                                                                        splitPane
                                                                                                            .setDividerBackground(
                                                                                                                "#ffffff"
                                                                                                            ) //劈分条的背景色#0d4981
                                                                                                        splitPane
                                                                                                            .setDividerOpacity(
                                                                                                                0.7
                                                                                                            ) //设置劈分条的透明度
                                                                                                        splitPane
                                                                                                            .setDividerWidth(
                                                                                                                0.05
                                                                                                            ) //劈分条的宽度
                                                                                                    }

                                                                                                    //------------------------------保存图片-----------------------------
                                                                                                    function imageExport() {
                                                                                                        var
                                                                                                            canvas;
                                                                                                        if (network
                                                                                                            .getCanvasSize
                                                                                                        ) {
                                                                                                            canvas
                                                                                                                =
                                                                                                                network
                                                                                                                .toCanvas(
                                                                                                                    network
                                                                                                                    .getCanvasSize()
                                                                                                                    .width,
                                                                                                                    network
                                                                                                                    .getCanvasSize()
                                                                                                                    .height
                                                                                                                );
                                                                                                        } else {
                                                                                                            canvas
                                                                                                                =
                                                                                                                network
                                                                                                                .toCanvas(
                                                                                                                    network
                                                                                                                    .getView()
                                                                                                                    .scrollWidth,
                                                                                                                    network
                                                                                                                    .getView()
                                                                                                                    .scrollHeight
                                                                                                                );
                                                                                                        }
                                                                                                        if (twaver
                                                                                                            .Util
                                                                                                            .isIE
                                                                                                        ) {
                                                                                                            var w =
                                                                                                                window
                                                                                                                .open();
                                                                                                            w.document
                                                                                                                .open();
                                                                                                            w.document
                                                                                                                .write(
                                                                                                                    "<img
                                                                                                                    src =
                                                                                                                    '" + canvas.toDataURL() + "' /
                                                                                                                    >
                                                                                                                    ");
                                                                                                                    w
                                                                                                                    .document
                                                                                                                    .close();
                                                                                                                }
                                                                                                            else {
                                                                                                                window
                                                                                                                    .open(
                                                                                                                        canvas
                                                                                                                        .toDataURL(),
                                                                                                                        'network.png'
                                                                                                                    );
                                                                                                            }
                                                                                                        }
                                                                                                        //-----------------------------------------------------------------

                                                                                                        //-------------------------保存位置信息---------------------------
                                                                                                        function savelocation() {
                                                                                                            if (confirm(
                                                                                                                    "确认保存拓扑图现在位置？"
                                                                                                                )) {
                                                                                                                var
                                                                                                                    location = [];
                                                                                                                box.forEach(
                                                                                                                    function (
                                                                                                                        node
                                                                                                                    ) {
                                                                                                                        if (node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Node' ||
                                                                                                                            node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.SubNetwork' ||
                                                                                                                            node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Group'
                                                                                                                        ) {
                                                                                                                            var loc =
                                                                                                                                node
                                                                                                                                .getLocation();
                                                                                                                            var temp =
                                                                                                                                node
                                                                                                                                .getId() +
                                                                                                                                ";" +
                                                                                                                                loc
                                                                                                                                .x +
                                                                                                                                ";" +
                                                                                                                                loc
                                                                                                                                .y;
                                                                                                                            location
                                                                                                                                .push(
                                                                                                                                    encodeURIComponent(
                                                                                                                                        temp
                                                                                                                                    )
                                                                                                                                );
                                                                                                                        }
                                                                                                                    }
                                                                                                                );


                                                                                                                $.ajax({
                                                                                                                    type: "post",
                                                                                                                    async: false, //同步执
                                                                                                                    traditional: true,
                                                                                                                    data: {
                                                                                                                        "dataArr": location
                                                                                                                    },
                                                                                                                    url: "/rsing/topo/savelocation.do?1=1&rsing_id=" +
                                                                                                                        rsing_id +
                                                                                                                        "&type=0",
                                                                                                                    success: function (
                                                                                                                        result,
                                                                                                                        status
                                                                                                                    ) {
                                                                                                                        if ("success" ==
                                                                                                                            status
                                                                                                                        ) {
                                                                                                                            alert
                                                                                                                                (
                                                                                                                                    "位置保存成功！"
                                                                                                                                );
                                                                                                                        } else {
                                                                                                                            alert
                                                                                                                                (
                                                                                                                                    "位置保存失败！"
                                                                                                                                );
                                                                                                                        }
                                                                                                                        network
                                                                                                                            .addViewListener(
                                                                                                                                reload
                                                                                                                            );
                                                                                                                    },
                                                                                                                    error: function () {
                                                                                                                        alert
                                                                                                                            (
                                                                                                                                "保存位置失败！"
                                                                                                                            );

                                                                                                                    }
                                                                                                                });
                                                                                                            }
                                                                                                        }
                                                                                                        var reload =
                                                                                                            function (
                                                                                                                e
                                                                                                            ) {
                                                                                                                location
                                                                                                                    .reload();
                                                                                                            }
                                                                                                        //网元加载完成后network.zoomOverview(true)不生效的解决方案
                                                                                                        var callback =
                                                                                                            function (
                                                                                                                e
                                                                                                            ) {
                                                                                                                if (e
                                                                                                                    .kind ===
                                                                                                                    'validateEnd'
                                                                                                                ) {
                                                                                                                    network
                                                                                                                        .removeViewListener(
                                                                                                                            callback
                                                                                                                        );
                                                                                                                    network
                                                                                                                        .zoomOverview();
                                                                                                                    overend
                                                                                                                        =
                                                                                                                        true; //画图完成标识
                                                                                                                } else {
                                                                                                                    overend
                                                                                                                        =
                                                                                                                        false;
                                                                                                                }
                                                                                                            };
                                                                                                        //---------------------------------------------------------------------------------------------

                                                                                                        var box;
                                                                                                        var
                                                                                                            network;
                                                                                                        var
                                                                                                            autoLayouter;
                                                                                                        var
                                                                                                            overview;
                                                                                                        var
                                                                                                            idfinder;
                                                                                                        var
                                                                                                            width;
                                                                                                        var
                                                                                                            height;
                                                                                                        var
                                                                                                            symbolLocationMap = {};
                                                                                                        var
                                                                                                            linkDataList;
                                                                                                        var resizeTimer =
                                                                                                            null;
                                                                                                        var
                                                                                                            rightPane;
                                                                                                        var rsing_id,
                                                                                                            pro;
                                                                                                        var
                                                                                                            tree;
                                                                                                        var overend =
                                                                                                            false;
                                                                                                        var whole_color =
                                                                                                            '#0d4981'; //全局背景色
                                                                                                        var
                                                                                                            devids_169;
                                                                                                        var pro;

                                                                                                        requirejs
                                                                                                            (["jquery",
                                                                                                                    "jqueryUi",
                                                                                                                    "bootstrap",
                                                                                                                    "datatable",
                                                                                                                    "datetime_zh"
                                                                                                                ],
                                                                                                                function (
                                                                                                                    $,
                                                                                                                    jqueryUi,
                                                                                                                    bootstrap,
                                                                                                                    datatable,
                                                                                                                    datetime_zh,
                                                                                                                    twaver2
                                                                                                                ) {
                                                                                                                    $(document)
                                                                                                                        .ready(
                                                                                                                            function () {
                                                                                                                                var requ =
                                                                                                                                    getRequest();
                                                                                                                                rsing_id
                                                                                                                                    =
                                                                                                                                    requ[
                                                                                                                                        'rsing_id'
                                                                                                                                    ];
                                                                                                                                devids_169
                                                                                                                                    =
                                                                                                                                    requ[
                                                                                                                                        'devids_169'
                                                                                                                                    ];
                                                                                                                                pro =
                                                                                                                                    requ[
                                                                                                                                        'pro'
                                                                                                                                    ];
                                                                                                                                $(document)
                                                                                                                                    .attr(
                                                                                                                                        "title",
                                                                                                                                        pro +
                                                                                                                                        "骨干网拓扑图"
                                                                                                                                    )
                                                                                                                                box =
                                                                                                                                    new ElementBox();
                                                                                                                                network
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .vector
                                                                                                                                    .Network(
                                                                                                                                        box
                                                                                                                                    );
                                                                                                                                autoLayouter
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .layout
                                                                                                                                    .AutoLayouter(
                                                                                                                                        box
                                                                                                                                    );
                                                                                                                                overview
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .vector
                                                                                                                                    .Overview(
                                                                                                                                        network
                                                                                                                                    ); //鹰眼视图组件
                                                                                                                                idfinder
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .QuickFinder(
                                                                                                                                        box,
                                                                                                                                        "id"
                                                                                                                                    ); //devid
                                                                                                                                namefinder
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .QuickFinder(
                                                                                                                                        box,
                                                                                                                                        "name"
                                                                                                                                    ); //根据name查询
                                                                                                                                subAuto_list
                                                                                                                                    =
                                                                                                                                    new twaver
                                                                                                                                    .List();
                                                                                                                                tree =
                                                                                                                                    new Tree(
                                                                                                                                        box
                                                                                                                                    );
                                                                                                                                data =
                                                                                                                                    new twaver
                                                                                                                                    .Element();
                                                                                                                                width
                                                                                                                                    =
                                                                                                                                    $(
                                                                                                                                        window
                                                                                                                                    )
                                                                                                                                    .width();
                                                                                                                                height
                                                                                                                                    =
                                                                                                                                    $(
                                                                                                                                        window
                                                                                                                                    )
                                                                                                                                    .height();
                                                                                                                                init
                                                                                                                                    ();
                                                                                                                            }
                                                                                                                        )
                                                                                                                }
                                                                                                            )

                                                                                                        function init() {
                                                                                                            $(".modal")
                                                                                                                .draggable({
                                                                                                                    handle: ".modal-header"
                                                                                                                });
                                                                                                            var toolbar =
                                                                                                                document
                                                                                                                .getElementById(
                                                                                                                    "toolbar"
                                                                                                                );
                                                                                                            initToolbar
                                                                                                                (
                                                                                                                    toolbar
                                                                                                                );
                                                                                                            windowResize
                                                                                                                ();
                                                                                                            tick
                                                                                                                ();
                                                                                                        }

                                                                                                        function tick() {
                                                                                                            var
                                                                                                                today;
                                                                                                            $.post("/rsing/topo/howAreYou",
                                                                                                                function (
                                                                                                                    data
                                                                                                                ) {
                                                                                                                    console
                                                                                                                        .log(
                                                                                                                            data
                                                                                                                        )
                                                                                                                }
                                                                                                            );
                                                                                                            window
                                                                                                                .setTimeout(
                                                                                                                    function () {
                                                                                                                        tick
                                                                                                                            ();
                                                                                                                    },
                                                                                                                    300000
                                                                                                                ); //5分钟刷一次
                                                                                                        }

                                                                                                        var cityMap = { //处理直辖市
                                                                                                            "北京": 1101,
                                                                                                            "上海": 11022,
                                                                                                            "天津": 1105,
                                                                                                            "重庆": 1103
                                                                                                        }

                                                                                                        function windowResize() {
                                                                                                            var self =
                                                                                                                this;
                                                                                                            initHomeNetwork
                                                                                                                ();
                                                                                                            init169DataBox_byDevid
                                                                                                                ();

                                                                                                            network
                                                                                                                .setScrollBarVisible(
                                                                                                                    false
                                                                                                                ); //设置滚动条是否可见

                                                                                                            //监听事件----点击显示设备信息
                                                                                                            var resizeTimer =
                                                                                                                0;
                                                                                                            network
                                                                                                                .addInteractionListener(
                                                                                                                    function (
                                                                                                                        e
                                                                                                                    ) {
                                                                                                                        if (e
                                                                                                                            .kind ==
                                                                                                                            'clickBackground' ||
                                                                                                                            e
                                                                                                                            .kind ==
                                                                                                                            'enterSubNetwork' ||
                                                                                                                            e
                                                                                                                            .kind ==
                                                                                                                            'liveMoveStart' ||
                                                                                                                            e
                                                                                                                            .kind ==
                                                                                                                            'liveMoveBetween'
                                                                                                                        ) {
                                                                                                                            $("#devdiv")
                                                                                                                                .hide();
                                                                                                                            $("#ifinfo")
                                                                                                                                .hide();
                                                                                                                            $("#ifbundle")
                                                                                                                                .hide();
                                                                                                                        }
                                                                                                                        if (e
                                                                                                                            .kind ==
                                                                                                                            'clickElement'
                                                                                                                        ) {
                                                                                                                            $("#ifinfo")
                                                                                                                                .hide();
                                                                                                                            $("#devdiv")
                                                                                                                                .hide();
                                                                                                                            $("#ifbundle")
                                                                                                                                .hide();
                                                                                                                            if (
                                                                                                                                resizeTimer
                                                                                                                            ) {
                                                                                                                                clearTimeout
                                                                                                                                    (
                                                                                                                                        resizeTimer
                                                                                                                                    ) //timeout 控制鼠标连带问题
                                                                                                                                resizeTimer
                                                                                                                                    =
                                                                                                                                    0;
                                                                                                                            }
                                                                                                                            resizeTimer
                                                                                                                                =
                                                                                                                                setTimeout(
                                                                                                                                    function () { //timeout 控制鼠标连带问题
                                                                                                                                        //------------------------------------------------------------------------
                                                                                                                                        if (e
                                                                                                                                            .element
                                                                                                                                            .getClassName() ==
                                                                                                                                            'twaver.Node'
                                                                                                                                        ) {
                                                                                                                                            var devinfo_node =
                                                                                                                                                e
                                                                                                                                                .element;
                                                                                                                                            if (devinfo_node
                                                                                                                                                .getId() !=
                                                                                                                                                0 &&
                                                                                                                                                devinfo_node
                                                                                                                                                .getToolTip() !=
                                                                                                                                                null
                                                                                                                                            ) { //处理骨干网的
                                                                                                                                                var dialog =
                                                                                                                                                    initDialog(
                                                                                                                                                        devinfo_node
                                                                                                                                                    );
                                                                                                                                                var s =
                                                                                                                                                    dialog
                                                                                                                                                    .style;
                                                                                                                                                s.left =
                                                                                                                                                    (e.event
                                                                                                                                                        .clientX -
                                                                                                                                                        0.15 *
                                                                                                                                                        width
                                                                                                                                                    ) +
                                                                                                                                                    'px';
                                                                                                                                                s.top =
                                                                                                                                                    (e.event
                                                                                                                                                        .clientY +
                                                                                                                                                        24
                                                                                                                                                    ) +
                                                                                                                                                    'px';
                                                                                                                                            }
                                                                                                                                        } else if (
                                                                                                                                            e
                                                                                                                                            .element
                                                                                                                                            .getClassName() ==
                                                                                                                                            'twaver.Link'
                                                                                                                                        ) {
                                                                                                                                            var tmp_link =
                                                                                                                                                e
                                                                                                                                                .element;
                                                                                                                                            var expanded =
                                                                                                                                                tmp_link
                                                                                                                                                .getStyle(
                                                                                                                                                    'link.bundle.expanded'
                                                                                                                                                ); //是否展开
                                                                                                                                            if (expanded ||
                                                                                                                                                tmp_link
                                                                                                                                                .getBundleCount() ==
                                                                                                                                                1
                                                                                                                                            ) { //解决绑定线路为1的时候下不显示链路信息
                                                                                                                                                var dialog =
                                                                                                                                                    ifDialog(
                                                                                                                                                        tmp_link
                                                                                                                                                    ); //获取接口性能数据
                                                                                                                                                var s =
                                                                                                                                                    dialog
                                                                                                                                                    .style;
                                                                                                                                                s.display =
                                                                                                                                                    'block';
                                                                                                                                                s.left =
                                                                                                                                                    (e.event
                                                                                                                                                        .clientX -
                                                                                                                                                        0.15 *
                                                                                                                                                        width
                                                                                                                                                    ) +
                                                                                                                                                    'px';
                                                                                                                                                s.top =
                                                                                                                                                    e
                                                                                                                                                    .event
                                                                                                                                                    .clientY +
                                                                                                                                                    'px';
                                                                                                                                            } else if (
                                                                                                                                                tmp_link
                                                                                                                                                .isBundleAgent()
                                                                                                                                            ) {
                                                                                                                                                var sum =
                                                                                                                                                    0;
                                                                                                                                                var
                                                                                                                                                    tmpMap = {};
                                                                                                                                                var linklist =
                                                                                                                                                    tmp_link
                                                                                                                                                    .getBundleLinks()
                                                                                                                                                    .getLinks();
                                                                                                                                                linklist
                                                                                                                                                    .forEach(
                                                                                                                                                        function (
                                                                                                                                                            value
                                                                                                                                                        ) {
                                                                                                                                                            var ifspeed =
                                                                                                                                                                value
                                                                                                                                                                .getClient(
                                                                                                                                                                    "ifspeed"
                                                                                                                                                                );
                                                                                                                                                            var alpha =
                                                                                                                                                                value
                                                                                                                                                                .getStyle(
                                                                                                                                                                    'whole.alpha'
                                                                                                                                                                ); //TODO this
                                                                                                                                                            if (alpha ==
                                                                                                                                                                1
                                                                                                                                                            ) { //TODO this
                                                                                                                                                                var type_name =
                                                                                                                                                                    value
                                                                                                                                                                    .getClient(
                                                                                                                                                                        "type_name"
                                                                                                                                                                    );
                                                                                                                                                                var ip_ver =
                                                                                                                                                                    value
                                                                                                                                                                    .getClient(
                                                                                                                                                                        "ip_ver"
                                                                                                                                                                    ); //IPv4v6
                                                                                                                                                                var tmp_str =
                                                                                                                                                                    ipv4v6Map[
                                                                                                                                                                        ip_ver
                                                                                                                                                                    ] +
                                                                                                                                                                    "_" +
                                                                                                                                                                    type_name;
                                                                                                                                                                if (tmpMap[
                                                                                                                                                                        tmp_str
                                                                                                                                                                    ] ==
                                                                                                                                                                    null
                                                                                                                                                                ) {
                                                                                                                                                                    tmpMap
                                                                                                                                                                        [
                                                                                                                                                                            tmp_str
                                                                                                                                                                        ] =
                                                                                                                                                                        1;
                                                                                                                                                                } else {
                                                                                                                                                                    tmpMap
                                                                                                                                                                        [
                                                                                                                                                                            tmp_str
                                                                                                                                                                        ] +=
                                                                                                                                                                        1;
                                                                                                                                                                }
                                                                                                                                                                sum +=
                                                                                                                                                                    ifspeed;
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    )

                                                                                                                                                var result =
                                                                                                                                                    sum /
                                                                                                                                                    1000 /
                                                                                                                                                    1000 /
                                                                                                                                                    1000 +
                                                                                                                                                    "G";
                                                                                                                                                var dialog =
                                                                                                                                                    ifbundleDialog(
                                                                                                                                                        result,
                                                                                                                                                        tmpMap
                                                                                                                                                    );
                                                                                                                                                var s =
                                                                                                                                                    dialog
                                                                                                                                                    .style;
                                                                                                                                                s.display =
                                                                                                                                                    'block';
                                                                                                                                                s.left =
                                                                                                                                                    (e.event
                                                                                                                                                        .clientX -
                                                                                                                                                        0.15 *
                                                                                                                                                        width
                                                                                                                                                    ) +
                                                                                                                                                    'px';
                                                                                                                                                s.top =
                                                                                                                                                    e
                                                                                                                                                    .event
                                                                                                                                                    .clientY +
                                                                                                                                                    'px';
                                                                                                                                            }
                                                                                                                                        } else if (
                                                                                                                                            e
                                                                                                                                            .element instanceof twaver
                                                                                                                                            .SubNetwork
                                                                                                                                        ) {

                                                                                                                                        }

                                                                                                                                        //------------------------------------------------------------------------
                                                                                                                                    },
                                                                                                                                    200
                                                                                                                                ); //timeout 控制鼠标连带问题
                                                                                                                        } else if (
                                                                                                                            e
                                                                                                                            .kind ===
                                                                                                                            'doubleClickElement'
                                                                                                                        ) {
                                                                                                                            if (
                                                                                                                                resizeTimer
                                                                                                                            ) {
                                                                                                                                clearTimeout
                                                                                                                                    (
                                                                                                                                        resizeTimer
                                                                                                                                    );
                                                                                                                                resizeTimer
                                                                                                                                    =
                                                                                                                                    0;
                                                                                                                            }
                                                                                                                            if (e
                                                                                                                                .element instanceof twaver
                                                                                                                                .SubNetwork
                                                                                                                            ) {
                                                                                                                                var subNetWork =
                                                                                                                                    currentSubnetwork =
                                                                                                                                    e
                                                                                                                                    .element;
                                                                                                                                if (subNetWork
                                                                                                                                    .getChildrenSize() <
                                                                                                                                    1
                                                                                                                                ) {
                                                                                                                                    initSubDataBox
                                                                                                                                        (subNetWork,
                                                                                                                                            false
                                                                                                                                        )
                                                                                                                                } else {
                                                                                                                                    network
                                                                                                                                        .zoomOverview(
                                                                                                                                            true
                                                                                                                                        );
                                                                                                                                }
                                                                                                                            }
                                                                                                                        } else if (
                                                                                                                            e
                                                                                                                            .kind ===
                                                                                                                            'upSubNetwork'
                                                                                                                        ) {
                                                                                                                            if (
                                                                                                                                is_query_multi_hop
                                                                                                                            ) {
                                                                                                                                location
                                                                                                                                    .reload();
                                                                                                                            } else {
                                                                                                                                network
                                                                                                                                    .zoomOverview(
                                                                                                                                        true
                                                                                                                                    );
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                );
                                                                                                            tree.addInteractionListener(
                                                                                                                function (
                                                                                                                    evt
                                                                                                                ) {
                                                                                                                    var
                                                                                                                        node =
                                                                                                                        evt
                                                                                                                        .data;
                                                                                                                    if (evt
                                                                                                                        .kind ==
                                                                                                                        'click'
                                                                                                                    ) { //单击
                                                                                                                        if (node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.SubNetwork'
                                                                                                                        ) {
                                                                                                                            if (node
                                                                                                                                .getChildrenSize() <
                                                                                                                                1
                                                                                                                            ) {
                                                                                                                                initSubDataBox
                                                                                                                                    (node,
                                                                                                                                        false
                                                                                                                                    );
                                                                                                                            } else {
                                                                                                                                network
                                                                                                                                    .zoomOverview(
                                                                                                                                        true
                                                                                                                                    );
                                                                                                                            }
                                                                                                                        } else
                                                                                                                        if (node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Group'
                                                                                                                        ) {
                                                                                                                            network
                                                                                                                                .zoomOverview(
                                                                                                                                    true
                                                                                                                                );
                                                                                                                        }
                                                                                                                    } else
                                                                                                                    if (evt
                                                                                                                        .kind ==
                                                                                                                        'collapse'
                                                                                                                    ) { //合并
                                                                                                                        if (node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.SubNetwork'
                                                                                                                        ) {
                                                                                                                            if (
                                                                                                                                is_query_multi_hop
                                                                                                                            ) {
                                                                                                                                location
                                                                                                                                    .reload();
                                                                                                                            } else {
                                                                                                                                network
                                                                                                                                    .upSubNetwork(
                                                                                                                                        true
                                                                                                                                    );
                                                                                                                            }
                                                                                                                        } else
                                                                                                                        if (node
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Group'
                                                                                                                        ) {
                                                                                                                            node.setExpanded(
                                                                                                                                false
                                                                                                                            );
                                                                                                                        }
                                                                                                                        network
                                                                                                                            .zoomOverview(
                                                                                                                                true
                                                                                                                            );
                                                                                                                    }
                                                                                                                }
                                                                                                            );
                                                                                                            tree.setVisibleFunction(
                                                                                                                function (
                                                                                                                    element
                                                                                                                ) {
                                                                                                                    return
                                                                                                                    element instanceof twaver
                                                                                                                        .Node;
                                                                                                                }
                                                                                                            );
                                                                                                            tree.getIcon =
                                                                                                                function (
                                                                                                                    element
                                                                                                                ) {
                                                                                                                    return null;
                                                                                                                }; //选中颜色变化功能
                                                                                                            network
                                                                                                                .getSelectionModel()
                                                                                                                .addSelectionChangeListener(
                                                                                                                    function (
                                                                                                                        e
                                                                                                                    ) {
                                                                                                                        e.datas
                                                                                                                            .forEach(
                                                                                                                                function (
                                                                                                                                    element
                                                                                                                                ) {
                                                                                                                                    if (self
                                                                                                                                        .box
                                                                                                                                        .getSelectionModel()
                                                                                                                                        .contains(
                                                                                                                                            element
                                                                                                                                        )
                                                                                                                                    ) {
                                                                                                                                        element
                                                                                                                                            .setStyle(
                                                                                                                                                'body.type',
                                                                                                                                                'default.vector'
                                                                                                                                            );
                                                                                                                                        element
                                                                                                                                            .setStyle(
                                                                                                                                                'select.color',
                                                                                                                                                '#ffffff'
                                                                                                                                            ); //选中模型边框颜色
                                                                                                                                        element
                                                                                                                                            .setStyle(
                                                                                                                                                'vector.fill.color',
                                                                                                                                                '#185d9e'
                                                                                                                                            ); //选中模型背景颜色 } else {
                                                                                                                                        element
                                                                                                                                            .setStyle(
                                                                                                                                                'body.type',
                                                                                                                                                'default'
                                                                                                                                            );
                                                                                                                                    }
                                                                                                                                },
                                                                                                                                this
                                                                                                                            );
                                                                                                                    },
                                                                                                                    this
                                                                                                                ); //------------------------------------------------------------------------- //设置链路聚合显示链路条数
                                                                                                            network
                                                                                                                .getLinkHandlerLabel =
                                                                                                                function (
                                                                                                                    link
                                                                                                                ) { //一大堆的条件过滤就是为了减少遍历和计算
                                                                                                                    if (link
                                                                                                                        .isBundleAgent()
                                                                                                                    ) {
                                                                                                                        var
                                                                                                                            expanded =
                                                                                                                            link
                                                                                                                            .getStyle(
                                                                                                                                'link.bundle.expanded'
                                                                                                                            ); //是否展开
                                                                                                                        if (expanded ||
                                                                                                                            link
                                                                                                                            .getBundleLinks() ==
                                                                                                                            null
                                                                                                                        ) { //展开或展开只有自己一条link return
                                                                                                                            link.getClient(
                                                                                                                                    "ifspeed"
                                                                                                                                ) /
                                                                                                                                1000 /
                                                                                                                                1000 /
                                                                                                                                1000;
                                                                                                                        }
                                                                                                                        var sum =
                                                                                                                            0;
                                                                                                                        var agentFlag =
                                                                                                                            false;
                                                                                                                        var agentLink =
                                                                                                                            null;
                                                                                                                        var
                                                                                                                            linkGouplist =
                                                                                                                            link
                                                                                                                            .getBundleLinks()
                                                                                                                            .getLinks();
                                                                                                                        linkGouplist
                                                                                                                            .forEach(
                                                                                                                                function (
                                                                                                                                    value
                                                                                                                                ) {
                                                                                                                                    var
                                                                                                                                        ifspeed =
                                                                                                                                        value
                                                                                                                                        .getClient(
                                                                                                                                            "ifspeed"
                                                                                                                                        );
                                                                                                                                    var
                                                                                                                                        alpha =
                                                                                                                                        value
                                                                                                                                        .getStyle(
                                                                                                                                            'whole.alpha'
                                                                                                                                        ); //TODO this
                                                                                                                                    if (alpha ==
                                                                                                                                        1
                                                                                                                                    ) { //TODO this sum+=ifspeed; if(!agentFlag){
                                                                                                                                        agentFlag
                                                                                                                                            =
                                                                                                                                            true;
                                                                                                                                        agentLink
                                                                                                                                            =
                                                                                                                                            value;
                                                                                                                                    }
                                                                                                                                } //TODO this })
                                                                                                                                return sum /
                                                                                                                                    1000 /
                                                                                                                                    1000 /
                                                                                                                                    1000;
                                                                                                                            }
                                                                                                                        else
                                                                                                                        if (!
                                                                                                                            link
                                                                                                                            .isBundleAgent()
                                                                                                                        ) {
                                                                                                                            return
                                                                                                                            link.getClient(
                                                                                                                                    "ifspeed"
                                                                                                                                ) /
                                                                                                                                1000 /
                                                                                                                                1000 /
                                                                                                                                1000;
                                                                                                                        } else {
                                                                                                                            alert
                                                                                                                                (
                                                                                                                                    "111111"
                                                                                                                                );
                                                                                                                            return null;
                                                                                                                        }
                                                                                                                        alert
                                                                                                                            (
                                                                                                                                "2222222222"
                                                                                                                            );
                                                                                                                        return null;
                                                                                                                    }; //------------------------------------------------------------------------- //解决点击网元，显示的div使网元无法拖动的情况
                                                                                                                    network
                                                                                                                        .getView()
                                                                                                                        .addEventListener(
                                                                                                                            'mouseup',
                                                                                                                            function (
                                                                                                                                e
                                                                                                                            ) {
                                                                                                                                var element =
                                                                                                                                    network
                                                                                                                                    .getElementAt(
                                                                                                                                        e
                                                                                                                                    );
                                                                                                                                if (element !=
                                                                                                                                    null &&
                                                                                                                                    element
                                                                                                                                    .getClassName() ==
                                                                                                                                    'twaver.Node'
                                                                                                                                ) {
                                                                                                                                    setTimeout
                                                                                                                                        (function () {
                                                                                                                                                if (element
                                                                                                                                                    .getId() !=
                                                                                                                                                    0 &&
                                                                                                                                                    element
                                                                                                                                                    .getToolTip() !=
                                                                                                                                                    null
                                                                                                                                                ) {
                                                                                                                                                    $("#devdiv")
                                                                                                                                                        .show();
                                                                                                                                                }
                                                                                                                                            },
                                                                                                                                            200
                                                                                                                                        ) //延迟0.2秒显示 }
                                                                                                                                }
                                                                                                                            ); //-------------------------------------------------------------------------
                                                                                                                        } //创建工具栏 function initToolbar (div) { var
                                                                                                                    b1 = addButton2(
                                                                                                                        div,
                                                                                                                        "拓扑说明",
                                                                                                                        "",
                                                                                                                        function () {
                                                                                                                            $("#waringinfo")
                                                                                                                                .modal(
                                                                                                                                    "show"
                                                                                                                                );
                                                                                                                        }
                                                                                                                    );
                                                                                                                    b1.innerHTML =
                                                                                                                        "<span class='glyphicon glyphicon-pushpin' aria-hidden='true'></span>"
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            "放大",
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                network
                                                                                                                                    .zoomIn();
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '缩小',
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                network
                                                                                                                                    .zoomOut();
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '显示全部',
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                network
                                                                                                                                    .zoomOverview();
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '显示默认',
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                network
                                                                                                                                    .setZoom(
                                                                                                                                        1
                                                                                                                                    );
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '自动布局',
                                                                                                                            false,
                                                                                                                            function () { //只布局当前页面的拓扑位置 var
                                                                                                                                currSub
                                                                                                                                    =
                                                                                                                                    network
                                                                                                                                    .getCurrentSubNetwork();
                                                                                                                                if (rsing_id ==
                                                                                                                                    99 &&
                                                                                                                                    (devids_169 !=
                                                                                                                                        null
                                                                                                                                    )
                                                                                                                                ) {
                                                                                                                                    autoLayouter
                                                                                                                                        .setRepulsion(
                                                                                                                                            2
                                                                                                                                        )
                                                                                                                                    autoLayouter
                                                                                                                                        .doLayout(
                                                                                                                                            'symmetry',
                                                                                                                                            function () {
                                                                                                                                                network
                                                                                                                                                    .zoomOverview(
                                                                                                                                                        true
                                                                                                                                                    );
                                                                                                                                            }
                                                                                                                                        );
                                                                                                                                } else {
                                                                                                                                    alert
                                                                                                                                        (
                                                                                                                                            "不支持该视图自动布局"
                                                                                                                                        );
                                                                                                                                }
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addSelect
                                                                                                                        (div,
                                                                                                                            'select_up_div'
                                                                                                                        ); //ipv4v6切换按钮
                                                                                                                    addSelect
                                                                                                                        (div,
                                                                                                                            'select_ipv4v6'
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '保存当前位置',
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                savelocation
                                                                                                                                    ();
                                                                                                                            }
                                                                                                                        );
                                                                                                                    addButton
                                                                                                                        (div,
                                                                                                                            '刷新',
                                                                                                                            false,
                                                                                                                            function () {
                                                                                                                                location
                                                                                                                                    .reload();
                                                                                                                            }
                                                                                                                        );
                                                                                                                }

                                                                                                            function select(
                                                                                                                s,
                                                                                                                e,
                                                                                                                type
                                                                                                            ) {
                                                                                                                s = s *
                                                                                                                    1;
                                                                                                                e = e *
                                                                                                                    1;
                                                                                                                var currSub =
                                                                                                                    network
                                                                                                                    .getCurrentSubNetwork()
                                                                                                                if (currSub !=
                                                                                                                    null
                                                                                                                ) {
                                                                                                                    var chilList =
                                                                                                                        currSub
                                                                                                                        .getChildren();
                                                                                                                    chilList
                                                                                                                        .forEach(
                                                                                                                            function (
                                                                                                                                link
                                                                                                                            ) {
                                                                                                                                if (link
                                                                                                                                    .getClassName() ==
                                                                                                                                    'twaver.Link'
                                                                                                                                ) {
                                                                                                                                    var
                                                                                                                                        send =
                                                                                                                                        link
                                                                                                                                        .getClient(
                                                                                                                                            "send_rate"
                                                                                                                                        ) *
                                                                                                                                        1;
                                                                                                                                    var
                                                                                                                                        rec =
                                                                                                                                        link
                                                                                                                                        .getClient(
                                                                                                                                            "rec_rate"
                                                                                                                                        ) *
                                                                                                                                        1;
                                                                                                                                    var flag =
                                                                                                                                        false;
                                                                                                                                    if ('all' ==
                                                                                                                                        type
                                                                                                                                    ) {
                                                                                                                                        if ((send >=
                                                                                                                                                s &&
                                                                                                                                                send <
                                                                                                                                                e
                                                                                                                                            ) ||
                                                                                                                                            (rec >=
                                                                                                                                                s &&
                                                                                                                                                rec <
                                                                                                                                                e
                                                                                                                                            )
                                                                                                                                        )
                                                                                                                                            flag =
                                                                                                                                            true;
                                                                                                                                    } else if (
                                                                                                                                        'up' ==
                                                                                                                                        type
                                                                                                                                    ) {
                                                                                                                                        if (send >=
                                                                                                                                            s &&
                                                                                                                                            send <
                                                                                                                                            e
                                                                                                                                        )
                                                                                                                                            flag =
                                                                                                                                            true;
                                                                                                                                    } else if (
                                                                                                                                        'down' ==
                                                                                                                                        type
                                                                                                                                    ) {
                                                                                                                                        if (rec >=
                                                                                                                                            s &&
                                                                                                                                            rec <
                                                                                                                                            e
                                                                                                                                        )
                                                                                                                                            flag =
                                                                                                                                            true;
                                                                                                                                    }
                                                                                                                                    if (
                                                                                                                                        flag
                                                                                                                                    ) {
                                                                                                                                        link.setStyle(
                                                                                                                                            'whole.alpha',
                                                                                                                                            1
                                                                                                                                        );
                                                                                                                                    } else {
                                                                                                                                        link.setStyle(
                                                                                                                                            'whole.alpha',
                                                                                                                                            0.2
                                                                                                                                        );
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        );
                                                                                                                } else { //说明是首页
                                                                                                                    box.forEach(
                                                                                                                        function (
                                                                                                                            ele
                                                                                                                        ) { //China
                                                                                                                            169 骨干网 省网核心
                                                                                                                            var
                                                                                                                                filter =
                                                                                                                                ele
                                                                                                                                .getClassName() ==
                                                                                                                                'twaver.Link' &&
                                                                                                                                ele
                                                                                                                                .getToNode()
                                                                                                                                .getParent()
                                                                                                                                .getClassName() ==
                                                                                                                                'twaver.Group';
                                                                                                                            if (
                                                                                                                                filter
                                                                                                                            ) {
                                                                                                                                var
                                                                                                                                    send =
                                                                                                                                    ele
                                                                                                                                    .getClient(
                                                                                                                                        "send_rate"
                                                                                                                                    ) *
                                                                                                                                    1;
                                                                                                                                var
                                                                                                                                    rec =
                                                                                                                                    ele
                                                                                                                                    .getClient(
                                                                                                                                        "rec_rate"
                                                                                                                                    ) *
                                                                                                                                    1;
                                                                                                                                var
                                                                                                                                    flag =
                                                                                                                                    false;
                                                                                                                                if ('all' ==
                                                                                                                                    type
                                                                                                                                ) {
                                                                                                                                    if ((send >=
                                                                                                                                            s &&
                                                                                                                                            send <
                                                                                                                                            e
                                                                                                                                        ) ||
                                                                                                                                        (rec >=
                                                                                                                                            s &&
                                                                                                                                            rec <
                                                                                                                                            e
                                                                                                                                        )
                                                                                                                                    )
                                                                                                                                        flag =
                                                                                                                                        true;
                                                                                                                                } else if (
                                                                                                                                    'up' ==
                                                                                                                                    type
                                                                                                                                ) {
                                                                                                                                    if (send >=
                                                                                                                                        s &&
                                                                                                                                        send <
                                                                                                                                        e
                                                                                                                                    )
                                                                                                                                        flag =
                                                                                                                                        true;
                                                                                                                                } else if (
                                                                                                                                    'down' ==
                                                                                                                                    type
                                                                                                                                ) {
                                                                                                                                    if (rec >=
                                                                                                                                        s &&
                                                                                                                                        rec <
                                                                                                                                        e
                                                                                                                                    )
                                                                                                                                        flag =
                                                                                                                                        true;
                                                                                                                                }
                                                                                                                                if (
                                                                                                                                    flag
                                                                                                                                ) {
                                                                                                                                    ele.setStyle(
                                                                                                                                        'whole.alpha',
                                                                                                                                        1
                                                                                                                                    );
                                                                                                                                } else {
                                                                                                                                    ele.setStyle(
                                                                                                                                        'whole.alpha',
                                                                                                                                        0.2
                                                                                                                                    );
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    )
                                                                                                                }
                                                                                                            }

                                                                                                            function
                                                                                                            selectv4v6(
                                                                                                                args1,
                                                                                                                args2
                                                                                                            ) {
                                                                                                                box.forEach(
                                                                                                                    function (
                                                                                                                        ele
                                                                                                                    ) {
                                                                                                                        var
                                                                                                                            filter =
                                                                                                                            ele
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Link' //
                                                                                                                            &&
                                                                                                                            ele
                                                                                                                            .getToNode()
                                                                                                                            .getParent()
                                                                                                                            .getClassName() ==
                                                                                                                            'twaver.Group';
                                                                                                                        if (
                                                                                                                            filter
                                                                                                                        ) {
                                                                                                                            var
                                                                                                                                ip_ver =
                                                                                                                                ele
                                                                                                                                .getClient(
                                                                                                                                    "ip_ver"
                                                                                                                                );
                                                                                                                            var flag =
                                                                                                                                false;
                                                                                                                            if ('all' ==
                                                                                                                                args1
                                                                                                                            ) {
                                                                                                                                flag =
                                                                                                                                    true;
                                                                                                                            } else
                                                                                                                            if (args1 ==
                                                                                                                                ip_ver ||
                                                                                                                                args2 ==
                                                                                                                                ip_ver
                                                                                                                            ) {
                                                                                                                                flag =
                                                                                                                                    true;
                                                                                                                            }
                                                                                                                            if (
                                                                                                                                flag
                                                                                                                            ) {
                                                                                                                                ele.setStyle(
                                                                                                                                    'whole.alpha',
                                                                                                                                    1
                                                                                                                                );
                                                                                                                            } else {
                                                                                                                                ele.setStyle(
                                                                                                                                    'whole.alpha',
                                                                                                                                    0.2
                                                                                                                                );
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                )
                                                                                                            } //首页布局 function
                                                                                                            initHomeNetwork
                                                                                                                () {
                                                                                                                    network
                                                                                                                        .setZoomManager(
                                                                                                                            new twaver
                                                                                                                            .vector
                                                                                                                            .LogicalZoomManager(
                                                                                                                                network
                                                                                                                            )
                                                                                                                        ); //混合缩放视图,使得图标不缩放，只缩放距离 //设置背景颜色
                                                                                                                    box.setStyle(
                                                                                                                        'background.type',
                                                                                                                        'vector'
                                                                                                                    );
                                                                                                                    box.setStyle(
                                                                                                                        'background.vector.fill',
                                                                                                                        true
                                                                                                                    );
                                                                                                                    box.setStyle(
                                                                                                                        'background.vector.fill.color',
                                                                                                                        whole_color
                                                                                                                    ); //"#99CCFF"
                                                                                                                    network
                                                                                                                        .setToolTipEnabled(
                                                                                                                            false
                                                                                                                        ); //设置tooltip显示
                                                                                                                    network
                                                                                                                        .adjustBounds({
                                                                                                                            width: width *
                                                                                                                                0.85 *
                                                                                                                                2,
                                                                                                                            height: height *
                                                                                                                                2
                                                                                                                        }); //注册图标
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/169ggw.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/sw.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/CR.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/CR-group.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/SR.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/SR-group.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/idccloud-gray.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/cdncloud-gray.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/mobcloud-gray.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/treeC.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/treeE.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/dev_background.png",
                                                                                                                            network
                                                                                                                        );
                                                                                                                    registerImage
                                                                                                                        ("../resource/img/rsing/topoimages/169group.png",
                                                                                                                            network
                                                                                                                        ); //插入图例-----------------------------------------
                                                                                                                    var
                                                                                                                        legend =
                                                                                                                        document
                                                                                                                        .createElement(
                                                                                                                            'div'
                                                                                                                        );
                                                                                                                    var
                                                                                                                        analysisView =
                                                                                                                        document
                                                                                                                        .getElementById(
                                                                                                                            'analysisView'
                                                                                                                        );
                                                                                                                    var
                                                                                                                        waringinfo =
                                                                                                                        document
                                                                                                                        .getElementById(
                                                                                                                            'waringinfo'
                                                                                                                        );
                                                                                                                    rightPane
                                                                                                                        =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .controls
                                                                                                                        .BorderPane(
                                                                                                                            network
                                                                                                                        );
                                                                                                                    demo.Util
                                                                                                                        .appendChild(
                                                                                                                            analysisView,
                                                                                                                            rightPane
                                                                                                                            .getView(),
                                                                                                                            null,
                                                                                                                            null,
                                                                                                                            null,
                                                                                                                            null
                                                                                                                        ); //top, right,
                                                                                                                    bottom,
                                                                                                                    left
                                                                                                                    demo.Util
                                                                                                                        .appendChild(
                                                                                                                            waringinfo,
                                                                                                                            rightPane
                                                                                                                            .getView(),
                                                                                                                            200,
                                                                                                                            50,
                                                                                                                            null,
                                                                                                                            50
                                                                                                                        ); //top, right,
                                                                                                                    bottom,
                                                                                                                    left //----------------------------------------------------------------------- //-------调整tree的整体样式----------------------------------------------------------
                                                                                                                    var
                                                                                                                        treeview =
                                                                                                                        tree
                                                                                                                        .getView();
                                                                                                                    treeview
                                                                                                                        .setAttribute(
                                                                                                                            "style",
                                                                                                                            "background:#282d33;color:#ffffff; " +
                                                                                                                            //#dbdada;设置tree的背景色和字体颜色 font-family:'微软雅黑';
                                                                                                                            " font-size:13px;padding-top:10px;overflow: auto;"
                                                                                                                        ); //overflow是滚动条 tree.setExpandIcon("treeE");//合并图标
                                                                                                                    tree.setCollapseIcon(
                                                                                                                        "treeC"
                                                                                                                    ); //展开图标
                                                                                                                    var treePane =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .controls
                                                                                                                        .BorderPane(
                                                                                                                            tree,
                                                                                                                        );
                                                                                                                    treePane
                                                                                                                        .setTopHeight(
                                                                                                                            10
                                                                                                                        );
                                                                                                                    var leftSplit =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .controls
                                                                                                                        .SplitPane(
                                                                                                                            treePane,
                                                                                                                            legend,
                                                                                                                            'vertical',
                                                                                                                            1
                                                                                                                        ); //-------调整tree的整体样式----------------------------------------------------------
                                                                                                                    demo.Util
                                                                                                                        .appendChild(
                                                                                                                            document
                                                                                                                            .getElementById(
                                                                                                                                'toolbar'
                                                                                                                            ),
                                                                                                                            rightPane
                                                                                                                            .getView(),
                                                                                                                            0,
                                                                                                                            null,
                                                                                                                            null,
                                                                                                                            0
                                                                                                                        );
                                                                                                                    var
                                                                                                                        mainSplit =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .controls
                                                                                                                        .SplitPane(
                                                                                                                            leftSplit,
                                                                                                                            rightPane,
                                                                                                                            'horizontal',
                                                                                                                            0.13
                                                                                                                        );
                                                                                                                    demo.Util
                                                                                                                        .appendChild(
                                                                                                                            mainSplit
                                                                                                                            .getView(),
                                                                                                                            document
                                                                                                                            .body,
                                                                                                                            0,
                                                                                                                            0,
                                                                                                                            0,
                                                                                                                            0
                                                                                                                        );
                                                                                                                    initPane
                                                                                                                        (
                                                                                                                            leftSplit
                                                                                                                        );
                                                                                                                    initPane
                                                                                                                        (
                                                                                                                            mainSplit
                                                                                                                        ); //----------鹰眼(OverView)
                                                                                                                    overview
                                                                                                                        .setOutlineColor(
                                                                                                                            "#020202"
                                                                                                                        ); //边框线颜色
                                                                                                                    overview
                                                                                                                        .setOutlineWidth(
                                                                                                                            1.3
                                                                                                                        ); //边框线宽度
                                                                                                                    demo.Util
                                                                                                                        .appendChild(
                                                                                                                            overview
                                                                                                                            .getView(),
                                                                                                                            rightPane
                                                                                                                            .getView(),
                                                                                                                            0,
                                                                                                                            0,
                                                                                                                            null,
                                                                                                                            null
                                                                                                                        );
                                                                                                                    var
                                                                                                                        owidth =
                                                                                                                        width *
                                                                                                                        0.85 *
                                                                                                                        0.2;
                                                                                                                    var
                                                                                                                        oheight =
                                                                                                                        height *
                                                                                                                        0.2; //其实overview内的canvas是自动调整的,这个只是设置了边界
                                                                                                                    overview
                                                                                                                        .adjustBounds({
                                                                                                                            width: owidth,
                                                                                                                            height: oheight
                                                                                                                        });
                                                                                                                }

                                                                                                            function
                                                                                                            init169DataBox_byDevid() {
                                                                                                                $.ajaxSetup({
                                                                                                                    async: false
                                                                                                                }); //ajax
                                                                                                                同步--
                                                                                                                --
                                                                                                                -
                                                                                                                这是一个全局的
                                                                                                                box
                                                                                                                    .clear();
                                                                                                                var
                                                                                                                    autoflag =
                                                                                                                    true; //自动布局标识
                                                                                                                var devid_set =
                                                                                                                    new Set();
                                                                                                                var
                                                                                                                    the_devids =
                                                                                                                    devids_169
                                                                                                                    .split(
                                                                                                                        ","
                                                                                                                    );
                                                                                                                for (
                                                                                                                    var tmp in
                                                                                                                        the_devids
                                                                                                                ) {
                                                                                                                    devid_set
                                                                                                                        .add(
                                                                                                                            the_devids[
                                                                                                                                tmp
                                                                                                                            ] +
                                                                                                                            ""
                                                                                                                        );
                                                                                                                } //加载位置信息 var
                                                                                                                loc_url
                                                                                                                    =
                                                                                                                    "/rsing/topo/getlocation.do?1=1&rsing_id=" +
                                                                                                                    rsing_id +
                                                                                                                    "&type=3";
                                                                                                                $.post(loc_url,
                                                                                                                    function (
                                                                                                                        data
                                                                                                                    ) {
                                                                                                                        symbolLocationMap
                                                                                                                            =
                                                                                                                            data;
                                                                                                                    }
                                                                                                                ) var
                                                                                                                    url =
                                                                                                                    "/rsing/topo/get169TopoData_byDevid.do?1=1&rsing_id=" +
                                                                                                                    rsing_id +
                                                                                                                    "&devids_169=" +
                                                                                                                    devids_169;
                                                                                                                $.post(url,
                                                                                                                    function (
                                                                                                                        data
                                                                                                                    ) {
                                                                                                                        devDataList
                                                                                                                            =
                                                                                                                            data
                                                                                                                            .devDataList;
                                                                                                                        var devsize =
                                                                                                                            devDataList
                                                                                                                            .length
                                                                                                                        if (devDataList
                                                                                                                            .length >
                                                                                                                            0
                                                                                                                        ) {
                                                                                                                            $.each(devDataList,
                                                                                                                                function (
                                                                                                                                    n,
                                                                                                                                    value
                                                                                                                                ) {
                                                                                                                                    var id =
                                                                                                                                        value
                                                                                                                                        .dev_id;
                                                                                                                                    var name =
                                                                                                                                        value
                                                                                                                                        .symbol_name;
                                                                                                                                    var area =
                                                                                                                                        value
                                                                                                                                        .area;
                                                                                                                                    var dev_pro =
                                                                                                                                        value
                                                                                                                                        .pro; //注意区分pro和dev_pro
                                                                                                                                    var city =
                                                                                                                                        value
                                                                                                                                        .city;
                                                                                                                                    var tmpnode =
                                                                                                                                        creatNode(
                                                                                                                                            pro +
                                                                                                                                            " _" +
                                                                                                                                            id +
                                                                                                                                            "_169_pro",
                                                                                                                                            name,
                                                                                                                                            "CR",
                                                                                                                                            value
                                                                                                                                        );
                                                                                                                                    if (devid_set
                                                                                                                                        .has(
                                                                                                                                            id +
                                                                                                                                            ""
                                                                                                                                        )
                                                                                                                                    ) {
                                                                                                                                        var
                                                                                                                                            group =
                                                                                                                                            creat169Group(
                                                                                                                                                rsing_id +
                                                                                                                                                "_" +
                                                                                                                                                dev_pro +
                                                                                                                                                "_" +
                                                                                                                                                value
                                                                                                                                                .dev_type,
                                                                                                                                                pro +
                                                                                                                                                "_" +
                                                                                                                                                typeMap[
                                                                                                                                                    value
                                                                                                                                                    .dev_type
                                                                                                                                                ],
                                                                                                                                                "CR-group"
                                                                                                                                            );
                                                                                                                                        group
                                                                                                                                            .setExpanded(
                                                                                                                                                true
                                                                                                                                            );
                                                                                                                                        group
                                                                                                                                            .addChild(
                                                                                                                                                tmpnode
                                                                                                                                            );
                                                                                                                                    } else {
                                                                                                                                        if (area ==
                                                                                                                                            "海外节点"
                                                                                                                                        ) {
                                                                                                                                            tmpnode
                                                                                                                                                .setName(
                                                                                                                                                    city
                                                                                                                                                );
                                                                                                                                        } else {
                                                                                                                                            var
                                                                                                                                                area_group =
                                                                                                                                                creat169Group(
                                                                                                                                                    "a_" +
                                                                                                                                                    area,
                                                                                                                                                    area,
                                                                                                                                                    "169group"
                                                                                                                                                );
                                                                                                                                            var
                                                                                                                                                group =
                                                                                                                                                creat169Group(
                                                                                                                                                    rsing_id +
                                                                                                                                                    "_" +
                                                                                                                                                    dev_pro +
                                                                                                                                                    "_" +
                                                                                                                                                    value
                                                                                                                                                    .dev_type,
                                                                                                                                                    dev_pro +
                                                                                                                                                    "_" +
                                                                                                                                                    typeMap[
                                                                                                                                                        value
                                                                                                                                                        .dev_type
                                                                                                                                                    ],
                                                                                                                                                    "CR-group"
                                                                                                                                                );
                                                                                                                                            group
                                                                                                                                                .addChild(
                                                                                                                                                    tmpnode
                                                                                                                                                );
                                                                                                                                            area_group
                                                                                                                                                .setExpanded(
                                                                                                                                                    true
                                                                                                                                                );
                                                                                                                                            area_group
                                                                                                                                                .addChild(
                                                                                                                                                    group
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    if (autoflag &&
                                                                                                                                        (
                                                                                                                                            tmpnode
                                                                                                                                            .getClient(
                                                                                                                                                "flag"
                                                                                                                                            )
                                                                                                                                        )
                                                                                                                                    ) { //位置表有位置，不会触发自动布局
                                                                                                                                        autoflag
                                                                                                                                            =
                                                                                                                                            false;
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            )
                                                                                                                        } //链路信息linkDataList
                                                                                                                        linkDataList
                                                                                                                            =
                                                                                                                            data
                                                                                                                            .linkDataList;
                                                                                                                        $.each(linkDataList,
                                                                                                                            function (
                                                                                                                                n,
                                                                                                                                value
                                                                                                                            ) {
                                                                                                                                var fromNode =
                                                                                                                                    null;
                                                                                                                                var
                                                                                                                                    toNode =
                                                                                                                                    null; //查找连接点 var
                                                                                                                                fromId
                                                                                                                                    =
                                                                                                                                    pro +
                                                                                                                                    "_" +
                                                                                                                                    value
                                                                                                                                    .a_dev_id +
                                                                                                                                    "_169_pro";
                                                                                                                                var
                                                                                                                                    toId =
                                                                                                                                    pro +
                                                                                                                                    "_" +
                                                                                                                                    value
                                                                                                                                    .z_dev_id +
                                                                                                                                    "_169_pro";
                                                                                                                                toNode
                                                                                                                                    =
                                                                                                                                    idfinder
                                                                                                                                    .findFirst(
                                                                                                                                        toId
                                                                                                                                    );
                                                                                                                                fromNode
                                                                                                                                    =
                                                                                                                                    idfinder
                                                                                                                                    .findFirst(
                                                                                                                                        fromId
                                                                                                                                    );
                                                                                                                                if (fromNode !=
                                                                                                                                    null &&
                                                                                                                                    toNode !=
                                                                                                                                    null &&
                                                                                                                                    fromNode !=
                                                                                                                                    toNode
                                                                                                                                ) {
                                                                                                                                    var
                                                                                                                                        link_id =
                                                                                                                                        "pro-" +
                                                                                                                                        rsing_id +
                                                                                                                                        "-" +
                                                                                                                                        value
                                                                                                                                        .a_dev_id +
                                                                                                                                        "-" +
                                                                                                                                        value
                                                                                                                                        .a_ifindex;
                                                                                                                                    var
                                                                                                                                        link =
                                                                                                                                        creatLink(
                                                                                                                                            link_id,
                                                                                                                                            fromNode,
                                                                                                                                            toNode,
                                                                                                                                            value
                                                                                                                                        );
                                                                                                                                }
                                                                                                                            }
                                                                                                                        );
                                                                                                                    }
                                                                                                                ); //自动布局
                                                                                                                --
                                                                                                                --
                                                                                                                围绕布局round
                                                                                                                对称布局(
                                                                                                                    symmetry
                                                                                                                ) //上下topbottom
                                                                                                                下上布局(
                                                                                                                    bottomtop
                                                                                                                )
                                                                                                                左右布局(
                                                                                                                    leftright
                                                                                                                ) 左右布局(
                                                                                                                    leftright
                                                                                                                ) 分层布局(
                                                                                                                    hierarchic
                                                                                                                )
                                                                                                                if (
                                                                                                                    autoflag
                                                                                                                ) {
                                                                                                                    autoLayouter
                                                                                                                        .setRepulsion(
                                                                                                                            2
                                                                                                                        )
                                                                                                                    autoLayouter
                                                                                                                        .doLayout(
                                                                                                                            'symmetry',
                                                                                                                            function () {
                                                                                                                                network
                                                                                                                                    .zoomOverview(
                                                                                                                                        true
                                                                                                                                    );
                                                                                                                            }
                                                                                                                        );
                                                                                                                } else {
                                                                                                                    network
                                                                                                                        .addViewListener(
                                                                                                                            callback
                                                                                                                        );
                                                                                                                }
                                                                                                                $("#loading")
                                                                                                                    .hide();
                                                                                                            } //创建node结点 function
                                                                                                            creatNode
                                                                                                                (id, name,
                                                                                                                    image,
                                                                                                                    devinfo
                                                                                                                ) {
                                                                                                                    var
                                                                                                                        node =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .Node(
                                                                                                                            id
                                                                                                                        ); //id为topo图中的symble_id
                                                                                                                    if (devinfo !=
                                                                                                                        null
                                                                                                                    )
                                                                                                                        setDeviceDetail2Node(
                                                                                                                            node,
                                                                                                                            devinfo
                                                                                                                        );
                                                                                                                    node.setName(
                                                                                                                        name
                                                                                                                    );
                                                                                                                    node.setImage(
                                                                                                                        image
                                                                                                                    );
                                                                                                                    node.setStyle(
                                                                                                                        'select.style',
                                                                                                                        'border'
                                                                                                                    );
                                                                                                                    node.setStyle(
                                                                                                                        'select.width',
                                                                                                                        1
                                                                                                                    );
                                                                                                                    node.setStyle(
                                                                                                                        'select.join',
                                                                                                                        'round'
                                                                                                                    );
                                                                                                                    node.setStyle(
                                                                                                                        'select.color',
                                                                                                                        '#000000'
                                                                                                                    );
                                                                                                                    node.setStyle(
                                                                                                                        'label.color',
                                                                                                                        '#ffffff'
                                                                                                                    );
                                                                                                                    if (devinfo !=
                                                                                                                        null
                                                                                                                    ) {
                                                                                                                        var
                                                                                                                            nodetooltip =
                                                                                                                            devinfo
                                                                                                                            .dev_id; //存储结点信息
                                                                                                                        实际dev_id
                                                                                                                        node.setToolTip(
                                                                                                                            nodetooltip
                                                                                                                        );
                                                                                                                    }
                                                                                                                    var
                                                                                                                        loc =
                                                                                                                        symbolLocationMap[
                                                                                                                            id
                                                                                                                        ];
                                                                                                                    var x =
                                                                                                                        0;
                                                                                                                    var y =
                                                                                                                        0;
                                                                                                                    var
                                                                                                                        flag =
                                                                                                                        false;
                                                                                                                    if (loc !=
                                                                                                                        null
                                                                                                                    ) {
                                                                                                                        x = loc[
                                                                                                                            0
                                                                                                                        ];
                                                                                                                        y = loc[
                                                                                                                            1
                                                                                                                        ];
                                                                                                                        flag =
                                                                                                                            true;
                                                                                                                    }
                                                                                                                    node.setLocation(
                                                                                                                        x,
                                                                                                                        y
                                                                                                                    );
                                                                                                                    node.setClient(
                                                                                                                        "flag",
                                                                                                                        flag
                                                                                                                    );
                                                                                                                    box.add(
                                                                                                                        node
                                                                                                                    );
                                                                                                                    return
                                                                                                                    node
                                                                                                                    ;
                                                                                                                } //创建组 function
                                                                                                            creatGroup
                                                                                                                (id, name,
                                                                                                                    image
                                                                                                                ) {
                                                                                                                    var group =
                                                                                                                        new
                                                                                                                    twaver
                                                                                                                        .Group(
                                                                                                                            id
                                                                                                                        );
                                                                                                                    group
                                                                                                                        .setName(
                                                                                                                            name
                                                                                                                        );
                                                                                                                    group
                                                                                                                        .s('group.shape',
                                                                                                                            'oval'
                                                                                                                        ); //设置分组边框形状
                                                                                                                    group
                                                                                                                        .s('group.fill.color',
                                                                                                                            whole_color
                                                                                                                        ); //填充色FEF3E2
                                                                                                                    E0FFFF //
                                                                                                                    group
                                                                                                                        .s('group.fill.color',
                                                                                                                            '#ECF6FB'
                                                                                                                        ); //填充色FEF3E2 E0FFFF
                                                                                                                    group
                                                                                                                        .s('group.outline.color',
                                                                                                                            '#3cb2e6'
                                                                                                                        ); //F8C374 #0099FF
                                                                                                                    #99caea //































                                                                                        group.s('group.outline.color', '# 3399 FF
                                                                                                                        '
                                                                                                                ); //F8C374 #0099FF
                                                                                                            #99caea































                                                                                        group.s('group.outline.width', '2'































                                                                                        );































                                                                                        group.s('vector.outline.pattern',































                                                                                        [10,0]);//轮廓































                                                                                        group.s('group.deep',































                                                                                        0);































                                                                                        group.s('select.style', 'border'































                                                                                        );































                                                                                        group.s('select.width',































                                                                                        1);































                                                                                        group.s('select.join', 'round'































                                                                                        );































                                                                                        group.s('select.color', '# 000000
                                                                                                                '
                                                                                                        );
                                                                                                        group.s('label.color',
                                                                                                            '#ffffff'
                                                                                                        );
                                                                                                        var
                                                                                                            loc =
                                                                                                            symbolLocationMap[
                                                                                                                id
                                                                                                            ];
                                                                                                        var x =
                                                                                                            0;
                                                                                                        var y =
                                                                                                            0;
                                                                                                        var
                                                                                                            flag =
                                                                                                            false;
                                                                                                        if (loc !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            x = loc[
                                                                                                                0
                                                                                                            ];
                                                                                                            y = loc[
                                                                                                                1
                                                                                                            ];
                                                                                                            flag =
                                                                                                                true;
                                                                                                        }
                                                                                                        group
                                                                                                            .setLocation(
                                                                                                                x,
                                                                                                                y
                                                                                                            );
                                                                                                        group
                                                                                                            .setClient(
                                                                                                                "flag",
                                                                                                                flag
                                                                                                            );
                                                                                                        group
                                                                                                            .setImage(
                                                                                                                image
                                                                                                            );
                                                                                                        group
                                                                                                            .setExpanded(
                                                                                                                false
                                                                                                            );
                                                                                                        box.add(
                                                                                                            group
                                                                                                        );
                                                                                                        return
                                                                                                        group;
                                                                                                    }

                                                                                                    function creat169Group(
                                                                                                        id,
                                                                                                        name,
                                                                                                        image) {
                                                                                                        var
                                                                                                            group =
                                                                                                            idfinder
                                                                                                            .findFirst(
                                                                                                                id
                                                                                                            );
                                                                                                        if (group ==
                                                                                                            null
                                                                                                        ) {
                                                                                                            group
                                                                                                                =
                                                                                                                creatGroup(
                                                                                                                    id,
                                                                                                                    name,
                                                                                                                    image
                                                                                                                );
                                                                                                            group
                                                                                                                .setExpanded(
                                                                                                                    false
                                                                                                                );
                                                                                                        }
                                                                                                        return group;
                                                                                                    }

                                                                                                    function setDeviceDetail2Node(
                                                                                                        node,
                                                                                                        devinfo
                                                                                                    ) {
                                                                                                        node.setClient(
                                                                                                            "devname",
                                                                                                            devinfo
                                                                                                            .symbol_name
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "vendorname",
                                                                                                            devinfo
                                                                                                            .vendor_name
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "devip",
                                                                                                            devinfo
                                                                                                            .dev_ip
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "devipmask",
                                                                                                            devinfo
                                                                                                            .dev_ip_mask
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "typename",
                                                                                                            devinfo
                                                                                                            .type_name
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "net",
                                                                                                            netMap[
                                                                                                                devinfo
                                                                                                                .dev_net
                                                                                                            ]
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "type",
                                                                                                            typeMap[
                                                                                                                devinfo
                                                                                                                .dev_type
                                                                                                            ]
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "role",
                                                                                                            roleMap[
                                                                                                                devinfo
                                                                                                                .dev_role
                                                                                                            ]
                                                                                                        );
                                                                                                        node.setClient(
                                                                                                            "city",
                                                                                                            devinfo
                                                                                                            .city
                                                                                                        );
                                                                                                    } //创建链路 function
                                                                                                    creatLink(
                                                                                                        link_id,
                                                                                                        from,
                                                                                                        to,
                                                                                                        linkinfo
                                                                                                    ) {
                                                                                                        var link =
                                                                                                            new
                                                                                                        twaver
                                                                                                            .Link(
                                                                                                                link_id
                                                                                                            );
                                                                                                        link.setFromNode(
                                                                                                            from
                                                                                                        );
                                                                                                        link.setToNode(
                                                                                                            to
                                                                                                        );
                                                                                                        if (linkinfo !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            autoLinkStyle
                                                                                                                (link,
                                                                                                                    linkinfo
                                                                                                                    .ifspeed
                                                                                                                );
                                                                                                        } else {
                                                                                                            link.setStyle(
                                                                                                                'link.width',
                                                                                                                5
                                                                                                            );
                                                                                                            link.setStyle(
                                                                                                                'link.bundle.expanded',
                                                                                                                false
                                                                                                            ); //设定绑定状态
                                                                                                            false为合并
                                                                                                            link.setStyle(
                                                                                                                'link.color',
                                                                                                                '#4DA492'
                                                                                                            );
                                                                                                        };
                                                                                                        var linkToolTip =
                                                                                                            "";
                                                                                                        if (from !=
                                                                                                            null &&
                                                                                                            to !=
                                                                                                            null &&
                                                                                                            linkinfo !=
                                                                                                            null
                                                                                                        ) {
                                                                                                            linkToolTip
                                                                                                                =
                                                                                                                from
                                                                                                                .getToolTip() +
                                                                                                                "=" +
                                                                                                                to
                                                                                                                .getToolTip();
                                                                                                            link.setClient(
                                                                                                                " a_dev_name",
                                                                                                                linkinfo
                                                                                                                .a_dev_name
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "a_if",
                                                                                                                linkinfo
                                                                                                                .a_if
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "z_dev_name",
                                                                                                                linkinfo
                                                                                                                .z_dev_name
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "z_if",
                                                                                                                linkinfo
                                                                                                                .z_if
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "type_name",
                                                                                                                linkinfo
                                                                                                                .type_name
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "ifspeed",
                                                                                                                linkinfo
                                                                                                                .ifspeed
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "send_rate",
                                                                                                                linkinfo
                                                                                                                .send_rate
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "rec_rate",
                                                                                                                linkinfo
                                                                                                                .rec_rate
                                                                                                            );
                                                                                                            link.setClient(
                                                                                                                "ip_ver",
                                                                                                                linkinfo
                                                                                                                .ip_ver
                                                                                                            );
                                                                                                        }
                                                                                                        link.setToolTip(
                                                                                                            linkToolTip
                                                                                                        );
                                                                                                        box.add(
                                                                                                            link
                                                                                                        );
                                                                                                        return
                                                                                                        link;
                                                                                                    } //link颜色
                                                                                                    function autoLinkStyle(
                                                                                                        link,
                                                                                                        ifspeed
                                                                                                    ) {
                                                                                                        link.setStyle(
                                                                                                            'link.bundle.expanded',
                                                                                                            false
                                                                                                        ); //设定绑定状态
                                                                                                        false为合并
                                                                                                        var l_w =
                                                                                                            0.5;
                                                                                                        var col =
                                                                                                            '#14a8e2'; //
                                                                                                        var
                                                                                                            spe =
                                                                                                            ifspeed /
                                                                                                            1000 /
                                                                                                            1000; //端口带宽MB
                                                                                                        if (spe <
                                                                                                            1000
                                                                                                        ) { //小于1G
                                                                                                            l_w =
                                                                                                                0.6
                                                                                                        } else
                                                                                                        if (spe <
                                                                                                            2500
                                                                                                        ) { //大于等于1G小于2.5G
                                                                                                            l_w =
                                                                                                                0.7 col =
                                                                                                                '#14a8e2'; //紫色col='#6600CC';
                                                                                                        } else
                                                                                                        if (spe <
                                                                                                            10000
                                                                                                        ) { //大于等于2.5G小于10GE
                                                                                                            l_w =
                                                                                                                1 col =
                                                                                                                '#37baed'; //绿色col='#336699' }else
                                                                                                            if (spe <
                                                                                                                40000
                                                                                                            ) { //大于等于10G小于40GE
                                                                                                                l_w =
                                                                                                                    1.5 col =
                                                                                                                    '#56c5f1'; //绿色col='#66FF66' }else
                                                                                                                if (spe <
                                                                                                                    100000
                                                                                                                ) { //大于等于40G小于100GE
                                                                                                                    l_w =
                                                                                                                        2 col =
                                                                                                                        '#70d5fd'; //col='#0099CC';
                                                                                                                } else { //大于等于100GE l_w=3;
                                                                                                                    col =
                                                                                                                        '#90dffe'; //深蓝col='#006699'; }
                                                                                                                    link.setStyle(
                                                                                                                        'link.width',
                                                                                                                        l_w
                                                                                                                    );
                                                                                                                    link.setStyle(
                                                                                                                        'link.color',
                                                                                                                        col
                                                                                                                    );
                                                                                                                    link.setStyle(
                                                                                                                        'link.handler.color',
                                                                                                                        '#ffffff'
                                                                                                                    );
                                                                                                                } //初始化代理,代理链路需要显示总带宽
                                                                                                                function
                                                                                                                initAgentLink(
                                                                                                                    linklist
                                                                                                                ) {
                                                                                                                    for (
                                                                                                                        var link of
                                                                                                                            linklist
                                                                                                                    ) { //
                                                                                                                        遍历linklist
                                                                                                                        if (link
                                                                                                                            .isBundleAgent()
                                                                                                                        ) {
                                                                                                                            var sum =
                                                                                                                                0;
                                                                                                                            var
                                                                                                                                linkGouplist =
                                                                                                                                link
                                                                                                                                .getBundleLinks()
                                                                                                                                .getLinks();
                                                                                                                            linkGouplist
                                                                                                                                .forEach(
                                                                                                                                    function (
                                                                                                                                        value
                                                                                                                                    ) {
                                                                                                                                        var
                                                                                                                                            ifspeed =
                                                                                                                                            value
                                                                                                                                            .getClient(
                                                                                                                                                "ifspeed"
                                                                                                                                            );
                                                                                                                                        sum +=
                                                                                                                                            ifspeed;
                                                                                                                                    }
                                                                                                                                )
                                                                                                                            link.setClient(
                                                                                                                                "sumbandwidth",
                                                                                                                                sum /
                                                                                                                                1000 /
                                                                                                                                1000 /
                                                                                                                                1000
                                                                                                                            );
                                                                                                                        }
                                                                                                                    }
                                                                                                                }

                                                                                                                function
                                                                                                                addButton(
                                                                                                                    div,
                                                                                                                    name,
                                                                                                                    src,
                                                                                                                    callbackfun
                                                                                                                ) {
                                                                                                                    var
                                                                                                                        button =
                                                                                                                        document
                                                                                                                        .createElement(
                                                                                                                            'input'
                                                                                                                        );
                                                                                                                    button
                                                                                                                        .setAttribute(
                                                                                                                            'type',
                                                                                                                            src ?
                                                                                                                            'image' :
                                                                                                                            'button'
                                                                                                                        );
                                                                                                                    button
                                                                                                                        .setAttribute(
                                                                                                                            'title',
                                                                                                                            name
                                                                                                                        );
                                                                                                                    if ("放大" ==
                                                                                                                        name ||
                                                                                                                        "缩小" ==
                                                                                                                        name
                                                                                                                    )
                                                                                                                        button
                                                                                                                        .setAttribute(
                                                                                                                            'title',
                                                                                                                            "转动鼠标滚轮可快捷操作放大或缩小视图"
                                                                                                                        );
                                                                                                                    button
                                                                                                                        .style
                                                                                                                        .verticalAlign =
                                                                                                                        'top';
                                                                                                                    if (
                                                                                                                        src
                                                                                                                    ) {
                                                                                                                        button
                                                                                                                            .style
                                                                                                                            .padding =
                                                                                                                            '4px 4px 4px 4px';
                                                                                                                        if (src
                                                                                                                            .indexOf(
                                                                                                                                '/'
                                                                                                                            ) <
                                                                                                                            0
                                                                                                                        ) {
                                                                                                                            src =
                                                                                                                                '../resource/img/rsing/toolbar/' +
                                                                                                                                src +
                                                                                                                                '.png';
                                                                                                                        }
                                                                                                                        button
                                                                                                                            .setAttribute(
                                                                                                                                'src',
                                                                                                                                src
                                                                                                                            );
                                                                                                                    } else {
                                                                                                                        button
                                                                                                                            .setAttribute(
                                                                                                                                "class",
                                                                                                                                "btn
                                                                                                                                btn -
                                                                                                                                info btn -
                                                                                                                                sm ");
                                                                                                                                button
                                                                                                                                .setAttribute(
                                                                                                                                    "style",
                                                                                                                                    "padding:5px
                                                                                                                                    5 px 5 px 5 px; margin:
                                                                                                                                    1 px 5 px 1 px 0 px; background -
                                                                                                                                    color: #1c68ac;");//































                                                                                        button.value= name;
                                                                                                                                }
                                                                                                                                button
                                                                                                                                .addEventListener(
                                                                                                                                    'click',
                                                                                                                                    callbackfun,
                                                                                                                                    false
                                                                                                                                ); div
                                                                                                                                .appendChild(
                                                                                                                                    button
                                                                                                                                );
                                                                                                                                return button;
                                                                                                                            }

                                                                                                                        function
                                                                                                                        addButton2(
                                                                                                                            div,
                                                                                                                            title,
                                                                                                                            name,
                                                                                                                            callbackfun
                                                                                                                        ) {
                                                                                                                            var
                                                                                                                                button =
                                                                                                                                document
                                                                                                                                .createElement(
                                                                                                                                    'button'
                                                                                                                                );
                                                                                                                            button
                                                                                                                                .setAttribute(
                                                                                                                                    'title',
                                                                                                                                    title
                                                                                                                                );
                                                                                                                            button
                                                                                                                                .style
                                                                                                                                .verticalAlign =
                                                                                                                                'top';
                                                                                                                            button
                                                                                                                                .setAttribute(
                                                                                                                                    "class",
                                                                                                                                    "btn
                                                                                                                                    btn -
                                                                                                                                    info btn -
                                                                                                                                    sm ");
                                                                                                                                    button
                                                                                                                                    .setAttribute(
                                                                                                                                        "style",
                                                                                                                                        "padding:5px
                                                                                                                                        5 px 5 px 5 px; margin:
                                                                                                                                        1 px 5 px 1 px 0 px; background -
                                                                                                                                        color:
                                                                                                                                        #1c68ac;");//































                                                                                        button.value= name; button.addEventListener('click',
                                                                                                                                            callbackfun,
                                                                                                                                            false
                                                                                                                                        ); //
                                                                                                                                        button
                                                                                                                                        .setAttribute(
                                                                                                                                            'onclick',
                                                                                                                                            callbackfun
                                                                                                                                        ); div
                                                                                                                                        .appendChild(
                                                                                                                                            button
                                                                                                                                        );
                                                                                                                                        return button;
                                                                                                                                    }

                                                                                                                                    function addSelect(
                                                                                                                                        div,
                                                                                                                                        chr_divid
                                                                                                                                    ) {
                                                                                                                                        var
                                                                                                                                            select_div =
                                                                                                                                            document
                                                                                                                                            .getElementById(
                                                                                                                                                chr_divid
                                                                                                                                            );
                                                                                                                                        div.appendChild(
                                                                                                                                            select_div
                                                                                                                                        );
                                                                                                                                    }

                                                                                                                                    function getImageFormDev(
                                                                                                                                        net,
                                                                                                                                        type,
                                                                                                                                        role
                                                                                                                                    ) {
                                                                                                                                        if (net ==
                                                                                                                                            1
                                                                                                                                        ) {
                                                                                                                                            return
                                                                                                                                            imgtypeMap
                                                                                                                                                [
                                                                                                                                                    type
                                                                                                                                                ];
                                                                                                                                        } else
                                                                                                                                        if (net ==
                                                                                                                                            2
                                                                                                                                        ) {
                                                                                                                                            return "SR";
                                                                                                                                        } else if (
                                                                                                                                            net ==
                                                                                                                                            3
                                                                                                                                        ) {
                                                                                                                                            return "SR";
                                                                                                                                        } else {
                                                                                                                                            return "169ggw";
                                                                                                                                        }
                                                                                                                                    }

                                                                                                                                    function getGroupImageFormDev(
                                                                                                                                        net,
                                                                                                                                        type,
                                                                                                                                        role
                                                                                                                                    ) {
                                                                                                                                        if (net ==
                                                                                                                                            1
                                                                                                                                        ) {
                                                                                                                                            if (type ==
                                                                                                                                                1 &&
                                                                                                                                                role ==
                                                                                                                                                3
                                                                                                                                            ) {
                                                                                                                                                return "sw";
                                                                                                                                            }
                                                                                                                                            return
                                                                                                                                            imgtypeMap
                                                                                                                                                [
                                                                                                                                                    type
                                                                                                                                                ] +
                                                                                                                                                "-group";
                                                                                                                                        } else if (
                                                                                                                                            net ==
                                                                                                                                            2
                                                                                                                                        ) {
                                                                                                                                            return "idccloud-gray";
                                                                                                                                        } else if (
                                                                                                                                            net ==
                                                                                                                                            3
                                                                                                                                        ) {
                                                                                                                                            return "cdncloud-gray";
                                                                                                                                        } else if (
                                                                                                                                            net ==
                                                                                                                                            4
                                                                                                                                        ) {
                                                                                                                                            return "169ggw";
                                                                                                                                        } else {
                                                                                                                                            return "mobcloud-gray";
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    var ipv4v6Map = {
                                                                                                                                        "-1": "未知",
                                                                                                                                        "0": "未知",
                                                                                                                                        "4": "IPv4",
                                                                                                                                        "6": "IPv6",
                                                                                                                                        "10": "双栈"
                                                                                                                                    }
                                                                                                                                    var netMap = {
                                                                                                                                        "1": "IP城域网",
                                                                                                                                        "2": "IDC网络",
                                                                                                                                        "3": "CDN网络",
                                                                                                                                        "4": "China169骨干网",
                                                                                                                                        "5": "国际网络",
                                                                                                                                        "6": "移动网",
                                                                                                                                        "-1": "未知"
                                                                                                                                    }
                                                                                                                                    var
                                                                                                                                        typeMap = { //TODO
                                                                                                                                            需要改为去数据库读取 "1": "CR",
                                                                                                                                            "2": "BRAS",
                                                                                                                                            "3": "SR",
                                                                                                                                            "4": "独立NAT44",
                                                                                                                                            "5": "出口路由器",
                                                                                                                                            "6": "出口交换机",
                                                                                                                                            "7": "汇聚路由器",
                                                                                                                                            "8": "汇聚交换机",
                                                                                                                                            "9": "接入交换机",
                                                                                                                                            "10": "省中心",
                                                                                                                                            "11": "地市中心",
                                                                                                                                            "12": "边缘节点",
                                                                                                                                            "13": "GI",
                                                                                                                                            "14": "默认",
                                                                                                                                            "15": "核心交换机",
                                                                                                                                            "16": "169A",
                                                                                                                                            "17": "169C",
                                                                                                                                            "18": "169I",
                                                                                                                                            "19": "169IX",
                                                                                                                                            "20": "169NAP",
                                                                                                                                            "21": "169RR",
                                                                                                                                            "22": "169S",
                                                                                                                                            "23": "169T",
                                                                                                                                            "24": "169NMS",
                                                                                                                                            "25": "169SDN",
                                                                                                                                            "-1": "未知"
                                                                                                                                        }
                                                                                                                                    var roleMap = {
                                                                                                                                        "1": "核心路由器",
                                                                                                                                        "2": "汇聚路由器",
                                                                                                                                        "3": "省网路由器",
                                                                                                                                        "4": "宽带",
                                                                                                                                        "5": "宽带+专线",
                                                                                                                                        "6": "宽带+IPTV",
                                                                                                                                        "7": "宽带+专线+IPTV",
                                                                                                                                        "8": "专线",
                                                                                                                                        "9": "IPTV",
                                                                                                                                        "10": "专线+IPTV",
                                                                                                                                        "11": "RR",
                                                                                                                                        "12": "ASBR",
                                                                                                                                        "13": "RR+ASBR",
                                                                                                                                        "14": "蜜罐",
                                                                                                                                        "-1": "未知"
                                                                                                                                    }
                                                                                                                                    var
                                                                                                                                        imgtypeMap = {
                                                                                                                                            "1": "SR",
                                                                                                                                            "2": "SR",
                                                                                                                                            "3": "SR",
                                                                                                                                            "4": "SR",
                                                                                                                                            "13": "SR"
                                                                                                                                        } //画云用的 var
                                                                                                                                    imgnetMap = {
                                                                                                                                        "2": "idccloud-gray",
                                                                                                                                        "3": "cdncloud-gray",
                                                                                                                                        "6": "mobcloud-gray"
                                                                                                                                    } //加载获取图片 svg为network
                                                                                                                                    function registerImage(
                                                                                                                                        url,
                                                                                                                                        svg
                                                                                                                                    ) {
                                                                                                                                        var image =
                                                                                                                                            new Image();
                                                                                                                                        image
                                                                                                                                            .src =
                                                                                                                                            url;
                                                                                                                                        var
                                                                                                                                            views =
                                                                                                                                            arguments;
                                                                                                                                        image
                                                                                                                                            .onload =
                                                                                                                                            function () {
                                                                                                                                                twaver
                                                                                                                                                    .Util
                                                                                                                                                    .registerImage(
                                                                                                                                                        getImageName(
                                                                                                                                                            url
                                                                                                                                                        ),
                                                                                                                                                        image,
                                                                                                                                                        image
                                                                                                                                                        .width,
                                                                                                                                                        image
                                                                                                                                                        .height,
                                                                                                                                                        svg ===
                                                                                                                                                        true
                                                                                                                                                    );
                                                                                                                                                image
                                                                                                                                                    .onload =
                                                                                                                                                    null;
                                                                                                                                                for (
                                                                                                                                                    var i =
                                                                                                                                                        1; i <
                                                                                                                                                    views
                                                                                                                                                    .length; i++
                                                                                                                                                ) {
                                                                                                                                                    var
                                                                                                                                                        view =
                                                                                                                                                        views[
                                                                                                                                                            i
                                                                                                                                                        ];
                                                                                                                                                    if (view
                                                                                                                                                        .invalidateElementUIs
                                                                                                                                                    ) {
                                                                                                                                                        view
                                                                                                                                                            .invalidateElementUIs();
                                                                                                                                                    }
                                                                                                                                                    if (view
                                                                                                                                                        .invalidateDisplay
                                                                                                                                                    ) {
                                                                                                                                                        view
                                                                                                                                                            .invalidateDisplay();
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            };
                                                                                                                                    }

                                                                                                                                    function getImageName(
                                                                                                                                        url
                                                                                                                                    ) {
                                                                                                                                        var
                                                                                                                                            index =
                                                                                                                                            url
                                                                                                                                            .lastIndexOf(
                                                                                                                                                '/'
                                                                                                                                            );
                                                                                                                                        var name =
                                                                                                                                            url;
                                                                                                                                        if (index > =
                                                                                                                                            0
                                                                                                                                        ) {
                                                                                                                                            name =
                                                                                                                                                url
                                                                                                                                                .substring(
                                                                                                                                                    index +
                                                                                                                                                    1
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                        index
                                                                                                                                            =
                                                                                                                                            name
                                                                                                                                            .lastIndexOf(
                                                                                                                                                '.'
                                                                                                                                            );
                                                                                                                                        if (index >=
                                                                                                                                            0
                                                                                                                                        ) {
                                                                                                                                            name =
                                                                                                                                                name
                                                                                                                                                .substring(
                                                                                                                                                    0,
                                                                                                                                                    index
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                        return name;
                                                                                                                                    }

                                                                                                                                    //--------设备详情-----------
                                                                                                                                    function initDialog(
                                                                                                                                        node
                                                                                                                                    ) {
                                                                                                                                        var div =
                                                                                                                                            document
                                                                                                                                            .getElementById(
                                                                                                                                                "devdiv"
                                                                                                                                            );
                                                                                                                                        if (div ==
                                                                                                                                            null
                                                                                                                                        ) {
                                                                                                                                            div =
                                                                                                                                                document
                                                                                                                                                .createElement(
                                                                                                                                                    'div'
                                                                                                                                                );
                                                                                                                                            div.setAttribute(
                                                                                                                                                "id",
                                                                                                                                                "devdiv"
                                                                                                                                            );
                                                                                                                                            //
                                                                                                                                            div.setAttribute(
                                                                                                                                                "style",
                                                                                                                                                "height:230px;width:243px;padding-top:15px;
                                                                                                                                                opacity:
                                                                                                                                                0.9;
                                                                                                                                                " +
                                                                                                                                                //
                                                                                                                                                "background:url(../resource/img/rsing/topoimages/dev_background.png)"
                                                                                                                                            );
                                                                                                                                            div.style
                                                                                                                                                .display =
                                                                                                                                                'none';
                                                                                                                                            div.style
                                                                                                                                                .zIndex =
                                                                                                                                                100;
                                                                                                                                            demo.Util
                                                                                                                                                .appendChild(
                                                                                                                                                    div,
                                                                                                                                                    rightPane
                                                                                                                                                    .getView(),
                                                                                                                                                    0,
                                                                                                                                                    0,
                                                                                                                                                    null,
                                                                                                                                                    null
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                        var
                                                                                                                                            devname =
                                                                                                                                            node
                                                                                                                                            .getClient(
                                                                                                                                                "devname"
                                                                                                                                            );
                                                                                                                                        //table-bordered
                                                                                                                                        background
                                                                                                                                            -
                                                                                                                                            color: #
                                                                                                                                            FFFFCC
                                                                                                                                        div.innerHTML =
                                                                                                                                            "<table
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'dialog table table2 table-hover' >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            设备名称： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+
                                                                                                                                        "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                                                        devname
                                                                                                                                            +
                                                                                                                                            "\
                                                                                                                                        "
                                                                                                                                        target
                                                                                                                                            = \
                                                                                                                                            "_blank\">" +
                                                                                                                                            devname +
                                                                                                                                            "</a> < /
                                                                                                                                        td >
                                                                                                                                            <
                                                                                                                                            /tr>"+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            设备厂家： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        vendorname
                                                                                                                                            ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            设备型号： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        typename
                                                                                                                                            ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            IP地址： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        devip
                                                                                                                                            ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            掩码： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        devipmask
                                                                                                                                            ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            网络类型： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        net ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            设备类型： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        type ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            设备角色： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        role ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td11' >
                                                                                                                                            省份 /
                                                                                                                                            城市： <
                                                                                                                                            /td> <
                                                                                                                                        td class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+node.getClient("
                                                                                                                                        city ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "</table>";

                                                                                                                                        return div;
                                                                                                                                    }

                                                                                                                                    //绘制接口详情
                                                                                                                                    function ifDialog(
                                                                                                                                        tmp_link
                                                                                                                                    ) {
                                                                                                                                        var div =
                                                                                                                                            document
                                                                                                                                            .getElementById(
                                                                                                                                                "ifinfo"
                                                                                                                                            );
                                                                                                                                        if (div ==
                                                                                                                                            null
                                                                                                                                        ) {
                                                                                                                                            div =
                                                                                                                                                document
                                                                                                                                                .createElement(
                                                                                                                                                    'div'
                                                                                                                                                );
                                                                                                                                            div.setAttribute(
                                                                                                                                                "id",
                                                                                                                                                "ifinfo"
                                                                                                                                            );
                                                                                                                                            //
                                                                                                                                            div.setAttribute(
                                                                                                                                                "style",
                                                                                                                                                "height:183px;width:290px;padding-top:15px;
                                                                                                                                                opacity:
                                                                                                                                                0.9;
                                                                                                                                                " +
                                                                                                                                                //
                                                                                                                                                "background:url(../resource/img/rsing/topoimages/link_background.png)"
                                                                                                                                            );
                                                                                                                                            div.style
                                                                                                                                                .display =
                                                                                                                                                'none';
                                                                                                                                            div.style
                                                                                                                                                .zIndex =
                                                                                                                                                100;
                                                                                                                                            demo.Util
                                                                                                                                                .appendChild(
                                                                                                                                                    div,
                                                                                                                                                    rightPane
                                                                                                                                                    .getView(),
                                                                                                                                                    0,
                                                                                                                                                    0,
                                                                                                                                                    null,
                                                                                                                                                    null
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                        var
                                                                                                                                            a_name =
                                                                                                                                            tmp_link
                                                                                                                                            .getClient(
                                                                                                                                                "a_dev_name"
                                                                                                                                            );
                                                                                                                                        var
                                                                                                                                            a_if =
                                                                                                                                            tmp_link
                                                                                                                                            .getClient(
                                                                                                                                                "a_if"
                                                                                                                                            );
                                                                                                                                        var
                                                                                                                                            z_name =
                                                                                                                                            tmp_link
                                                                                                                                            .getClient(
                                                                                                                                                "z_dev_name"
                                                                                                                                            );
                                                                                                                                        var
                                                                                                                                            z_if =
                                                                                                                                            tmp_link
                                                                                                                                            .getClient(
                                                                                                                                                "z_if"
                                                                                                                                            );
                                                                                                                                        div.innerHTML =
                                                                                                                                            "<table
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'dialogif table table2 table-hover' >
                                                                                                                                            "+
                                                                                                                                        "<tbody>" +
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif tdiftop' >
                                                                                                                                            A端设备： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            " +
                                                                                                                                        "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                                                        a_name
                                                                                                                                            +
                                                                                                                                            "\
                                                                                                                                        "
                                                                                                                                        target
                                                                                                                                            = \
                                                                                                                                            "_blank\">" +
                                                                                                                                            a_name +
                                                                                                                                            "</a> < /
                                                                                                                                        td >
                                                                                                                                            <
                                                                                                                                            /tr>"+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            A端接口： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+
                                                                                                                                        "<a href=\"instanceInfo_dev.html?dev_name=" +
                                                                                                                                        a_name
                                                                                                                                            +
                                                                                                                                            " &
                                                                                                                                        inf_name
                                                                                                                                            =
                                                                                                                                            "+a_if+"\
                                                                                                                                        "
                                                                                                                                        target
                                                                                                                                            = \
                                                                                                                                            "_blank\">" +
                                                                                                                                            a_if +
                                                                                                                                            "</a> < /
                                                                                                                                        td >
                                                                                                                                            <
                                                                                                                                            /tr>"+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            Z端设备： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+
                                                                                                                                        "<a href=\"deviceInfo.html?dev_name=" +
                                                                                                                                        z_name
                                                                                                                                            +
                                                                                                                                            "\
                                                                                                                                        "
                                                                                                                                        target
                                                                                                                                            = \
                                                                                                                                            "_blank\">" +
                                                                                                                                            z_name +
                                                                                                                                            "</a> < /
                                                                                                                                        td >
                                                                                                                                            <
                                                                                                                                            /tr>"+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            Z端接口： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+
                                                                                                                                        "<a href=\"instanceInfo_dev.html?dev_name=" +
                                                                                                                                        z_name
                                                                                                                                            +
                                                                                                                                            " &
                                                                                                                                        inf_name
                                                                                                                                            =
                                                                                                                                            "+z_if+"\
                                                                                                                                        "
                                                                                                                                        target
                                                                                                                                            = \
                                                                                                                                            "_blank\">" +
                                                                                                                                            z_if +
                                                                                                                                            "</a> < /
                                                                                                                                        td >
                                                                                                                                            <
                                                                                                                                            /tr>"+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            接口带宽： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+tmp_link.getClient("
                                                                                                                                        type_name
                                                                                                                                            ")+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            链路类型： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+ipv4v6Map[tmp_link.getClient("
                                                                                                                                        ip_ver
                                                                                                                                            ")]+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            利用率峰值A -
                                                                                                                                            Z： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+tmp_link.getClient("
                                                                                                                                        send_rate
                                                                                                                                            ")+" %
                                                                                                                                            "+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "<tr> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'tdif' >
                                                                                                                                            利用率峰值Z -
                                                                                                                                            A： <
                                                                                                                                            /td> <
                                                                                                                                        td
                                                                                                                                        class
                                                                                                                                            =
                                                                                                                                            'td2' >
                                                                                                                                            "+tmp_link.getClient("
                                                                                                                                        rec_rate
                                                                                                                                            ")+" %
                                                                                                                                            "+" <
                                                                                                                                            /td> < /
                                                                                                                                        tr >
                                                                                                                                            "+
                                                                                                                                        "</tbody>" +
                                                                                                                                        " < /
                                                                                                                                        table
                                                                                                                                            >
                                                                                                                                            ";
                                                                                                                                        return div;
                                                                                                                                    }

                                                                                                                                    //绘制接口详情
                                                                                                                                    function ifbundleDialog(
                                                                                                                                        result,
                                                                                                                                        tmpMap
                                                                                                                                    ) {
                                                                                                                                        var div =
                                                                                                                                            document
                                                                                                                                            .getElementById(
                                                                                                                                                "ifbundle"
                                                                                                                                            );
                                                                                                                                        if (div ==
                                                                                                                                            null
                                                                                                                                        ) {
                                                                                                                                            div =
                                                                                                                                                document
                                                                                                                                                .createElement(
                                                                                                                                                    'div'
                                                                                                                                                );
                                                                                                                                            div.setAttribute(
                                                                                                                                                "id",
                                                                                                                                                "ifbundle"
                                                                                                                                            );
                                                                                                                                            div.style
                                                                                                                                                .display =
                                                                                                                                                'none';
                                                                                                                                            div.style
                                                                                                                                                .zIndex =
                                                                                                                                                100;
                                                                                                                                            demo.Util
                                                                                                                                                .appendChild(
                                                                                                                                                    div,
                                                                                                                                                    rightPane
                                                                                                                                                    .getView(),
                                                                                                                                                    0,
                                                                                                                                                    0,
                                                                                                                                                    null,
                                                                                                                                                    null
                                                                                                                                                );
                                                                                                                                        }
                                                                                                                                        var tmphtml =
                                                                                                                                            "";
                                                                                                                                        var linksum =
                                                                                                                                            0;
                                                                                                                                        for (
                                                                                                                                            var key in
                                                                                                                                                tmpMap
                                                                                                                                        ) {
                                                                                                                                            tmphtml
                                                                                                                                                +=
                                                                                                                                                " <
                                                                                                                                            tr >
                                                                                                                                                <
                                                                                                                                                td class =
                                                                                                                                                'tdbundle' >
                                                                                                                                                "+key+"
                                                                                                                                            链路： <
                                                                                                                                                /td> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'td2' >
                                                                                                                                                "+tmpMap[key]+" <
                                                                                                                                                /td> < /
                                                                                                                                            tr >
                                                                                                                                                ";
                                                                                                                                            linksum
                                                                                                                                                +=
                                                                                                                                                tmpMap[
                                                                                                                                                    key
                                                                                                                                                ];
                                                                                                                                        }

                                                                                                                                        if (tmpMap[
                                                                                                                                                "undefined_undefined"
                                                                                                                                            ] >
                                                                                                                                            1
                                                                                                                                        ) {
                                                                                                                                            div.innerHTML =
                                                                                                                                                "<table class='dialogif table table2 table-hover'>
                                                                                                                                            "+
                                                                                                                                            "<tbody>" +
                                                                                                                                            "<tr> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'td2' >
                                                                                                                                                双击展开链路两端逻辑视图后展示详细信息 <
                                                                                                                                                /td> <
                                                                                                                                            td >
                                                                                                                                                <
                                                                                                                                                /td> < /
                                                                                                                                            tr >
                                                                                                                                                "+ " <
                                                                                                                                                /tbody >
                                                                                                                                            "+" <
                                                                                                                                            /table>";
                                                                                                                                        } else {
                                                                                                                                            div.innerHTML =
                                                                                                                                                "<table
                                                                                                                                            class
                                                                                                                                                =
                                                                                                                                                'dialogif_b table table2 table-hover' >
                                                                                                                                                "+
                                                                                                                                            "<tr> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'tdbundle' >
                                                                                                                                                链路总数： <
                                                                                                                                                /td> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'td2' >
                                                                                                                                                "+linksum+" <
                                                                                                                                                /td> < /
                                                                                                                                            tr >
                                                                                                                                                "+
                                                                                                                                            "<tr> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'tdbundle' >
                                                                                                                                                链路总带宽： <
                                                                                                                                                /td> <
                                                                                                                                            td class
                                                                                                                                                =
                                                                                                                                                'td2' >
                                                                                                                                                "+result+" <
                                                                                                                                                /td> < /
                                                                                                                                            tr >
                                                                                                                                                "+
                                                                                                                                            tmphtml
                                                                                                                                                +
                                                                                                                                                "</table>";
                                                                                                                                        }
                                                                                                                                        return div;
                                                                                                                                    }

                                                                                                                                    function initPane(
                                                                                                                                        splitPane
                                                                                                                                    ) {
                                                                                                                                        splitPane
                                                                                                                                            .setDividerBackground(
                                                                                                                                                "#ffffff"
                                                                                                                                            ) //劈分条的背景色#0d4981
                                                                                                                                        splitPane
                                                                                                                                            .setDividerOpacity(
                                                                                                                                                0.7
                                                                                                                                            ) //设置劈分条的透明度
                                                                                                                                        splitPane
                                                                                                                                            .setDividerWidth(
                                                                                                                                                0.05
                                                                                                                                            ) //劈分条的宽度
                                                                                                                                    }

                                                                                                                                    //-------------------------保存位置信息---------------------------
                                                                                                                                    function savelocation() {
                                                                                                                                        if (confirm(
                                                                                                                                                "确认保存拓扑图现在位置？"
                                                                                                                                            )) {
                                                                                                                                            var
                                                                                                                                                location = [];
                                                                                                                                            box.forEach(
                                                                                                                                                function (
                                                                                                                                                    node
                                                                                                                                                ) {
                                                                                                                                                    if (node
                                                                                                                                                        .getClassName() ==
                                                                                                                                                        'twaver.Node' ||
                                                                                                                                                        node
                                                                                                                                                        .getClassName() ==
                                                                                                                                                        'twaver.SubNetwork' ||
                                                                                                                                                        node
                                                                                                                                                        .getClassName() ==
                                                                                                                                                        'twaver.Group'
                                                                                                                                                    ) {
                                                                                                                                                        var loc =
                                                                                                                                                            node
                                                                                                                                                            .getLocation();
                                                                                                                                                        var temp =
                                                                                                                                                            node
                                                                                                                                                            .getId() +
                                                                                                                                                            ";" +
                                                                                                                                                            loc
                                                                                                                                                            .x +
                                                                                                                                                            ";" +
                                                                                                                                                            loc
                                                                                                                                                            .y;
                                                                                                                                                        location
                                                                                                                                                            .push(
                                                                                                                                                                encodeURIComponent(
                                                                                                                                                                    temp
                                                                                                                                                                )
                                                                                                                                                            );
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            );


                                                                                                                                            $.ajax({
                                                                                                                                                type: "post",
                                                                                                                                                async: false, //同步执
                                                                                                                                                traditional: true,
                                                                                                                                                data: {
                                                                                                                                                    "dataArr": location
                                                                                                                                                },
                                                                                                                                                //---------------------------------------------注意这里type=3-----
                                                                                                                                                url: "/rsing/topo/savelocation.do?1=1&rsing_id=" +
                                                                                                                                                    rsing_id +
                                                                                                                                                    "&type=3",
                                                                                                                                                success: function (
                                                                                                                                                    result,
                                                                                                                                                    status
                                                                                                                                                ) {
                                                                                                                                                    if ("success" ==
                                                                                                                                                        status
                                                                                                                                                    ) {
                                                                                                                                                        alert
                                                                                                                                                            (
                                                                                                                                                                "位置保存成功！"
                                                                                                                                                            );
                                                                                                                                                    } else {
                                                                                                                                                        alert
                                                                                                                                                            (
                                                                                                                                                                "位置保存失败！"
                                                                                                                                                            );
                                                                                                                                                    }
                                                                                                                                                    network
                                                                                                                                                        .addViewListener(
                                                                                                                                                            reload
                                                                                                                                                        );
                                                                                                                                                },
                                                                                                                                                error: function () {
                                                                                                                                                    alert
                                                                                                                                                        (
                                                                                                                                                            "保存位置失败！"
                                                                                                                                                        );

                                                                                                                                                }
                                                                                                                                            });
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    var reload =
                                                                                                                                        function (
                                                                                                                                            e
                                                                                                                                        ) {
                                                                                                                                            location
                                                                                                                                                .reload();
                                                                                                                                        }
                                                                                                                                    //网元加载完成后network.zoomOverview(true)不生效的解决方案
                                                                                                                                    var callback =
                                                                                                                                        function (e) {
                                                                                                                                            if (e
                                                                                                                                                .kind ===
                                                                                                                                                'validateEnd'
                                                                                                                                            ) {
                                                                                                                                                network
                                                                                                                                                    .removeViewListener(
                                                                                                                                                        callback
                                                                                                                                                    );
                                                                                                                                                network
                                                                                                                                                    .zoomOverview();
                                                                                                                                                overend
                                                                                                                                                    =
                                                                                                                                                    true; //画图完成标识
                                                                                                                                            } else {
                                                                                                                                                overend
                                                                                                                                                    =
                                                                                                                                                    false;
                                                                                                                                            }
                                                                                                                                        };
                                                                                                                                    //---------------------------------------------------------------------------------------------