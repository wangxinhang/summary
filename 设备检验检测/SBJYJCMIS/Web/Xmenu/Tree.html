<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title></title>
    <link href="../Styles/Page.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/ScrollBar.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />    
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwTree.js" type="text/javascript"></script>
        
    <style type="text/css">
        input::-ms-clear{display:none;} 
    </style>
</head>
<body style="background-color:#EEEEEE">
    <form action="">
        <div id="leftPanel"></div> 
    </form>  
    
    <script type="text/javascript">
        //#region 全局变量
        var xuserId,xmenuId,permission = null;//用户及权限：json格式 
        var bodyWidth = $(document.body).width();
        var bodyHeight = $(document.body).height(); 
        var ml = 20; mt = 20; //ml:margin-left;mt:margin-top;
        var btnWidth = 30; btnHeight = 30; btnImageWidth = 30; //btnWidth:按钮宽;btnHeight:按钮高;btnImageWidth:按钮图片宽
        var panelWidth = bodyWidth - ml * 2;//面板宽度       
        var panelMinWidth = 1030;//面板最小宽度        
        //#endregion 全局变量

        //#region 网页加载 

        //#region 初始加载
        $(document).ready(function () {    
            //获取用户Id和MenuId
            xuserId=GetXuserId();
            xmenuId=GetXmenuId();
                    
            //设置查询面板
            SetLeftPanel();
        });
        //#endregion 初始加载

        //#region 重设元素位置尺寸

        //#region 获取查询面板位置尺寸
        //获取查询面板高度
        function GetLeftPanelWidth() {
            var p = $("#leftPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerWidth(true);
        }

        function GetLeftPanelHeight() {
            var p = $("#leftPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerHeight(true);
        }

        //获取查询面板纵坐标
        function GetLeftPanelY() {
            var p = $("#leftPanel");
            return $(p).css("display") == "none" ? 0 : $(p).offset().top;
        }

        //获取查询面板横坐标
        function GetLeftPanelX() {
            var p = $("#leftPanel");
            return $(p).offset().left;
        }
        //#endregion 获取查询面板位置尺寸              

        //#endregion 重设元素尺寸
        
        //#endregion 网页加载

        //#region 用户权限
        //获取用户Id
        function GetXuserId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xuserId;

        }

        //获取菜单ID:xMenuId
        function GetXmenuId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xmenuId;
        }

        //获取导出打印权限
        function GetExportPrintPermission() {
            var xUserId = xuserId;
            var xMenuId = xmenuId;
            var url = "../Permission/XuserPermissionProcess.ashx";
            var paramJson = { xUserId: xUserId, xMenuId: xMenuId, MethodName: "GetXUserPermission" };
            $.ajax({ url: url, type: "post", data: paramJson, dataType: "json", async: false,
                success: function (jsData) {
                    if (!$.isEmptyObject(jsData)) {
                        permission = jsData;
                        ShowExportButton();
                        ShowSubtotalButton();
                    }
                }
            });
        }
        //#endregion 用户权限
        
        //#region 左面板
        //#region 设置左面板
        function SetLeftPanel() {
            var lp = $("#leftPanel");           
            var x = ml;
            var y = mt;
            var w = 200;
            var h = bodyHeight - y - mt;
            var lpCssJson = { "position": "absolute", "left": x, "top": y };
            $(lp).css(lpCssJson).outerWidth(w).outerHeight(h);
            
            //初始加载结果数据
            LoadTree();
        }
        //#endregion 设置左面板
                  
        //#region 创建Tree

        //#region 载入Tree 
        function LoadTree() {
            //获取父容器及其相关属性
            var lpw = GetLeftPanelWidth();
            var lph = GetLeftPanelHeight();
            var c = $("#leftPanel");
            var position = "relative";
            var x = 0;
            var y = 0;
            var w = lpw;
            var h = lph;

            //创建Tree并绑定数据
            CreateTree(c, position, x, y, w, h);
        }
        //#endregion 单击按钮事件

        //#region 创建SzdwTree并绑定数据
        var szdwTree = null;
        function CreateTree(namingContainer, position, x, y, width, height) {
            if (szdwTree == null || typeof (szdwTree) == "undefined") {
                //创建SzdwGridViewt实例
                szdwTree = new SzdwTree(position, x, y, width, height);
                szdwTree.namingContainer = namingContainer;
                szdwTree.fnInsert = InsertClick;
            }
            var parentId = 100000;
            var paramJson = { xuserId: xuserId}; //, parentId: parentId
            paramJson["MethodName"] = "AdministrativeDivisionGetList";
            szdwTree.requestUrl = "../AdministrativeDivision/AdministrativeDivisionProcess.ashx";
            szdwTree.paramJson = paramJson;
            szdwTree.defaultItemText = "北京市";
            szdwTree.value = "110000";
            szdwTree.panelCssJson["padding-right"] = "1px";
            szdwTree.DataBind();
        }

        //新增项函数
        function InsertClick(szdwCtrl) {
            alert(szdwCtrl.defaultItemText);
        }
            
       
        //#endregion 创建SzdwTree并绑定数据  

        //#endregion 创建Tree 

        //#endregion 左面板
    </script>
</body>
</html>