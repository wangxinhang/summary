<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="../Styles/Page.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwAjaxDataOperate.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwGridView.js" type="text/javascript"></script>
    <link href="../SzdwControls/SzdwGridView.css" rel="stylesheet" type="text/css" />
    <script src="../SzdwControls/SzdwPagination.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwButton.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwDropDownList.js" type="text/javascript"></script>
    <style type="text/css">
        input::-ms-clear
        {
            display: none;
        }
    </style>
</head>
<body style="background-color: #EEEEEE">
    <form onsubmit="return false;">
    <div id="queryPanel" class="queryPanelNew" style="border:0px;background-color:transparent;">
        <div id="filterPanel">
            <div id="row0" >
                <div id="cell00" class="cellDiv" >
                    <input id="txtName" type="text" class="textBox2" style="width:205px; height:28px;border-right:0px;"/>
                </div>
            </div>
        </div>
    </div>
    <div id="dataPanel">
    </div>
    </form>
    <script type="text/javascript">
        //#region 全局变量
        var xuserId, xmenuId, permission = null; //用户及权限：json格式 
        var bodyWidth = $(document.body).width();
        var bodyHeight = $(document.body).height();
        var ml = 10; mt = 10; //ml:margin-left;mt:margin-top;
        var btnWidth = 90; btnHeight = 30; btnImageWidth = 28; //btnWidth:按钮宽;btnHeight:按钮高;btnImageWidth:按钮图片宽
        var panelWidth = bodyWidth - ml * 2; //面板宽度       
        var panelMinWidth = 240; //面板最小宽度
        var rectificationDepartmentId;
        var flowOperationId;
        var name;
        var isExisted = 555555;
        var ssssssss=3333;
        //#endregion 全局变量
        //#region 网页加载 

        //#region 初始加载
        $(document).ready(function () {
            //获取用户Id和MenuId
            xuserId = parent.xuserId;

            rectificationDepartmentId = parent.rectificationDepartmentId;
            flowOperationId = parent.flowOperationId;
            //设置查询面板
            SetQueryPanel();

            //设置结果面板
            SetDataPanel();

            //窗口调整大小
            $(window).resize(function () {
                var body = document.body;
                bodyWidth = $(body).width();
                bodyHeight = $(body).height();
                panelWidth = bodyWidth - ml * 2;
                RepositionControls();
                ResizeControls();
            });
        });
        //#endregion 初始加载

        //#region 重设元素位置尺寸

        //#region 重设位置尺寸
        //重设网页元素位置
        function RepositionControls() {
            var qh = GetQueryPanelHeight();
            var qx = GetQueryPanelX();
            var qy = GetQueryPanelY();

            //设置结果集
            var dx = qx;
            var dy = qy + qh + mt;
            $("#dataPanel").css({ "left": dx, "top": dy });

            //重设弹窗位置
            var t = document.body;
            var pw = t.popupWindow;
            if (pw) {
                var bw = $(t).width();
                var w = pw.width;
                var x = bw - w - ml - 2;
                var y = dy + 2;
                pw.RePosition(x, y);
            }
        }

        //重设网页元素尺寸
        function ResizeControls() {
            var dh = bodyHeight;
            var pw = Math.max(panelWidth, panelMinWidth);
            var qx = GetQueryPanelX();
            var qy = GetQueryPanelY();
            var qw = GetQueryPanelWidth();
            var qh = GetQueryPanelHeight();

            var q = $("#queryPanel");
            if (q) {
                $(q).outerWidth(pw);
            }

            //结果集
            if (szdwGv) {
                var w = pw;
                var y = qy + qh + mt;
                var h = dh - y - mt;

                $("#dataPanel").outerWidth(w).outerHeight(h);
                szdwGv.Resize(w, h);
            }

            //重设弹窗尺寸
            var t = document.body;
            var pw = t.popupWindow;
            if (pw) {
                var w = pw.width;
                var h = $(dataPanel).height() - 4;
                pw.ReSize(w, h);
            }
        }
        //#endregion 重设位置尺寸

        //#region 获取查询面板位置尺寸
        //获取查询面板宽度
        function GetQueryPanelWidth() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerWidth(true);
        }

        //获取查询面板高度
        function GetQueryPanelHeight() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerHeight(true);
        }

        //获取查询面板纵坐标
        function GetQueryPanelY() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).offset().top;
        }

        //获取查询面板横坐标
        function GetQueryPanelX() {
            var p = $("#queryPanel");
            return $(p).offset().left;
        }
        //#endregion 获取查询面板位置尺寸              

        //#endregion 重设元素尺寸

        //#endregion 网页加载

        //#region 查询面板
        //#region 查询条件面板
        //#region 设置查询面板
        function SetQueryPanel() {
            var q = $("#queryPanel");
            var w = Math.max(panelWidth, panelMinWidth);
            $(q).outerWidth(w);

            //设置按钮面板
            CreateButton();
            
            //隐患名称回车筛选
            $("#txtName").keypress(function (e) {
                var k = e.which;
                if (k == 13) {
                    var btnPanel = szdwSearchButton.button;
                    $(btnPanel).trigger("click");
                }
            });
        }
        //#endregion 设置查询面板 

        //#endregion 查询条件面板

        //#region 查询按钮面板

        //#region 创建按钮
        function CreateButton() {
            //创建按钮
            CreateSearchButton();

           
        }
        //#endregion 设置按钮面板

        //查询按钮事件
        function GetQueryResult() {
            //设置结果面板相关属性
            var body = document.body;
            var c = $("#dataPanel");
            var position = "absolute";
            var x = 0;
            var y = 0;
            var w = $(c).width();
            var h = $(c).height();

            //创建Gridview并绑定数据
            CreateGridView(c, position, x, y, w, h);
        }
        //#endregion 查询按钮

        //#region 查询按钮
        var szdwSearchButton = null;
        function CreateSearchButton() {
            var nc = $("#txtName").parent();
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = 0;
            var h = btnHeight;
            szdwSearchButton = new SzdwButton(p, x, y, w, h);
            szdwSearchButton.namingContainer = nc;
            szdwSearchButton.imageWidth = btnImageWidth;
            szdwSearchButton.image = "../Image/query20b.png";
            szdwSearchButton.title = "员工名称筛选";
            szdwSearchButton.Load();

            //单击事件
            var btn = szdwSearchButton.button;
            $(btn).click(function (e) {
                szdwGv.paramJson["departmentId"] = 0;

                var name = $.trim($("#txtName").val());
                var reg = /[\u4e00-\u9fa5]/;
                if (name.length > 0) {
                    if (reg.test(name)) {
                        szdwGv.paramJson["partName"] = name;
                        szdwGv.paramJson["partPinyin"] = "";
                    } else {
                        szdwGv.paramJson["partName"] = "";
                        szdwGv.paramJson["partPinyin"] = name;
                    }
                }
                else {
                    szdwGv.paramJson["partName"] = name;
                    szdwGv.paramJson["partPinyin"] = name;
                }

                szdwGv.DataBind();
                e.stopPropagation();
            });
        }
        //#endregion 查询按钮 

        //#endregion 查询按钮面板
        //#endregion 查询面板

        //#region 结果集面板
        //#region 设置结果集面板
        function SetDataPanel() {
            var q = $("#queryPanel");
            var qw = $(q).outerWidth();
            var qh = $(q).outerHeight();
            var qt = $(q).offset().top;
            var x = $(q).offset().left;
            var y = qh + qt + mt;
            var w = qw;
            var h = bodyHeight - y - mt;

            var d = $("#dataPanel");
            $(d).css({ "position": "relative", "left": x, "top": y }).outerWidth(w).outerHeight(h);

            //初始加载结果数据
            GetQueryResult();
        }
        //#endregion 设置结果集面板

        //#region 查询结果

        //#region 获取查询参数
        function GetParamJson() {

            var name = $.trim($("#txtName").val());
            var paramJson = { xuserId: xuserId};

            var reg = /[\u4e00-\u9fa5]/;
            if (name.length > 0) {
                if (reg.test(name)) {
                    paramJson["partName"] = name;
                    paramJson["partPinyin"] = "";
                } else {
                    paramJson["partName"] = "";
                    paramJson["partPinyin"] = name;
                }
            }

            else {
                paramJson["partName"] = name;
                paramJson["partPinyin"] = name;
            }

            return paramJson;
        }
        //#endregion 获取查询参数

        //#region 创建Gridview并绑定数据
        var szdwGv = null;
        function CreateGridView(namingContainer, position, x, y, width, height) {
            if (szdwGv == null || typeof (szdwGv) == "undefined") {
                //创建SzdwGridViewt实例
                szdwGv = new SzdwGridView(position, x, y, width, height);
                szdwGv.namingContainer = namingContainer;
                szdwGv.fnInitial = InitialGridview(szdwGv);
                szdwGv.fnRowClick = SzdwRowClick;
            }

            //异步加载数据
            if (szdwGv.pagination != null) {
                szdwGv.pagination.ResetBar();
            }

            var paramJson = GetParamJson();
            paramJson["pageSize"] = szdwGv.pageSize;
            paramJson["MethodName"] = "GetEmployeeNameListByDepartmentIdAndPartNamePaged";
            szdwGv.requestUrl = "../Employee/EmployeeHandler.ashx";
            szdwGv.paramJson = paramJson;
            szdwGv.DataBind();
        }
        //#endregion 创建Gridview并绑定数据

        //#region 初始化Gridview属性
        function InitialGridview(szdwGv) {
            //个性样式设置    
            szdwGv.dataPanelCssJson = { "background-color": "White", "border": "1px solid Silver" };
            szdwGv.paginationCssJson = { "background-color": "White", "font-family": "微软雅黑", "font-size": "small", "border": "1px solid Silver", "border-top": "0px" };
            szdwGv.minHeight = 300;

            //dataPanel设置
            szdwGv.hasSumRow = false;
            szdwGv.allowRowClickEvent = true;
            //head设置
            szdwGv.headCssName = "gridHead2";
            szdwGv.headHeight = 30;
            szdwGv.fieldJsonData = [{ "Field": "RowNumber", "Text": "序号", "Width": 35 },
                                    { "Field": "Name", "Text": "人员姓名", "Width": 100, "OrderField": "Name" },
                                    { "Field": "PinYin", "Text": "姓名拼音", "Width": 100, "OrderField": "PinYin" }
                                   ];
            szdwGv.cellCssJson = {
                "Name": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "PinYin": { "text-align": "left", "font-size": "small", "font-family": "宋体" }
              
            };
        }
        //#endregion 初始化Gridview属性

        //#endregion 查询结果

        //#region 行单击事件
        function SzdwRowClick(rowIndex) {
            var jsonList = szdwGv.recordSetJson;
            if (jsonList) {
                var doc = parent.opInsert.pageDocument;
                var txtName = $(doc).find("[id='txtName']");

                var jsonData = jsonList[rowIndex];
                txtName.val(jsonData.PinYin);

                var txtNameCN = $(doc).find("[id='txtNameCN']");
                txtNameCN.val(jsonData.Name);

                $(txtName).focus().blur();
                parent.opEQuery.Hide();
            }
        }
   
        //#endregion 行单击事件

        //#endregion 结果集面板
      
    </script>
</body>
</html>