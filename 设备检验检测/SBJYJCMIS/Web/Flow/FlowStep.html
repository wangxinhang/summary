<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="../Styles/Page.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwDropDownList.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwButtonGroup.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwGridView.js" type="text/javascript"></script>
    <link href="../SzdwControls/SzdwGridView.css" rel="stylesheet" type="text/css" />
    <script src="../SzdwControls/SzdwPagination.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwButton.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwPopupWindow.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwValidator.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwAjaxDataOperate.js" type="text/javascript"></script>
    <script src="../Scripts/myparm.js" type="text/javascript"></script>
    <script src="../SzdwControls/domCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwInfoPanel.js" type="text/javascript"></script>
    <style type="text/css">
        input::-ms-clear
        {
            display: none;
        }
    </style>
</head>
<body style="background-color: #EEEEEE">
    <form>
    <div id="queryPanel" class="queryPanelNew">
        <div id="filterPanel" class="filterPanel">
            <div id="row0">
                <div id="cell03" class="cellDiv">
                    <label for="ddlFlow" class="label">
                        流程
                    </label>
                    <input id="ddlFlow" type="text" class="dropDownList" style="width: 80px;" />
                </div>
                <div id="cell00" class="cellDiv">
                    <label for="ddlSubmitFlowNode" class="label">
                        申请节点:</label>
                    <input id="ddlSubmitFlowNode" type="text" class="dropDownList" style="width: 150px;" />
                </div>
                <div id="cell01" class="cellDiv">
                    <label for="ddlApprovalFlowNode" class="label">
                        审批节点:</label>
                    <input id="ddlApprovalFlowNode" type="text" class="dropDownList" style="width: 150px;" />
                </div>
                <div id="cell02" class="cellDiv">
                    <label for="ddlFlowRule" class="label">
                        触发规则:</label>
                    <input id="ddlFlowRule" type="text" class="dropDownList" style="width: 70px;" />
                </div>
            </div>
        </div>
        <div id="btnPanel" class="btnPanel2">
        </div>
    </div>
    <div id="dataPanel">
    </div>
    </form>
    <script type="text/javascript">
        //#region 全局变量
        var xuserId, xmenuId; //用户
        var permission = {}; //权限json格式:{ accessPermission: false, insertPermission: false, deletePermission: false, modifyPermission: false, exportPrintPermission: false };
        var ml = 10; mt = 10; //ml:margin-left;mt:margin-top;
        var btnWidth = 90; btnHeight = 25; btnImageWidth = 25; //btnWidth:按钮宽;btnHeight:按钮高;btnImageWidth:按钮图片宽
        var pwWidth = 320; themeColor = parent.themeColor; //弹窗宽度及主题颜色
        //#endregion 全局变量

        //#region 网页加载 

        //#region 初始加载
        $(document).ready(function () {
            //获取用户Id和MenuId
            xuserId = GetXuserId();
            xmenuId = GetXmenuId();
            permission = GetPermission();

            bodyWidth = Math.max($(document.body).width(), minWidth);
            bodyHeight = Math.max($(document.body).height(), minHeight);

            //设置查询面板
            SetQueryPanel();

            //设置结果面板
            SetDataPanel();

            //窗口调整大小
            $(window).resize(function () {
                var body = document.body;
                bodyWidth = Math.max($(document.body).width(), minWidth);
                bodyHeight = Math.max($(document.body).height(), minHeight);
                panelWidth = bodyWidth - ml * 2;
                RepositionControls();
                ResizeControls();
            });
        });
        //#endregion 初始加载

        //#region 重设元素位置尺寸

        //#region 重设位置尺寸
        //重设网页元素位置
        function RepositionControls() {
            var qh = GetQueryPanelHeight();
            var qx = GetQueryPanelX();
            var qy = GetQueryPanelY();

            //设置结果集
            var dx = qx;
            var dy = qy + qh + mt;
            $("#dataPanel").css({ "left": dx, "top": dy });

            //重设弹窗位置
            var t = document.body;
            var pw = t.popupWindow;
            if (pw) {
                var bw = $(t).width();
                var w = pw.width;
                var x = bw - w - ml - 2;
                var y = dy + 2;
                pw.RePosition(x, y);
            }
        }

        //重设网页元素尺寸
        function ResizeControls() {
            var dh = bodyHeight;
            var pw = bodyWidth - 2 * ml;
            var qx = GetQueryPanelX();
            var qy = GetQueryPanelY();
            var qw = GetQueryPanelWidth();
            var qh = GetQueryPanelHeight();

            var q = $("#queryPanel");
            if (q) {
                $(q).outerWidth(pw);
            }

            //结果集
            if (szdwGv) {
                var w = pw;
                var y = qy + qh + mt;
                var h = dh - y - mt;

                $("#dataPanel").outerWidth(w).outerHeight(h);
                szdwGv.Resize(w, h);
            }

            //重设弹窗尺寸
            var t = document.body;
            var pw = t.popupWindow;
            if (pw) {
                var w = pw.width;
                var h = $("#dataPanel").height() - 4;
                pw.ReSize(w, h);
            }
        }
        //#endregion 重设位置尺寸

        //#region 获取查询面板位置尺寸
        //获取查询面板宽度
        function GetQueryPanelWidth() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerWidth(true);
        }

        //获取查询面板高度
        function GetQueryPanelHeight() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).outerHeight(true);
        }

        //获取查询面板纵坐标
        function GetQueryPanelY() {
            var p = $("#queryPanel");
            return $(p).css("display") == "none" ? 0 : $(p).offset().top;
        }

        //获取查询面板横坐标
        function GetQueryPanelX() {
            var p = $("#queryPanel");
            return $(p).offset().left;
        }
        //#endregion 获取查询面板位置尺寸              

        //#endregion 重设元素尺寸

        //#endregion 网页加载

        //#region 用户权限
        //获取用户Id
        function GetXuserId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xuserId;

        }

        //获取菜单ID:xMenuId
        function GetXmenuId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xmenuId;
        }

        //获取权限
        function GetPermission() {
            var jsonList = $.parseJSON(SzdwCommon.getUrlParam("paramJson")).permissionJsonList;
            return SzdwCommon.getPermission(jsonList);
        }
        //#endregion 用户权限

        //#region 查询面板

        //#region 查询条件面板

        //#region 设置查询面板
        function SetQueryPanel() {
            var q = $("#queryPanel");
            $("#queryPanel").outerWidth(bodyWidth - ml * 2);

            //绑定数据
            BindDdlFlow();
            BindDdlFlowRule();
            BindDdlApprovalFlowNode();
            BindDdlSubmitFlowNode();

            //设置按钮面板
            CreateButton();
        }
        //#endregion 设置查询面板 

        //#region 下拉框

        //绑定下拉框到目标控件
        //#region 流程类别列表下拉框
        var szdwDdlFlow = null;
        function BindDdlFlow() {
            var requestUrl = "../Permission/PermissionDropDwonListProcess.ashx";
            //部门下拉框
            var paramJson = { MethodName: "GetFlowList" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: paramJson, fnInitial: InitialDdlFlow, maxHeight: 300, width: 120 };
            $("#ddlFlow").dropDownList(paramDdlDep);
            $("#ddlFlow").val("全部");
            $("#ddlFlow").data("value", 0);
        }
        //通用下拉框初始化设置
        function InitialDdlFlow(szdwDdl) {
            szdwDdl.jsonItemAll = { Id: 0, Name: "全部" };
            szdwDdl.fnItemClick = function () {
                flowId = $.trim($("#ddlFlow").data("value"));
                var btn = szdwQueryButton.button;
                if (btn) {
                    $(btn).trigger("click");
                }
            }
        }
        //#endregion 部门列表下拉框

        //#region 提交节点下拉框
        function BindDdlSubmitFlowNode() {
            var requestUrl = "FlowStepProcess.ashx";
            //部门下拉框
            var pjDdlDep = { flowId: 1, MethodName: "GetFlowNodeListByFlowId" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: pjDdlDep, fnInitial: InitialDdlSubmitFlowNode, maxHeight: 300, hasSearchBox: 1, width: 240 };
            $("#ddlSubmitFlowNode").dropDownList(paramDdlDep);
            $("#ddlSubmitFlowNode").val("全部");
            $("#ddlSubmitFlowNode").data("value", "0");
        }
        //提交节点下拉框基础设置
        function InitialDdlSubmitFlowNode(szdwDdl) {
            szdwDdl.jsonItemAll = { Id: 0, Name: "全部" };
            szdwDdl.hasSearchBox = true;
            szdwDdl.fnItemClick = function () {
                if (szdwGv) {
                    var btn = szdwQueryButton.button;
                    if (btn) {
                        $(btn).trigger("click");
                    }
                }
            }
        }

        //#endregion 提交节点下拉框

        //#region 审批节点下拉框
        function BindDdlApprovalFlowNode() {
            var requestUrl = "FlowStepProcess.ashx";
            //部门下拉框
            var pjDdlDep = { flowId: 1, MethodName: "GetFlowNodeListByFlowId" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: pjDdlDep, fnInitial: InitialDdlApprovalFlowNode, maxHeight: 300, hasSearchBox: 1, width: 240 };
            $("#ddlApprovalFlowNode").dropDownList(paramDdlDep);
            $("#ddlApprovalFlowNode").val("全部");
            $("#ddlApprovalFlowNode").data("value", "0");

        }
        //提交节点下拉框基础设置
        function InitialDdlApprovalFlowNode(szdwDdl) {
            szdwDdl.jsonItemAll = { Id: 0, Name: "全部" };
            szdwDdl.hasSearchBox = true;
            szdwDdl.fnItemClick = function () {
                if (szdwGv) {
                    var btn = szdwQueryButton.button;
                    if (btn) {
                        $(btn).trigger("click");
                    }
                }
            }
        }
        //#endregion 审批节点下拉框

        //#region 流程触发规则下拉框
        function BindDdlFlowRule() {
            var requestUrl = "FlowStepProcess.ashx";
            //部门下拉框
            var pjDdlDep = { flowId: 1, MethodName: "GetFlowRuleListByFlowId" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: pjDdlDep, fnInitial: InitialDdlFlowRule };
            $("#ddlFlowRule").dropDownList(paramDdlDep);
            $("#ddlFlowRule").val("全部");
            $("#ddlFlowRule").data("value", "0");
        }
        //提交节点下拉框基础设置
        function InitialDdlFlowRule(szdwDdl) {
            szdwDdl.jsonItemAll = { Id: 0, Name: "全部" };
            szdwDdl.fnItemClick = function () {
                if (szdwGv) {
                    var btn = szdwQueryButton.button;
                    if (btn) {
                        $(btn).trigger("click");
                    }
                }
            }
        }
        //#endregion 流程触发规则下拉框

        //#endregion 下拉框

        //#endregion 查询条件面板

        //#region 查询按钮面板

        //#region 创建按钮
        function CreateButton() {
            //创建按钮
            CreateQueryButton();
            //if (permission.exportPrintPermission) { CreateExportButton(); }
            CreateResetButton();
            CreateRetractButton();
            if (permission.insertPermission) { CreateInsertButton(); }
        }
        //#endregion 设置按钮面板

        //#region 查询按钮
        var szdwQueryButton = null;
        function CreateQueryButton() {
            var nc = $("#btnPanel");
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = btnWidth;
            var h = btnHeight;
            szdwQueryButton = new SzdwButton(p, x, y, w, h);
            szdwQueryButton.namingContainer = nc;
            szdwQueryButton.image = imgFile.query;
            szdwQueryButton.text = "查询数据";
            szdwQueryButton.btnCssJson["border"] = "0px";
            szdwQueryButton.btnHoverCssJson = { "color": "#017BBA" };
            szdwQueryButton.imageWidth = btnImageWidth;
            szdwQueryButton.Load();

            //单击事件
            var btn = szdwQueryButton.button;
            $(btn).click(function (e) {
                GetQueryResult();
                e.stopPropagation();
            });
        }

        //查询按钮事件
        function GetQueryResult() {
            //设置结果面板相关属性
            var body = document.body;
            var c = $("#dataPanel");
            var position = "absolute";
            var x = 0;
            var y = 0; //by + bh + mt;
            var w = $(c).width();
            var h = $(c).height();

            //创建Gridview并绑定数据
            CreateGridView(c, position, x, y, w, h);
        }
        //#endregion 查询按钮

        //#region 导出按钮
        var szdwExportButton = null;
        function CreateExportButton() {
            var nc = $("#btnPanel");
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = btnWidth;
            var h = btnHeight;
            szdwExportButton = new SzdwButton(p, x, y, w, h);
            szdwExportButton.namingContainer = nc;
            szdwExportButton.image = imgFile.report;
            szdwExportButton.text = "导出打印";
            szdwExportButton.btnCssJson["border"] = "0px";
            szdwExportButton.btnCssJson["margin-left"] = "5px";
            szdwExportButton.btnCssJson["border-left"] = "1px solid #EEEEEE";
            szdwExportButton.btnHoverCssJson = { "color": "#017BBA" };
            szdwExportButton.imageWidth = btnImageWidth;
            szdwExportButton.Load();

            //单击事件
            var btn = szdwExportButton.button;
            $(btn).click(function () {
                ExportAndPrint();
            });
        }

        //导出事件
        function ExportAndPrint() {
            var pageUrl = "ContractChainReport.aspx";
            var paramJson = GetParamJson();
            var titleText = "流程步骤数据导出打印";
            var body = document.body
            var bw = $(body).width();
            var bh = $(body).height();
            var w = bw * 4 / 5;
            var h = bh * 4 / 5;
            var x = (bw - w) / 2;
            var y = (bh - h) / 2;
            var hasAnimation = true;
            OpenPopupWindow(titleText, pageUrl, paramJson, x, y, w, h, hasAnimation);
        }

        //#endregion 导出按钮        

        //#region 重置按钮
        var szdwResetButton = null;
        function CreateResetButton() {
            var nc = $("#btnPanel");
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = btnWidth;
            var h = btnHeight;
            szdwResetButton = new SzdwButton(p, x, y, w, h);
            szdwResetButton.namingContainer = nc;
            szdwResetButton.image = imgFile.reset;
            szdwResetButton.text = "重置条件";
            szdwResetButton.btnCssJson["border"] = "0px";
            szdwResetButton.btnCssJson["margin-left"] = "5px";
            szdwResetButton.btnCssJson["border-left"] = "1px solid #EEEEEE";
            szdwResetButton.btnHoverCssJson = { "color": "#017BBA" };
            szdwResetButton.imageWidth = btnImageWidth;
            szdwResetButton.Load();

            //单击事件
            var btn = szdwResetButton.button;
            $(btn).click(function () {
                $("#ddlFlow").val("全部");
                $("#ddlFlow").data("value", "0");
                $("#ddlFlowRule").val("全部");
                $("#ddlFlowRule").data("value", "0");
                $("#ddlApprovalFlowNode").val("全部");
                $("#ddlApprovalFlowNode").data("value", "0");
                $("#ddlSubmitFlowNode").val("全部");
                $("#ddlSubmitFlowNode").data("value", "0");
                var btn = szdwQueryButton.button;
                if (btn) {
                    $(btn).trigger("click");
                }
            });
        }
        //#endregion 重置按钮

        //#region 新增按钮
        var szdwInsertButton = null;
        function CreateInsertButton() {
            var nc = $("#btnPanel");
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = 120;
            var h = btnHeight;
            szdwInsertButton = new SzdwButton(p, x, y, w, h);
            szdwInsertButton.namingContainer = nc;
            szdwInsertButton.image = imgFile.insert;
            szdwInsertButton.text = "新增流程步骤";
            szdwInsertButton.btnCssJson["border"] = "0px";
            szdwInsertButton.btnCssJson["margin-left"] = "5px";
            szdwInsertButton.btnCssJson["border-left"] = "1px solid #EEEEEE";
            szdwInsertButton.btnHoverCssJson = { "color": "#017BBA" };
            szdwInsertButton.imageWidth = btnImageWidth;
            szdwInsertButton.Load();

            //单击事件
            var btn = szdwInsertButton.button;
            $(btn).click(function () {
                FlowStepInsert();
            });
        }
        //#endregion 重置按钮

        //#region 收起条件按钮
        var szdwRetractButton = null;
        function CreateRetractButton() {
            var nc = $("#btnPanel");
            var p = "relative";
            var x = 0;
            var y = 0;
            var w = 0; //btnWidth;
            var h = btnHeight;
            szdwRetractButton = new SzdwButton(p, x, y, w, h);
            szdwRetractButton.namingContainer = nc;
            szdwRetractButton.btnCssJson["float"] = "right";
            szdwRetractButton.btnCssJson["border"] = "0px";
            szdwRetractButton.btnCssJson["margin-left"] = "5px";
            szdwRetractButton.btnHoverCssJson = { "color": "#017BBA" };
            szdwRetractButton.imageWidth = btnImageWidth;

            szdwRetractButton.isToggle = true;
            szdwRetractButton.imageWidth = btnImageWidth;
            szdwRetractButton.image = imgFile.retractUp;
            szdwRetractButton.imageToggle = imgFile.retractDown;
            szdwRetractButton.title = "收起或展开条件";
            szdwRetractButton.text = "";

            szdwRetractButton.Load();

            //单击事件
            var btn = szdwRetractButton.button;
            $(btn).click(function () {
                //设置控件位置尺寸
                var fp = $("#filterPanel");
                if (fp != null) {
                    if ($(fp).css("display") == "none") {
                        $(fp).fadeIn();
                        $(fp).css("display", "block");
                    } else {
                        $(fp).fadeOut();
                        $(fp).css("display", "none");
                    }
                    RepositionControls();
                    ResizeControls();
                }
            });
        }
        //#endregion 收起条件按钮

        //#endregion 查询按钮面板
        //#endregion 查询面板

        //#region 结果集面板

        //#region 设置结果集面板
        function SetDataPanel() {
            var q = $("#queryPanel");
            var qw = $(q).outerWidth();
            var qh = $(q).outerHeight();
            var qt = $(q).offset().top;
            var x = $(q).offset().left;
            var y = qh + qt + mt;
            var w = qw;
            var h = bodyHeight - y - mt;

            var d = $("#dataPanel");
            $(d).css({ "position": "relative", "left": x, "top": y }).outerWidth(w).outerHeight(h);

            //初始加载结果数据
            GetQueryResult();
        }
        //#endregion 设置结果集面板

        //#region 查询结果

        //#region 获取查询参数
        function GetParamJson() {
            var xuserId = xuserId;
            var flowId = $("#ddlFlow").data("value");
            var submitFlowNode = $("#ddlSubmitFlowNode").data("value");
            var approvalFlowNodeId = $("#ddlApprovalFlowNode").data("value");
            var flowRuleId = $("#ddlFlowRule").data("value");

            var paramJson = { xuserId: xuserId, flowId: flowId };

            if (submitFlowNode > 0) {
                paramJson["submitFlowNode"] = submitFlowNode;
            }
            if (approvalFlowNodeId > 0) {
                paramJson["approvalFlowNodeId"] = approvalFlowNodeId;
            }
            if (flowRuleId > 0) {
                paramJson["flowRuleId"] = flowRuleId;
            }
            
            return paramJson;
        }
        //#endregion 获取查询参数

        //#region 创建Gridview并绑定数据
        var szdwGv = null;
        function CreateGridView(namingContainer, position, x, y, width, height) {
            if (szdwGv == null || typeof (szdwGv) == "undefined") {
                //创建SzdwGridViewt实例
                szdwGv = new SzdwGridView(position, x, y, width, height);
                szdwGv.namingContainer = namingContainer;
                szdwGv.fnInitial = InitialArGridview(szdwGv);
                szdwGv.fnDeleting = FlowStepDelete; ;
                szdwGv.fnEditing = FlowStepUpdate;
            }

            //异步加载数据
            if (szdwGv.pagination != null) {
                szdwGv.pagination.ResetBar();
            }

            var paramJson = GetParamJson();
            paramJson["pageSize"] = szdwGv.pageSize;
            paramJson["MethodName"] = "FlowStepGetList";
            szdwGv.requestUrl = "FlowStepProcess.ashx";
            szdwGv.paramJson = paramJson;
            szdwGv.DataBind();
        }
        //#endregion 创建Gridview并绑定数据

        //#region 初始化Gridview属性
        function InitialArGridview(szdwGv) {
            //个性样式设置
            //szdwGv.headCssJson = { "font-weight": "bolder"};        
            szdwGv.dataPanelCssJson = { "background-color": "White", "border": "1px solid Silver" };
            szdwGv.paginationCssJson = { "background-color": "White", "font-family": "微软雅黑", "font-size": "small", "border": "1px solid Silver", "border-top": "0px" };
            szdwGv.minHeight = 300;

            //dataPanel设置
            szdwGv.hasSumRow = false;
            szdwGv.hasButtonPanel = true;
            szdwGv.permission.modifyPermission = permission.modifyPermission;
            szdwGv.permission.deletePermission = permission.deletePermission;

            //head设置
            szdwGv.headCssName = "gridHead2";
            szdwGv.headHeight = 30;
            szdwGv.fieldJsonData = [{ "Field": "RowNumber", "Text": "序号", "Width": 50 },
                                    { "Field": "Flow", "Text": "流程类别", "Width": 120, "OrderField": "Flow" },
                                    { "Field": "SubmitFlowNode", "Text": "申请节点", "Width": 250, "OrderField": "SubmitFlowNode" },
                                    { "Field": "ApprovalFlowNode", "Text": "审批节点", "Width": 250, "OrderField": "ApprovalFlowNode" },
                                    { "Field": "FlowRule", "Text": "触发规则", "Width": 100, "OrderField": "FlowRule" },
                                    { "Field": "Memo", "Text": "描述", "Width": 100, "OrderField": "Memo" }];

            szdwGv.cellCssJson = {
                "SubmitFlowNode": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "ApprovalFlowNode": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "Memo": { "text-align": "left", "font-size": "small", "font-family": "宋体" }
            };
        }
        //#endregion 初始化Gridview属性

        //#endregion 查询结果

        //#endregion 结果集面板

        //#region 数据操作：增删改

        //#region 新增
        function FlowStepInsert() {
            var body = document.body;
            var bw = $(document).width();
            var bh = $(document).height();
            var pageUrl = "FlowStepInsert.html";
            var titleText = "新增流程步骤";
            var paramJson = null;

            var dp = $("#dataPanel");
            var w = pwWidth;
            var h = $(dp).height() - 4;
            var x = bw - w - ml - 2;
            var y = $(dp).offset().top + 2;
            var hasAnimation = false;
            SzdwCommon.openPopupWindow(titleText, pageUrl, paramJson, x, y, w, h);
        }

        //写入后刷新数据
        function RefreshDataAfterInsert() {
            SzdwCommon.refreshDataAfterInsert(szdwGv);
        }
        //#endregion 新增

        //#region 删除
        function FlowStepDelete(rowIndex) {
            var jsData = szdwGv.recordSetJson[rowIndex];
            var id = jsData.Id;
            var modifierId = xuserId;
            
            var requestUrl = "FlowStepProcess.ashx";
            var paramJson = { id: id, modifierId: modifierId, "MethodName": "FlowStepLogicDelete" };
            SzdwAjaxDataOperate.ajaxDelete(szdwGv, requestUrl, paramJson);
        }
        //#endregion 删除

        //#region 修改
        function FlowStepUpdate(rowIndex) {
            //设置编辑行的样式（加底色）
            szdwGv.SetSelectedRow(szdwGv.bodyRows[rowIndex]);

            //弹出更新窗口
            var body = document.body;
            var bw = $(document).width();
            var bh = $(document).height();

            var jsData = szdwGv.recordSetJson[rowIndex];
            var titleText = "编辑流程步骤";
            var pageUrl = "FlowStepUpdate.html";
            var paramJson = { Id: jsData.Id, SubmitFlowNodeId: jsData.SubmitFlowNodeId, SubmitFlowNode: jsData.SubmitFlowNode,
                ApprovalFlowNodeId: jsData.ApprovalFlowNodeId, ApprovalFlowNode: jsData.ApprovalFlowNode,
                FlowRuleId: jsData.FlowRuleId, FlowRule: jsData.FlowRule, Memo: jsData.Memo,
                ModifierId: xuserId, FlowId: jsData.FlowId, Flow: jsData.Flow
            };

            var dp = $("#dataPanel");
            var w = pwWidth;
            var h = $(dp).height() - 4;
            var x = bw - w - ml - 2;
            var y = $(dp).offset().top + 2;
            var hasAnimation = false;
            var oJson = { fnCloseCallBack: RecoverSelectedRow };
            SzdwCommon.openPopupWindow(titleText, pageUrl, paramJson, x, y, w, h, oJson);
        }

        //更新完毕后恢复行样式（无选中底色）
        function RecoverSelectedRow() {
            szdwGv.RecoverSelectedRow();
        }
        //#endregion 修改

        //#region 数据操作提示信息面板
        var opInfoPanel = null;
        function CreateOperateInfoPanel() {
            opInfoPanel = SzdwCommon.createOperateInfoPanel({ backColor: themeColor, namingContainer: document.body });
            return opInfoPanel;
        }
        //#endregion 数据操作提示信息面板

        //#endregion 数据操作：增删改
    </script>
</body>
</html>
