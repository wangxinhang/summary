<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/ScrollBar.css" rel="stylesheet" type="text/css" />
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwAjaxDataOperate.js" type="text/javascript"></script>
    <script src="../SzdwControls/domCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwDropDownList.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwDatePicker.js" type="text/javascript"></script>
    <!--    <script src="../SzdwControls/SzdwInfoPanel.js" type="text/javascript"></script>-->
    <script src="../SzdwControls/SzdwValidator.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwOnOff.js" type="text/javascript"></script>


    <style type="text/css">
        input::-ms-clear
        {
            display: none;
        }
    </style>
</head>
<body>
    <form action="">
    <div id="InsertPanel">
        <div id="basicInfoTitle" class="groupTitle" style="cursor: pointer;">
            <label>
                基本信息</label>
            <div id="expBasic" style="float: right">
            </div>
        </div>
        <div id="basicInfoGroup" class="groupPanel">
            <div class="pwRow">
                <div id="cell00" class="cellDiv">
                    <label class="pwLabel">
                        人员名称:</label>
                    <input id="txtName" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell20" class="cellDiv">
                    <label class="pwLabel">
                        姓名拼音:</label>
                    <input id="txtPinYin" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell30" class="cellDiv">
                    <label class="pwLabel">
                        姓名简拼:</label>
                    <input id="txtSimplePinYin" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow" style="display:none;">
                <div id="cell130" class="cellDiv">
                    <label class="pwLabel">
                        身份证号:</label>
                    <input id="txtIDNumber" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow" style="margin-bottom: 0">
                <div id="cell60" class="cellDiv">
                    <label class="pwLabel">
                        性别:</label>
                    <div id="sexPanel" style="float: right"></div>
                </div>
            </div>
        </div>
        <div id="organizationInfoTitle" class="groupTitle" style="cursor: pointer;">
            <label>组织信息</label>
            <div id="expOrganization" style="float: right">
            </div>
        </div>
        <div id="organizationInfoGroup" class="groupPanel" style="display: none">
            <div class="pwRow">
                <div id="cell10" class="cellDiv">
                    <label class="pwLabel">所属部门:</label>
                    <input id="ddlDepartment" type="text" class="pwDropDownList" style="width: 183px;float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell120" class="cellDiv">
                    <label class="pwLabel">
                        岗位/职务:</label>
                    <input id="ddlPosition" type="text" class="pwDropDownList" style="width: 183px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="Div1" class="cellDiv">
                    <label class="pwLabel">
                        入职日期:</label>
                    <div id="cell40" style="float: right;">
                        <input id="txtDate" type="text" class="pwTextBox" style="width: 154px;" />
                        <div id="btnDate" class="pwBtnDate" style="float: right;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="contactInfoTitle" class="groupTitle" style="cursor: pointer;">
            <label>
                联络信息</label>
            <div id="expContact" style="float: right">
            </div>
        </div>
        <div id="contactInfoGroup" class="groupPanel" style="display: none">
            <div class="pwRow">
                <div id="cell80" class="cellDiv">
                    <label class="pwLabel">
                        手机号码:</label>
                    <input id="txtMobile" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div class="cellDiv">
                    <label class="pwLabel">
                        办公电话:</label>
                    <input id="txtOfficePhone" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow" style="margin-bottom: 0">
                <div id="cell100" class="cellDiv">
                    <label class="pwLabel">
                        邮箱:</label>
                    <input id="txtEmail" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
        </div>
        <div id="familyInfoTitle" class="groupTitle" style="cursor: pointer;display:none;">
            <label>
                家庭信息</label>
            <div id="expFamily" style="float: right">
            </div>
        </div>
        <div id="familyInfoGroup" class="groupPanel" style="display: none">
            <div class="pwRow">
                <div id="cell150" class="cellDiv">
                    <label class="pwLabel">
                        家庭电话:</label>
                    <input id="txtTel" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell160" class="cellDiv">
                    <label class="pwLabel">
                        现居地址:</label>
                    <input id="txtAddress" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell140" class="cellDiv">
                    <label class="pwLabel">
                        紧急联系人:</label>
                    <input id="txtEmergencyMan" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
            <div class="pwRow" style="margin-bottom: 0">
                <div id="cell170" class="cellDiv">
                    <label class="pwLabel">
                        紧急联系电话:</label>
                    <input id="txtEmergencyTel" type="text" class="pwTextBox" style="width: 180px; float: right" />
                </div>
            </div>
        </div>
        <div id="otherInfoTitle" class="groupTitle" style="cursor: pointer;">
            <label>
                其他信息</label>
            <div id="expOther" style="float: right">
            </div>
        </div>
        <div id="otherInfoGroup" class="groupPanel" style="display: none;">
            <div class="pwRow">
                <div id="cell50" class="cellDiv">
                    <label class="pwLabel">
                        民族:</label>
                    <input id="ddlNation" type="text" class="pwDropDownList" style="width: 183px; float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell90" class="cellDiv">
                    <label class="pwLabel">学历:</label>
                    <input id="ddlEducation" type="text" class="pwDropDownList" style="width: 183px;
                        float: right" />
                </div>
            </div>
            <div class="pwRow">
                <div id="cell70" class="cellDiv">
                    <label class="pwLabel">婚否:</label>
                    <div id="maritalPanel" style="float: right">
                    </div>
                </div>
            </div>
            <div class="pwRow" style="height:45px;">
                <div id="cell180" class="cellDiv">
                    <label class="pwLabel">人员描述:</label>
                   <!-- <input id="txtMemo" type="text" class="pwTextBox" style="width: 180px; float: right" />-->
                    <textarea id="txtMemo" rows="2" cols="1" class="pwTextarea" style="width: 180px;
                        height: 50px; float: right; overflow: auto"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div id="buttonPanel" class="pwBtnPanel">
        <input id="chkClose" type="checkbox" checked="checked" class="pwCheckbox" />
        <label for="chkClose" class="pwLabel">提交后关闭</label>
        <input id="btnCancel" type="button" value="取消" class="pwButton2" style="float: right;" />
        <input id="btnSave" type="button" value="提交保存" class="pwKeyButton2" style="float: right" />
    </div>
    </form>
    <script type="text/javascript">

        //#region 全局变量
        var xuserId, permission = null;
        var bodyWidth = $(document).width();
        var opw = parent.document.body.popupWindow;
        var bodyHeight = opw.pagePanelHeight;
        var ml = 10; mt = 10; btnHeight = 32; btnPanelHeight = 35;
        var maxHeight = bodyHeight - btnPanelHeight - 28;
        var panelWidth = bodyWidth - ml * 2;
        var sex;
        var maritalStatus;
        //#endregion 全局变量

        //#region 网页加载

        //#region 初始加载
        $(document).ready(function () {
            xuserId = parent.xuserId;
            //设置录入面板
            SetInsertPanel();
            LoadValidaor();

            //设置按钮面板
            SetButtonPanel();

            ClearInsertPanelData();
            //窗口调整大小
            $(window).resize(function () {
                bodyWidth = $(document.body).width();
                bodyHeight = $(document.body).height();
                RePositionControls();
                ReSize();
            });
        });
        //#endregion 初始加载

        //#region 重新定位
        function RePositionControls() {
            var pw = parent.document.body.popupWindow;
            if (pw) {
                var p = $("#buttonPanel");
                var ph = pw.pagePanelHeight;
                var h = $(p).outerHeight();
                var x = 0;
                var y = ph - h - 2;
                $(p).css({ "left": x, "top": y });
            }
        }
        //#endregion 重新定位  

        //#region 重设尺寸
        function ReSize() {
            var pw = parent.document.body.popupWindow;
            if (pw) {
                var p = $("#InsertPanel");
                var ph = pw.pagePanelHeight;
                var bph = $("#buttonPanel").outerHeight();
                var h = ph - bph;
                $(p).outerHeight(h);
            }
        }
        //#endregion 重设尺寸  

        //#endregion 网页加载  

        //#region 录入面板

        //#region 设置录入面板
        function SetInsertPanel() {
            var p = $("#InsertPanel");
            var x = 0;
            var y = 0;
            var w = bodyWidth - x * 2;
            var h = bodyHeight - btnPanelHeight;
            $(p).addClass("queryPanel").css({ "left": x, "top": y, "min-width": 0, "margin-bottom": "3px", "padding": "0px 0px 15px 0px", "overflow": "hidden" }).outerWidth(w).outerHeight(h, true);

            var cw = w - ml * 2;
            $(".cellDiv").outerWidth(cw); //.css({"padding":"0px"});            

            //设置滚动条
            $(p).addClass("scrollBar2");
            $(p).mouseover(function () {
                $(this).css({ "overflow-y": "auto" });
            }).mouseleave(function () {
                $(this).css({ "overflow-y": "hidden" });
            });

            //人员基本信息
            SetBasicInfoTitle();
            LoadSzdwExpBasic();
            SetBasicInfoGroup();

            //人员联络信息
            SetContactInfoTitle();
            LoadSzdwExpContact();
            SetContactInfoGroup();

            //人员组织信息
            SetOrganizationInfoTitle();
            LoadSzdwExpOrganization();
            SetOrganizationInfoGroup();

            //人员家庭信息
            SetFamilyInfoTitle();
            LoadSzdwExpFamily();
            SetFamilyInfoGroup();

            //人员其他信息
            SetOtherInfoTitle();
            LoadSzdwExpOther();
            SetOtherInfoGroup();

            //控件设置
            BindDropDownLists();
            LoadSzdwSex();
           
            LoadSzdwMaritalStatus();
            SetDate();
        }

        //#endregion 设置录入面板

        //#region 信息分组

        //#region 人员基本信息

        //#region 基本信息标题
        function SetBasicInfoTitle() {
            var p = $("#basicInfoTitle");
            var x = 0;
            var y = 0;
            var w = bodyWidth;
            $(p).css({ "position": "relative", "left": x, "top": y }).outerWidth(w);

            //绑定事件
            $(p).click(function () {
                InfoTitleClick(szdwExpBasic, basicInfoValidators);
            }).mouseover(function () {
                if (szdwExpBasic.onOff) szdwExpBasic.Show();
            }).mouseleave(function () {
                if (szdwExpBasic.onOff) szdwExpBasic.Hide();
            });
        }
        //#endregion 基本信息标题   

        //#region 基本信息显隐
        var szdwExpBasic = null;
        function LoadSzdwExpBasic() {
            if (!szdwExpBasic) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 56;
                var h = 22;
                szdwExpBasic = new SzdwOnOff(p, x, y, w, h);
                szdwExpBasic.namingContainer = $("#expBasic");
                szdwExpBasic.visible = false;
                szdwExpBasic.onOff = true;
                szdwExpBasic.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwExpBasic.fnClickCallBack = FnExpBasic;
                szdwExpBasic.Load();
            }
        }

        //显隐回调函数
        var basicInfoValidators = []; //存储验证器对象的数组
        function FnExpBasic() {
            var arrValidators = basicInfoValidators;
            //隐藏验证器
            $.each(arrValidators, function (i, item) {
                $(item.panel).css({ "display": "none" });
                item.showing = false;
            });

            //组面板显示完毕后执行验证
            var g = $("#basicInfoGroup");
            $(g).slideToggle(300, null, function () {
                SetValidatorsPosition(arrValidators);
                InfoGroupScroll(g);
            });
        }

        //获取组验证结果
        function GetBasicInfoGroupValidation() {
            var isValid = true;
            $.each(basicInfoValidators, function (i, item) {
                var t = item.targetControl;
                $(t).trigger("blur");
                isValid = isValid && $(t).data("isValid");
            });

            return isValid;
        }
        //#endregion 基本信息显隐

        //#region 基本信息组
        function SetBasicInfoGroup() {
            var p = $("#basicInfoGroup");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);
        }

        //#endregion 基本信息组    

        //#region 性别
        var szdwSex = null;
        function LoadSzdwSex() {
            if (!szdwSex) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 80;
                var h = 26;
                szdwSex = new SzdwOnOff(p, x, y, w, h);
                szdwSex.namingContainer = $("#sexPanel");
                szdwSex.onOff = true;
                szdwSex.onText = "男";
                szdwSex.offText = "女";
                szdwSex.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwSex.fnClickCallBack = GetSex;
                szdwSex.Load();
                sex = Number(szdwSex.value);
            }
        }

        //获取性别值
        function GetSex() {
            if (szdwSex) sex = Number(szdwSex.value);
        }
        //#endregion 性别

        //#endregion 人员基本信息

        //#region 人员组织信息

        //#region 组织信息标题

        //设置标题
        function SetOrganizationInfoTitle() {
            var p = $("#organizationInfoTitle");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);

            //绑定事件
            $(p).click(function () {
                InfoTitleClick(szdwExpOrganization, orgInfoValidators);
            }).mouseover(function () {
                if (szdwExpOrganization.onOff) szdwExpOrganization.Show();
            }).mouseleave(function () {
                if (szdwExpOrganization.onOff) szdwExpOrganization.Hide();
            });
        }
        //#endregion 组织信息标题   

        //#region 组织信息显隐

        //显隐开关
        var szdwExpOrganization = null;
        function LoadSzdwExpOrganization() {
            if (!szdwExpOrganization) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 56;
                var h = 22;
                szdwExpOrganization = new SzdwOnOff(p, x, y, w, h);
                szdwExpOrganization.namingContainer = $("#expOrganization");
                szdwExpOrganization.visible = true;
                szdwExpOrganization.onOff = false;
                szdwExpOrganization.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwExpOrganization.fnClickCallBack = FnExpOrganization;
                szdwExpOrganization.Load();
            }
        }

        //显隐回调函数
        var orgInfoValidators = [];
        function FnExpOrganization() {
            var arrValidators = orgInfoValidators;
            //隐藏验证器
            $.each(arrValidators, function (i, item) {
                $(item.panel).css({ "display": "none" });
                item.showing = false;
            });

            //组面板显示完毕后执行验证
            var g = $("#organizationInfoGroup");
            $(g).slideToggle(300, null, function () {
                SetValidatorsPosition(arrValidators);
                InfoGroupScroll(g);
            });
        }
        //#endregion 组织信息显隐

        //#region 组织信息组
        function SetOrganizationInfoGroup() {
            var p = $("#organizationInfoGroup");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);
        }

        //#endregion 组织信息组    

        //#endregion 组织基本信息

        //#region 人员联络信息

        //#region 联络信息标题

        //设置标题
        function SetContactInfoTitle() {
            var p = $("#contactInfoTitle");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);

            //绑定事件
            $(p).click(function () {
                InfoTitleClick(szdwExpContact, contactInfoValidators);
            }).mouseover(function () {
                if (szdwExpContact.onOff) szdwExpContact.Show();
            }).mouseleave(function () {
                if (szdwExpContact.onOff) szdwExpContact.Hide();
            });
        }
        //#endregion 联络信息标题

        //#region 联络信息显隐
        var szdwExpContact = null;
        function LoadSzdwExpContact() {
            if (!szdwExpContact) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 56;
                var h = 22;
                szdwExpContact = new SzdwOnOff(p, x, y, w, h);
                szdwExpContact.namingContainer = $("#expContact");
                szdwExpContact.visible = true;
                szdwExpContact.onOff = false;
                szdwExpContact.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwExpContact.fnClickCallBack = FnExpContact;
                szdwExpContact.Load();
            }
        }

        //显隐回调函数
        var contactInfoValidators = [];
        function FnExpContact() {
            var arrValidators = contactInfoValidators;
            $.each(arrValidators, function (i, item) {
                $(item.panel).css({ "display": "none" });
                item.showing = false;
            });

            var g = $("#contactInfoGroup");
            $(g).slideToggle(300, null, function () {
                SetValidatorsPosition(arrValidators);
                InfoGroupScroll(g);
            });
        }
        //#endregion 联络信息显隐

        //#region 联络信息组
        function SetContactInfoGroup() {
            var p = $("#contactInfoGroup");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);
        }

        //#endregion 联络信息组    

        //#endregion 联络基本信息

        //#region 人员家庭信息

        //#region 家庭信息标题
        function SetFamilyInfoTitle() {
            var p = $("#familyInfoTitle");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);

            //绑定事件
            $(p).click(function () {
                InfoTitleClick(szdwExpFamily, familyInfoValidators);
            }).mouseover(function () {
                if (szdwExpFamily.onOff) szdwExpFamily.Show();
            }).mouseleave(function () {
                if (szdwExpFamily.onOff) szdwExpFamily.Hide();
            });
        }
        //#endregion 家庭信息标题   

        //#region 家庭信息显隐
        var szdwExpFamily = null;
        function LoadSzdwExpFamily() {
            if (!szdwExpFamily) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 56;
                var h = 22;
                szdwExpFamily = new SzdwOnOff(p, x, y, w, h);
                szdwExpFamily.namingContainer = $("#expFamily");
                szdwExpFamily.visible = true;
                szdwExpFamily.onOff = false;
                szdwExpFamily.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwExpFamily.fnClickCallBack = FnExpFamily;
                szdwExpFamily.Load();
            }
        }

        //显隐回调函数
        var familyInfoValidators = [];
        function FnExpFamily() {
            var arrValidators = familyInfoValidators;
            $.each(arrValidators, function (i, item) {
                $(item.panel).css({ "display": "none" });
                item.showing = false;
            });

            var g = $("#familyInfoGroup");
            $(g).slideToggle(300, null, function () {
                SetValidatorsPosition(arrValidators);
                InfoGroupScroll(g);
            });
        }

        //#endregion 家庭信息显隐

        //#region 家庭信息组
        function SetFamilyInfoGroup() {
            var p = $("#familyInfoGroup");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);
        }

        //#endregion 家庭信息组    

        //#endregion 家庭基本信息

        //#region 人员其他信息

        //#region 其他信息标题
        function SetOtherInfoTitle() {
            var p = $("#otherInfoTitle");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);

            //绑定事件
            $(p).click(function () {
                InfoTitleClick(szdwExpOther, otherInfoValidators);
            }).mouseover(function () {
                if (szdwExpOther.onOff) szdwExpOther.Show();
            }).mouseleave(function () {
                if (szdwExpOther.onOff) szdwExpOther.Hide();
            });
        }
        //#endregion 其他信息标题 

        //#region 其他信息显隐
        var szdwExpOther = null;
        function LoadSzdwExpOther() {
            if (!szdwExpOther) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 56;
                var h = 22;
                szdwExpOther = new SzdwOnOff(p, x, y, w, h);
                szdwExpOther.namingContainer = $("#expOther");
                szdwExpOther.visible = true;
                szdwExpOther.onOff = false;
                szdwExpOther.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwExpOther.fnClickCallBack = FnExpOther;
                szdwExpOther.Load();
            }
        }

        //显隐其他信息组
        var otherInfoValidators = new Array();
        function FnExpOther() {
            var arrValidators = otherInfoValidators;
            $.each(arrValidators, function (i, item) {
                $(item.panel).css({ "display": "none" });
                item.showing = false;
            });

            var g = $("#otherInfoGroup");
            $(g).slideToggle(300, null, function () {
                SetValidatorsPosition(arrValidators);
                InfoGroupScroll(g);
            });
        }
        //#endregion 其他信息显隐

        //#region 其他信息组
        function SetOtherInfoGroup() {
            var p = $("#otherInfoGroup");
            var w = bodyWidth;
            $(p).css({ "position": "relative" }).outerWidth(w);
        }
        //#endregion 其他信息组

        //#region 婚否
        var szdwMaritalStatus = null;
        function LoadSzdwMaritalStatus() {
            if (!szdwMaritalStatus) {
                var p = "relative";
                var x = 0;
                var y = 0;
                var w = 80;
                var h = 26;
                szdwMaritalStatus = new SzdwOnOff(p, x, y, w, h);
                szdwMaritalStatus.namingContainer = $("#maritalPanel");
                szdwMaritalStatus.onOff = true;
                szdwMaritalStatus.onText = "未婚";
                szdwMaritalStatus.offText = "已婚";
                szdwMaritalStatus.backColorOn = parent.themeColor ? parent.themeColor : parent.parent.themeColor;
                szdwMaritalStatus.fnClickCallBack = GetMaritalStatus;
                szdwMaritalStatus.Load();
                maritalStatus = Number(szdwMaritalStatus.value);
            }
        }

        //获取婚否值
        function GetMaritalStatus() {
            if (maritalStatus) maritalStatus = Number(szdwMaritalStatus.value);
        }
        //#endregion 婚否

        //#endregion 人员其他信息

        //#region 组标题通用点击事件

        //标题点击事件
        function InfoTitleClick(objSzdwOnOff, arrValidators) {
            if (objSzdwOnOff.onOff) {
                //收起
                var isValid = GetValidation(arrValidators);
                objSzdwOnOff.allowClickEvent = isValid;
                if (isValid) {
                    objSzdwOnOff.Click();
                }
            } else {
                //展开
                objSzdwOnOff.Click();

            }
        }
        //#endregion 组标题通用点击事件

        //#region 滚动组到完全可视位置
        function InfoGroupScroll(objGroup) {
            var g = objGroup;
            var p = $("#InsertPanel");
            var ph = $(p).height();
            var y = $(g).offset().top;
            var h = $(g).outerHeight();
            var oh = h - (ph - y);
            oh = oh > ph ? ph : oh;
            var st = $(p).scrollTop() + oh;
            $(p).animate({ scrollTop: st }, 300);
        }
        //#endregion 滚动组到完全可视位置

        //#endregion 信息分组

        //#region 下拉框

        //#region 加载下拉框 
        function BindDropDownLists() {
            //绑定下拉框到目标控件
            BindDdlDepartment();
            BindDdlEducation();
            BindDdlPosition();
            BindDdlNation();
        }
        //#endregion 加载下拉框 

        //#region 单位列表下拉框 
        //绑定
        function BindDdlDepartment() {

            var requestUrl = "../Department/XuserHandler.ashx";

            //单位下拉框
            var paramJson = { XuserId: xuserId, MethodName: "GetDepartmentListByXuserId" };
            var paramDdlDep = {
            	requestUrl: requestUrl,
            	paramJson: paramJson,
            	fnInitial: InitialDdlDepartment,
            	maxHeight: maxHeight
            };
            $("#ddlDepartment").dropDownList(paramDdlDep);
        }

        //下拉框初始化设置
        function InitialDdlDepartment(szdwDdl) {
            szdwDdl.hasSearchBox = 1;
            szdwDdl.namingContainer = $("#InsertPanel");
            szdwDdl.fnItemClick = function () {
                var v = $(szdwDdl.targetControl).data("validator");
                if (v) {
                    $(v.panel).css({ "display": "none" });
                }
            };
        }
        //#endregion 单位列表下拉框

        //#region 民族下拉框
        function BindDdlNation() {

            var requestUrl = "../Employee/NationHandler.ashx";

            //单位下拉框
            var paramJson = { MethodName: "GetNationNameList" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: paramJson, fnInitial: InitialDdlNation, maxHeight: maxHeight };
            $("#ddlNation").dropDownList(paramDdlDep);
            $("#ddlNation").val("汉族");
            $("#ddlNation").data("value", "1");
        }

        function InitialDdlNation(szdwDdl) {
            szdwDdl.namingContainer = $("#InsertPanel");
            szdwDdl.hasSearchBox = true;
        }
        //#endregion

        //#region 职务下拉框
        //绑定下拉框到目标控件
        function BindDdlPosition() {

            var requestUrl = "../Employee/PositionHandler.ashx";

            //单位下拉框
            var paramJson = { MethodName: "GetPositionNameList" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: paramJson, fnInitial: InitialDdlPosition, maxHeight: maxHeight };
            $("#ddlPosition").dropDownList(paramDdlDep);
        }

        //通用下拉框初始化设置
        function InitialDdlPosition(szdwDdl) {
            szdwDdl.namingContainer = $("#InsertPanel");
        }
        //#endregion 职务下拉框

        //#region 学历下拉框
        //绑定下拉框到目标控件
        function BindDdlEducation() {
            var requestUrl = "../Employee/EducationHandler.ashx";

            //单位下拉框
            var paramJson = { MethodName: "GetEducationNameList" };
            var paramDdlDep = { requestUrl: requestUrl, paramJson: paramJson, fnInitial: InitialDdlEducation, maxHeight: maxHeight };
            $("#ddlEducation").dropDownList(paramDdlDep);
        }

        //通用下拉框初始化设置
        function InitialDdlEducation(szdwDdl) {
            szdwDdl.namingContainer = $("#InsertPanel");
        }
        //#endregion 学历下拉框

        //#endregion 下拉框    

        //#region 设置日期
        function SetDate() {
            var d = $("#txtDate");
            $(d).val(new Date().format("yyyy-MM-dd"));
            $(d).datePicker({ relateControl: $("#btnDate"), namingContainer: $("#InsertPanel") });
        }

        //#endregion 设置日期

        //#region 验证

        //#region 加载验证
        function LoadValidaor() {
            var wt = 3;

            //#region 基本信息验证
            var ncBsc = $("#basicInfoGroup");
            $("#txtName").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncBsc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { required: true, existence: true };
                    szdwCtrl.existenceRequestUrl = "../Employee/EmployeeHandler.ashx";
                    szdwCtrl.existenceRequestMethodName = "IsExistedByName";
                    szdwCtrl.existenceParamName = "name";
                    szdwCtrl.submitControl = $("#btnSave");
                    basicInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtPinYin").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncBsc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { required: true, pinyin: true, existence: true };
                    szdwCtrl.existenceRequestUrl = "../Employee/EmployeeHandler.ashx";
                    szdwCtrl.existenceRequestMethodName = "IsExistedByPinYin";
                    szdwCtrl.existenceParamName = "pinYin";
                    szdwCtrl.submitControl = $("#btnSave");
                    basicInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtSimplePinYin").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncBsc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { pinyin: true };
                    basicInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtIDNumber").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncBsc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { idCard: true };
                    basicInfoValidators.push(szdwCtrl);
                }
            });
            //#endregion 基本信息验证

            //#region 组织信息验证
            var ncOrg = $("#organizationInfoGroup");

            $("#ddlDepartment").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncOrg;
                    szdwCtrl.offsetMode = 0;
                    orgInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtDate").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncOrg;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { required:false, date: true };
                    orgInfoValidators.push(szdwCtrl);
                }
            });
            //#endregion 组织信息验证

            //#region 联络信息验证
            var ncCtc = $("#contactInfoGroup");
            $("#txtMobile").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncCtc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { required: false, mobile: true };
                    contactInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtOfficePhone").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncCtc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { number: true };
                    contactInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtEmail").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncCtc;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { email: true };
                    contactInfoValidators.push(szdwCtrl);
                }
            });
            //#endregion 联络信息验证

            //#region 家庭信息验证
            var ncFml = $("#familyInfoGroup");
            $("#txtTel").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncFml;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { number: true };
                    familyInfoValidators.push(szdwCtrl);
                }
            });

            $("#txtEmergencyTel").szdwValidate({
                widthType: wt,
                fnInitial: function (szdwCtrl) {
                    szdwCtrl.namingContainer = ncFml;
                    szdwCtrl.offsetMode = 0;
                    szdwCtrl.ruleJson = { number: true };
                    familyInfoValidators.push(szdwCtrl);
                }
            });
            //#endregion 家庭信息验证        
        }
        //#endregion 家在验证

        //#region 重设组内验证器位置
        function SetValidatorsPosition(arrValidators) {
            $.each(arrValidators, function (i, item) {
                var t = item.targetControl;
                $(t).trigger("blur");
                var isValid = $(t).data("isValid");
                if (!isValid) {
                    item.SetPosition();
                    item.Show();
                }
            });
        }
        //#endregion 重设组内验证器位置

        //#region 获取组验证结果
        function GetValidation(arrValidators) {
            var isValid = true;
            $.each(arrValidators, function (i, item) {
                var t = item.targetControl;
                $(t).trigger("blur");
                isValid = isValid && $(t).data("isValid");
            });

            return isValid;
        }
        //#endregion 获取组验证结果

        //#endregion 验证 

        //#endregion 录入面板

        //#region 按钮面板

        //#region 设置按钮面板
        function SetButtonPanel() {
            var p = $("#buttonPanel");
            var w = bodyWidth;
            var h = btnPanelHeight;
            var x = 0;
            var y = bodyHeight - h - 2;
            $(p).css({ "position": "relative", "left": x, "top": y, "border-top": "0px solid #444444", "padding": "5px 10px 0px 5px" });
            $(p).outerWidth(w).outerHeight(h);

            //按钮事件绑定
            ButtonHandler();
        }
        //#endregion 设置按钮面板 

        //#region 按钮事件
        function ButtonHandler() {
            //获取弹窗
            var pw = parent.document.body.popupWindow;
            var szdwGv = parent.szdwGv;

            $("#btnSave").click(function () {
                //验证  
                var isValid = GetValidResult();

                //验证通过写入数据
                if (isValid) {

                    //显示操作信息
                    SzdwCommon.showOperateInfoPanel(parent.opInfoPanel, parent.CreateOperateInfoPanel, "正在添加记录…");

                    //写入数据
                    //#region 参数
                    var IsIE8 = navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion.match(/8./i) == "8.";
                    var departmentId = $("#ddlDepartment").data("value");
                    var positionId = $("#ddlPosition").data("value");
                    var nationId = $("#ddlNation").data("value");

                    var educationId = $("#ddlEducation").data("value");
                    var name = $.trim($("#txtName").val());
                    var pinYin = $.trim($("#txtPinYin").val());
                    var simplePinYin = $.trim($("#txtSimplePinYin").val());
                    var idNumber = $.trim($("#txtIDNumber").val());
                    var mobile = $.trim($("#txtMobile").val());
                    var officePhone = $.trim($("#txtOfficePhone").val());
                    var email = $.trim($("#txtEmail").val());
                    var tel = $.trim($("#txtTel").val());
                    var emergencyMan = $.trim($("#txtEmergencyMan").val());
                    var emergencyTel = $.trim($("#txtEmergencyTel").val());
                    var address = $.trim($("#txtAddress").val());

                    var date = IsIE8 ? $("#txtDate").val().replace("-", "/") : $("#txtDate").val();
                    var memo = $.trim($("#txtMemo").val());
                    var creatorId = xuserId;
                    var isCreateAccount = $("#chkAccount").prop("checked")?1:0;
                    //#endregion 参数

                    var objDataBind = szdwGv;
                    var requestUrl = "EmployeeHandler.ashx";
                    var paramJson = { departmentId: departmentId, educationId: educationId, positionId: positionId, nationId: nationId, sex: sex, maritalStatus: maritalStatus, address: address, name: name, pinYin: pinYin, simplePinYin: simplePinYin, idNumber: idNumber, mobile: mobile,
                        officePhone: officePhone, email: email, tel: tel, emergencyMan: emergencyMan, emergencyTel: emergencyTel, companyTime: date, memo: memo, creatorId: creatorId, MethodName: "InsertEmployee"
                    };
                    SzdwAjaxDataOperate.ajaxInsert(null, requestUrl, paramJson, InsertCallBack);
                }
            });

            $("#btnCancel").click(function () {
                pw.Hide();
            });
        }

        //获取验证结果
        function GetValidResult() {
            var basicValid = GetValidation(basicInfoValidators);
            if (!basicValid && !szdwExpBasic.onOff) {
                szdwExpBasic.Click();
            }

            var orgValid = GetValidation(orgInfoValidators);
            if (!orgValid && !szdwExpOrganization.onOff) {
                szdwExpOrganization.Click();
            }

            var contactValid = GetValidation(contactInfoValidators);
            if (!contactValid && !szdwExpContact.onOff) {
                szdwExpContact.Click();
            }

            var familyValid = GetValidation(familyInfoValidators);
            if (!familyValid && !szdwExpFamily.onOff) {
                szdwExpFamily.Click();
            }

            var otherValid = GetValidation(otherInfoValidators);
            if (!otherValid && !szdwExpOther.onOff) {
                szdwExpOther.Click();
            }

            var isValid = basicValid && orgValid && contactValid && familyValid && otherValid;

            return isValid;
        }



        //#endregion 按钮事件      

        //#region 回调函数
        function InsertCallBack() {
            SzdwCommon.hideOperateInfoPanel(parent.opInfoPanel, "添加记录成功");
            parent.RefreshDataAfterInsert();

            if ($("#chkClose").prop("checked")) {
                $("#btnCancel").trigger("click");
            }
            else {
                ClearInsertPanelData();
            }
        }

        //#endregion 回调函数  

        //#region 清空插入面板数据

        function ClearInsertPanelData() {
            $("#txtName").val("");
            $("#txtPinYin").val("");
            $("#txtSimplePinYin").val("");
            $("#txtIDNumber").val("");
            $("#ddlDepartment").data("value", 0).val("");

            $("#ddlPosition").data("value", 0).val("");
            $("#txtMobile").val("");
            $("#txtOfficePhone").val("");
            $("#txtEmail").val("");

            $("#txtTel").val("");
            $("#txtAddress").val("");
            $("#txtEmergencyMan").val("");
            $("#txtEmergencyTel").val("");

            $("#ddlEducation").data("value", 0).val("");
            $("#txtMemo").val("");

        }

        //#endregion 清空插入面板数据

        //#endregion 按钮面板   

    </script>
</body>
</html>
