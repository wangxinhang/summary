<!DOCTYPE html>
<html>
<head>
    <title>设备列表</title>
    <link href="../Styles/Page.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />
    <link href="../Styles/ScrollBar.css" rel="stylesheet" type="text/css" />
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwAjaxDataOperate.js" type="text/javascript"></script>
    <script src="../SzdwControls/domCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwGridView.js" type="text/javascript"></script>
    <link href="../SzdwControls/SzdwGridView.css" rel="stylesheet" type="text/css" />
    <script src="../SzdwControls/SzdwPagination.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwButton.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwDropDownList.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwButtonGroup.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwPopupWindow.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwInfoPanel.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../Scripts/CommonJScript.js" type="text/javascript"></script>
    <script src="../Scripts/myparm.js" type="text/javascript"></script>
</head>
<body>
    <div id="dataPanel"></div>
    <script type="text/javascript">
        //#region 全局变量
        var xuserId, xmenuId, permission = null; //用户及权限：json格式
        //#endregion 全局变量

        $(document).ready(function () {
            //获取用户Id和MenuId
            //var paramJson = SzdwCommon.getJsonParm();
            //xuserId = paramJson.xuserId;
            //xmenuId = paramJson.xmenuId;
            //permission = SzdwCommon.getPermission(paramJson.permissionJsonList);
            xuserId = parent.xuserId;
            bodyWidth = $(document.body).width();
            bodyHeight = $(document.body).height();
            //设置结果面板
            SetDataPanel();
            //窗口调整大小
            $(window).resize(function () {
                bodyWidth = $(document.body).width();
                bodyHeight = $(document.body).height();
                var dw = bodyWidth - ml * 2;
                var dh = bodyHeight - mt * 2;
                if (szdwGv) {
                    $("#dataPanel").outerWidth(dw).outerHeight(dh);
                    szdwGv.Resize(dw, dh);
                }
            });
        });

        function SetDataPanel() {
            $("#dataPanel")
                .css({ "position": "relative", "left": ml, "top": mt })
                .outerWidth(bodyWidth-ml*2)
                .outerHeight(bodyHeight - mt*2);
            //初始加载结果数据
            GetQueryResult();
        }

        //#region 获取查询参数
        function GetParamJson() {
            var paramJson = { xuserId: xuserId };
            return paramJson;
        }

        //查询按钮事件
        function GetQueryResult() {
            //设置结果面板相关属性
            var c = $("#dataPanel");
            var position = "absolute";
            var x = 0;
            var y = 0;
            var w = c.width();
            var h = c.height();
            //创建Gridview并绑定数据
            CreateGridView(c, position, x, y, w, h);
        }

        var szdwGv = null;
        function CreateGridView(namingContainer, position, x, y, width, height) {
            if (szdwGv == null || typeof (szdwGv) == "undefined") {
                //创建SzdwGridViewt实例
                szdwGv = new SzdwGridView(position, x, y, width, height);
                szdwGv.namingContainer = namingContainer;
                szdwGv.fnInitial = InitialGridview(szdwGv);
            }
            //异步加载数据
            if (szdwGv.pagination != null) {
                szdwGv.pagination.ResetBar();
            }
            var paramJson = GetParamJson();
            paramJson["pageSize"] = szdwGv.pageSize;
            paramJson["MethodName"] = "GetExpireEquipmentForGV";
            szdwGv.requestUrl = "../Analyze/AnalyzeHandler.ashx";
            szdwGv.paramJson = paramJson;
            szdwGv.DataBind();
        }

        function InitialGridview(szdwGv) {
            //个性样式设置
            szdwGv.dataPanelCssJson = { "background-color": "White", "border": "1px solid Silver" };
            szdwGv.paginationCssJson = { "background-color": "White", "font-family": "微软雅黑", "font-size": "small", "border": "1px solid Silver", "border-top": "0px" };

            //dataPanel设置
            szdwGv.hasPagination = false;
            szdwGv.hasSumRow = false;
            szdwGv.hasButtonPanel = true;
            szdwGv.hasOperationColumn = false;
            szdwGv.permission.modifyPermission = false;
            szdwGv.permission.deletePermission = false;
            szdwGv.freezeCols = 3;
            szdwGv.scrollKeeingType = 1;
            //head设置
            szdwGv.headCssName = "gridHead2";
            szdwGv.headHeight = 30;
            szdwGv.fieldJsonData = [{ "Field": "RowNumber", "Text": "序号", "Width": 50 },
                                    { "Field": "MineName", "Text": "煤矿", "Width":240, "OrderField": "MineName" },
                                    { "Field": "", "Text": "预警状态", "Width": 70, "FnControlColumn": CreateSignControl },
									{ "Field": "ModelNumber", "Text": "设备编号", "Width": 80, "OrderField": "ModelNumber" },
                                    { "Field": "EquipmentType", "Text": "设备类型", "Width": 80, "OrderField": "EquipmentType" },
                                    { "Field": "UsingLocation", "Text": "安装地点", "Width": 100, "OrderField": "UsingLocation" },
                                    { "Field": "ValidEndDate", "Text": "有效期止", "Width": 80, "OrderField": "ValidEndDate", "FieldType": szdwGv.fieldType.Date }];
            szdwGv.cellCssJson = {
                "MineName": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "ModelNumber": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "EquipmentType": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "UsingLocation": { "text-align": "left", "font-size": "small", "font-family": "宋体" },
                "ValidEndDate": { "text-align": "center", "font-size": "small", "font-family": "宋体" },
                "Memo": { "text-align": "left", "font-size": "small", "font-family": "宋体" }
            };
        }

        function CreateSignControl(jsonList, cell) {
            var rowIndex = $(cell).data("rowIndex");
            var jsData = jsonList[rowIndex];
            var c = document.createElement("div");
            $(c).css({ "height": 25, "line-height": "25px", "float": "center", "text-align": "center" });
            var s = "";
            switch(jsData.RunStatus){
                case -1:
                    s = "<span style=\"color:red;\"><b>逾期</b></span>";
                    break;
                case 0:
                    s = "<span style=\"color:green;\">正常</span>"
                    break;
                case 1:
                    s = "<span style=\"color:orange;\">一级预警</span>"
                    break
                case 2:
                    s = "<span style=\"color:orange;\">二级预警</span>"
                    break
                case 3:
                    s = "<span style=\"color:orange;\">三级预警</span>"
                    break
            }
            $(c).html(s);
            return c;
        }
        //#endregion
    </script>
</body>
</html>
