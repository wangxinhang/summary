<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
</head>
<body style="background:url(../Image/backImg/SiteBackground.png)">
    <form id="mainForm" action=""> 
        <div id="welcome"></div> 
        <div id="naviPanel">
            <div id="paicha"></div>
            <div id="zhenggai"></div>
            <div id="jiancha"></div>
        </div>
    </form>
    <script type="text/javascript">
        //#region 全局常量
        var themeColor = "#406406";m=15;  //"#406406";017BBA;4C7608
        var xuserId, xuser, xuserName, department, departmentId;
        var welcomeHeight = 130;tileCountX = 3;tileWidth = 330; tileHeight = 180;
        //#endregion 全局常量

        /*#region 网页加载时事件*/
        $(document).ready(function () {
            //获取用户信息
            GetXuserName();

            //设置welcome
            SetWelcome();

            //设置导航面板
            SetNaviPanel();

            //载入导航tile     
            LoadNaviTile();

            //重设尺寸
            $(window).resize(function () {
                ResizeControls();
            });
        });
        //#endregion 网页加载时事件
        
        //#region 重设尺寸
        function ResizeControls() {
            SetWelcome();
            SetNaviPanel();
        }
        //#endregion 重设尺寸

        //#region 用户及权限
        function GetXuserName() {
            xuserName = parent.xuserName;
        }

        //获取用户Id
        function GetXuserId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xuserId;

        }

        //获取菜单ID:xMenuId
        function GetXmenuId() {
            return $.parseJSON(SzdwCommon.getUrlParam("paramJson")).xmenuId;
        }

        //获取权限
        function GetPermission() {
            var jsonList = $.parseJSON(SzdwCommon.getUrlParam("paramJson")).permissionJsonList;
            return SzdwCommon.getPermission(jsonList);
        }
        //#endregion 用户及权限

        //#region 设置welcome
        function SetWelcome() {
            var bw = $(document).width();
            var bh = $(document).height();
            var x = bw * 0.1;
            var y = m;
            var w = bw * 0.8;//bw - m * 2;
            var h = welcomeHeight;
            var wl = $("#welcome");
            var cssJson = { "position": "absolute", "font-family": "微软雅黑", "font-size": "30pt", "color": "RGB(0,100,0)", "left": x, "top": y, "text-align": "center", "line-height": h + "px" };
            var text = xuserName + "，欢迎您登入系统";
            $(wl).css(cssJson).outerWidth(w).outerHeight(h).text(text);
        }
        //#endregion 设置welcome

        //#region 导航面板

        //#region 设置导航面板
        function SetNaviPanel() {
            var bw = $(document).width();
            var bh = $(document).height();
            var wl = $("#welcome");
            var w_wl = $(wl).outerWidth();
            var h_wl = $(wl).outerHeight();
            var x_wl = $(wl).offset().left;
            var y_wl = $(wl).offset().top;

            var np = $("#naviPanel");
            var sw = tileCountX * (tileWidth + m * 2);
            var w = Math.min(bw - m * 2, sw);
            var h = bw - y - m;
            var sx = (bw - sw) / 2;
            var x = Math.max(m,sx);
            var y = y_wl + h_wl + m;
            var cssJson = { "position": "absolute", "left": x, "top": y, "line-height": h + "px" };
            $(np).css(cssJson).outerWidth(w);//.outerHeight(h);"background-color": "red", 
            
            //SzdwCommon.showTestInfo("bw:" + bw + " ;sw:" + sw + " ;w_wl:" + w_wl + " ;w:" + w + " ;x:" + x);
        }
        //#endregion 设置导航面板
        
        //#region 导航tile
        function LoadNaviTile() {
            var np = $("#naviPanel");
            var x = 0;
            var y = m;
            var w = tileWidth;
            var h = tileHeight;
            var tJson = { width: w, height: h, opacity: 0.3 };
            var btnWidth = 100;
            var btnHeight = 70;
            var szdwMenu = parent.szdwMenu;

            //#region 排查导航Tile  
            var pcdPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("排查单")).accessPermission;
            var pcPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("排查结果")).accessPermission; 
            var pcFlag = pcdPermission || pcPermission;
            if (pcFlag) {
                tJson["icon"] = "../Image/Navi/paicha32b.png";
                tJson["text"] = "隐患排查";
                tJson["backgroundColor"] = themeColor;
                var pc = CreateNaviTile(tJson);
                $(np).append(pc);
                $(pc).fadeIn(300);

                var pcJsonList = new Array();
                if (pcdPermission) {
                    pcJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/print32w.png", text: "排查单", title: "打印排查单", color: "white", fontSize: "12pt", fnClick: PrintPaicha } });
                }
                if (pcPermission) {
                    pcJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/Edit32w.png", text: "排查结果", title: "填写排查结果", color: "white", fontSize: "12pt", fnClick: Paicha } });
                }

                $(pc).mouseover(function () {
                    if (!this.btnList) {
                        this.btnList = CreateNaviButtonPanel(pcJsonList, this);
                    }
                    $(this.btnList).fadeIn(200);
                }).mouseleave(function () {
                    $(this.btnList).fadeOut(200);
                });
            }
            //#endregion 排查导航Tile

            //#region 整改导航Tile
            var zgPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("隐患处理")).accessPermission;
            var zhcxPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("整改查询")).accessPermission;
            var zgFlag = zgPermission || zhcxPermission;

            if (zgFlag) {
                tJson["icon"] = "../Image/Navi/chuli32b.png";
                tJson["text"] = "隐患处理";
                tJson["backgroundColor"] = "Red";
                var zg = CreateNaviTile(tJson);
                $(np).append(zg);
                $(zg).fadeIn(900);

                var zgJsonList = new Array();
                if (zgPermission) {
                    zgJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/zhenggai32w.png", text: "隐患处理", title: "隐患整改处理", color: "white", fontSize: "12pt", fnClick: YinhuanZhenggai} });
                }
                if (zhcxPermission) {
                    zgJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/search32w.png", text: "整改查询", title: "查询隐患整改情况", color: "white", fontSize: "12pt", fnClick: ZhenggaiChaxun } });
                }

                //var zgJsonList = [{ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/zhenggai32w.png", text: "隐患整改", title: "隐患整改处理", color: "white", fontSize: "12pt", fnClick: YinhuanZhenggai } },
                //   { btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/search32w.png", text: "整改查询", title: "查询隐患整改情况", color: "white", fontSize: "12pt", fnClick: ZhenggaiChaxun } }
                //];
                $(zg).mouseover(function () {
                    if (!this.btnList) {
                        this.btnList = CreateNaviButtonPanel(zgJsonList, this);
                    }
                    $(this.btnList).fadeIn(200);
                }).mouseleave(function () {
                    $(this.btnList).fadeOut(200);
                });
            }
            //#endregion 整改导航Tile

            //#region 检查导航Tile
            var jcdPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("检查单")).accessPermission;
            var jcjgPermission = SzdwCommon.getPermission(szdwMenu.GetPermissionListByText("检查结果")).accessPermission;
            var jcFlag = jcdPermission || jcjgPermission;

            if (jcFlag) {
                tJson["icon"] = "../Image/Navi/jiancha36b.png";
                tJson["text"] = "检查";
                tJson["backgroundColor"] = "Blue";
                var jc = CreateNaviTile(tJson);
                $(np).append(jc);
                $(jc).fadeIn(1800);

                var jcJsonList = new Array();
                if (jcdPermission) {
                    jcJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/print32w.png", text: "检查单", title: "打印检查单", color: "white", fontSize: "12pt", fnClick: PrintJiancha } });
                }
                if (jcjgPermission) {
                    jcJsonList.push({ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/search32w.png", text: "检查结果", title: "录入查询检查结果", color: "white", fontSize: "12pt", fnClick: Jiancha } });
                }
                //var jcJsonList = [{ btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/print32w.png", text: "检查单", title: "打印检查单", color: "white", fontSize: "12pt", fnClick: PrintJiancha } },
                //   { btnJson: { width: btnWidth, height: btnHeight, icon: "../Image/Navi/search32w.png", text: "检查结果", title: "录入查询检查结果", color: "white", fontSize: "12pt", fnClick: Jiancha } }
                //];
                $(jc).mouseover(function () {
                    if (!this.btnList) {
                        this.btnList = CreateNaviButtonPanel(jcJsonList, this);
                    }
                    $(this.btnList).fadeIn(200);
                }).mouseleave(function () {
                    $(this.btnList).fadeOut(200);
                });
            }
            //#endregion 检查导航Tile

            //#region 统计导航Tile
            //tJson["icon"] = "../Image/Navi/subtotal36b.png";
            //tJson["text"] = "统计分析";
            ////tJson["backgroundColor"] = "Purple";
            //var tj = CreateNaviTile(tJson);
            //$(np).append(tj);
            //#endregion 统计导航Tile

        }
        //创建导航tile
        function CreateNaviTile(tJson) {
            //#region 参数解析
            if (!tJson) var tJson = {};
            var w = tJson.width == undefined ? 0 : tJson.width;
            var h = tJson.height == undefined ? 0 : tJson.height;
            var color = tJson.color == undefined ? "black" : tJson.color;
            var backColor = tJson.backgroundColor == undefined ? "silver" : tJson.backgroundColor
            var opacity = tJson.opacity == undefined ? 0.5 : tJson.opacity;
            var icon = tJson.icon == undefined ? null : tJson.icon;
            var text = tJson.text == undefined ? null : tJson.text;             

            //#endregion 参数解析

            //导航sign
            var sh = 74;
            var y = (h - sh) / 2;
            var sJson = { x: 0, y: y, width: w, height: sh, icon: icon, text: text, color: color };
            var s = CreateButton(sJson);

            //导航Tile
            var t = document.createElement("div");
            var cssJson = {
                "position": "relative", "float": "left", "margin": m, "font-family": "微软雅黑", "color": color, "font-size": "16pt", "font-weight": "lighter",
                "text-align": "center","line-height": h + "px", "cursor": "pointer","display":"none"
            };
            SzdwCommon.SetOpacity(t, backColor, opacity);
            $(t).css(cssJson).outerWidth(w).outerHeight(h).append(s);
            
            //#region 导航Tile事件
            $(t).mouseover(function () {
                $(s).fadeOut(200);
            }).mouseleave(function () {
                $(s).fadeIn(200);
            });
            //#endregion 导航Tile事件

            return t;
        }

        //创建导航tile的按钮面板
        //btnJsonList = [{ btnJson: { width: 100, height: 80, icon: "../Image/Navi/print32w.png", text: "打印排查单", color: "white", fontSize: "12pt" } },
        //        { btnJson: { width: 100, height: 80, icon: "../Image/Navi/Edit32w.png", text: "排查结果", color: "white", fontSize: "12pt" } }
        //];
        function CreateNaviButtonPanel(btnJsonList, nameContainer) {
            //创建btnList
            var c = nameContainer;
            var btnList = CreateButtonList(btnJsonList);
            var blw = $(btnList).data("width");
            var blh = $(btnList).data("height");            
            var cw = $(c).outerWidth();
            var ch = $(c).outerHeight();
            var x = (cw - blw) / 2;
            var y = (ch - blh) / 2;
            $(btnList).css({ "position": "relative", "left": x, "top": y });

            //创建btnList的panel
            var btnPanel = document.createElement("div");
            var cssJson = { width: cw, height:ch, "display": "none" };
            $(btnPanel).css(cssJson).append(btnList).appendTo(c);
            SzdwCommon.SetOpacity(btnPanel, "black", 0.6);

            return btnPanel;
        }

        //创建按钮
        function CreateButtonList(jsonList) {            
            if (jsonList) {
                var btnList = document.createElement("div");
                var w = 0;h = 0;
                var len = jsonList.length;
                var bx = 0;
                for (var i = 0; i < len; i++) {
                    var btnJson = jsonList[i].btnJson;
                    var btn = CreateButton(btnJson);
                    if (i > 0) {
                        bx += btnJson.width;
                    }
                    w += btnJson.width;
                    h = btnJson.height;
                    $(btn).css({ "left": bx });
                    $(btnList).append(btn);
                }
                $(btnList).data("width", w).data("height", h);
                return btnList;
            } else {
                return null;
            }
        }

        //创建按钮
        function CreateButton(oJson) {
            //#region 参数解析
            if (!oJson) var oJson = {};
            var x = oJson.x == undefined ? 0 : oJson.x;
            var y = oJson.y == undefined ? 0 : oJson.y;
            var w = oJson.width == undefined ? 0 : oJson.width;
            var h = oJson.height == undefined ? 0 : oJson.height/2;
            var color = oJson.color == undefined ? "black" : oJson.color;
            var icon = oJson.icon == undefined ? null : oJson.icon;
            var text = oJson.text == undefined ? null : oJson.text;
            var title = oJson.title == undefined ? text : oJson.title;
            var fontSize = oJson.fontSize == undefined ? null : oJson.fontSize;
            var fnClick = oJson.fnClick == undefined ? null : oJson.fnClick;

            //#endregion 参数解析

            //#region 按钮

            //外框
            var btn = document.createElement("div");
            var bCssJson = { "position": "absolute", "left": x, "top": y, "color": color };
            if (fontSize) { bCssJson["font-size"] = fontSize;}
            $(btn).css(bCssJson).attr("title",title);

            //图标
            if (icon) {
                var itemImg = document.createElement("div");
                var backImg = "url(" + icon + ") no-repeat center";
                $(itemImg).css({ "background": backImg }).outerWidth(w).outerHeight(h).appendTo(btn);
            }

            //文字              
            if (text) {
                var itemText = document.createElement("div");
                $(itemText).css({ "line-height": h + "px", "text-align": "center" }).outerWidth(w).outerHeight(h);
                $(itemText).text(text).appendTo(btn);
            }
            //#endregion 按钮

            //#region 事件
            if (fnClick) {
                $(btn).click(function (e) {
                    fnClick();
                    e.stopPropagation();
                });
            }
            //#endregion 事件

            return btn;
        }


        //#endregion 导航tile

        //#region 导航按钮事件
        //打印排查单
        function PrintPaicha() {
            var oJson= { "text": "排查单" };           
            var menu = parent.szdwMenu;
            menu.ExecItemClick(oJson);
        }

        //填写排查结果
        function Paicha() {
            var menu = parent.szdwMenu;
            var oJson = { "text": "排查结果" };
            menu.ExecItemClick(oJson);
        }

        //隐患整改
        function YinhuanZhenggai() {
            var oJson = { "text": "隐患处理" };
            var menu = parent.szdwMenu;
            menu.ExecItemClick(oJson);
        }

        //整改查询
        function ZhenggaiChaxun() {
            var menu = parent.szdwMenu;
            var oJson = { "text": "整改查询"};
            menu.ExecItemClick(oJson);
        }

        //检查单
        function PrintJiancha() {
            var oJson = { "text": "检查单" };
            var menu = parent.szdwMenu;
            menu.ExecItemClick(oJson);
        }

        //检查查询
        function Jiancha() {
            var menu = parent.szdwMenu;
            var oJson = { "text": "检查结果" };
            menu.ExecItemClick(oJson);
        }
        //#endregion 导航按钮事件

        //#endregion 导航面板
    </script>
</body>
</html>
