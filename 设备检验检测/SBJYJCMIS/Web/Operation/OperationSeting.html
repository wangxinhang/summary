<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title></title>
    <script src="../Scripts/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCommon.js" type="text/javascript"></script>
    <script src="../SzdwControls/SzdwCheckBoxList.js" type="text/javascript"></script>
    <link href="../Styles/Query.css" rel="stylesheet" type="text/css" />
    <script src="../SzdwControls/SzdwAjaxDataOperate.js" type="text/javascript"></script>
    
    <style type="text/css">
        input::-ms-clear{display:none;} 
    </style>
</head>
<body> 
    <form action="">
        <div id="InsertPanel"></div>
        <div id="buttonPanel">
            <input id="btnCancel" type="button" value="取消" class="cancelButtonW" style="float:right;"/>
            <input id="btnSave" type="button" value=" 保存" class="keyButton2" style="float:right"/>
        </div>          
    </form>
      
    <script type="text/javascript">
        //#region 全局变量
        var permission = null;
        var bodyWidth = $(document).width();
        var bodyHeight = $(document).height();
        var ml = 10; mt = 10; btnHeight = 32;
        var panelWidth = bodyWidth - ml * 2;
        //#endregion 全局变量

        //#region 网页加载 

        //#region 初始加载
        $(document).ready(function () {

            //设置录入面板
            SetInsertPanel();

            //设置按钮面板
            SetButtonPanel();

            //按钮事件绑定
            ButtonHandler();

            //窗口调整大小
            $(window).resize(function () {
                RePositionControls();
            });
        });

        function RePositionControls() {
            var pw = parent.document.body.popupWindow;
            if (pw) {
                var p = $("#buttonPanel");
                var ph = pw.pagePanelHeight;
                var h = $(p).outerHeight();
                var x = 0;
                var y = ph - h - 2;
                $(p).css({ "left": x, "top": y });
            }
        }
        //#endregion 初始加载

        //#endregion 网页加载  

        //#region 设置录入面板
        var szdwChkl = null;
        function SetInsertPanel() {
            var p = $("#InsertPanel");
            var x = ml;
            var y = mt;
            var w = panelWidth;
            $(p).addClass("queryPanel");
            $(p).css({ "left": x, "top": y, "min-width": 0 });
            $(p).outerWidth(w);

            var jsonList = $.parseJSON(SzdwCommon.getQueryString("paramJson"));
            if (!szdwChkl) {
                szdwChkl = CreateCheckBoxList(jsonList, p);
                $(p).append(szdwChkl);
            }
        }
        //#endregion 设置录入面板

        //#region 操作列表
        //创建统计页面框架
        function CreateCheckBoxList(jsonList, namingContainer) {
            //位置宽高属性
            var c = namingContainer;
            var position = "relative";
            var cw = $(c).width();
            var ch = $(c).height();
            var w = cw;
            var h = 0;
            var x = 0;
            var y = 0;

            //创建CheckBoxList
            var szdwChkl = new SzdwCheckBoxList(position, x, y, w, h);
            szdwChkl.namingContainer = c;
            szdwChkl.backgroundColor = "transparent";
            szdwChkl.direction = 1;
            szdwChkl.opacity = 1;
            szdwChkl.allowLeastOne = false;
            szdwChkl.itemCssJson["opacity"] = 1;
            szdwChkl.itemHoverCssJson = { "background-color": "#888888", "opacity": 0.8 };
            szdwChkl.panelCssJson["float"] = "left";
            szdwChkl.hasTitle = false;
            szdwChkl.fieldText = "FlowOperation";
            szdwChkl.fieldValue = "Permissable";
            szdwChkl.jsonList = jsonList;
            szdwChkl.Load();

            return szdwChkl;
        }
        //#endregion 操作列表 

        //#region 设置按钮面板
        function SetButtonPanel() {
            var p = $("#buttonPanel");
            var w = bodyWidth;
            var h = 35;
            var x = 0;
            var y = bodyHeight - h - 2;
            $(p).css({ "position": "relative", "left": x, "top": y, "border-top": "0px solid #E2E2E2", "padding": "5px 10px 5px 5px" });
            $(p).outerWidth(w);
            $(p).outerHeight(h);
        }
        //#endregion 设置按钮面板        

        //#region 按钮事件
        function ButtonHandler() {
            $("#btnSave").click(function () {
                //更新选择后的可用权限
                var chklJsonList = szdwChkl.jsonList;
                var chklArray = szdwChkl.checkBoxArray;
                var opList = new Array();
                var rdJson = null;
                for (i = 0; i < chklJsonList.length; i++) {
                    var checked = $(chklArray[i]).prop("checked");
                    if (chklJsonList[i]["Permissable"] != checked) {
                        chklJsonList[i]["Permissable"] = checked;
                        opList.push(chklJsonList[i]);
                    }
                }
                var objDataBind = parent.szdwGv;
                var requestUrl = "FlowNodeOperationRelationProcess.ashx";
                var paramJson = null;
                var operationList = $.toJSONString(opList);
                paramJson = { jsonList: operationList, MethodName: "FlowNodeOperationRelationInsert" }
                SzdwAjaxDataOperate.ajaxDataOperateIgnoreReturnValue(objDataBind, requestUrl, paramJson, OperateCallBack);
            });

            $("#btnCancel").click(function () {
                parent.document.body.popupWindow.Hide();
                parent.szdwGvRp.RecoverSelectedRow();
            });
        }

        function OperateCallBack() {
            parent.document.body.popupWindow.Hide();
            //parent.szdwGvRp.RecoverSelectedRow();
        }
        //#endregion 按钮事件        
    </script>
</body>
</html>